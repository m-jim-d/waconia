<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">
<!--
generated by Pygments <https://pygments.org/>
Copyright 2006-2025 by the Pygments team.
Licensed under the BSD license, see LICENSE for details.
-->
<html>
<head>
  <link rel='canonical' href='https://waconia.triquence.org/gleaners/rosy-mysql.html' />
  <title>rosy-mysql</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <style type="text/css">
/*
generated by Pygments <https://pygments.org/>
Copyright 2006-2025 by the Pygments team.
Licensed under the BSD license, see LICENSE for details.
*/
pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
body .hll { background-color: #49483e }
body { background: #272822; color: #F8F8F2 }
body .c { color: #959077 } /* Comment */
body .err { color: #ED007E; background-color: #1E0010 } /* Error */
body .esc { color: #F8F8F2 } /* Escape */
body .g { color: #F8F8F2 } /* Generic */
body .k { color: #66D9EF } /* Keyword */
body .l { color: #AE81FF } /* Literal */
body .n { color: #F8F8F2 } /* Name */
body .o { color: #FF4689 } /* Operator */
body .x { color: #F8F8F2 } /* Other */
body .p { color: #F8F8F2 } /* Punctuation */
body .ch { color: #959077 } /* Comment.Hashbang */
body .cm { color: #959077 } /* Comment.Multiline */
body .cp { color: #959077 } /* Comment.Preproc */
body .cpf { color: #959077 } /* Comment.PreprocFile */
body .c1 { color: #959077 } /* Comment.Single */
body .cs { color: #959077 } /* Comment.Special */
body .gd { color: #FF4689 } /* Generic.Deleted */
body .ge { color: #F8F8F2; font-style: italic } /* Generic.Emph */
body .ges { color: #F8F8F2; font-weight: bold; font-style: italic } /* Generic.EmphStrong */
body .gr { color: #F8F8F2 } /* Generic.Error */
body .gh { color: #F8F8F2 } /* Generic.Heading */
body .gi { color: #A6E22E } /* Generic.Inserted */
body .go { color: #66D9EF } /* Generic.Output */
body .gp { color: #FF4689; font-weight: bold } /* Generic.Prompt */
body .gs { color: #F8F8F2; font-weight: bold } /* Generic.Strong */
body .gu { color: #959077 } /* Generic.Subheading */
body .gt { color: #F8F8F2 } /* Generic.Traceback */
body .kc { color: #66D9EF } /* Keyword.Constant */
body .kd { color: #66D9EF } /* Keyword.Declaration */
body .kn { color: #FF4689 } /* Keyword.Namespace */
body .kp { color: #66D9EF } /* Keyword.Pseudo */
body .kr { color: #66D9EF } /* Keyword.Reserved */
body .kt { color: #66D9EF } /* Keyword.Type */
body .ld { color: #E6DB74 } /* Literal.Date */
body .m { color: #AE81FF } /* Literal.Number */
body .s { color: #E6DB74 } /* Literal.String */
body .na { color: #A6E22E } /* Name.Attribute */
body .nb { color: #F8F8F2 } /* Name.Builtin */
body .nc { color: #A6E22E } /* Name.Class */
body .no { color: #66D9EF } /* Name.Constant */
body .nd { color: #A6E22E } /* Name.Decorator */
body .ni { color: #F8F8F2 } /* Name.Entity */
body .ne { color: #A6E22E } /* Name.Exception */
body .nf { color: #A6E22E } /* Name.Function */
body .nl { color: #F8F8F2 } /* Name.Label */
body .nn { color: #F8F8F2 } /* Name.Namespace */
body .nx { color: #A6E22E } /* Name.Other */
body .py { color: #F8F8F2 } /* Name.Property */
body .nt { color: #FF4689 } /* Name.Tag */
body .nv { color: #F8F8F2 } /* Name.Variable */
body .ow { color: #FF4689 } /* Operator.Word */
body .pm { color: #F8F8F2 } /* Punctuation.Marker */
body .w { color: #F8F8F2 } /* Text.Whitespace */
body .mb { color: #AE81FF } /* Literal.Number.Bin */
body .mf { color: #AE81FF } /* Literal.Number.Float */
body .mh { color: #AE81FF } /* Literal.Number.Hex */
body .mi { color: #AE81FF } /* Literal.Number.Integer */
body .mo { color: #AE81FF } /* Literal.Number.Oct */
body .sa { color: #E6DB74 } /* Literal.String.Affix */
body .sb { color: #E6DB74 } /* Literal.String.Backtick */
body .sc { color: #E6DB74 } /* Literal.String.Char */
body .dl { color: #E6DB74 } /* Literal.String.Delimiter */
body .sd { color: #E6DB74 } /* Literal.String.Doc */
body .s2 { color: #E6DB74 } /* Literal.String.Double */
body .se { color: #AE81FF } /* Literal.String.Escape */
body .sh { color: #E6DB74 } /* Literal.String.Heredoc */
body .si { color: #E6DB74 } /* Literal.String.Interpol */
body .sx { color: #E6DB74 } /* Literal.String.Other */
body .sr { color: #E6DB74 } /* Literal.String.Regex */
body .s1 { color: #E6DB74 } /* Literal.String.Single */
body .ss { color: #E6DB74 } /* Literal.String.Symbol */
body .bp { color: #F8F8F2 } /* Name.Builtin.Pseudo */
body .fm { color: #A6E22E } /* Name.Function.Magic */
body .vc { color: #F8F8F2 } /* Name.Variable.Class */
body .vg { color: #F8F8F2 } /* Name.Variable.Global */
body .vi { color: #F8F8F2 } /* Name.Variable.Instance */
body .vm { color: #F8F8F2 } /* Name.Variable.Magic */
body .il { color: #AE81FF } /* Literal.Number.Integer.Long */

  </style>
</head>
<body>
<h2></h2>

<div class="highlight"><pre><span></span><span class="o">&lt;%</span><span class="err">@</span><span class="w"> </span><span class="nx">Language</span><span class="o">=</span><span class="nx">VBScript</span><span class="w"> </span><span class="o">%&gt;</span>

<span class="o">&lt;%</span><span class="w"> </span>
<span class="nx">Option</span><span class="w"> </span><span class="nx">Explicit</span>

<span class="s1">&#39; Author: Jim Miller</span>
<span class="s1">&#39;</span><span class="w"> </span><span class="nx">MySQL</span><span class="w"> </span><span class="nx">Version</span><span class="o">:</span><span class="w"> </span><span class="mf">1.0</span>
<span class="s1">&#39; May 17, 2025</span>

<span class="s1">&#39;</span><span class="w"> </span><span class="nx">Buffer</span><span class="w"> </span><span class="nx">and</span><span class="w"> </span><span class="nx">release</span><span class="w"> </span><span class="nx">all</span><span class="w"> </span><span class="nx">at</span><span class="w"> </span><span class="nx">once</span><span class="p">...</span>
<span class="nx">Response</span><span class="p">.</span><span class="nx">Buffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">True</span><span class="w"> </span>
<span class="o">%&gt;</span>

<span class="c">&lt;!--</span><span class="w"> </span><span class="n">#include</span><span class="w"> </span><span class="nx">file</span><span class="o">=</span><span class="s2">&quot;common/headers.asp&quot;</span><span class="w"> </span><span class="o">--&gt;</span>
<span class="c">&lt;!--</span><span class="w"> </span><span class="n">#include</span><span class="w"> </span><span class="nx">file</span><span class="o">=</span><span class="s2">&quot;common/utilities.asp&quot;</span><span class="w"> </span><span class="o">--&gt;</span>

<span class="o">&lt;%</span>
<span class="s1">&#39;==========================================</span>
<span class="s1">&#39;</span><span class="w"> </span><span class="nx">Common</span><span class="w"> </span><span class="nx">Variables</span><span class="w"> </span><span class="p">(</span><span class="nx">globals</span><span class="p">)</span>
<span class="s1">&#39;==========================================</span>

<span class="s1">Const adStateOpen = 1</span>
<span class="s1">Const adStateClosed = 0</span>
<span class="s1">Const adOpenStatic = 3</span>
<span class="s1">Const adLockBatchOptimistic = 4</span>
<span class="s1">Const adLockReadOnly = 1</span>
<span class="s1">Const adCmdText = 1</span>

<span class="s1">Dim dicTraceIO</span>

<span class="s1">Dim DBConnection, rstDate, rstStations, rstLatestDate, rstMostRecent, rstTimeZone</span>

<span class="s1">&#39;</span><span class="w"> </span><span class="nx">Arrays</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">sensor</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="nx">values</span>
<span class="nx">Dim</span><span class="w"> </span><span class="nx">dataPoints_WindDirection</span><span class="p">,</span><span class="w"> </span><span class="nx">dataPoints_WindGust</span><span class="p">,</span><span class="w"> </span><span class="nx">dataPoints_WindSpeed</span>
<span class="nx">Dim</span><span class="w"> </span><span class="nx">dataPoints_Pressure</span>
<span class="nx">Dim</span><span class="w"> </span><span class="nx">dataPoints_TempAvg</span><span class="p">,</span><span class="w"> </span><span class="nx">dataPoints_TempMax</span><span class="p">,</span><span class="w"> </span><span class="nx">dataPoints_TempMin</span><span class="p">,</span><span class="w"> </span><span class="nx">dataPoints_DewPoint</span>
<span class="nx">Dim</span><span class="w"> </span><span class="nx">dataPoints_DeltaP_trace_A</span><span class="p">,</span><span class="w"> </span><span class="nx">dataPoints_DeltaP_trace_B</span>

<span class="nx">Dim</span><span class="w"> </span><span class="nx">dteMaxTimeStamp</span>
<span class="nx">Dim</span><span class="w"> </span><span class="nx">strSQL</span><span class="p">,</span><span class="w"> </span><span class="nx">strNameForPlot</span><span class="p">,</span><span class="w"> </span><span class="nx">intMaxGust</span><span class="p">,</span><span class="w"> </span><span class="nx">intNonPlottingHeight</span><span class="p">,</span><span class="w"> </span><span class="nx">intTempDiffScalingThreshold</span>
<span class="nx">Dim</span><span class="w"> </span><span class="nx">strTitle</span><span class="p">,</span><span class="w"> </span><span class="nx">strHGSL</span>
<span class="nx">Dim</span><span class="w"> </span><span class="nx">sglTempMax</span><span class="p">,</span><span class="w"> </span><span class="nx">sglTempMin</span><span class="p">,</span><span class="w"> </span><span class="nx">sglPressureMin</span><span class="p">,</span><span class="w"> </span><span class="nx">sglPressureMax</span><span class="p">,</span><span class="w"> </span><span class="nx">sglTempRange</span><span class="p">,</span><span class="w"> </span><span class="nx">sglDewPointMin</span><span class="p">,</span><span class="w"> </span><span class="nx">blnDewPointData</span>
<span class="nx">Dim</span><span class="w"> </span><span class="nx">strMRTime</span><span class="p">,</span><span class="w"> </span><span class="nx">strMRWindAvg</span><span class="p">,</span><span class="w"> </span><span class="nx">strMRWindMax</span><span class="p">,</span><span class="w"> </span><span class="nx">strMRWindDir</span><span class="p">,</span><span class="w"> </span><span class="nx">strMRTemp</span><span class="p">,</span><span class="w"> </span><span class="nx">strMRPressure</span><span class="p">,</span><span class="w"> </span><span class="nx">strMRDewPoint</span>
<span class="nx">Dim</span><span class="w"> </span><span class="nx">Chart</span>
<span class="nx">Dim</span><span class="w"> </span><span class="nx">Filename</span>
<span class="nx">Dim</span><span class="w"> </span><span class="nx">WeatherTypes</span><span class="p">,</span><span class="w"> </span><span class="nx">WeatherTypes_URL</span><span class="p">,</span><span class="w"> </span><span class="nx">WeatherTypes_count</span><span class="p">,</span><span class="w"> </span><span class="nx">DaysChoices</span>
<span class="nx">Dim</span><span class="w"> </span><span class="nx">dteStartDateTime</span><span class="p">,</span><span class="w"> </span><span class="nx">dteEndDateTime</span><span class="p">,</span><span class="w"> </span><span class="nx">dteStartDate_forLabels</span>
<span class="nx">Dim</span><span class="w"> </span><span class="nx">TimeLabels</span><span class="p">,</span><span class="w"> </span><span class="nx">TheHour</span><span class="p">,</span><span class="w"> </span><span class="nx">DayValue</span><span class="p">,</span><span class="w"> </span><span class="nx">DaysDecSinceRef</span><span class="p">,</span><span class="w"> </span><span class="nx">intHour</span>
<span class="nx">Dim</span><span class="w"> </span><span class="nx">blnMinMax</span><span class="p">,</span><span class="w"> </span><span class="nx">blnFoundSomeData</span>
<span class="nx">Dim</span><span class="w"> </span><span class="nx">intTheColor</span>
<span class="nx">Dim</span><span class="w"> </span><span class="nx">strRandomNameString</span><span class="p">,</span><span class="w"> </span><span class="nx">strFileName2</span><span class="p">,</span><span class="w"> </span><span class="nx">strOrderBy</span><span class="p">,</span><span class="w"> </span><span class="nx">intColorScaleFactor</span>
<span class="nx">Dim</span><span class="w"> </span><span class="nx">fsoObject</span><span class="p">,</span><span class="w"> </span><span class="nx">fdrObject</span><span class="p">,</span><span class="w"> </span><span class="nx">filObject</span>
<span class="nx">Dim</span><span class="w"> </span><span class="nx">intFileCount</span>
<span class="nx">Dim</span><span class="w"> </span><span class="nx">blnDayLightSavingsTime</span>
<span class="nx">Dim</span><span class="w"> </span><span class="nx">dtePostedDate</span><span class="p">,</span><span class="w"> </span><span class="nx">blnPostedDate_default</span>
<span class="nx">Dim</span><span class="w"> </span><span class="nx">intJ</span><span class="p">,</span><span class="w"> </span><span class="nx">intDays</span><span class="p">,</span><span class="w"> </span><span class="nx">intXLabels</span><span class="p">,</span><span class="w"> </span><span class="nx">dblDaysIncrement</span><span class="p">,</span><span class="w"> </span><span class="nx">dblDaysFraction</span><span class="p">,</span><span class="w"> </span><span class="nx">dblFractionalPart</span><span class="p">,</span><span class="w"> </span><span class="nx">dteLabelDate</span><span class="p">,</span><span class="w"> </span><span class="nx">intLabelsPerDay</span>
<span class="nx">Dim</span><span class="w"> </span><span class="nx">dblDPmin</span><span class="p">,</span><span class="w"> </span><span class="nx">dblDPmax</span>
<span class="nx">Dim</span><span class="w"> </span><span class="nx">dblWindNormFactor</span><span class="p">,</span><span class="w"> </span><span class="nx">intRed</span><span class="p">,</span><span class="w"> </span><span class="nx">intGreen</span><span class="p">,</span><span class="w"> </span><span class="nx">intBlue</span><span class="p">,</span><span class="w"> </span><span class="nx">intGray</span>
<span class="nx">Dim</span><span class="w"> </span><span class="nx">strRegionURL</span><span class="p">,</span><span class="w"> </span><span class="nx">strSensorType</span><span class="p">,</span><span class="w"> </span><span class="nx">strInitializeTimer</span><span class="p">,</span><span class="w"> </span><span class="nx">strLocation</span>
<span class="nx">Dim</span><span class="w"> </span><span class="nx">serverTimeArray</span><span class="p">,</span><span class="w"> </span><span class="nx">serverTime</span><span class="p">,</span><span class="w"> </span><span class="nx">intPixelBottomShift</span><span class="p">,</span><span class="w"> </span><span class="nx">intPixelRightShift</span><span class="p">,</span><span class="w"> </span><span class="nx">intPixelRightShift_tweak</span>
<span class="nx">Dim</span><span class="w"> </span><span class="nx">strShowImages_command</span>
<span class="nx">Dim</span><span class="w"> </span><span class="nx">vrtReturnFromMINMAX</span>
<span class="nx">Dim</span><span class="w"> </span><span class="nx">intMinutes</span><span class="p">,</span><span class="w"> </span><span class="nx">dblFiveMinutes</span><span class="p">,</span><span class="w"> </span><span class="nx">intSeconds_FromMinutes</span><span class="p">,</span><span class="w"> </span><span class="nx">intSeconds_FromSeconds</span><span class="p">,</span><span class="w"> </span><span class="nx">intDelay_to_5min</span>
<span class="nx">Dim</span><span class="w"> </span><span class="nx">strButtonLabel</span>
<span class="nx">Dim</span><span class="w"> </span><span class="nx">strTimeZone</span><span class="p">,</span><span class="w"> </span><span class="nx">dicTZ</span>
<span class="nx">Dim</span><span class="w"> </span><span class="nx">arrRegions</span><span class="p">,</span><span class="w"> </span><span class="nx">strRegionValue</span><span class="p">,</span><span class="w"> </span><span class="nx">strRegion</span><span class="p">,</span><span class="w"> </span><span class="nx">strRegionState</span>
<span class="nx">Dim</span><span class="w"> </span><span class="nx">strDebugMessage</span>
<span class="nx">Dim</span><span class="w"> </span><span class="nx">dteNowTime</span><span class="p">,</span><span class="w"> </span><span class="nx">dteStartDateTime_forQuery</span>
<span class="nx">Dim</span><span class="w"> </span><span class="nx">str24Hrs_state</span><span class="p">,</span><span class="w"> </span><span class="nx">strTimer_state</span><span class="p">,</span><span class="w"> </span><span class="nx">strTimer_value</span><span class="p">,</span><span class="w"> </span><span class="nx">strRA_state</span>

<span class="nx">Dim</span><span class="w"> </span><span class="nx">useRunningAverage</span><span class="p">,</span><span class="w"> </span><span class="nx">RA_x</span><span class="p">,</span><span class="w"> </span><span class="nx">RA_y</span>

<span class="nb">Set</span><span class="w"> </span><span class="nx">DBConnection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Nothing</span>

<span class="s1">&#39;=============================================================================================</span>
<span class="s1">&#39;</span><span class="w"> </span><span class="nx">Functions</span><span class="w"> </span><span class="nx">and</span><span class="w"> </span><span class="nx">Subroutines</span>
<span class="s1">&#39;=============================================================================================</span>


<span class="s1">&#39;</span><span class="w"> </span><span class="nx">Add</span><span class="w"> </span><span class="nx">error</span><span class="w"> </span><span class="nx">logging</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">that</span><span class="w"> </span><span class="nx">writes</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">page</span>
<span class="nx">Sub</span><span class="w"> </span><span class="nx">LogError</span><span class="p">(</span><span class="nx">location</span><span class="p">)</span>
<span class="w">    </span><span class="nx">If</span><span class="w"> </span><span class="nx">Err</span><span class="p">.</span><span class="nb">Number</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">        </span><span class="nx">Response</span><span class="p">.</span><span class="nx">Write</span><span class="w"> </span><span class="s2">&quot;&lt;div style=&#39;color:red; background-color:#ffe0e0; padding:5px; margin:5px; border:1px solid red&#39;&gt;&quot;</span>
<span class="w">        </span><span class="nx">Response</span><span class="p">.</span><span class="nx">Write</span><span class="w"> </span><span class="s2">&quot;&lt;strong&gt;ERROR at &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">location</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;:&lt;/strong&gt; &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">Err</span><span class="p">.</span><span class="nb">Number</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot; - &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">Err</span><span class="p">.</span><span class="nx">Description</span>
<span class="w">        </span><span class="nx">Response</span><span class="p">.</span><span class="nx">Write</span><span class="w"> </span><span class="s2">&quot;&lt;/div&gt;&quot;</span>
<span class="w">        </span><span class="nx">Err</span><span class="p">.</span><span class="nx">Clear</span><span class="w"> </span><span class="s1">&#39; Clear the error so we can continue</span>
<span class="s1">    End If</span>
<span class="s1">End Sub</span>


<span class="s1">Sub RBC(strTheString)</span>
<span class="s1">   Response.Write strTheString &amp; &quot;&lt;BR&gt;&quot; &amp; Chr(10)</span>
<span class="s1">End Sub</span>

<span class="s1">&#39;</span><span class="nx">Alias</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">RBC</span>
<span class="nx">Sub</span><span class="w"> </span><span class="nx">RWBR</span><span class="p">(</span><span class="nx">strTheString</span><span class="p">)</span>
<span class="w">   </span><span class="nx">RBC</span><span class="w"> </span><span class="nx">strTheString</span>
<span class="nx">End</span><span class="w"> </span><span class="nx">Sub</span>

<span class="nx">Sub</span><span class="w"> </span><span class="nx">RC</span><span class="p">(</span><span class="nx">strTheString</span><span class="p">)</span>
<span class="w">   </span><span class="nx">Response</span><span class="p">.</span><span class="nx">Write</span><span class="w"> </span><span class="nx">strTheString</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">Chr</span><span class="p">(</span><span class="mf">10</span><span class="p">)</span>
<span class="nx">End</span><span class="w"> </span><span class="nx">Sub</span>

<span class="s1">&#39;This will not make a new line in the HTML file.</span>
<span class="s1">Sub RW(strTheString)</span>
<span class="s1">   Response.Write strTheString</span>
<span class="s1">End Sub</span>


<span class="s1">Sub MinMax(ByVal dblNewValue, ByRef dblMax, ByRef dblMin)</span>
<span class="s1">   If (dblNewValue &gt; dblMax) Then</span>
<span class="s1">      dblMax = dblNewValue</span>
<span class="s1">   End If</span>
<span class="s1">   </span>
<span class="s1">   If (dblNewValue &lt; dblMin) Then</span>
<span class="s1">      dblMin = dblNewValue</span>
<span class="s1">   End If</span>
<span class="s1">End Sub</span>


<span class="s1">Function DaylightTime(strMRTime)</span>
<span class="s1">   Dim strMRTime_DLS</span>
<span class="s1">   If (strMRTime &lt;&gt; &quot;-&quot;) Then</span>
<span class="s1">      If (DaylightSavingsTime(strMRTime)) Then</span>
<span class="s1">         strMRTime_DLS = DateAdd(&quot;h&quot;,1,strMRTime)</span>
<span class="s1">      Else</span>
<span class="s1">         strMRTime_DLS = strMRTime</span>
<span class="s1">      End If</span>
<span class="s1">   Else</span>
<span class="s1">      strMRTime_DLS = &quot;-&quot;</span>
<span class="s1">   End If</span>
<span class="s1">   DaylightTime = strMRTime_DLS</span>
<span class="s1">End Function</span>


<span class="s1">Function AgeOfData(strMRTime)</span>
<span class="s1">   If (strMRTime &lt;&gt; &quot;-&quot;) Then</span>
<span class="s1">      &#39;</span><span class="w"> </span><span class="nx">The</span><span class="w"> </span><span class="nx">following</span><span class="w"> </span><span class="nx">line</span><span class="w"> </span><span class="nx">works</span><span class="w"> </span><span class="nx">mainly</span><span class="w"> </span><span class="nx">because</span><span class="w"> </span><span class="nx">strMRTime</span><span class="w"> </span><span class="nx">is</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">standard</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="w"> </span><span class="nx">So</span><span class="w"> </span><span class="nx">no</span><span class="w"> </span><span class="nx">problem</span><span class="w"> </span><span class="kd">with</span><span class="w"> </span><span class="nx">HI</span><span class="p">.</span>
<span class="w">      </span><span class="nx">AgeOfData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">DateDiff</span><span class="p">(</span><span class="s2">&quot;n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">DaylightTime</span><span class="p">(</span><span class="nx">strMRTime</span><span class="p">),</span><span class="w"> </span><span class="nx">Now</span><span class="p">())</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">60</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dicTZ</span><span class="p">.</span><span class="nx">item</span><span class="p">(</span><span class="nx">strTimeZone</span><span class="p">)</span>
<span class="w">   </span><span class="nx">Else</span>
<span class="w">      </span><span class="nx">AgeOfData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;-&quot;</span>
<span class="w">   </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>
<span class="nx">End</span><span class="w"> </span><span class="nb">Function</span>


<span class="nb">Function</span><span class="w"> </span><span class="nx">DaysDecSinceRefF</span><span class="p">(</span><span class="nx">byVal</span><span class="w"> </span><span class="nx">timeMDY</span><span class="p">,</span><span class="w"> </span><span class="nx">byVal</span><span class="w"> </span><span class="nx">timeHr</span><span class="p">,</span><span class="w"> </span><span class="nx">byVal</span><span class="w"> </span><span class="nx">timeMin</span><span class="p">)</span>
<span class="w">   </span><span class="nx">Dim</span><span class="w"> </span><span class="nx">dteRecordTime</span>
<span class="w">   </span><span class="nx">Dim</span><span class="w"> </span><span class="nx">TheMin</span>
<span class="w"> </span>
<span class="w">   </span><span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">intDays</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">      </span><span class="nx">TheMin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">timeMin</span>
<span class="w">   </span><span class="nx">Else</span>
<span class="w">      </span><span class="nx">TheMin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span>
<span class="w">   </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>
<span class="w"> </span>
<span class="w">   </span><span class="nx">dteRecordTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">timeMDY</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">TimeSerial</span><span class="p">(</span><span class="nx">timeHr</span><span class="p">,</span><span class="w"> </span><span class="nx">TheMin</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w">   </span>
<span class="w">   </span>
<span class="w">   </span><span class="nx">DaysDecSinceRefF</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">CDbl</span><span class="p">(</span><span class="w">  </span><span class="nx">DateDiff</span><span class="p">(</span><span class="s2">&quot;n&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">dteStartDateTime</span><span class="p">,</span><span class="w"> </span><span class="nx">dteRecordTime</span><span class="p">)</span><span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">1440</span><span class="w"> </span>
<span class="nx">End</span><span class="w"> </span><span class="nb">Function</span>


<span class="nb">Function</span><span class="w"> </span><span class="nx">DaysDec</span><span class="p">(</span><span class="w"> </span><span class="nx">dteTime</span><span class="p">)</span>
<span class="w">   </span><span class="s1">&#39; 86400 = 24.0*60.0*60.0  (Seconds in a day).</span>
<span class="s1">   &#39;</span><span class="w"> </span><span class="nx">Decimal</span><span class="w"> </span><span class="nx">day</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">measured</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">midnight</span><span class="w"> </span><span class="nx">start</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span>
<span class="w">   </span><span class="nx">DaysDec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">CDbl</span><span class="p">(</span><span class="w"> </span><span class="nx">DateDiff</span><span class="p">(</span><span class="s2">&quot;s&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">dteStartDateTime</span><span class="p">,</span><span class="w"> </span><span class="nx">dteTime</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">86400.0</span>
<span class="nx">End</span><span class="w"> </span><span class="nb">Function</span>


<span class="nb">Function</span><span class="w"> </span><span class="nx">DirectionLabel</span><span class="w"> </span><span class="p">(</span><span class="nx">WindDeg</span><span class="p">)</span>
<span class="w">   </span><span class="nx">If</span><span class="w">     </span><span class="p">(</span><span class="nx">WindDeg</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">345</span><span class="w"> </span><span class="nx">And</span><span class="w"> </span><span class="nx">WindDeg</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">360</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span><span class="w"> </span>
<span class="w">      </span><span class="nx">DirectionLabel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;North&quot;</span>
<span class="w">   </span><span class="nx">ElseIf</span><span class="w"> </span><span class="p">(</span><span class="nx">WindDeg</span><span class="w"> </span><span class="o">&gt;</span><span class="w">   </span><span class="mf">0</span><span class="w"> </span><span class="nx">And</span><span class="w"> </span><span class="nx">WindDeg</span><span class="w"> </span><span class="o">&lt;=</span><span class="w">  </span><span class="mf">15</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span><span class="w"> </span>
<span class="w">      </span><span class="nx">DirectionLabel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;North&quot;</span>
<span class="w">   </span>
<span class="w">   </span><span class="nx">ElseIf</span><span class="w"> </span><span class="p">(</span><span class="nx">WindDeg</span><span class="w"> </span><span class="o">&gt;</span><span class="w">  </span><span class="mf">15</span><span class="w"> </span><span class="nx">And</span><span class="w"> </span><span class="nx">WindDeg</span><span class="w"> </span><span class="o">&lt;=</span><span class="w">  </span><span class="mf">45</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span><span class="w"> </span>
<span class="w">      </span><span class="nx">DirectionLabel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;NNE&quot;</span>
<span class="w">   </span><span class="nx">ElseIf</span><span class="w"> </span><span class="p">(</span><span class="nx">WindDeg</span><span class="w"> </span><span class="o">&gt;</span><span class="w">  </span><span class="mf">45</span><span class="w"> </span><span class="nx">And</span><span class="w"> </span><span class="nx">WindDeg</span><span class="w"> </span><span class="o">&lt;=</span><span class="w">  </span><span class="mf">75</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span><span class="w"> </span>
<span class="w">      </span><span class="nx">DirectionLabel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;ENE&quot;</span>
<span class="w">   </span><span class="nx">ElseIf</span><span class="w"> </span><span class="p">(</span><span class="nx">WindDeg</span><span class="w"> </span><span class="o">&gt;</span><span class="w">  </span><span class="mf">75</span><span class="w"> </span><span class="nx">And</span><span class="w"> </span><span class="nx">WindDeg</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">105</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span><span class="w"> </span>
<span class="w">      </span><span class="nx">DirectionLabel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;East&quot;</span>
<span class="w">   </span><span class="nx">ElseIf</span><span class="w"> </span><span class="p">(</span><span class="nx">WindDeg</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">105</span><span class="w"> </span><span class="nx">And</span><span class="w"> </span><span class="nx">WindDeg</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">135</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span><span class="w"> </span>
<span class="w">      </span><span class="nx">DirectionLabel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;ESE&quot;</span>
<span class="w">   </span><span class="nx">ElseIf</span><span class="w"> </span><span class="p">(</span><span class="nx">WindDeg</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">135</span><span class="w"> </span><span class="nx">And</span><span class="w"> </span><span class="nx">WindDeg</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">165</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span><span class="w"> </span>
<span class="w">      </span><span class="nx">DirectionLabel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;SSE&quot;</span>
<span class="w">   </span><span class="nx">ElseIf</span><span class="w"> </span><span class="p">(</span><span class="nx">WindDeg</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">165</span><span class="w"> </span><span class="nx">And</span><span class="w"> </span><span class="nx">WindDeg</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">195</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span><span class="w"> </span>
<span class="w">      </span><span class="nx">DirectionLabel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;South&quot;</span>
<span class="w">   </span><span class="nx">ElseIf</span><span class="w"> </span><span class="p">(</span><span class="nx">WindDeg</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">195</span><span class="w"> </span><span class="nx">And</span><span class="w"> </span><span class="nx">WindDeg</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">225</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span><span class="w"> </span>
<span class="w">      </span><span class="nx">DirectionLabel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;SSW&quot;</span>
<span class="w">   </span><span class="nx">ElseIf</span><span class="w"> </span><span class="p">(</span><span class="nx">WindDeg</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">225</span><span class="w"> </span><span class="nx">And</span><span class="w"> </span><span class="nx">WindDeg</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">255</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span><span class="w"> </span>
<span class="w">      </span><span class="nx">DirectionLabel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;WSW&quot;</span>
<span class="w">   </span><span class="nx">ElseIf</span><span class="w"> </span><span class="p">(</span><span class="nx">WindDeg</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">255</span><span class="w"> </span><span class="nx">And</span><span class="w"> </span><span class="nx">WindDeg</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">285</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span><span class="w"> </span>
<span class="w">      </span><span class="nx">DirectionLabel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;West&quot;</span>
<span class="w">   </span><span class="nx">ElseIf</span><span class="w"> </span><span class="p">(</span><span class="nx">WindDeg</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">285</span><span class="w"> </span><span class="nx">And</span><span class="w"> </span><span class="nx">WindDeg</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">315</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span><span class="w"> </span>
<span class="w">      </span><span class="nx">DirectionLabel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;WNW&quot;</span>
<span class="w">   </span><span class="nx">ElseIf</span><span class="w"> </span><span class="p">(</span><span class="nx">WindDeg</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">315</span><span class="w"> </span><span class="nx">And</span><span class="w"> </span><span class="nx">WindDeg</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">345</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span><span class="w"> </span>
<span class="w">      </span><span class="nx">DirectionLabel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;NNW&quot;</span>
<span class="w">   </span><span class="nx">Else</span><span class="w"> </span>
<span class="w">      </span><span class="nx">DirectionLabel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Var&quot;</span>
<span class="w">   </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>
<span class="w">   </span>
<span class="w">   </span><span class="nx">If</span><span class="w">     </span><span class="p">(</span><span class="nx">WindDeg</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">45</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span><span class="w"> </span>
<span class="w">      </span><span class="nx">DirectionLabel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;NE&quot;</span>
<span class="w">   </span><span class="nx">ElseIf</span><span class="w"> </span><span class="p">(</span><span class="nx">WindDeg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">135</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">      </span><span class="nx">DirectionLabel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;SE&quot;</span>
<span class="w">   </span><span class="nx">ElseIf</span><span class="w"> </span><span class="p">(</span><span class="nx">WindDeg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">225</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">      </span><span class="nx">DirectionLabel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;SW&quot;</span>
<span class="w">   </span><span class="nx">ElseIf</span><span class="w"> </span><span class="p">(</span><span class="nx">WindDeg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">315</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">      </span><span class="nx">DirectionLabel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;NW&quot;</span>
<span class="w">   </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>
<span class="nx">End</span><span class="w"> </span><span class="nb">Function</span>


<span class="nx">Sub</span><span class="w"> </span><span class="nx">AddHorizontalLine_gray</span><span class="p">(</span><span class="nx">intLineWidth</span><span class="p">,</span><span class="w"> </span><span class="nx">intColor</span><span class="p">,</span><span class="w"> </span><span class="nx">dblYvalue</span><span class="p">)</span>
<span class="w">   </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">AddSeries</span><span class="w"> </span><span class="p">(</span><span class="mf">5</span><span class="p">)</span>
<span class="w">   </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">linewidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">intLineWidth</span>
<span class="w">   </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">SeriesInLegend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span>

<span class="w">   </span><span class="s1">&#39; The -0.009 extends the line all the way to the left edge of the 1-day chart.</span>
<span class="s1">   MyChartAddXY      -0.009, dblYvalue, &quot;&quot;, RGB(intColor, intColor, intColor)  </span>
<span class="s1">   MyChartAddXY intDays+1.0, dblYvalue, &quot;&quot;, RGB(intColor, intColor, intColor)</span>
<span class="s1">End Sub</span>


<span class="s1">Sub AddHorizontalLine_color(intLineWidth, intRed, intGreen, intBlue, dblYvalue)</span>
<span class="s1">   Chart.AddSeries (5)</span>
<span class="s1">   Chart.linewidth = intLineWidth</span>
<span class="s1">   Chart.SeriesInLegend = false</span>

<span class="s1">   MyChartAddXY      -0.009, dblYvalue, &quot;&quot;, RGB(intRed, intGreen, intBlue)  </span>
<span class="s1">   MyChartAddXY intDays+1.0, dblYvalue, &quot;&quot;, RGB(intRed, intGreen, intBlue)</span>
<span class="s1">End Sub</span>


<span class="s1">Sub MyChartAddXY(dblXValue, dblYValue, strXLabel, intColor)</span>
<span class="s1">   &#39;</span><span class="w"> </span><span class="nx">Feed</span><span class="w"> </span><span class="nx">only</span><span class="w"> </span><span class="nx">NON</span><span class="o">-</span><span class="nx">Null</span><span class="w"> </span><span class="nx">values</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">AddXY</span><span class="w"> </span><span class="nx">method</span><span class="p">.</span>
<span class="w">   </span><span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">Not</span><span class="w"> </span><span class="nx">IsNull</span><span class="p">(</span><span class="nx">dblYValue</span><span class="p">))</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">      </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">AddXY</span><span class="w"> </span><span class="nx">dblXValue</span><span class="p">,</span><span class="w"> </span><span class="nx">dblYValue</span><span class="p">,</span><span class="w"> </span><span class="nx">strXLabel</span><span class="p">,</span><span class="w"> </span><span class="nx">intColor</span>
<span class="w">   </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>
<span class="nx">End</span><span class="w"> </span><span class="nx">Sub</span>


<span class="s1">&#39; Format date for MySQL (YYYY-MM-DD HH:MM:SS)</span>
<span class="s1">Function MySQLDate(dateValue)</span>
<span class="s1">    MySQLDate = &quot;&#39;</span><span class="s2">&quot; &amp; Year(dateValue) &amp; &quot;</span><span class="o">-</span><span class="s2">&quot; &amp; _</span>
<span class="s2">                Right(&quot;</span><span class="mf">0</span><span class="s2">&quot; &amp; Month(dateValue), 2) &amp; &quot;</span><span class="o">-</span><span class="s2">&quot; &amp; _</span>
<span class="s2">                Right(&quot;</span><span class="mf">0</span><span class="s2">&quot; &amp; Day(dateValue), 2) &amp; &quot;</span><span class="w"> </span><span class="s2">&quot; &amp; _</span>
<span class="s2">                Right(&quot;</span><span class="mf">0</span><span class="s2">&quot; &amp; Hour(dateValue), 2) &amp; &quot;</span><span class="o">:</span><span class="s2">&quot; &amp; _</span>
<span class="s2">                Right(&quot;</span><span class="mf">0</span><span class="s2">&quot; &amp; Minute(dateValue), 2) &amp; &quot;</span><span class="o">:</span><span class="s2">&quot; &amp; _</span>
<span class="s2">                Right(&quot;</span><span class="mf">0</span><span class="s2">&quot; &amp; Second(dateValue), 2) &amp; &quot;</span><span class="s1">&#39;&quot;</span>
<span class="s1">End Function</span>


<span class="s1">Sub AddVerticalLine( dblXValue, intLineWidth)</span>
<span class="s1">   Dim intColor, intGray, intColor_Red, intColor_Green, intColor_Blue</span>
<span class="s1">   </span>
<span class="s1">   Chart.AddSeries (5)</span>
<span class="s1">   Chart.linewidth = intLineWidth</span>
<span class="s1">   Chart.SeriesInLegend = false</span>

<span class="s1">   intGray = 75  &#39;</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="p">(</span><span class="nx">black</span><span class="p">)</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="mf">255</span><span class="w"> </span><span class="p">(</span><span class="nx">white</span><span class="p">)</span>
<span class="w">   </span>
<span class="w">   </span><span class="nx">intColor_Red</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">intGray</span>
<span class="w">   </span><span class="nx">intColor_Green</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">intGray</span>
<span class="w">   </span><span class="nx">intColor_Blue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">intGray</span>
<span class="w">   </span>
<span class="w">   </span><span class="nx">intColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">RGB</span><span class="p">(</span><span class="nx">intColor_Red</span><span class="p">,</span><span class="w"> </span><span class="nx">intColor_Green</span><span class="p">,</span><span class="w"> </span><span class="nx">intColor_Blue</span><span class="p">)</span>
<span class="w">   </span><span class="s1">&#39;intColor = vbBlack</span>
<span class="s1">   </span>
<span class="s1">   MyChartAddXY  dblXValue, Chart.VertAxisMin, &quot;&quot;, intColor  </span>
<span class="s1">   MyChartAddXY  dblXValue, Chart.VertAxisMax, &quot;&quot;, intColor</span>
<span class="s1">End Sub</span>


<span class="s1">Function DeltaP_SQL(ByVal intDays, ByRef dicTraceIO)</span>
<span class="s1">   Dim strWestSite, strEastSite</span>
<span class="s1">   </span>
<span class="s1">   strWestSite = dicTraceIO.Item(&quot;WestSite&quot;)</span>
<span class="s1">   strEastSite = dicTraceIO.Item(&quot;EastSite&quot;)</span>

<span class="s1">   If (intDays = 1) then</span>
<span class="s1">      &#39;</span><span class="w"> </span><span class="nx">This</span><span class="w"> </span><span class="nx">query</span><span class="w"> </span><span class="nx">uses</span><span class="w"> </span><span class="nx">an</span><span class="w"> </span><span class="nx">interesting</span><span class="w"> </span><span class="nx">trick</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">accomplish</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">delta</span><span class="o">-</span><span class="nx">P</span>
<span class="w">      </span><span class="s1">&#39; calculation.  It selects all the needed data from two sites and then</span>
<span class="s1">      &#39;</span><span class="w"> </span><span class="nx">groups</span><span class="w"> </span><span class="nx">it</span><span class="w"> </span><span class="nx">by</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="w">  </span><span class="nx">It</span><span class="w"> </span><span class="nx">feeds</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">SUM</span><span class="w"> </span><span class="nx">operator</span><span class="w"> </span><span class="kd">with</span><span class="w"> </span><span class="nx">logic</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">IIF</span>
<span class="w">      </span><span class="s1">&#39; operator.  That is how the delta is calculated.  The HAVING clause</span>
<span class="s1">      &#39;</span><span class="w"> </span><span class="nx">insures</span><span class="w"> </span><span class="nx">that</span><span class="w"> </span><span class="nx">only</span><span class="w"> </span><span class="nx">groups</span><span class="w"> </span><span class="kd">with</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nx">count</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="mf">2</span><span class="w"> </span><span class="nx">are</span><span class="w"> </span><span class="nx">used</span><span class="p">.</span>
<span class="w">      </span>
<span class="w">      </span><span class="s1">&#39; old MS Access version</span>
<span class="s1">      &#39;</span><span class="nx">strSQL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;SELECT DateTimeStamp, TimeMDY, TimeHr, TimeMin, SUM(IIf([StationName]=&#39;&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">strWestSite</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;&#39;,+[Pressure],-[Pressure])) AS DeltaP &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">      </span><span class="s1">&#39;         &quot;FROM FifteenMinData &quot; &amp; _</span>
<span class="s1">      &#39;</span><span class="w">         </span><span class="s2">&quot;WHERE ((StationName) In (&#39;&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">strWestSite</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;&#39;,&#39;&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">strEastSite</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;&#39;)) AND &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">      </span><span class="s1">&#39;         &quot;      (DateTimeStamp &lt;=     &quot; &amp; MySQLDate(dteEndDateTime)    &amp; &quot;) AND &quot; &amp; _</span>
<span class="s1">      &#39;</span><span class="w">         </span><span class="s2">&quot;      (DateTimeStamp &gt;=     &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">MySQLDate</span><span class="p">(</span><span class="nx">dteStartDateTime_forQuery</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;) &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">      </span><span class="s1">&#39;         &quot;GROUP BY DateTimeStamp, TimeMDY, TimeHr, TimeMin &quot; &amp; _</span>
<span class="s1">      &#39;</span><span class="w">         </span><span class="s2">&quot;HAVING (((Count(DateTimeStamp))=2)) &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">      </span><span class="s1">&#39;         &quot;ORDER BY TimeMDY ASC, TimeHr ASC, TimeMin ASC&quot;</span>
<span class="s1">      </span>
<span class="s1">      &#39;</span><span class="w"> </span><span class="nx">MySQL</span><span class="o">-</span><span class="nx">compatible</span><span class="w"> </span><span class="nx">query</span><span class="w"> </span><span class="p">(</span><span class="nx">replacing</span><span class="w"> </span><span class="nx">IIf</span><span class="w"> </span><span class="kd">with</span><span class="w"> </span><span class="nx">CASE</span><span class="w"> </span><span class="nx">expression</span><span class="p">)</span>
<span class="w">      </span><span class="nx">strSQL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;SELECT DateTimeStamp, TimeMDY, TimeHr, TimeMin, &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">               </span><span class="s2">&quot;SUM(CASE WHEN StationName = &#39;&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">strWestSite</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;&#39; THEN Pressure ELSE -Pressure END) AS DeltaP &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">               </span><span class="s2">&quot;FROM FifteenMinData &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">               </span><span class="s2">&quot;WHERE StationName IN (&#39;&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">strWestSite</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;&#39;,&#39;&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">strEastSite</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;&#39;) AND &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">               </span><span class="s2">&quot;DateTimeStamp &lt;= &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">MySQLDate</span><span class="p">(</span><span class="nx">dteEndDateTime</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot; AND &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">               </span><span class="s2">&quot;DateTimeStamp &gt;= &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">MySQLDate</span><span class="p">(</span><span class="nx">dteStartDateTime_forQuery</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot; &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">               </span><span class="s2">&quot;GROUP BY DateTimeStamp, TimeMDY, TimeHr, TimeMin &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">               </span><span class="s2">&quot;HAVING COUNT(DISTINCT StationName) = 2 &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">               </span><span class="s2">&quot;ORDER BY TimeMDY ASC, TimeHr ASC, TimeMin ASC&quot;</span>

<span class="w">   </span><span class="nx">Else</span>
<span class="w">      </span><span class="s1">&#39; Multi-day query</span>

<span class="s1">      &#39;</span><span class="w"> </span><span class="nx">old</span><span class="w"> </span><span class="nx">MS</span><span class="w"> </span><span class="nx">Access</span><span class="w"> </span><span class="nx">version</span>
<span class="w">      </span><span class="s1">&#39;strSQL = &quot;SELECT DateTimeStamp, TimeMDY, TimeHr, TimeMin, SUM(IIf([StationName]=&#39;</span><span class="s2">&quot; &amp; strWestSite &amp; &quot;</span><span class="s1">&#39;,+[Pressure],-[Pressure])) AS DeltaP1 &quot; &amp; _</span>
<span class="s1">      &#39;</span><span class="w">         </span><span class="s2">&quot;FROM FifteenMinData &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">      </span><span class="s1">&#39;         &quot;WHERE ((StationName) In (&#39;</span><span class="s2">&quot; &amp; strWestSite &amp; &quot;</span><span class="s1">&#39;,&#39;</span><span class="s2">&quot; &amp; strEastSite &amp; &quot;</span><span class="s1">&#39;)) AND &quot; &amp; _</span>
<span class="s1">      &#39;</span><span class="w">         </span><span class="s2">&quot;      ([DateTimeStamp] &lt;=     #&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">dteEndDateTime</span><span class="w">    </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;#) AND &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">      </span><span class="s1">&#39;         &quot;      ([DateTimeStamp] &gt;=     #&quot; &amp; dteStartDateTime_forQuery &amp; &quot;#) &quot; &amp; _</span>
<span class="s1">      &#39;</span><span class="w">         </span><span class="s2">&quot;GROUP BY DateTimeStamp, TimeMDY, TimeHr, TimeMin &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">      </span><span class="s1">&#39;         &quot;HAVING (((Count(DateTimeStamp))=2)) &quot; &amp; _</span>
<span class="s1">      &#39;</span><span class="w">         </span><span class="s2">&quot;ORDER BY TimeMDY ASC, TimeHr ASC, TimeMin ASC&quot;</span><span class="w">   </span>
<span class="w">      </span><span class="s1">&#39;</span>
<span class="s1">      &#39;</span><span class="w"> </span><span class="nx">And</span><span class="w"> </span><span class="nx">now</span><span class="w"> </span><span class="nx">we</span><span class="w"> </span><span class="nx">feed</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">query</span><span class="w"> </span><span class="nx">above</span><span class="w"> </span><span class="nx">into</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">aggregation</span><span class="w"> </span><span class="nx">query</span><span class="w"> </span><span class="nx">below</span>
<span class="w">      </span><span class="s1">&#39; (another interesting SQL trick).</span>
<span class="s1">      &#39;</span>
<span class="w">      </span><span class="s1">&#39;strSQL = &quot;SELECT TimeMDY, TimeHr, AVG(DeltaP1) AS DeltaP &quot; &amp; _</span>
<span class="s1">      &#39;</span><span class="w">         </span><span class="s2">&quot;FROM (&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">strSQL</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;) &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">      </span><span class="s1">&#39;         &quot;GROUP BY TimeMDY, TimeHr &quot; &amp; _</span>
<span class="s1">      &#39;</span><span class="w">         </span><span class="s2">&quot;ORDER BY TimeMDY ASC , TimeHr ASC &quot;</span>

<span class="w">      </span><span class="s1">&#39; MySQL-compatible query for multi-day</span>
<span class="s1">      strSQL = &quot;SELECT DateTimeStamp, TimeMDY, TimeHr, TimeMin, &quot; &amp; _</span>
<span class="s1">         &quot;SUM(CASE WHEN StationName = &#39;</span><span class="s2">&quot; &amp; strWestSite &amp; &quot;</span><span class="s1">&#39; THEN Pressure ELSE -Pressure END) AS DeltaP1 &quot; &amp; _</span>
<span class="s1">         &quot;FROM FifteenMinData &quot; &amp; _</span>
<span class="s1">         &quot;WHERE StationName IN (&#39;</span><span class="s2">&quot; &amp; strWestSite &amp; &quot;</span><span class="s1">&#39;,&#39;</span><span class="s2">&quot; &amp; strEastSite &amp; &quot;</span><span class="s1">&#39;) AND &quot; &amp; _</span>
<span class="s1">         &quot;DateTimeStamp &lt;= &quot; &amp; MySQLDate(dteEndDateTime) &amp; &quot; AND &quot; &amp; _</span>
<span class="s1">         &quot;DateTimeStamp &gt;= &quot; &amp; MySQLDate(dteStartDateTime_forQuery) &amp; &quot; &quot; &amp; _</span>
<span class="s1">         &quot;GROUP BY DateTimeStamp, TimeMDY, TimeHr, TimeMin &quot; &amp; _</span>
<span class="s1">         &quot;HAVING COUNT(DISTINCT StationName) = 2 &quot; &amp; _</span>
<span class="s1">         &quot;ORDER BY TimeMDY ASC, TimeHr ASC, TimeMin ASC&quot;   </span>

<span class="s1">      &#39;</span><span class="w"> </span><span class="nx">And</span><span class="w"> </span><span class="nx">now</span><span class="w"> </span><span class="nx">we</span><span class="w"> </span><span class="nx">feed</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">query</span><span class="w"> </span><span class="nx">above</span><span class="w"> </span><span class="nx">into</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">aggregation</span><span class="w"> </span><span class="nx">query</span><span class="w"> </span><span class="nx">below</span>
<span class="w">      </span><span class="s1">&#39; (another interesting SQL trick).</span>
<span class="s1">      &#39;</span><span class="w"> </span><span class="nx">For</span><span class="w"> </span><span class="nx">MySQL</span><span class="p">,</span><span class="w"> </span><span class="nx">we</span><span class="w"> </span><span class="nx">need</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">add</span><span class="w"> </span><span class="nx">an</span><span class="w"> </span><span class="nx">alias</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">derived</span><span class="w"> </span><span class="nx">table</span>

<span class="w">      </span><span class="nx">strSQL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;SELECT TimeMDY, TimeHr, AVG(DeltaP1) AS DeltaP &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">               </span><span class="s2">&quot;FROM (&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">strSQL</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;) AS derived_table &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">               </span><span class="s2">&quot;GROUP BY TimeMDY, TimeHr &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">               </span><span class="s2">&quot;ORDER BY TimeMDY ASC, TimeHr ASC&quot;</span>

<span class="w">   </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>

<span class="w">   </span><span class="nx">DeltaP_SQL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">strSQL</span>
<span class="nx">End</span><span class="w"> </span><span class="nb">Function</span>


<span class="nb">Function</span><span class="w"> </span><span class="nx">CollectTraceData</span><span class="p">(</span><span class="nx">ByVal</span><span class="w"> </span><span class="nx">strSensor_DBName</span><span class="p">,</span><span class="w"> </span><span class="nx">ByVal</span><span class="w"> </span><span class="nx">intColor</span><span class="p">,</span><span class="w"> </span><span class="nx">ByRef</span><span class="w"> </span><span class="nx">dicTraceIO</span><span class="p">)</span>
<span class="w">   </span><span class="nx">Dim</span><span class="w"> </span><span class="nx">strSensorSelectClause</span><span class="p">,</span><span class="w"> </span><span class="nx">strSQL_trace</span><span class="p">,</span><span class="w"> </span><span class="nx">rstTelem</span>

<span class="w">   </span><span class="nx">Dim</span><span class="w"> </span><span class="nx">points</span><span class="p">(),</span><span class="w"> </span><span class="nx">points_smoothed</span><span class="p">(),</span><span class="w"> </span><span class="nx">pointCount</span><span class="p">,</span><span class="w"> </span><span class="nx">maxPointCount</span><span class="p">,</span><span class="w"> </span><span class="nx">n_records</span>

<span class="w">   </span><span class="nx">Dim</span><span class="w"> </span><span class="nx">dblYMax</span><span class="p">,</span><span class="w"> </span><span class="nx">dblYMin</span>
<span class="w">   </span><span class="nx">Dim</span><span class="w"> </span><span class="nx">dblXValue_raw</span><span class="p">,</span><span class="w"> </span><span class="nx">dblXValue</span><span class="w"> </span>
<span class="w">   </span><span class="nx">Dim</span><span class="w"> </span><span class="nx">dblYValue_raw</span><span class="p">,</span><span class="w"> </span><span class="nx">dblYValue</span>
<span class="w">   </span><span class="nx">Dim</span><span class="w"> </span><span class="nx">arrayIndex</span>

<span class="w">   </span><span class="s1">&#39; Initialize array</span>
<span class="s1">   pointCount = 0</span>
<span class="s1">   If intDays = 1 Then</span>
<span class="s1">      &#39;</span><span class="w"> </span><span class="nx">Allocate</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">up</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nx">day</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="mf">5</span><span class="o">-</span><span class="nx">minute</span><span class="w"> </span><span class="nx">data</span><span class="p">.</span>
<span class="w">      </span><span class="nx">maxPointCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">intDays</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">24</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">12</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">50</span>
<span class="w">   </span><span class="nx">Else</span>
<span class="w">      </span><span class="s1">&#39; Allocate for up to a day of hourly data.</span>
<span class="s1">      maxPointCount = (intDays * 24) + 10</span>
<span class="s1">   End If</span>
<span class="s1">   ReDim points(maxPointCount)</span>
<span class="s1">   ReDim points_smoothed(maxPointCount)</span>
<span class="s1">   </span>
<span class="s1">   dblYMax = dicTraceIO.Item(&quot;YMax&quot;) </span>
<span class="s1">   dblYMin = dicTraceIO.Item(&quot;YMin&quot;) </span>

<span class="s1">   dicTraceIO.Item(&quot;FoundData_ForThisTrace&quot;) = False</span>
<span class="s1">   </span>
<span class="s1">   If (intDays = 1) Then</span>
<span class="s1">      &#39;</span><span class="w"> </span><span class="nx">Single</span><span class="w"> </span><span class="nx">day</span><span class="w"> </span><span class="nx">query</span><span class="w"> </span><span class="p">(</span><span class="nx">multiple</span><span class="w"> </span><span class="nx">values</span><span class="w"> </span><span class="nx">per</span><span class="w"> </span><span class="nx">hour</span><span class="p">)</span>
<span class="w">      </span><span class="nx">If</span><span class="w"> </span><span class="p">((</span><span class="nx">strMRTime</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="s2">&quot;-&quot;</span><span class="p">)</span><span class="w"> </span><span class="nx">And</span><span class="w"> </span><span class="p">(</span><span class="nx">DaysDec</span><span class="p">(</span><span class="nx">strMRTime</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="nx">And</span><span class="w"> </span><span class="p">(</span><span class="nx">DaysDec</span><span class="p">(</span><span class="w"> </span><span class="nx">strMRTime</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">1.0</span><span class="p">)</span><span class="w"> </span><span class="nx">And</span><span class="w"> </span><span class="p">(</span><span class="nx">str24Hrs_state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;checked&quot;</span><span class="p">))</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">         </span><span class="s1">&#39; Go back a full day. This modification of dteStartDateTime_forQuery is in support </span>
<span class="s1">         &#39;</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="mf">24</span><span class="nx">h</span><span class="w"> </span><span class="nx">plot</span><span class="p">.</span>
<span class="w">         </span><span class="nx">dteStartDateTime_forQuery</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">DateAdd</span><span class="p">(</span><span class="s2">&quot;d&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="nx">DateAdd</span><span class="p">(</span><span class="s2">&quot;n&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">strMRTime</span><span class="p">))</span>
<span class="w">      </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>
<span class="w">      </span>
<span class="w">      </span><span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">strSensor_DBName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;DeltaP&quot;</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">         </span><span class="nx">strSQL_trace</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">DeltaP_SQL</span><span class="p">(</span><span class="nx">intDays</span><span class="p">,</span><span class="w"> </span><span class="nx">dicTraceIO</span><span class="p">)</span>
<span class="w">      </span><span class="nx">Else</span>
<span class="w">         </span><span class="nx">strSQL_trace</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;SELECT StationName, DateTimeStamp, TimeMDY, TimeMin, TimeHr, &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">strSensor_DBName</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot; &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">                        </span><span class="s2">&quot;FROM FifteenMinData &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span>
<span class="w">                        </span><span class="s2">&quot;WHERE (StationName = &#39;&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">strLocation</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;&#39;) AND &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">                              </span><span class="s2">&quot;(DateTimeStamp &lt;=     &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">MySQLDate</span><span class="p">(</span><span class="nx">dteEndDateTime</span><span class="p">)</span><span class="w">    </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;) AND &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">                              </span><span class="s2">&quot;(DateTimeStamp &gt;=     &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">MySQLDate</span><span class="p">(</span><span class="nx">dteStartDateTime_forQuery</span><span class="p">)</span><span class="w">     </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;) AND &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">                              </span><span class="s2">&quot;(&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">strSensor_DBName</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot; IS NOT NULL) &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">                        </span><span class="s2">&quot;ORDER BY TimeMDY ASC, TimeHr ASC, TimeMin ASC&quot;</span>
<span class="w">      </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>

<span class="w">   </span><span class="nx">Else</span><span class="w">   </span>
<span class="w">      </span><span class="s1">&#39; Multi-day query (hourly data)</span>
<span class="s1">      If (strSensor_DBName = &quot;DeltaP&quot;) Then</span>
<span class="s1">         strSQL_trace = DeltaP_SQL(intDays, dicTraceIO)</span>
<span class="s1">      Else</span>
<span class="s1">         If (strSensor_DBName = &quot;TempMax&quot;) or (strSensor_DBName = &quot;WindGust&quot;) Then</span>
<span class="s1">            strSensorSelectClause = &quot;MAX(A.&quot; &amp; strSensor_DBName &amp; &quot;) AS &quot; &amp; strSensor_DBName</span>
<span class="s1">         ElseIf (strSensor_DBName = &quot;TempMin&quot;) Then</span>
<span class="s1">            strSensorSelectClause = &quot;MIN(A.&quot; &amp; strSensor_DBName &amp; &quot;) AS &quot; &amp; strSensor_DBName</span>
<span class="s1">         Else</span>
<span class="s1">            strSensorSelectClause = &quot;AVG(A.&quot; &amp; strSensor_DBName &amp; &quot;) AS &quot; &amp; strSensor_DBName</span>
<span class="s1">         End If</span>
<span class="s1">         </span>
<span class="s1">         strSQL_trace = &quot;SELECT TimeMDY, TimeHr, MIN(A.StationName) AS StationName, AVG(A.DateTimeStamp) AS DateTimeStamp, &quot; &amp; strSensorSelectClause &amp; &quot; &quot; &amp; _</span>
<span class="s1">                        &quot;FROM FifteenMinData AS A &quot; &amp; _ </span>
<span class="s1">                        &quot;WHERE (StationName = &#39;</span><span class="s2">&quot; &amp; strLocation &amp; &quot;</span><span class="s1">&#39;) AND &quot; &amp; _</span>
<span class="s1">                           &quot;(DateTimeStamp &lt;=     &quot; &amp; MySQLDate(dteEndDateTime)    &amp; &quot;) AND &quot; &amp; _</span>
<span class="s1">                           &quot;(DateTimeStamp &gt;=     &quot; &amp; MySQLDate(dteStartDateTime_forQuery)     &amp; &quot;) AND &quot; &amp; _</span>
<span class="s1">                           &quot;(&quot; &amp; strSensor_DBName &amp; &quot; IS NOT NULL) &quot; &amp; _</span>
<span class="s1">                        &quot;GROUP BY TimeMDY, TimeHr &quot; &amp; _</span>
<span class="s1">                        &quot;ORDER BY TimeMDY ASC, TimeHr ASC&quot;       </span>
<span class="s1">      End If</span>
<span class="s1">   End If</span>


<span class="s1">   Set rstTelem = Server.CreateObject(&quot;ADODB.Recordset&quot;)</span>
<span class="s1">	On Error Resume Next</span>
<span class="s1">	rstTelem.Open strSQL_trace, DBConnection, adOpenStatic, adLockReadOnly, adCmdText</span>
<span class="s1">	LogError(&quot;Recordset = rstTelem, SQL = &quot; &amp; strSQL_trace)</span>
<span class="s1">	On Error Goto 0</span>

<span class="s1">   &#39;</span><span class="w"> </span><span class="nx">Collect</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="nx">into</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">points</span><span class="w"> </span><span class="nx">array</span>
<span class="w">   </span><span class="nx">If</span><span class="w"> </span><span class="nx">Not</span><span class="w"> </span><span class="nx">rstTelem</span><span class="p">.</span><span class="nx">EOF</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">      </span><span class="nx">rstTelem</span><span class="p">.</span><span class="nx">MoveFirst</span>
<span class="w">      </span><span class="nx">Do</span><span class="w"> </span><span class="nx">Until</span><span class="w"> </span><span class="nx">rstTelem</span><span class="p">.</span><span class="nx">EOF</span>
<span class="w">         </span><span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">intDays</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">            </span><span class="nx">dblXValue_raw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">DaysDecSinceRefF</span><span class="p">(</span><span class="nx">rstTelem</span><span class="p">(</span><span class="s2">&quot;TimeMDY&quot;</span><span class="p">),</span><span class="w"> </span><span class="nx">rstTelem</span><span class="p">(</span><span class="s2">&quot;TimeHr&quot;</span><span class="p">),</span><span class="w"> </span><span class="nx">rstTelem</span><span class="p">(</span><span class="s2">&quot;TimeMin&quot;</span><span class="p">))</span>
<span class="w">         </span><span class="nx">Else</span>
<span class="w">            </span><span class="nx">dblXValue_raw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">DaysDecSinceRefF</span><span class="p">(</span><span class="nx">rstTelem</span><span class="p">(</span><span class="s2">&quot;TimeMDY&quot;</span><span class="p">),</span><span class="w"> </span><span class="nx">rstTelem</span><span class="p">(</span><span class="s2">&quot;TimeHr&quot;</span><span class="p">),</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span>
<span class="w">         </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>

<span class="w">         </span><span class="nx">dblYValue_raw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">CDbl</span><span class="p">(</span><span class="nx">rstTelem</span><span class="p">(</span><span class="w"> </span><span class="nx">strSensor_DBName</span><span class="p">))</span>
<span class="w">         </span><span class="s1">&#39; If there will the a running average done later, don&#39;</span><span class="nx">t</span><span class="w"> </span><span class="nx">scale</span><span class="w"> </span><span class="nx">direction</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="nx">here</span><span class="p">.</span><span class="w"> </span>
<span class="w">         </span><span class="s1">&#39; Leave it in degrees for now. Scale after the running average (which expects degrees).</span>
<span class="s1">         If (strSensor_DBName = &quot;WindDirection&quot;) and (strRA_state &lt;&gt; &quot;checked&quot;) Then</span>
<span class="s1">            dblYValue = dblYValue_raw * dblWindNormFactor</span>
<span class="s1">         Else</span>
<span class="s1">            dblYValue = dblYValue_raw</span>
<span class="s1">         End If</span>

<span class="s1">         MinMax dblYValue, dblYMax, dblYMin</span>

<span class="s1">         &#39;</span><span class="w"> </span><span class="nx">Store</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">array</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">format</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="nx">day</span><span class="o">-</span><span class="nx">since</span><span class="o">-</span><span class="nx">ref</span><span class="p">,</span><span class="w"> </span><span class="nx">sensor</span><span class="o">-</span><span class="nx">value</span><span class="p">]</span>
<span class="w">         </span><span class="nx">points</span><span class="p">(</span><span class="nx">pointCount</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Array</span><span class="p">(</span><span class="nx">CDbl</span><span class="p">(</span><span class="nx">dblXValue_raw</span><span class="p">),</span><span class="w"> </span><span class="nx">CDbl</span><span class="p">(</span><span class="nx">dblYValue</span><span class="p">),</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">intColor</span><span class="p">)</span>
<span class="w">         </span><span class="nx">pointCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">pointCount</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span>
<span class="w">         </span>
<span class="w">         </span><span class="nx">rstTelem</span><span class="p">.</span><span class="nx">MoveNext</span>
<span class="w">      </span><span class="nx">Loop</span>
<span class="w">      </span>
<span class="w">      </span><span class="s1">&#39; Resize array to actual number of points</span>
<span class="s1">      If pointCount &gt; 0 Then</span>
<span class="s1">         ReDim Preserve points(pointCount - 1)</span>
<span class="s1">      End If</span>
<span class="s1">   End If</span>

<span class="s1">   If rstTelem.State = adStateOpen Then rstTelem.Close</span>
<span class="s1">   Set rstTelem = Nothing</span>


<span class="s1">   &#39;</span><span class="w"> </span><span class="nx">Smooth</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="nx">using</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nx">running</span><span class="w"> </span><span class="nx">average</span><span class="w"> </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="nx">requested</span><span class="w"> </span><span class="nx">and</span><span class="w"> </span><span class="mf">5</span><span class="o">+</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="nx">points</span><span class="p">)</span>
<span class="w">   </span><span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">strRA_state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;checked&quot;</span><span class="p">)</span><span class="w"> </span><span class="nx">AND</span><span class="w"> </span><span class="p">(</span><span class="nx">pointCount</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">5</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">      </span><span class="s1">&#39; Create the running average objects directly here</span>
<span class="s1">      Dim n_RA_stack</span>
<span class="s1">      n_RA_stack = 3</span>
<span class="s1">      </span>
<span class="s1">      &#39;</span><span class="w"> </span><span class="nx">Initialize</span><span class="w"> </span><span class="nx">running</span><span class="w"> </span><span class="nx">average</span><span class="w"> </span><span class="nx">objects</span><span class="w"> </span><span class="kd">with</span><span class="w"> </span><span class="nx">stack</span><span class="w"> </span><span class="nx">size</span><span class="o">:</span><span class="w"> </span><span class="nx">n_RA_stack</span>
<span class="w">   </span>
<span class="w">      </span><span class="s1">&#39; Create running average objects</span>
<span class="s1">      Set RA_x = New RunningAverage</span>
<span class="s1">      RA_x.Initialize n_RA_stack</span>
<span class="s1">      </span>
<span class="s1">      &#39;</span><span class="w"> </span><span class="nx">Reset</span><span class="w"> </span><span class="kd">with</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">total</span><span class="w"> </span><span class="nx">number</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">points</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">properly</span><span class="w"> </span><span class="nx">handle</span><span class="w"> </span><span class="nx">end</span><span class="o">-</span><span class="k">of</span><span class="o">-</span><span class="nx">data</span><span class="w"> </span><span class="nx">logic</span>
<span class="w">      </span><span class="nx">RA_x</span><span class="p">.</span><span class="nx">Reset</span><span class="w"> </span><span class="nx">pointCount</span>
<span class="w">      </span>
<span class="w">      </span><span class="nx">If</span><span class="w"> </span><span class="nx">strSensor_DBName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;WindDirection&quot;</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">         </span><span class="nb">Set</span><span class="w"> </span><span class="nx">RA_y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">New</span><span class="w"> </span><span class="nx">RunningAverage_Dir</span>
<span class="w">         </span><span class="nx">RA_y</span><span class="p">.</span><span class="nx">Initialize</span><span class="w"> </span><span class="nx">n_RA_stack</span>
<span class="w">         </span><span class="nx">RA_y</span><span class="p">.</span><span class="nx">Reset</span><span class="w"> </span><span class="nx">pointCount</span>
<span class="w">      </span><span class="nx">Else</span>
<span class="w">         </span><span class="nb">Set</span><span class="w"> </span><span class="nx">RA_y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">New</span><span class="w"> </span><span class="nx">RunningAverage</span>
<span class="w">         </span><span class="nx">RA_y</span><span class="p">.</span><span class="nx">Initialize</span><span class="w"> </span><span class="nx">n_RA_stack</span>
<span class="w">         </span><span class="nx">RA_y</span><span class="p">.</span><span class="nx">Reset</span><span class="w"> </span><span class="nx">pointCount</span>
<span class="w">      </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>
<span class="w">      </span>
<span class="w">      </span><span class="s1">&#39; Smooth the data</span>
<span class="s1">      For arrayIndex = 0 To UBound(points)</span>
<span class="s1">         dblXValue_raw = points(arrayIndex)(0)</span>
<span class="s1">         dblYValue_raw = points(arrayIndex)(1)</span>
<span class="s1">         </span>
<span class="s1">         &#39;</span><span class="w"> </span><span class="nx">Apply</span><span class="w"> </span><span class="nx">running</span><span class="w"> </span><span class="nx">average</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">all</span><span class="w"> </span><span class="nx">points</span>
<span class="w">         </span><span class="s1">&#39; The RunningAverage class now handles special cases for endpoints</span>
<span class="s1">         dblXValue = RA_x.update(dblXValue_raw)</span>
<span class="s1">         &#39;</span><span class="w"> </span><span class="nx">Now</span><span class="p">,</span><span class="w"> </span><span class="nx">after</span><span class="w"> </span><span class="nx">averaging</span><span class="p">,</span><span class="w"> </span><span class="nx">scale</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">direction</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">deal</span><span class="w"> </span><span class="kd">with</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">single</span><span class="o">-</span><span class="nx">axis</span><span class="w"> </span><span class="nx">chart</span><span class="p">.</span>
<span class="w">         </span><span class="s1">&#39; The RunningAverage_Dir class expects the data in degrees.</span>
<span class="s1">         If (strSensor_DBName = &quot;WindDirection&quot;) Then</span>
<span class="s1">            dblYValue = RA_y.update(dblYValue_raw) * dblWindNormFactor</span>
<span class="s1">         Else</span>
<span class="s1">            dblYValue = RA_y.update(dblYValue_raw)</span>
<span class="s1">         End If</span>

<span class="s1">         points_smoothed(arrayIndex) = Array(dblXValue, dblYValue, &quot;&quot;, intColor)</span>
<span class="s1">      Next</span>
<span class="s1">      ReDim Preserve points_smoothed(pointCount - 1)      </span>
<span class="s1">      </span>
<span class="s1">      useRunningAverage = True</span>
<span class="s1">   Else</span>
<span class="s1">      useRunningAverage = False</span>
<span class="s1">   End If</span>


<span class="s1">   &#39;</span><span class="w"> </span><span class="nx">Note</span><span class="w"> </span><span class="nx">that</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="nx">assignment</span><span class="w"> </span><span class="nx">can</span><span class="w"> </span><span class="nx">not</span><span class="w"> </span><span class="nx">be</span><span class="w"> </span><span class="nx">made</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">call</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">MinMax</span><span class="p">.</span><span class="w"> </span><span class="nx">It</span><span class="w"> </span><span class="nx">can</span><span class="s1">&#39;t modify the</span>
<span class="s1">   &#39;</span><span class="w"> </span><span class="nx">dictionary</span><span class="w"> </span><span class="nx">values</span><span class="w"> </span><span class="nx">directly</span><span class="w"> </span><span class="p">(</span><span class="nx">unless</span><span class="w"> </span><span class="nx">you</span><span class="w"> </span><span class="nx">passed</span><span class="w"> </span><span class="nx">it</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">whole</span><span class="w"> </span><span class="nx">dictionary</span><span class="p">).</span>
<span class="w">   </span><span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">strSensor_DBName</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="s2">&quot;WindDirection&quot;</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">      </span><span class="nx">dicTraceIO</span><span class="p">.</span><span class="nx">Item</span><span class="p">(</span><span class="s2">&quot;YMax&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dblYMax</span>
<span class="w">      </span><span class="nx">dicTraceIO</span><span class="p">.</span><span class="nx">Item</span><span class="p">(</span><span class="s2">&quot;YMin&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dblYMin</span>
<span class="w">   </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>

<span class="w">   </span><span class="s1">&#39; Return the array</span>
<span class="s1">   If pointCount &gt; 0 Then   </span>
<span class="s1">      dicTraceIO.Item(&quot;FoundData&quot;) = True</span>
<span class="s1">      dicTraceIO.Item(&quot;FoundData_ForThisTrace&quot;) = True</span>
<span class="s1">      </span>
<span class="s1">      If useRunningAverage Then</span>
<span class="s1">         CollectTraceData = points_smoothed</span>
<span class="s1">      Else</span>
<span class="s1">         CollectTraceData = points</span>
<span class="s1">      End If</span>
<span class="s1">   Else</span>
<span class="s1">      CollectTraceData = Null</span>
<span class="s1">   End If</span>
<span class="s1">End Function</span>


<span class="s1">Sub AddTrace(strSensorName, intSeriesType, strSeriesTitle, intLineWidth, intColor, ByRef dicTraceIO)</span>
<span class="s1">   Dim intTraceArray_index</span>
<span class="s1">   Dim intYesterdayColor, intGray </span>
<span class="s1">   Dim dblYValue, dblYValue_raw</span>
<span class="s1">   Dim dblXValue, dblXValue_raw</span>
<span class="s1">   Dim strSQL_trace</span>
<span class="s1">   Dim i</span>
<span class="s1">   Dim pointCount</span>

<span class="s1">   Dim dataPoints</span>
<span class="s1">   </span>
<span class="s1">   If (strSensorName = &quot;WindDirection&quot;) Then</span>
<span class="s1">      dataPoints = dataPoints_WindDirection</span>
<span class="s1">   ElseIf (strSensorName = &quot;WindGust&quot;) Then</span>
<span class="s1">      dataPoints = dataPoints_WindGust</span>
<span class="s1">   ElseIf (strSensorName = &quot;WindSpeed&quot;) Then</span>
<span class="s1">      dataPoints = dataPoints_WindSpeed</span>

<span class="s1">   ElseIf (strSensorName = &quot;Pressure&quot;) Then</span>
<span class="s1">      dataPoints = dataPoints_Pressure</span>

<span class="s1">   ElseIf (strSensorName = &quot;DeltaP_trace_A&quot;) Then</span>
<span class="s1">      dataPoints = dataPoints_DeltaP_trace_A</span>
<span class="s1">   ElseIf (strSensorName = &quot;DeltaP_trace_B&quot;) Then</span>
<span class="s1">      dataPoints = dataPoints_DeltaP_trace_B</span>

<span class="s1">   ElseIf (strSensorName = &quot;TempAvg&quot;) Then</span>
<span class="s1">      dataPoints = dataPoints_TempAvg</span>
<span class="s1">   ElseIf (strSensorName = &quot;TempMax&quot;) Then</span>
<span class="s1">      dataPoints = dataPoints_TempMax</span>
<span class="s1">   ElseIf (strSensorName = &quot;TempMin&quot;) Then</span>
<span class="s1">      dataPoints = dataPoints_TempMin</span>
<span class="s1">   ElseIf (strSensorName = &quot;DewPoint&quot;) Then</span>
<span class="s1">      dataPoints = dataPoints_DewPoint</span>
<span class="s1">   End If</span>

<span class="s1">   If (IsArray(dataPoints)) Then </span>
<span class="s1">      pointCount = UBound(dataPoints)</span>
<span class="s1">      dicTraceIO.Item(&quot;FoundData&quot;) = True</span>
<span class="s1">      dicTraceIO.Item(&quot;FoundData_ForThisTrace&quot;) = True</span>
<span class="s1">   Else </span>
<span class="s1">      dicTraceIO.Item(&quot;FoundData_ForThisTrace&quot;) = False</span>
<span class="s1">      Exit Sub</span>
<span class="s1">   End If</span>
<span class="s1">   </span>
<span class="s1">   If intSeriesType = 6 Then</span>
<span class="s1">      intGray = 200</span>
<span class="s1">      intYesterdayColor = RGB(intGray,intGray,intGray)</span>
<span class="s1">   Else</span>
<span class="s1">      intYesterdayColor = intColor</span>
<span class="s1">   End If</span>
<span class="s1">   </span>
<span class="s1">   If (intDays = 1) Then</span>
<span class="s1">      &#39;</span><span class="w"> </span><span class="nx">Use</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">dataPoints</span><span class="w"> </span><span class="nx">array</span><span class="w"> </span><span class="nx">instead</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">directly</span><span class="w"> </span><span class="nx">accessing</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">recordset</span>
<span class="w">      </span><span class="nx">Dim</span><span class="w"> </span><span class="nx">yesterdayPoints</span><span class="p">,</span><span class="w"> </span><span class="nx">todayPoints</span>
<span class="w">      </span><span class="nx">Dim</span><span class="w"> </span><span class="nx">yesterdayCount</span><span class="p">,</span><span class="w"> </span><span class="nx">todayCount</span>
<span class="w">      </span>
<span class="w">      </span><span class="s1">&#39; Initialize counters and arrays</span>
<span class="s1">      yesterdayCount = 0</span>
<span class="s1">      todayCount = 0</span>
<span class="s1">      </span>
<span class="s1">      ReDim yesterdayPoints(pointCount)</span>
<span class="s1">      ReDim todayPoints(pointCount)</span>
<span class="s1">      </span>
<span class="s1">      &#39;</span><span class="w"> </span><span class="nx">Loop</span><span class="w"> </span><span class="nx">through</span><span class="w"> </span><span class="nx">all</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="nx">points</span><span class="w"> </span><span class="nx">and</span><span class="w"> </span><span class="nx">separate</span><span class="w"> </span><span class="nx">into</span><span class="w"> </span><span class="nx">yesterday</span><span class="w"> </span><span class="nx">and</span><span class="w"> </span><span class="nx">today</span><span class="w"> </span><span class="p">(</span><span class="nx">before</span><span class="w"> </span><span class="nx">and</span><span class="w"> </span><span class="nx">after</span><span class="w"> </span><span class="nx">midnight</span><span class="p">)</span>
<span class="w">      </span><span class="nx">For</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="nx">To</span><span class="w"> </span><span class="nx">pointCount</span>
<span class="w">         </span><span class="nx">dblXValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dataPoints</span><span class="p">(</span><span class="nx">i</span><span class="p">)(</span><span class="mf">0</span><span class="p">)</span>
<span class="w">         </span><span class="nx">dblYValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dataPoints</span><span class="p">(</span><span class="nx">i</span><span class="p">)(</span><span class="mf">1</span><span class="p">)</span>
<span class="w">         </span>
<span class="w">         </span><span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">dblXValue</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">            </span><span class="s1">&#39; This is yesterday&#39;</span><span class="nx">s</span><span class="w"> </span><span class="nx">data</span>
<span class="w">            </span><span class="s1">&#39; Add 1.0 to the x value to move yesterday&#39;</span><span class="nx">s</span><span class="w"> </span><span class="nx">points</span><span class="w"> </span><span class="nx">onto</span><span class="w"> </span><span class="nx">today</span><span class="s1">&#39;s plot</span>
<span class="s1">            dblXValue = dblXValue + 1.0</span>
<span class="s1">            yesterdayPoints(yesterdayCount) = Array(dblXValue, dblYValue, &quot;&quot;, intYesterdayColor)</span>
<span class="s1">            yesterdayCount = yesterdayCount + 1</span>
<span class="s1">            </span>
<span class="s1">         Else</span>
<span class="s1">            &#39;</span><span class="w"> </span><span class="nx">This</span><span class="w"> </span><span class="nx">is</span><span class="w"> </span><span class="nx">today</span><span class="s1">&#39;s data</span>
<span class="s1">            todayPoints(todayCount) = Array(dblXValue, dblYValue, &quot;&quot;, intColor)</span>
<span class="s1">            todayCount = todayCount + 1</span>
<span class="s1">         End If</span>
<span class="s1">      Next</span>

<span class="s1">      &#39;</span><span class="w"> </span><span class="nx">Resize</span><span class="w"> </span><span class="nx">arrays</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">actual</span><span class="w"> </span><span class="nx">counts</span>
<span class="w">      </span><span class="nx">If</span><span class="w"> </span><span class="nx">yesterdayCount</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">         </span><span class="nx">ReDim</span><span class="w"> </span><span class="nx">Preserve</span><span class="w"> </span><span class="nx">yesterdayPoints</span><span class="p">(</span><span class="nx">yesterdayCount</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span>
<span class="w">      </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>
<span class="w">      </span>
<span class="w">      </span><span class="nx">If</span><span class="w"> </span><span class="nx">todayCount</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">         </span><span class="nx">ReDim</span><span class="w"> </span><span class="nx">Preserve</span><span class="w"> </span><span class="nx">todayPoints</span><span class="p">(</span><span class="nx">todayCount</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span>
<span class="w">      </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>
<span class="w">      </span>
<span class="w">      </span><span class="s1">&#39; Plot yesterday&#39;</span><span class="nx">s</span><span class="w"> </span><span class="nx">data</span>
<span class="w">      </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">AddSeries</span><span class="p">(</span><span class="nx">intSeriesType</span><span class="p">)</span>
<span class="w">      </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">SeriesInLegend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">False</span>
<span class="w">      </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">linewidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="w">      </span>
<span class="w">      </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">AddXYArray</span><span class="w"> </span><span class="nx">yesterdayPoints</span>

<span class="w">      </span><span class="s1">&#39; Plot today&#39;</span><span class="nx">s</span><span class="w"> </span><span class="nx">data</span>
<span class="w">      </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">AddSeries</span><span class="p">(</span><span class="nx">intSeriesType</span><span class="p">)</span>
<span class="w">      </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">linewidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">intLineWidth</span>
<span class="w">      </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">SeriesTitle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">strSeriesTitle</span>
<span class="w">      </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">AddXYArray</span><span class="w"> </span><span class="nx">todayPoints</span>
<span class="w">   </span>
<span class="w">   </span><span class="nx">Else</span>
<span class="w">      </span><span class="s1">&#39; Multi-day chart</span>
<span class="s1">      Chart.AddSeries( intSeriesType)</span>
<span class="s1">      Chart.linewidth = intLineWidth</span>
<span class="s1">      Chart.SeriesTitle = strSeriesTitle</span>
<span class="s1">      Chart.AddXYArray dataPoints</span>

<span class="s1">   End If</span>
<span class="s1">End Sub</span>


<span class="s1">Sub Initialize_dicTraceIO()</span>
<span class="s1">   &#39;</span><span class="w"> </span><span class="nx">Use</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">facilitate</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nx">general</span><span class="w"> </span><span class="nx">ByReference</span><span class="w"> </span><span class="nx">argument</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">AddTrace</span><span class="w"> </span><span class="nx">subroutine</span><span class="p">.</span>
<span class="w">   </span><span class="nb">Set</span><span class="w"> </span><span class="nx">dicTraceIO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Server</span><span class="p">.</span><span class="nx">CreateObject</span><span class="p">(</span><span class="s2">&quot;Scripting.Dictionary&quot;</span><span class="p">)</span>
<span class="w">   </span><span class="nx">dicTraceIO</span><span class="p">.</span><span class="nx">Add</span><span class="w"> </span><span class="s2">&quot;YMax&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">999</span>
<span class="w">   </span><span class="nx">dicTraceIO</span><span class="p">.</span><span class="nx">Add</span><span class="w"> </span><span class="s2">&quot;YMin&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">999</span>
<span class="w">   </span><span class="nx">dicTraceIO</span><span class="p">.</span><span class="nx">Add</span><span class="w"> </span><span class="s2">&quot;FoundData&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">False</span>
<span class="w">   </span><span class="nx">dicTraceIO</span><span class="p">.</span><span class="nx">Add</span><span class="w"> </span><span class="s2">&quot;FoundData_ForThisTrace&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">False</span>
<span class="w">   </span><span class="s1">&#39;Used for Delta-P calculations.</span>
<span class="s1">   dicTraceIO.Add &quot;WestSite&quot;, &quot;&quot;</span>
<span class="s1">   dicTraceIO.Add &quot;EastSite&quot;, &quot;&quot;</span>
<span class="s1">End Sub</span>


<span class="s1">Sub FetchTheData()</span>
<span class="s1">   Initialize_dicTraceIO</span>

<span class="s1">   &#39;</span><span class="w"> </span><span class="nb">Set</span><span class="w"> </span><span class="nx">dteStartDate_forLabels</span><span class="w"> </span><span class="nx">and</span><span class="w"> </span><span class="nx">dteStartDateTime</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">use</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">queries</span><span class="w"> </span><span class="nx">and</span><span class="w"> </span><span class="nx">chart</span><span class="w"> </span><span class="nx">labels</span><span class="p">...</span>
<span class="w">   </span><span class="nx">dteStartDate_forLabels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">DateAdd</span><span class="p">(</span><span class="s2">&quot;d&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="mf">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">intDays</span><span class="p">),</span><span class="w"> </span><span class="nx">dtePostedDate</span><span class="p">)</span>
<span class="w">   </span>
<span class="w">   </span><span class="s1">&#39; The following is a somewhat clumsy way to deal with daylight savings time and </span>
<span class="s1">   &#39;</span><span class="w"> </span><span class="nx">timezone</span><span class="p">.</span><span class="w"> </span><span class="nx">Noteworthy</span><span class="w"> </span><span class="nx">here</span><span class="w"> </span><span class="nx">is</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">way</span><span class="w"> </span><span class="nx">that</span><span class="w"> </span><span class="nx">start</span><span class="w"> </span><span class="nx">and</span><span class="w"> </span><span class="nx">end</span><span class="w"> </span><span class="nx">times</span><span class="w"> </span><span class="nx">are</span><span class="w"> </span><span class="nx">shifted</span><span class="w"> </span>
<span class="w">   </span><span class="s1">&#39; back during periods of daylight savings time. This, coupled with the way that </span>
<span class="s1">   &#39;</span><span class="w"> </span><span class="nx">points</span><span class="w"> </span><span class="nx">are</span><span class="w"> </span><span class="nx">plotted</span><span class="w"> </span><span class="nx">using</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nx">decimal</span><span class="w"> </span><span class="nx">day</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="nx">that</span><span class="w"> </span><span class="nx">is</span><span class="w"> </span><span class="nx">calculated</span><span class="w"> </span><span class="nx">relative</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span>
<span class="w">   </span><span class="s1">&#39; the starting point AND using the standard time values that are in the </span>
<span class="s1">   &#39;</span><span class="w"> </span><span class="nx">database</span><span class="p">,</span><span class="w"> </span><span class="nx">has</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">net</span><span class="w"> </span><span class="nx">effect</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">shifting</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">standard</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">DLS</span><span class="w"> </span><span class="nx">values</span><span class="p">.</span><span class="w"> </span><span class="nx">It</span><span class="s1">&#39;s all </span>
<span class="s1">   &#39;</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nx">bit</span><span class="w"> </span><span class="nx">confusing</span><span class="p">.</span><span class="w"> </span><span class="nx">Not</span><span class="w"> </span><span class="nx">completely</span><span class="w"> </span><span class="nx">sure</span><span class="w"> </span><span class="nx">why</span><span class="w"> </span><span class="nx">I</span><span class="w"> </span><span class="nx">originally</span><span class="w"> </span><span class="nx">did</span><span class="w"> </span><span class="nx">it</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="nx">way</span><span class="p">.</span><span class="w"> </span>
<span class="w">   </span><span class="s1">&#39; But one advantage is that when aggregating large amounts of data </span>
<span class="s1">   &#39;</span><span class="w"> </span><span class="p">(</span><span class="nx">like</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="mf">25</span><span class="w"> </span><span class="nx">day</span><span class="w"> </span><span class="nx">plot</span><span class="p">)</span><span class="w"> </span><span class="nx">each</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="nx">point</span><span class="w"> </span><span class="nx">does</span><span class="w"> </span><span class="nx">not</span><span class="w"> </span><span class="nx">need</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">be</span><span class="w"> </span><span class="nx">converted</span><span class="p">.</span><span class="w"> </span><span class="nx">This</span><span class="w"> </span>
<span class="w">   </span><span class="s1">&#39; is an efficiency that is probably not noticeable on recent computers (2015), </span>
<span class="s1">   &#39;</span><span class="w"> </span><span class="nx">but</span><span class="w"> </span><span class="nx">probably</span><span class="w"> </span><span class="nx">was</span><span class="w"> </span><span class="nx">worth</span><span class="w"> </span><span class="nx">considering</span><span class="w"> </span><span class="nx">when</span><span class="w"> </span><span class="nx">I</span><span class="w"> </span><span class="nx">first</span><span class="w"> </span><span class="nx">did</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="mf">20</span><span class="o">-</span><span class="nx">some</span><span class="w"> </span><span class="nx">years</span><span class="w"> </span><span class="nx">ago</span><span class="p">.</span>
<span class="w">   </span>
<span class="w">   </span><span class="nx">dteStartDateTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">DateAdd</span><span class="p">(</span><span class="s2">&quot;d&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="mf">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">intDays</span><span class="p">),</span><span class="w"> </span><span class="nx">dtePostedDate</span><span class="p">)</span>
<span class="w">   </span><span class="nx">dteEndDateTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">DateAdd</span><span class="p">(</span><span class="s2">&quot;d&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="nx">dtePostedDate</span><span class="p">)</span>
<span class="w">   </span><span class="nx">dteNowTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">DateAdd</span><span class="p">(</span><span class="w"> </span><span class="s2">&quot;h&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">dicTZ</span><span class="p">.</span><span class="nx">item</span><span class="p">(</span><span class="nx">strTimeZone</span><span class="p">),</span><span class="w"> </span><span class="nx">Now</span><span class="p">())</span>
<span class="w">   </span><span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">blnDayLightSavingsTime</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">      </span><span class="nx">dteNowTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">DateAdd</span><span class="p">(</span><span class="s2">&quot;h&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="nx">dteNowTime</span><span class="p">)</span><span class="w"> </span>
<span class="w">      </span><span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">strTimeZone</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="s2">&quot;H&quot;</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">         </span><span class="nx">dteStartDateTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">DateAdd</span><span class="p">(</span><span class="s2">&quot;h&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="nx">dteStartDateTime</span><span class="p">)</span><span class="w">   </span>
<span class="w">         </span><span class="nx">dteEndDateTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">DateAdd</span><span class="p">(</span><span class="s2">&quot;h&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="nx">dteEndDateTime</span><span class="p">)</span><span class="w"> </span>
<span class="w">      </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>
<span class="w">   </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>
<span class="w">   </span>
<span class="w">   </span><span class="s1">&#39; Initialize the start time for the queries. This will later get modified for the 24h</span>
<span class="s1">   &#39;</span><span class="w"> </span><span class="nx">versions</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="mf">1</span><span class="o">-</span><span class="nx">day</span><span class="w"> </span><span class="nx">charts</span><span class="p">.</span>
<span class="w">   </span><span class="nx">dteStartDateTime_forQuery</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dteStartDateTime</span>

<span class="w">   </span><span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">left</span><span class="p">(</span><span class="nx">strSensorType</span><span class="p">,</span><span class="mf">4</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Wind&quot;</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">      </span><span class="nx">dataPoints_WindDirection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">CollectTraceData</span><span class="p">(</span><span class="s2">&quot;WindDirection&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">vbWhite</span><span class="w"> </span><span class="p">,</span><span class="nx">dicTraceIO</span><span class="p">)</span>
<span class="w">      </span><span class="nx">dataPoints_WindGust</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">CollectTraceData</span><span class="p">(</span><span class="s2">&quot;WindGust&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">RGB</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">h00</span><span class="p">,</span><span class="o">&amp;</span><span class="nx">h80</span><span class="p">,</span><span class="o">&amp;</span><span class="nx">h80</span><span class="p">),</span><span class="w"> </span><span class="nx">dicTraceIO</span><span class="p">)</span>
<span class="w">      </span><span class="nx">dataPoints_WindSpeed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">CollectTraceData</span><span class="p">(</span><span class="s2">&quot;WindSpeed&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">vbRed</span><span class="p">,</span><span class="w"> </span><span class="nx">dicTraceIO</span><span class="p">)</span>

<span class="w">   </span><span class="nx">ElseIf</span><span class="w"> </span><span class="p">(</span><span class="nx">strSensorType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Temperature&quot;</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">      </span><span class="nx">dataPoints_TempAvg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">CollectTraceData</span><span class="p">(</span><span class="s2">&quot;TempAvg&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">vbRed</span><span class="p">,</span><span class="w"> </span><span class="nx">dicTraceIO</span><span class="p">)</span>
<span class="w">      </span><span class="nx">dataPoints_TempMax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">CollectTraceData</span><span class="p">(</span><span class="s2">&quot;TempMax&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">vbBlack</span><span class="p">,</span><span class="w"> </span><span class="nx">dicTraceIO</span><span class="p">)</span>
<span class="w">      </span><span class="nx">dataPoints_TempMin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">CollectTraceData</span><span class="p">(</span><span class="s2">&quot;TempMin&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">vbBlack</span><span class="p">,</span><span class="w"> </span><span class="nx">dicTraceIO</span><span class="p">)</span>
<span class="w">      </span><span class="nx">dataPoints_DewPoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">CollectTraceData</span><span class="p">(</span><span class="s2">&quot;DewPoint&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">RGB</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">h00</span><span class="p">,</span><span class="o">&amp;</span><span class="nx">h80</span><span class="p">,</span><span class="o">&amp;</span><span class="nx">h80</span><span class="p">),</span><span class="w"> </span><span class="nx">dicTraceIO</span><span class="p">)</span>

<span class="w">   </span><span class="nx">ElseIf</span><span class="w"> </span><span class="p">(</span><span class="nx">strSensorType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Pressure&quot;</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">      </span><span class="nx">dataPoints_Pressure</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">CollectTraceData</span><span class="p">(</span><span class="s2">&quot;Pressure&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">vbRed</span><span class="p">,</span><span class="w"> </span><span class="nx">dicTraceIO</span><span class="p">)</span>

<span class="w">   </span><span class="nx">ElseIf</span><span class="w"> </span><span class="p">(</span><span class="nx">strSensorType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;DeltaP1&quot;</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">      </span><span class="nx">dicTraceIO</span><span class="p">(</span><span class="s2">&quot;WestSite&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;PORTLAND&quot;</span>
<span class="w">      </span><span class="nx">dicTraceIO</span><span class="p">(</span><span class="s2">&quot;EastSite&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;THE DALLES&quot;</span>
<span class="w">      </span><span class="nx">dataPoints_DeltaP_trace_A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">CollectTraceData</span><span class="p">(</span><span class="s2">&quot;DeltaP&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">RGB</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">h00</span><span class="p">,</span><span class="o">&amp;</span><span class="nx">h80</span><span class="p">,</span><span class="o">&amp;</span><span class="nx">h80</span><span class="p">),</span><span class="w"> </span><span class="nx">dicTraceIO</span><span class="p">)</span>
<span class="w">      </span>
<span class="w">      </span><span class="nx">dicTraceIO</span><span class="p">(</span><span class="s2">&quot;WestSite&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;THE DALLES&quot;</span>
<span class="w">      </span><span class="nx">dicTraceIO</span><span class="p">(</span><span class="s2">&quot;EastSite&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;PASCO&quot;</span>
<span class="w">      </span><span class="nx">dataPoints_DeltaP_trace_B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">CollectTraceData</span><span class="p">(</span><span class="s2">&quot;DeltaP&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">vbRed</span><span class="p">,</span><span class="w"> </span><span class="nx">dicTraceIO</span><span class="p">)</span>

<span class="w">   </span><span class="nx">ElseIf</span><span class="w"> </span><span class="p">(</span><span class="nx">strSensorType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;DeltaP2&quot;</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">      </span><span class="nx">dicTraceIO</span><span class="p">(</span><span class="s2">&quot;WestSite&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;KTTD&quot;</span>
<span class="w">      </span><span class="nx">dicTraceIO</span><span class="p">(</span><span class="s2">&quot;EastSite&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;KDLS&quot;</span>
<span class="w">      </span><span class="nx">dataPoints_DeltaP_trace_A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">CollectTraceData</span><span class="p">(</span><span class="s2">&quot;DeltaP&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">RGB</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">h00</span><span class="p">,</span><span class="o">&amp;</span><span class="nx">h80</span><span class="p">,</span><span class="o">&amp;</span><span class="nx">h80</span><span class="p">),</span><span class="w"> </span><span class="nx">dicTraceIO</span><span class="p">)</span>
<span class="w">      </span>
<span class="w">      </span><span class="nx">dicTraceIO</span><span class="p">(</span><span class="s2">&quot;WestSite&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;KDLS&quot;</span>
<span class="w">      </span><span class="nx">dicTraceIO</span><span class="p">(</span><span class="s2">&quot;EastSite&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;KHRI&quot;</span>
<span class="w">      </span><span class="nx">dataPoints_DeltaP_trace_B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">CollectTraceData</span><span class="p">(</span><span class="s2">&quot;DeltaP&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">vbRed</span><span class="p">,</span><span class="w"> </span><span class="nx">dicTraceIO</span><span class="p">)</span>

<span class="w">   </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>
<span class="nx">End</span><span class="w"> </span><span class="nx">Sub</span>


<span class="nx">Sub</span><span class="w"> </span><span class="nx">PlotTheChart</span><span class="p">()</span>
<span class="w">   </span><span class="s1">&#39; Set the ContentType</span>
<span class="s1">   &#39;</span><span class="nx">Response</span><span class="p">.</span><span class="nx">ContentType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;image/JPEG&quot;</span>

<span class="w">   </span><span class="s1">&#39; Instantiate the Chart component</span>
<span class="s1">   Set Chart = Server.CreateObject (&quot;ASPChart.Chart&quot;)</span>
<span class="s1">   Chart.JPEGQuality = 90 &#39;</span><span class="mf">80</span>

<span class="w">   </span><span class="nx">Dim</span><span class="w"> </span><span class="nx">dblTraceArray</span><span class="p">,</span><span class="w"> </span><span class="nx">intTraceArray_index</span><span class="p">,</span><span class="w"> </span><span class="nx">directAxisScale</span>
<span class="w">   </span>
<span class="w">   </span><span class="s1">&#39; Add a separate (pseudo) trace to do the x-axis labeling.  Shift the y</span>
<span class="s1">   &#39;</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="nx">by</span><span class="w"> </span><span class="nx">negative</span><span class="w"> </span><span class="mf">200</span><span class="w"> </span><span class="nx">so</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">points</span><span class="w"> </span><span class="nx">don</span><span class="s1">&#39;t show on the plot. Also prevent</span>
<span class="s1">   &#39;</span><span class="w"> </span><span class="nx">it</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="nx">showing</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">legend</span><span class="p">.</span>
<span class="w">   </span><span class="s1">&#39;</span>
<span class="s1">   &#39;</span><span class="w"> </span><span class="nx">Have</span><span class="w"> </span><span class="nx">tried</span><span class="w"> </span><span class="nx">more</span><span class="w"> </span><span class="nx">direct</span><span class="w"> </span><span class="nx">methods</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">charting</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">labels</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">part</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">data</span>
<span class="w">   </span><span class="s1">&#39; traces but always ran into problems.  This somewhat indirect (but</span>
<span class="s1">   &#39;</span><span class="w"> </span><span class="nx">successful</span><span class="p">)</span><span class="w"> </span><span class="nx">method</span><span class="p">,</span><span class="w"> </span><span class="nx">offers</span><span class="w"> </span><span class="nx">more</span><span class="w"> </span><span class="nx">control</span><span class="w"> </span><span class="nx">and</span><span class="w"> </span><span class="nx">is</span><span class="w"> </span><span class="nx">general</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">any</span><span class="w"> </span><span class="nx">numeric</span>
<span class="w">   </span><span class="s1">&#39; based x axis.</span>

<span class="s1">   Chart.AddSeries (5)</span>
<span class="s1">   Chart.linewidth = 0</span>
<span class="s1">   Chart.SeriesTitle = &quot; &quot;</span>
<span class="s1">   Chart.SeriesInLegend = False   </span>
<span class="s1">   </span>
<span class="s1">   If (intDays = 1) Then</span>
<span class="s1">      TimeLabels = Array(&quot;12m&quot;,&quot;1&quot;,&quot;2&quot;,&quot;3&quot;,&quot;4&quot;,&quot;5&quot;,&quot;6am&quot;,&quot;7&quot;,&quot;8&quot;,&quot;9&quot;,&quot;10&quot;,&quot;11&quot;,&quot;12n&quot;,&quot;1&quot;,&quot;2&quot;,&quot;3&quot;,&quot;4&quot;,&quot;5&quot;,&quot;6pm&quot;,&quot;7&quot;,&quot;8&quot;,&quot;9&quot;,&quot;10&quot;,&quot;11&quot;,&quot;12m&quot;)</span>

<span class="s1">      For intHour = 0 to 24</span>
<span class="s1">         &#39;</span><span class="w"> </span><span class="nx">The</span><span class="w"> </span><span class="nx">key</span><span class="w"> </span><span class="nx">difference</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="nx">dummy</span><span class="w"> </span><span class="nx">trace</span><span class="w"> </span><span class="nx">is</span><span class="w"> </span><span class="nx">that</span><span class="w"> </span><span class="nx">it</span><span class="w"> </span><span class="nx">has</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nx">parameter</span>
<span class="w">         </span><span class="s1">&#39; for the label.  All the data traces below have an empty string in</span>
<span class="s1">         &#39;</span><span class="w"> </span><span class="nx">that</span><span class="w"> </span><span class="nx">position</span><span class="p">.</span>

<span class="w">         </span><span class="nx">MyChartAddXY</span><span class="w"> </span><span class="p">(</span><span class="nx">CDbl</span><span class="p">(</span><span class="nx">intHour</span><span class="p">)</span><span class="o">/</span><span class="mf">24.0</span><span class="p">),</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">200</span><span class="p">,</span><span class="w"> </span><span class="nx">TimeLabels</span><span class="p">(</span><span class="nx">intHour</span><span class="p">),</span><span class="w"> </span><span class="nx">vbWhite</span><span class="w">   </span>
<span class="w">      </span><span class="nx">Next</span>
<span class="w">      </span>
<span class="w">   </span><span class="nx">Else</span><span class="w">      </span>
<span class="w">      </span><span class="s1">&#39; Make a special label trace (dummy) for multiple-day charts...</span>
<span class="s1">      </span>
<span class="s1">      If (intDays &gt;= 2) AND (intDays &lt;= 4) Then</span>
<span class="s1">         intLabelsPerDay = 4</span>
<span class="s1">      ElseIf (intDays &gt;= 5) AND (intDays &lt;= 9) Then</span>
<span class="s1">         intLabelsPerDay = 2</span>
<span class="s1">      ElseIf (intDays &gt;= 10) AND (intDays &lt;= 25) Then</span>
<span class="s1">         intLabelsPerDay = 1</span>
<span class="s1">      Else</span>
<span class="s1">         &#39;</span><span class="w"> </span><span class="nx">Shouldn</span><span class="s1">&#39;t be able to get here...</span>
<span class="s1">      End If      </span>

<span class="s1">      intXLabels = (intDays * intLabelsPerDay) + 1</span>
<span class="s1">      &#39;</span><span class="w"> </span><span class="nx">Dim</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">dynamic</span><span class="w"> </span><span class="nx">array</span><span class="p">...</span>
<span class="w">      </span><span class="nx">ReDim</span><span class="w"> </span><span class="nx">strTimeLabels</span><span class="p">(</span><span class="nx">intXLabels</span><span class="p">)</span>
<span class="w">      </span><span class="nx">dblDaysIncrement</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">intLabelsPerDay</span>
<span class="w">         </span>
<span class="w">      </span><span class="nx">For</span><span class="w"> </span><span class="nx">intJ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="nx">To</span><span class="w"> </span><span class="nx">intXLabels</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1</span>
<span class="w">         </span><span class="nx">dblDaysFraction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">intJ</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dblDaysIncrement</span>
<span class="w">         </span>
<span class="w">         </span><span class="s1">&#39; Put a Day label on the integer values (midnight)...</span>
<span class="s1">         If (dblDaysFraction = Int(dblDaysFraction)) Then</span>
<span class="s1">            dteLabelDate = DateAdd(&quot;d&quot;, Int(dblDaysFraction), dteStartDate_forLabels)</span>
<span class="s1">            strTimeLabels(intJ) = Left(WeekDayName(WeekDay(dteLabelDate), True),2) &amp; &quot;-&quot; &amp; Day(dteLabelDate)</span>
<span class="s1">         Else</span>
<span class="s1">            dblFractionalPart = dblDaysFraction - Int(dblDaysFraction)</span>
<span class="s1">            If (dblFractionalPart = 0.50) Then</span>
<span class="s1">               &#39;</span><span class="w"> </span><span class="nx">Suppress</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="mi">12n</span><span class="w"> </span><span class="nx">marks</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="mf">7</span><span class="w"> </span><span class="nx">though</span><span class="w"> </span><span class="mf">9.</span>
<span class="w">               </span><span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">intDays</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">6</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">                  </span><span class="nx">strTimeLabels</span><span class="p">(</span><span class="nx">intJ</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;12n&quot;</span>
<span class="w">               </span><span class="nx">Else</span>
<span class="w">                  </span><span class="nx">strTimeLabels</span><span class="p">(</span><span class="nx">intJ</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<span class="w">               </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>
<span class="w">            </span><span class="nx">Else</span>
<span class="w">               </span><span class="nx">strTimeLabels</span><span class="p">(</span><span class="nx">intJ</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="w"> </span><span class="s1">&#39;CStr(dblDaysFraction)</span>
<span class="s1">            End If      </span>
<span class="s1">         End If</span>
<span class="s1">      Next</span>

<span class="s1">      &#39;</span><span class="w"> </span><span class="nx">Plot</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">pseudo</span><span class="w"> </span><span class="nx">trace</span><span class="p">....</span><span class="w">         </span>
<span class="w">      </span><span class="nx">For</span><span class="w"> </span><span class="nx">intJ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="nx">To</span><span class="w"> </span><span class="nx">intXLabels</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1</span>
<span class="w">         </span><span class="s1">&#39; The key difference in this pseudo trace is that it has a parameter</span>
<span class="s1">         &#39;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">label</span><span class="p">.</span><span class="w"> </span><span class="nx">All</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="nx">traces</span><span class="w"> </span><span class="nx">below</span><span class="w"> </span><span class="nx">have</span><span class="w"> </span><span class="nx">an</span><span class="w"> </span><span class="nx">empty</span><span class="w"> </span><span class="nx">string</span><span class="w"> </span><span class="ow">in</span>
<span class="w">         </span><span class="s1">&#39; that position.</span>

<span class="s1">         MyChartAddXY intJ * dblDaysIncrement, 0 - 200, strTimeLabels(intJ), vbWhite   </span>
<span class="s1">      Next      </span>

<span class="s1">   End If</span>

<span class="s1">   &#39;</span><span class="o">===============================================================================</span>
<span class="w">   </span><span class="s1">&#39; Add trace(s) depending on the sensor or plot type...</span>
<span class="s1">   &#39;</span><span class="o">===============================================================================</span><span class="w">  </span>
<span class="w">   </span>
<span class="w">   </span><span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">left</span><span class="p">(</span><span class="nx">strSensorType</span><span class="p">,</span><span class="mf">4</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Wind&quot;</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">   </span>
<span class="w">      </span><span class="nx">intGray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">175</span>
<span class="w">      </span>
<span class="w">      </span><span class="s1">&#39; Make horizontal lines for the compass points. Do this before adding the</span>
<span class="s1">      &#39;</span><span class="w"> </span><span class="nx">trace</span><span class="w"> </span><span class="nx">lines</span><span class="w"> </span><span class="nx">so</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="nx">points</span><span class="w"> </span><span class="nx">will</span><span class="w"> </span><span class="nx">lay</span><span class="w"> </span><span class="nx">on</span><span class="w"> </span><span class="nx">top</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="nx">reference</span><span class="w"> </span><span class="nx">lines</span><span class="p">.</span>
<span class="w">       </span>
<span class="w">      </span><span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">strSensorType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Wind36&quot;</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">         </span><span class="nx">AddHorizontalLine_gray</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="nx">intGray</span><span class="p">,</span><span class="w">  </span><span class="mf">45</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dblWindNormFactor</span>
<span class="w">         </span><span class="nx">AddHorizontalLine_gray</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="nx">intGray</span><span class="p">,</span><span class="w"> </span><span class="mf">135</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dblWindNormFactor</span>
<span class="w">         </span><span class="nx">AddHorizontalLine_gray</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="nx">intGray</span><span class="p">,</span><span class="w"> </span><span class="mf">225</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dblWindNormFactor</span>
<span class="w">         </span><span class="nx">AddHorizontalLine_gray</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="nx">intGray</span><span class="p">,</span><span class="w"> </span><span class="mf">315</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dblWindNormFactor</span>
<span class="w">      </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>
<span class="w">     </span>
<span class="w">      </span><span class="s1">&#39; These are common to both Wind40 and Wind36</span>
<span class="s1">      AddHorizontalLine_gray 1, intGray,   0 * dblWindNormFactor</span>
<span class="s1">      AddHorizontalLine_gray 1, intGray,  90 * dblWindNormFactor</span>
<span class="s1">      AddHorizontalLine_gray 1, intGray, 180 * dblWindNormFactor</span>
<span class="s1">      AddHorizontalLine_gray 1, intGray, 270 * dblWindNormFactor</span>
<span class="s1">      AddHorizontalLine_gray 1, intGray, 360 * dblWindNormFactor</span>
<span class="s1">      </span>
<span class="s1">      AddTrace &quot;WindDirection&quot;, 6, &quot;Direction               &quot;,     3, vbWhite,             dicTraceIO</span>
<span class="s1">      AddTrace &quot;WindGust&quot;,      5, &quot;Maximum Speed&quot;,                2, RGB(&amp;h00,&amp;h80,&amp;h80), dicTraceIO     </span>
<span class="s1">      intMaxGust = dicTraceIO.Item(&quot;YMax&quot;)</span>
<span class="s1">      AddTrace &quot;WindSpeed&quot;,     5, &quot;Average Speed&quot;,                2, vbRed,               dicTraceIO</span>
<span class="s1">      </span>
<span class="s1">      If dicTraceIO.Item(&quot;FoundData&quot;) Then</span>
<span class="s1">      </span>
<span class="s1">         &#39;</span><span class="w"> </span><span class="nx">To</span><span class="w"> </span><span class="nx">be</span><span class="w"> </span><span class="nx">consistent</span><span class="w"> </span><span class="kd">with</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">other</span><span class="w"> </span><span class="nx">sensor</span><span class="w"> </span><span class="nx">charts</span><span class="p">,</span><span class="w"> </span><span class="nx">putting</span><span class="w"> </span><span class="nx">these</span><span class="w"> </span><span class="nx">scale</span>
<span class="w">         </span><span class="s1">&#39; limits here, after the trace filling calls above.</span>

<span class="s1">         Chart.VertAxisMin = 0.0  &#39;</span><span class="o">-</span><span class="mf">10</span>
<span class="w">         </span><span class="nx">If</span><span class="w">     </span><span class="p">(</span><span class="nx">intMaxGust</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">40</span><span class="p">)</span><span class="w"> </span><span class="nx">then</span>
<span class="w">            </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">VertAxisMax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">CDbl</span><span class="p">(</span><span class="nx">intMaxGust</span><span class="p">)</span>
<span class="w">         </span><span class="nx">Else</span>
<span class="w">            </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">VertAxisMax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">40.0</span>
<span class="w">         </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>
<span class="w">               </span>
<span class="w">         </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">AddAxisLabel</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Wind Speed (mph)&quot;</span>

<span class="w">         </span><span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">intDays</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span><span class="w"> </span><span class="nx">then</span>
<span class="w">            </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">ChartTitleAdd</span><span class="w">  </span><span class="s2">&quot; Wind at &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">strNameForPlot</span><span class="w"> </span>
<span class="w">            </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">HorizAxisMin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.00</span><span class="w">      </span>
<span class="w">         </span><span class="nx">Else</span>
<span class="w">            </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">ChartTitleAdd</span><span class="w">  </span><span class="s2">&quot; Wind at &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">strNameForPlot</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot; on &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">WeekDayName</span><span class="p">(</span><span class="nx">WeekDay</span><span class="p">(</span><span class="nx">dtePostedDate</span><span class="p">))</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot; &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">dtePostedDate</span>
<span class="w">            </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">HorizAxisMin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.04</span><span class="w">      </span>
<span class="w">         </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>

<span class="w">         </span><span class="s1">&#39; Use tweak of -4 if there is a carriage return after each image element</span>
<span class="s1">         &#39;</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">div</span><span class="p">.</span>
<span class="w">         </span><span class="nx">intPixelRightShift_tweak</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mf">4</span>
<span class="w">         </span><span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">intDays</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">10</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">            </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">Width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1250</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">61</span><span class="w">  </span><span class="s1">&#39; The 61 helps to get the days to line up with the temperature chart.</span>
<span class="s1">            intPixelRightShift = -210 + intPixelRightShift_tweak - 3  &#39;</span><span class="w"> </span><span class="nx">The</span><span class="w"> </span><span class="o">-</span><span class="mf">3</span><span class="w"> </span><span class="nx">is</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nx">secondary</span><span class="w"> </span><span class="nx">tweak</span><span class="w"> </span><span class="nx">needed</span><span class="w"> </span><span class="nx">after</span><span class="w"> </span><span class="nx">I</span><span class="w"> </span><span class="nx">added</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="mf">61</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">line</span><span class="w"> </span><span class="nx">above</span><span class="p">.</span>
<span class="w">         </span><span class="nx">Else</span>
<span class="w">            </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">Width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">855</span>
<span class="w">            </span><span class="nx">intPixelRightShift</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mf">188</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">intPixelRightShift_tweak</span>
<span class="w">         </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>

<span class="w">         </span><span class="s1">&#39; Set the chart height based on the y-axis maximum value.  Scale up the</span>
<span class="s1">         &#39;</span><span class="w"> </span><span class="nx">plotting</span><span class="w"> </span><span class="nx">area</span><span class="w"> </span><span class="nx">by</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">ratio</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">intMaxGust</span><span class="o">/</span><span class="mf">40.</span>

<span class="w">         </span><span class="nx">intNonPlottingHeight</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">75</span><span class="w"> </span>
<span class="w">         </span><span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">intMaxGust</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">40</span><span class="p">)</span><span class="w"> </span><span class="nx">then</span><span class="w">    </span>
<span class="w">            </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">Height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="mf">500</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">intNonPlottingHeight</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">intMaxGust</span><span class="o">/</span><span class="mf">40</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">intNonPlottingHeight</span>
<span class="w">            </span><span class="s1">&#39; This gets used in the style-sheet the positions the directions-overlay image.</span>
<span class="s1">            intPixelBottomShift = Fix((intMaxGust * 0.320) - 11)  &#39;</span><span class="nx">This</span><span class="w"> </span><span class="nx">is</span><span class="w"> </span><span class="nx">always</span><span class="w"> </span><span class="nx">positive</span><span class="p">.</span>
<span class="w">            </span>
<span class="w">         </span><span class="nx">Else</span>
<span class="w">            </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">Height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">500</span>
<span class="w">            </span><span class="nx">intPixelBottomShift</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span>
<span class="w">         </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>
<span class="w">         </span>
<span class="w">         </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">LeftAxisIncrement</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">5</span>
<span class="w">      </span>
<span class="w">      </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>

<span class="w">   </span><span class="nx">ElseIf</span><span class="w"> </span><span class="p">(</span><span class="nx">strSensorType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Temperature&quot;</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">         </span>
<span class="w">      </span><span class="s1">&#39; Do this one first. This one should return data for any type</span>
<span class="s1">      &#39;</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">temperature</span><span class="w"> </span><span class="nx">plot</span><span class="p">.</span><span class="w"> </span><span class="nx">If</span><span class="w"> </span><span class="nx">not</span><span class="p">,</span><span class="w"> </span><span class="nx">don</span><span class="s1">&#39;t try the other parts.</span>
<span class="s1">      AddTrace &quot;TempAvg&quot;, 5, &quot;Dry Bulb&quot;, 2, vbRed, dicTraceIO  </span>

<span class="s1">      If dicTraceIO.Item(&quot;FoundData&quot;) Then</span>
<span class="s1">         </span>
<span class="s1">         If IsArray(dataPoints_TempMin) Then</span>
<span class="s1">            AddTrace &quot;TempMin&quot;, 5, &quot;  Min&quot;, 1, vbBlack, dicTraceIO</span>
<span class="s1">            AddTrace &quot;TempMax&quot;, 5, &quot;  Max&quot;, 1, vbBlack, dicTraceIO</span>
<span class="s1">         End If</span>
<span class="s1">         </span>
<span class="s1">         If IsArray(dataPoints_DewPoint) Then</span>
<span class="s1">            AddTrace &quot;DewPoint&quot;, 5, &quot;Dew Point&quot;, 2, RGB(&amp;h00,&amp;h80,&amp;h80), dicTraceIO</span>
<span class="s1">         End If</span>
<span class="s1">      </span>
<span class="s1">         &#39;</span><span class="w"> </span><span class="nx">Ongoing</span><span class="w"> </span><span class="p">(</span><span class="nx">overall</span><span class="p">)</span><span class="w"> </span><span class="nx">Min</span><span class="w"> </span><span class="nx">and</span><span class="w"> </span><span class="nx">Max</span><span class="w"> </span><span class="nx">values</span><span class="w"> </span><span class="nx">are</span><span class="w"> </span><span class="nx">collected</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">dicTraceIO</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">each</span><span class="w"> </span><span class="nx">trace</span>
<span class="w">         </span><span class="s1">&#39; generated.</span>
<span class="s1">         sglTempMin = dicTraceIO(&quot;YMin&quot;)</span>
<span class="s1">         sglTempMax = dicTraceIO(&quot;YMax&quot;)</span>
<span class="s1">         sglTempRange = sglTempMax - sglTempMin</span>
<span class="s1">         </span>
<span class="s1">         &#39;</span><span class="w"> </span><span class="nx">To</span><span class="w"> </span><span class="nx">be</span><span class="w"> </span><span class="nx">consistent</span><span class="w"> </span><span class="kd">with</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">other</span><span class="w"> </span><span class="nx">sensor</span><span class="w"> </span><span class="nx">charts</span><span class="p">,</span><span class="w"> </span><span class="nx">putting</span><span class="w"> </span><span class="nx">these</span><span class="w"> </span><span class="nx">scale</span>
<span class="w">         </span><span class="s1">&#39; limits here, after the trace filling loop above. But seems to work</span>
<span class="s1">         &#39;</span><span class="w"> </span><span class="nx">either</span><span class="w"> </span><span class="nx">way</span><span class="w"> </span><span class="nx">here</span><span class="p">...</span>

<span class="w">         </span><span class="nx">intTempDiffScalingThreshold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">40</span>
<span class="w">         </span><span class="nx">intNonPlottingHeight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">108</span>
<span class="w">         </span><span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">sglTempRange</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">intTempDiffScalingThreshold</span><span class="p">)</span><span class="w"> </span><span class="nx">then</span>
<span class="w">            </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">VertAxisMin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">sglTempMin</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">((</span><span class="nx">intTempDiffScalingThreshold</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">sglTempRange</span><span class="p">)</span><span class="o">/</span><span class="mf">2</span><span class="p">)</span>
<span class="w">            </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">VertAxisMax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">sglTempMax</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">((</span><span class="nx">intTempDiffScalingThreshold</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">sglTempRange</span><span class="p">)</span><span class="o">/</span><span class="mf">2</span><span class="p">)</span>
<span class="w">            </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">Height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">500</span>
<span class="w">         </span><span class="nx">Else</span>
<span class="w">            </span><span class="s1">&#39; The 0.2 keeps the max and min data from being obscured by the outer</span>
<span class="s1">            &#39;</span><span class="w"> </span><span class="nx">boundaries</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">charting</span><span class="w"> </span><span class="nx">area</span><span class="p">.</span>
<span class="w">            </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">VertAxisMin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">sglTempMin</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">0.2</span><span class="w">     </span>
<span class="w">            </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">VertAxisMax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">sglTempMax</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.2</span>
<span class="w">            </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">Height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="mf">500</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">intNonPlottingHeight</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nx">sglTempRange</span><span class="o">/</span><span class="nx">intTempDiffScalingThreshold</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">intNonPlottingHeight</span><span class="w">    </span>
<span class="w">         </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>

<span class="w">         </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">LeftAxisIncrement</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">5</span>
<span class="w">         </span>
<span class="w">         </span>
<span class="w">         </span><span class="s1">&#39; Y axis label</span>
<span class="s1">         Chart.AddAxisLabel 1, &quot;Temperature (F)&quot;</span>
<span class="s1">             </span>
<span class="s1">         If (intDays &gt; 1) Then</span>
<span class="s1">            Chart.ChartTitleAdd  &quot; Temperature at &quot; &amp; strNameForPlot</span>
<span class="s1">         Else</span>
<span class="s1">            Chart.ChartTitleAdd  &quot; Temperature at &quot; &amp; strNameForPlot &amp; &quot; on &quot; &amp; WeekDayName(WeekDay(dtePostedDate)) &amp; &quot; &quot; &amp; dtePostedDate</span>
<span class="s1">         End If    </span>

<span class="s1">         If (intDays &gt;= 10) Then</span>
<span class="s1">            Chart.Width = 1250</span>
<span class="s1">         Else</span>
<span class="s1">            Chart.Width = 791  &#39;</span><span class="mf">780</span><span class="w">            </span>
<span class="w">         </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>

<span class="w">      </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>
<span class="w">      </span>
<span class="w">   </span><span class="nx">ElseIf</span><span class="w"> </span><span class="p">(</span><span class="nx">strSensorType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Pressure&quot;</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span>

<span class="w">      </span><span class="nx">AddTrace</span><span class="w"> </span><span class="s2">&quot;Pressure&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">5</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;no trace label&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="nx">vbRed</span><span class="p">,</span><span class="w"> </span><span class="nx">dicTraceIO</span>
<span class="w">      </span>
<span class="w">      </span><span class="nx">If</span><span class="w"> </span><span class="nx">dicTraceIO</span><span class="p">.</span><span class="nx">Item</span><span class="p">(</span><span class="s2">&quot;FoundData&quot;</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">      </span>
<span class="w">         </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">SeriesInLegend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">False</span>
<span class="w">         </span><span class="nx">sglPressureMin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dicTraceIO</span><span class="p">.</span><span class="nx">Item</span><span class="p">(</span><span class="s2">&quot;YMin&quot;</span><span class="p">)</span>
<span class="w">         </span><span class="nx">sglPressureMax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dicTraceIO</span><span class="p">.</span><span class="nx">Item</span><span class="p">(</span><span class="s2">&quot;YMax&quot;</span><span class="p">)</span>
<span class="w">         </span>
<span class="w">         </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">AddAxisLabel</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Pressure (Inches Hg)&quot;</span>
<span class="w">                  </span>
<span class="w">         </span><span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">intDays</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span><span class="w"> </span><span class="nx">then</span>
<span class="w">            </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">ChartTitleAdd</span><span class="w">  </span><span class="s2">&quot; Barometer at &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">strNameForPlot</span>
<span class="w">         </span><span class="nx">Else</span>
<span class="w">            </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">ChartTitleAdd</span><span class="w">  </span><span class="s2">&quot; Barometer at &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">strNameForPlot</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot; on &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">WeekDayName</span><span class="p">(</span><span class="nx">WeekDay</span><span class="p">(</span><span class="nx">dtePostedDate</span><span class="p">))</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot; &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">dtePostedDate</span>
<span class="w">         </span><span class="nx">end</span><span class="w"> </span><span class="nx">If</span><span class="w">    </span>
<span class="w">      </span>
<span class="w">         </span><span class="s1">&#39; Note: these axis limits only work if they come after</span>
<span class="s1">         &#39;</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">chart</span><span class="w"> </span><span class="nx">filling</span><span class="w"> </span><span class="nx">loop</span><span class="w"> </span><span class="nx">above</span><span class="p">...</span>

<span class="w">         </span><span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">sglPressureMin</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">29.42</span><span class="p">)</span><span class="w"> </span><span class="nx">then</span><span class="w"> </span>
<span class="w">            </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">VertAxisMin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">sglPressureMin</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">0.005</span>
<span class="w">         </span><span class="nx">Else</span>
<span class="w">            </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">VertAxisMin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">29.41</span>
<span class="w">         </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span><span class="w">    </span>
<span class="w">         </span>
<span class="w">         </span><span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">sglPressureMax</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">30.42</span><span class="p">)</span><span class="w"> </span><span class="nx">then</span><span class="w"> </span>
<span class="w">            </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">VertAxisMax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">sglPressureMax</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.005</span>
<span class="w">         </span><span class="nx">Else</span>
<span class="w">            </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">VertAxisMax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">30.43</span>
<span class="w">         </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span><span class="w">        </span>
<span class="w">            </span>
<span class="w">         </span><span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">sglPressureMin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="nx">then</span>
<span class="w">            </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">VertAxisMin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mf">0.5</span>
<span class="w">            </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">VertAxisMax</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">0.5</span><span class="w">   </span>
<span class="w">         </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>
<span class="w">         </span>
<span class="w">         </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">LeftAxisIncrement</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.1</span>
<span class="w">         </span>
<span class="w">         </span><span class="s1">&#39;Chart.AddAxisLabel 1, &quot;Pressure (Inches Hg)&quot;</span>
<span class="s1">         </span>
<span class="s1">         Chart.Height = 500</span>
<span class="s1">         If (intDays &gt;= 10) Then</span>
<span class="s1">            Chart.Width = 1128</span>
<span class="s1">         Else</span>
<span class="s1">            Chart.Width = 685</span>
<span class="s1">         End If</span>

<span class="s1">      End If</span>
<span class="s1">  </span>
<span class="s1">   ElseIf (Left(strSensorType,6) = &quot;DeltaP&quot;) Then</span>
<span class="s1">      </span>
<span class="s1">      &#39;</span><span class="w"> </span><span class="nx">Add</span><span class="w"> </span><span class="nx">some</span><span class="w"> </span><span class="nx">horizontal</span><span class="w"> </span><span class="nx">lines</span>
<span class="w">      </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">AddSeries</span><span class="w"> </span><span class="p">(</span><span class="mf">5</span><span class="p">)</span>
<span class="w">      </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">linewidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2</span>
<span class="w">      </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">SeriesInLegend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">False</span>
<span class="w">      </span><span class="nx">MyChartAddXY</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">vbBlack</span><span class="w">   </span>
<span class="w">      </span><span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">Request</span><span class="p">.</span><span class="nx">QueryString</span><span class="p">(</span><span class="s2">&quot;specName&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">         </span><span class="nx">MyChartAddXY</span><span class="w"> </span><span class="nx">intDays</span><span class="o">+</span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">vbWhite</span>
<span class="w">      </span><span class="nx">Else</span>
<span class="w">         </span><span class="s1">&#39; Gray line (if request is for the 50Webs example chart page).</span>
<span class="s1">         MyChartAddXY intDays+1, 0, &quot;&quot;, RGB(&amp;hB5,&amp;hB5,&amp;hB5)     </span>
<span class="s1">      End If</span>
<span class="s1">      </span>
<span class="s1">      &#39;</span><span class="w"> </span><span class="nx">Add</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">delta</span><span class="o">-</span><span class="nx">P</span><span class="w"> </span><span class="nx">traces</span><span class="p">.</span>
<span class="w">      </span>
<span class="w">      </span><span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">strSensorType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;DeltaP1&quot;</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">               </span>
<span class="w">         </span><span class="nx">dicTraceIO</span><span class="p">(</span><span class="s2">&quot;WestSite&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;PORTLAND&quot;</span>
<span class="w">         </span><span class="nx">dicTraceIO</span><span class="p">(</span><span class="s2">&quot;EastSite&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;THE DALLES&quot;</span>
<span class="w">         </span><span class="nx">AddTrace</span><span class="w"> </span><span class="s2">&quot;DeltaP_trace_A&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">5</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Portland - The Dalles &quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="nx">RGB</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">h00</span><span class="p">,</span><span class="o">&amp;</span><span class="nx">h80</span><span class="p">,</span><span class="o">&amp;</span><span class="nx">h80</span><span class="p">),</span><span class="w"> </span><span class="nx">dicTraceIO</span>
<span class="w">         </span>
<span class="w">         </span><span class="nx">dicTraceIO</span><span class="p">(</span><span class="s2">&quot;WestSite&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;THE DALLES&quot;</span>
<span class="w">         </span><span class="nx">dicTraceIO</span><span class="p">(</span><span class="s2">&quot;EastSite&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;PASCO&quot;</span>
<span class="w">         </span><span class="nx">AddTrace</span><span class="w"> </span><span class="s2">&quot;DeltaP_trace_B&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">5</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;The Dalles - Pasco&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="nx">vbRed</span><span class="p">,</span><span class="w"> </span><span class="nx">dicTraceIO</span>
<span class="w">         </span>
<span class="w">         </span><span class="s1">&#39;&quot;NORTH BEND&quot;, &quot;PASCO&quot;</span>
<span class="s1">               </span>
<span class="s1">      ElseIf (strSensorType = &quot;DeltaP2&quot;) Then</span>
<span class="s1">         </span>
<span class="s1">         dicTraceIO(&quot;WestSite&quot;) = &quot;KTTD&quot;</span>
<span class="s1">         dicTraceIO(&quot;EastSite&quot;) = &quot;KDLS&quot;</span>
<span class="s1">         AddTrace &quot;DeltaP_trace_A&quot;, 5, &quot;Troutdale - The Dalles&quot;, 2, RGB(&amp;h00,&amp;h80,&amp;h80), dicTraceIO</span>
<span class="s1">         </span>
<span class="s1">         dicTraceIO(&quot;WestSite&quot;) = &quot;KDLS&quot;</span>
<span class="s1">         dicTraceIO(&quot;EastSite&quot;) = &quot;KHRI&quot;</span>
<span class="s1">         AddTrace &quot;DeltaP_trace_B&quot;, 5, &quot;The Dalles - Hermiston&quot;, 2, vbRed, dicTraceIO</span>
<span class="s1">         </span>
<span class="s1">         &#39;</span><span class="w"> </span><span class="nx">dicTraceIO</span><span class="p">(</span><span class="s2">&quot;WestSite&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;KTTD&quot;</span>
<span class="w">         </span><span class="s1">&#39; dicTraceIO(&quot;EastSite&quot;) = &quot;KHRI&quot;</span>
<span class="s1">         &#39;</span><span class="w"> </span><span class="nx">AddTrace</span><span class="w"> </span><span class="s2">&quot;DeltaP_trace_B&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">5</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Troutdale - Hermiston&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="nx">vbBlue</span><span class="p">,</span><span class="w"> </span><span class="nx">dicTraceIO</span>

<span class="w">      </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>
<span class="w">      </span>
<span class="w">      </span><span class="nx">If</span><span class="w"> </span><span class="nx">dicTraceIO</span><span class="p">.</span><span class="nx">Item</span><span class="p">(</span><span class="s2">&quot;FoundData&quot;</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">         </span><span class="s1">&#39; Force limits on the Y axis for the Delta-P chart.</span>
<span class="s1">         dblDPmin = dicTraceIO(&quot;YMin&quot;)</span>
<span class="s1">         dblDPmax = dicTraceIO(&quot;YMax&quot;)</span>
<span class="s1">         </span>
<span class="s1">         If (dblDPmin &lt; -0.08) Then</span>
<span class="s1">            Chart.VertAxisMin = dblDPmin - .001</span>
<span class="s1">         Else</span>
<span class="s1">            Chart.VertAxisMin = -0.08</span>
<span class="s1">         End If</span>
<span class="s1">         </span>
<span class="s1">         If (dblDPmax &gt; 0.18) Then</span>
<span class="s1">            Chart.VertAxisMax = dblDPmax + 0.001</span>
<span class="s1">         Else</span>
<span class="s1">            Chart.VertAxisMax = 0.18</span>
<span class="s1">         End If</span>
<span class="s1">           </span>
<span class="s1">           </span>
<span class="s1">         If (intDays &gt; 1) Then</span>
<span class="s1">            Chart.ChartTitleAdd  &quot;Delta-P&quot;</span>
<span class="s1">         Else</span>
<span class="s1">            Chart.ChartTitleAdd  &quot;Delta-P on &quot; &amp; WeekDayName(WeekDay(dtePostedDate)) &amp; &quot; &quot; &amp; dtePostedDate</span>
<span class="s1">         End If    </span>
<span class="s1">         </span>
<span class="s1">         Chart.LeftAxisIncrement = 0.05</span>
<span class="s1">         </span>
<span class="s1">         Chart.AddAxisLabel 1, &quot;Pressure Differential (Inches Hg)&quot;</span>
<span class="s1">         </span>
<span class="s1">         If (intDays &gt;= 10) Then</span>
<span class="s1">            Chart.Width = 1270</span>
<span class="s1">         Else</span>
<span class="s1">            Chart.Width = 875</span>
<span class="s1">         End If</span>
<span class="s1">         </span>
<span class="s1">         &#39;</span><span class="w"> </span><span class="nx">Scale</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">height</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">image</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">y</span><span class="w"> </span><span class="nx">range</span><span class="w"> </span><span class="nx">is</span><span class="w"> </span><span class="nx">larger</span><span class="w"> </span><span class="nx">than</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="mf">0.26</span><span class="p">.</span>
<span class="w">         </span><span class="nx">intNonPlottingHeight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">90</span>
<span class="w">         </span><span class="nx">If</span><span class="w"> </span><span class="p">((</span><span class="nx">Chart</span><span class="p">.</span><span class="nx">VertAxisMax</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">VertAxisMin</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.26</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span><span class="w">    </span>
<span class="w">            </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">Height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="mf">510</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">intNonPlottingHeight</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">((</span><span class="nx">Chart</span><span class="p">.</span><span class="nx">VertAxisMax</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">VertAxisMin</span><span class="p">)</span><span class="o">/</span><span class="mf">0.26</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">intNonPlottingHeight</span>
<span class="w">         </span><span class="nx">Else</span>
<span class="w">            </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">Height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">510</span>
<span class="w">         </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span><span class="w">         </span>
<span class="w">         </span>
<span class="w">      </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>
<span class="w">   </span>
<span class="w">   </span><span class="nx">Else</span>
<span class="w">      </span><span class="s1">&#39; Shouldn&#39;</span><span class="nx">t</span><span class="w"> </span><span class="nx">ever</span><span class="w"> </span><span class="nx">get</span><span class="w"> </span><span class="nx">here</span><span class="p">...</span>
<span class="w">      </span><span class="nx">RBC</span><span class="w"> </span><span class="s2">&quot;No data or no match found for the specified sensor type.&quot;</span><span class="w"> </span>
<span class="w">   </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span><span class="w"> </span>

<span class="w">   </span><span class="s1">&#39;=============================================================================</span>
<span class="s1">   &#39;</span><span class="w"> </span><span class="nx">Control</span><span class="w"> </span><span class="nx">chart</span><span class="w"> </span><span class="nx">axes</span><span class="w"> </span><span class="nx">and</span><span class="w"> </span><span class="nx">labeling</span><span class="p">...</span>
<span class="w">   </span><span class="s1">&#39; (This is done for every type of plot)</span>
<span class="s1">   &#39;</span><span class="o">=============================================================================</span>

<span class="w">   </span><span class="nx">If</span><span class="w"> </span><span class="nx">dicTraceIO</span><span class="p">.</span><span class="nx">Item</span><span class="p">(</span><span class="s2">&quot;FoundData&quot;</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">      </span>
<span class="w">      </span><span class="s1">&#39; Plot the LatestRecord and the NOW lines.</span>
<span class="s1">      If ((intDays = 1) and (str24Hrs_state = &quot;checked&quot;)) Then</span>
<span class="s1">         AddVerticalLine DaysDec( strMRTime),  1</span>
<span class="s1">         AddVerticalLine DaysDec( dteNowTime), 1</span>
<span class="s1">      End If</span>
<span class="s1">        </span>
<span class="s1">      Chart.HorizAxisMax = intDays</span>
<span class="s1">      Chart.ShowMinorTicks false, false  </span>
<span class="s1">        </span>
<span class="s1">      If (intDays &gt; 1) then</span>
<span class="s1">         &#39;</span><span class="w"> </span><span class="nb">Set</span><span class="w"> </span><span class="nx">Horizontal</span><span class="w"> </span><span class="nx">Axis</span><span class="w"> </span><span class="nx">Label</span><span class="w"> </span><span class="nx">Style</span><span class="w"> </span><span class="nx">to</span><span class="o">:</span><span class="w"> </span><span class="nx">Axis</span><span class="w"> </span><span class="nx">Scales</span><span class="w"> </span><span class="p">(</span><span class="mf">2</span><span class="p">)</span>
<span class="w">         </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">HLabelStyle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span>
<span class="w">                  </span>
<span class="w">         </span><span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">blnDayLightSavingsTime</span><span class="w"> </span><span class="nx">And</span><span class="w"> </span><span class="p">(</span><span class="nx">strTimeZone</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="s2">&quot;H&quot;</span><span class="p">))</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">            </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">AddAxisLabel</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Days Starting with &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">WeekDayName</span><span class="p">(</span><span class="nx">WeekDay</span><span class="p">(</span><span class="nx">dteStartDate_forLabels</span><span class="p">))</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot; &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">FormatDateTime</span><span class="p">(</span><span class="nx">dteStartDate_forLabels</span><span class="p">,</span><span class="w"> </span><span class="nx">vbShortDate</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot; (&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">strTimeZone</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;DT)&quot;</span>
<span class="w">         </span><span class="nx">Else</span>
<span class="w">            </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">AddAxisLabel</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Days Starting with &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">WeekDayName</span><span class="p">(</span><span class="nx">WeekDay</span><span class="p">(</span><span class="nx">dteStartDate_forLabels</span><span class="p">))</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot; &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">FormatDateTime</span><span class="p">(</span><span class="nx">dteStartDate_forLabels</span><span class="p">,</span><span class="w"> </span><span class="nx">vbShortDate</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot; (&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">strTimeZone</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;ST)&quot;</span>
<span class="w">         </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>
<span class="w">         </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">HorizAxisMin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="w">     </span>
<span class="w">      </span><span class="nx">Else</span>
<span class="w">         </span><span class="s1">&#39; Set Horizontal Axis Label Style to: Automatic (0)      </span>
<span class="s1">         Chart.HLabelStyle = 0</span>
<span class="s1">             </span>
<span class="s1">         If (blnDayLightSavingsTime And (strTimeZone &lt;&gt; &quot;H&quot;)) Then</span>
<span class="s1">            Chart.AddAxisLabel 2, &quot;Hour of the Day (&quot; &amp; strTimeZone &amp; &quot;DT)&quot;</span>
<span class="s1">         Else</span>
<span class="s1">            Chart.AddAxisLabel 2, &quot;Hour of the Day (&quot; &amp; strTimeZone &amp; &quot;ST)&quot;</span>
<span class="s1">         End If</span>
<span class="s1">         </span>
<span class="s1">         &#39;</span><span class="w"> </span><span class="nx">Make</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nx">little</span><span class="w"> </span><span class="nx">more</span><span class="w"> </span><span class="nx">room</span><span class="w"> </span><span class="nx">on</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">y</span><span class="w"> </span><span class="nx">axis</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">last</span><span class="w"> </span><span class="nx">point</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="nx">yesterday</span><span class="p">.</span><span class="w"> </span><span class="nx">The</span>
<span class="w">         </span><span class="s1">&#39; square boxes (markers) for the direction trace enforce a little more room on </span>
<span class="s1">         &#39;</span><span class="w"> </span><span class="nx">their</span><span class="w"> </span><span class="nx">own</span><span class="p">,</span><span class="w"> </span><span class="nx">so</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">non</span><span class="o">-</span><span class="nx">wind</span><span class="w"> </span><span class="nx">plots</span><span class="w"> </span><span class="nx">require</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nx">little</span><span class="w"> </span><span class="nx">more</span><span class="w"> </span><span class="nx">wiggle</span><span class="w"> </span><span class="nx">room</span><span class="w"> </span><span class="nx">on</span><span class="w"> </span><span class="nx">each</span><span class="w"> </span>
<span class="w">         </span><span class="s1">&#39; end of the x-axis.</span>
<span class="s1">         If (left(strSensorType,4) = &quot;Wind&quot;) Then</span>
<span class="s1">            Chart.HorizAxisMin = -0.001</span>
<span class="s1">            Chart.HorizAxisMax = intDays + 0.001</span>
<span class="s1">         Else</span>
<span class="s1">            &#39;</span><span class="nx">Chart</span><span class="p">.</span><span class="nx">HorizAxisMin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.00</span>
<span class="w">            </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">HorizAxisMin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mf">0.003</span><span class="w">  </span>
<span class="w">            </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">HorizAxisMax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">intDays</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.003</span><span class="w">            </span>
<span class="w">         </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>
<span class="w">      </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>

<span class="w">      </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">ChartTitleFont</span><span class="p">.</span><span class="nx">Size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">16</span>
<span class="w">      </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">ChartTitleFont</span><span class="p">.</span><span class="nx">Name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Arial&quot;</span><span class="w">    </span>
<span class="w">      </span><span class="s1">&#39;Chart.ChartTitleFontColor = vbBlue</span>
<span class="s1">      Chart.ChartTitleFontColor = RGB(&amp;h00,&amp;h80,&amp;h80)    </span>
<span class="s1">      Chart.LegendFont.Size = 10</span>
<span class="s1">      Chart.AxisLabelFontBottom.Size = 10</span>
<span class="s1">      Chart.AxisLabelFontLeft.Size = 10</span>
<span class="s1">        </span>
<span class="s1">      Chart.BevelOuter = false</span>
<span class="s1">      </span>
<span class="s1">      If (Request.QueryString(&quot;specName&quot;) &lt;&gt; &quot;&quot;) Then</span>
<span class="s1">         Chart.GradientVisible = false</span>
<span class="s1">      Else</span>
<span class="s1">         Chart.GradientVisible = true</span>
<span class="s1">      End If</span>
<span class="s1">      Chart.GradientStartColor = RGB(&amp;hff,&amp;hcc,&amp;h99)</span>
<span class="s1">      Chart.GradientEndColor = vbWhite</span>
<span class="s1">      </span>
<span class="s1">      Chart.PanelColor = vbWhite</span>
<span class="s1">      Chart.View3D = false</span>
<span class="s1">      Chart.LegendVisible = true</span>
<span class="s1">      Chart.LegendStyle = 1</span>

<span class="s1">      &#39;</span><span class="w"> </span><span class="nb">Set</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">filename</span><span class="p">,</span><span class="w"> </span><span class="nx">save</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">image</span><span class="w"> </span><span class="nx">and</span><span class="w"> </span><span class="nx">write</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">image</span><span class="w"> </span><span class="nx">tag</span><span class="p">.</span>
<span class="w">        </span>
<span class="w">      </span><span class="s1">&#39; Do this with sessionID and random name generated via the</span>
<span class="s1">      &#39;</span><span class="w"> </span><span class="nx">FileSystemObject</span><span class="p">.</span><span class="w"> </span><span class="nx">First</span><span class="w"> </span><span class="nx">make</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nx">string</span><span class="w"> </span><span class="kd">with</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nx">random</span><span class="w"> </span><span class="nx">name</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">it</span><span class="p">.</span><span class="w"> </span><span class="nx">Use</span>
<span class="w">      </span><span class="s1">&#39; split here to get rid of the txt extension that normally is returned.</span>

<span class="s1">      strRandomNameString = Split(Server.CreateObject(&quot;Scripting.FileSystemObject&quot;).GetTempName,&quot;.&quot;)(0)</span>
<span class="s1">      If (Request.QueryString(&quot;specName&quot;) &lt;&gt; &quot;&quot;) Then</span>
<span class="s1">         strFileName2 = Request.QueryString(&quot;specName&quot;) &amp; &quot;.jpg&quot;</span>
<span class="s1">      Else</span>
<span class="s1">         strFileName2 = &quot;S&quot; &amp; &quot;_&quot; &amp; Session.SessionID &amp; &quot;_&quot; &amp; strRandomNameString &amp; &quot;.jpg&quot; </span>
<span class="s1">      End If</span>

<span class="s1">      &#39;</span><span class="nx">Response</span><span class="p">.</span><span class="nx">Write</span><span class="w"> </span><span class="s2">&quot;filename = &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">strPathToImageDir</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">strFileName2</span>
<span class="w">        </span>
<span class="w">      </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">FileName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">strPathToImageDir</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">strFileName2</span>
<span class="w">      </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">SaveChart</span>
<span class="w">      </span><span class="nb">Set</span><span class="w"> </span><span class="nx">Chart</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">nothing</span><span class="w">  </span>
<span class="w">     </span>
<span class="w">      </span><span class="s1">&#39; Put these two images into a DIV element that doesn&#39;</span><span class="nx">t</span><span class="w"> </span><span class="nx">wrap</span><span class="o">!</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">      </span><span class="s1">&#39; position the directions overlay relative to the original chart image.</span>

<span class="s1">      RC &quot;&lt;div style=&#39;</span><span class="nx">white</span><span class="o">-</span><span class="nx">space</span><span class="o">:</span><span class="nx">nowrap</span><span class="p">;</span><span class="s1">&#39;&gt;&quot;</span>
<span class="s1">      RC &quot;&lt;img id=&#39;</span><span class="nx">chartimage</span><span class="s1">&#39; style=&#39;</span><span class="nx">visibility</span><span class="o">:</span><span class="nx">hidden</span><span class="s1">&#39; src=&#39;</span><span class="s2">&quot; &amp; strURLPathToImageDir &amp; strFileName2 &amp; &quot;</span><span class="s1">&#39;&gt;&quot;</span>
<span class="s1">      </span>
<span class="s1">      If (Left(strSensorType,4) = &quot;Wind&quot;) Then</span>
<span class="s1">         If (strSensorType = &quot;Wind40&quot;) Then</span>
<span class="s1">            directAxisScale = &quot;&#39;</span><span class="nx">pictures</span><span class="o">/</span><span class="nx">directions_40</span><span class="p">.</span><span class="nx">gif</span><span class="s1">&#39;&quot;</span>
<span class="s1">         ElseIf (strSensorType = &quot;Wind36&quot;) Then</span>
<span class="s1">            directAxisScale = &quot;&#39;</span><span class="nx">pictures</span><span class="o">/</span><span class="nx">directions_36</span><span class="p">.</span><span class="nx">gif</span><span class="s1">&#39;&quot;</span>
<span class="s1">         End If</span>
<span class="s1">         RC &quot;&lt;img id=&#39;</span><span class="nx">directions</span><span class="s1">&#39; src=&quot; &amp; directAxisScale &amp; _</span>
<span class="s1">            &quot;style=&#39;</span><span class="nx">visibility</span><span class="o">:</span><span class="nx">hidden</span><span class="p">;</span><span class="w"> </span><span class="nx">position</span><span class="o">:</span><span class="nx">relative</span><span class="p">;</span><span class="w"> </span><span class="nx">left</span><span class="o">:</span><span class="s2">&quot; &amp; intPixelRightShift &amp; &quot;</span><span class="nx">px</span><span class="p">;</span><span class="w"> </span><span class="nx">bottom</span><span class="o">:</span><span class="s2">&quot; &amp; intPixelBottomShift &amp; &quot;</span><span class="nx">px</span><span class="s1">&#39;&gt;&quot;</span>
<span class="s1">      Else</span>
<span class="s1">         &#39;</span><span class="w"> </span><span class="nx">Could</span><span class="w"> </span><span class="nx">add</span><span class="w"> </span><span class="nx">secondary</span><span class="w"> </span><span class="nx">images</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">other</span><span class="w"> </span><span class="nx">sensors</span><span class="w"> </span><span class="nx">types</span><span class="w"> </span><span class="nx">here</span><span class="p">...</span>
<span class="w">      </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>
<span class="w">      </span>
<span class="w">      </span><span class="nx">RC</span><span class="w"> </span><span class="s2">&quot;&lt;/div&gt;&quot;</span>
<span class="w">        </span>
<span class="w">   </span><span class="nx">Else</span>
<span class="w">      </span><span class="nx">Response</span><span class="p">.</span><span class="nx">Write</span><span class="w"> </span><span class="s2">&quot;The query has returned no data for the selected sensor, location, and time period.&quot;</span>
<span class="w">   </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>
<span class="nx">End</span><span class="w"> </span><span class="nx">Sub</span>


<span class="nb">Function</span><span class="w"> </span><span class="nx">TimeZone</span><span class="p">(</span><span class="w"> </span><span class="nx">strStationName</span><span class="p">)</span>
<span class="w">   </span><span class="nx">strSQL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;SELECT StationNames.StationName, StationNames.NickName, StationNames.TimeZone FROM StationNames &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">            </span><span class="s2">&quot;WHERE (StationName = &#39;&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">strStationName</span><span class="w">  </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;&#39;) &quot;</span>
<span class="w">   </span>
<span class="w">   </span><span class="nb">Set</span><span class="w"> </span><span class="nx">rstTimeZone</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Server</span><span class="p">.</span><span class="nx">CreateObject</span><span class="p">(</span><span class="s2">&quot;ADODB.Recordset&quot;</span><span class="p">)</span>
<span class="w">	</span><span class="nx">On</span><span class="w"> </span><span class="ne">Error</span><span class="w"> </span><span class="nx">Resume</span><span class="w"> </span><span class="nx">Next</span>
<span class="w">	</span><span class="nx">rstTimeZone</span><span class="p">.</span><span class="nx">Open</span><span class="w"> </span><span class="nx">strSQL</span><span class="p">,</span><span class="w"> </span><span class="nx">DBConnection</span><span class="p">,</span><span class="w"> </span><span class="nx">adOpenStatic</span><span class="p">,</span><span class="w"> </span><span class="nx">adLockReadOnly</span><span class="p">,</span><span class="w"> </span><span class="nx">adCmdText</span>
<span class="w">	</span><span class="nx">LogError</span><span class="p">(</span><span class="s2">&quot;Recordset = rstTelem, SQL = &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">strSQL_trace</span><span class="p">)</span>
<span class="w">	</span><span class="nx">On</span><span class="w"> </span><span class="ne">Error</span><span class="w"> </span><span class="nx">Goto</span><span class="w"> </span><span class="mf">0</span>

<span class="w">   </span><span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">rstTimeZone</span><span class="p">.</span><span class="nx">RecordCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">      </span><span class="nx">TimeZone</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;?&quot;</span>
<span class="w">   </span><span class="nx">Else</span><span class="w"> </span>
<span class="w">      </span><span class="nx">rstTimeZone</span><span class="p">.</span><span class="nx">MoveFirst</span>
<span class="w">      </span><span class="nx">TimeZone</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">rstTimeZone</span><span class="p">(</span><span class="s2">&quot;TimeZone&quot;</span><span class="p">)</span>
<span class="w">   </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>

<span class="w">   </span><span class="nx">If</span><span class="w"> </span><span class="nx">rstTimeZone</span><span class="p">.</span><span class="nx">State</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">adStateOpen</span><span class="w"> </span><span class="nx">Then</span><span class="w"> </span><span class="nx">rstTimeZone</span><span class="p">.</span><span class="nx">Close</span>
<span class="w">   </span><span class="nb">Set</span><span class="w"> </span><span class="nx">rstTimeZone</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Nothing</span>
<span class="nx">End</span><span class="w"> </span><span class="nb">Function</span>


<span class="nb">Function</span><span class="w"> </span><span class="nx">RegionString</span><span class="p">(</span><span class="w"> </span><span class="nx">strRegion</span><span class="p">)</span>
<span class="w">   </span><span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">strRegion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;MN&quot;</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">      </span><span class="nx">RegionString</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Minnesota Weather&quot;</span>
<span class="w">   </span><span class="nx">ElseIf</span><span class="w"> </span><span class="p">(</span><span class="nx">strRegion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;CR&quot;</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">      </span><span class="nx">RegionString</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Columbia Basin Weather&quot;</span>
<span class="w">   </span><span class="nx">ElseIf</span><span class="w"> </span><span class="p">(</span><span class="nx">strRegion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Misc&quot;</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">      </span><span class="nx">RegionString</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Misc. Weather Stations&quot;</span>
<span class="w">   </span><span class="nx">Else</span>
<span class="w">      </span><span class="nx">RWBR</span><span class="w"> </span><span class="s2">&quot;No match when branching on Region.&quot;</span>
<span class="w">   </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>
<span class="nx">End</span><span class="w"> </span><span class="nb">Function</span>


<span class="s1">&#39;=======================================================================================</span>
<span class="s1">&#39;</span><span class="w"> </span><span class="nx">Main</span><span class="w"> </span><span class="nx">program</span><span class="w"> </span><span class="nx">body</span><span class="w"> </span><span class="p">(</span><span class="nx">start</span><span class="w"> </span><span class="nx">here</span><span class="w"> </span><span class="nx">and</span><span class="w"> </span><span class="nx">execute</span><span class="w"> </span><span class="nx">every</span><span class="w"> </span><span class="nx">time</span><span class="w"> </span><span class="ow">in</span><span class="p">)</span>
<span class="s1">&#39;=======================================================================================</span>
<span class="s1">  </span>
<span class="s1">&#39;</span><span class="w"> </span><span class="nx">Build</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">page</span>
<span class="o">%&gt;</span>

<span class="o">&lt;</span><span class="nx">html</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nx">head</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nx">meta</span><span class="w"> </span><span class="nx">name</span><span class="o">=</span><span class="s1">&#39;Author&#39;</span><span class="w"> </span><span class="nx">content</span><span class="o">=</span><span class="s1">&#39;James D. (Jim) Miller&#39;</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nx">meta</span><span class="w"> </span><span class="nx">name</span><span class="o">=</span><span class="s1">&#39;keywords&#39;</span><span class="w"> </span>
<span class="w">      </span><span class="nx">content</span><span class="o">=</span><span class="s1">&#39;WA,Washington,OR,Orgeon,MN,Minnesota,columbia,basin,weather,chart,plot,roosevelt,</span>
<span class="s1">               windsurfing,gorge,richland,wind,temperature,pressure,dewpoint&#39;</span><span class="o">&gt;</span><span class="w">             </span>
<span class="o">&lt;</span><span class="nx">meta</span><span class="w"> </span><span class="nx">charset</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span><span class="o">&gt;</span>

<span class="c">&lt;!--</span><span class="w"> </span><span class="nx">Icon</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">browsers</span><span class="w"> </span><span class="nx">using</span><span class="w"> </span><span class="nx">Waconia</span><span class="p">.</span><span class="w">  </span><span class="o">--&gt;</span><span class="w"> </span>
<span class="o">&lt;</span><span class="nx">link</span><span class="w"> </span><span class="nx">rel</span><span class="o">=</span><span class="s1">&#39;SHORTCUT ICON&#39;</span><span class="w"> </span><span class="nx">href</span><span class="o">=</span><span class="s1">&#39;pictures/favicon.ico&#39;</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nx">title</span><span class="o">&gt;</span><span class="nx">Waconia</span><span class="w"> </span><span class="nx">Weather</span><span class="w"> </span><span class="nx">Database</span><span class="o">&lt;</span><span class="err">/title&gt;</span>

<span class="o">&lt;</span><span class="nx">style</span><span class="o">&gt;</span>
<span class="w">   </span><span class="nx">TD</span><span class="w"> </span><span class="p">{</span><span class="nx">font</span><span class="o">-</span><span class="nx">family</span><span class="o">:</span><span class="w"> </span><span class="nx">Times</span><span class="p">;}</span>
<span class="w">   </span><span class="nx">TD</span><span class="p">.</span><span class="nx">data</span><span class="w"> </span><span class="p">{</span><span class="nx">font</span><span class="o">-</span><span class="nx">family</span><span class="o">:</span><span class="w"> </span><span class="nx">Arial</span><span class="p">;}</span>

<span class="w">   </span><span class="nx">A</span><span class="w">         </span><span class="p">{</span><span class="nx">color</span><span class="o">:</span><span class="err">#</span><span class="mo">00</span><span class="mf">8080</span><span class="p">;</span><span class="w"> </span><span class="nx">text</span><span class="o">-</span><span class="nx">decoration</span><span class="o">:</span><span class="nx">underline</span><span class="p">}</span>
<span class="w">   </span><span class="nx">A</span><span class="o">:</span><span class="nx">hover</span><span class="w">   </span><span class="p">{</span><span class="nx">color</span><span class="o">:</span><span class="err">#</span><span class="mo">00</span><span class="mf">8080</span><span class="p">;</span><span class="w"> </span><span class="nx">text</span><span class="o">-</span><span class="nx">decoration</span><span class="o">:</span><span class="nx">none</span><span class="p">;</span><span class="w"> </span><span class="nx">background</span><span class="o">:</span><span class="n">#FFF1E3</span><span class="p">}</span>

<span class="w">   </span><span class="nx">A</span><span class="p">.</span><span class="nx">noline</span><span class="w">       </span><span class="p">{</span><span class="nx">color</span><span class="o">:</span><span class="err">#</span><span class="mo">00</span><span class="mf">8080</span><span class="p">;</span><span class="w"> </span><span class="nx">text</span><span class="o">-</span><span class="nx">decoration</span><span class="o">:</span><span class="nx">none</span><span class="p">;</span><span class="w">      </span><span class="nx">font</span><span class="o">-</span><span class="nx">size</span><span class="o">:</span><span class="mf">18</span><span class="nx">pt</span><span class="p">;</span><span class="w"> </span><span class="nx">font</span><span class="o">-</span><span class="nx">weight</span><span class="o">:</span><span class="nx">bolder</span><span class="p">;</span><span class="w">                   </span><span class="p">}</span>
<span class="w">   </span><span class="nx">A</span><span class="p">.</span><span class="nx">noline</span><span class="o">:</span><span class="nx">hover</span><span class="w"> </span><span class="p">{</span><span class="nx">color</span><span class="o">:</span><span class="err">#</span><span class="mo">00</span><span class="mf">8080</span><span class="p">;</span><span class="w"> </span><span class="nx">text</span><span class="o">-</span><span class="nx">decoration</span><span class="o">:</span><span class="nx">underline</span><span class="p">;</span><span class="w"> </span><span class="nx">font</span><span class="o">-</span><span class="nx">size</span><span class="o">:</span><span class="mf">18</span><span class="nx">pt</span><span class="p">;</span><span class="w"> </span><span class="nx">font</span><span class="o">-</span><span class="nx">weight</span><span class="o">:</span><span class="nx">bolder</span><span class="p">;</span><span class="w"> </span><span class="nx">background</span><span class="o">:</span><span class="n">#FFCC99</span><span class="p">}</span>
<span class="w">   </span>
<span class="w">   </span><span class="nx">span</span><span class="p">.</span><span class="nx">regionstring</span><span class="w"> </span><span class="p">{</span><span class="nx">color</span><span class="o">:</span><span class="err">#</span><span class="mo">00</span><span class="mf">8080</span><span class="p">;</span><span class="w"> </span><span class="nx">font</span><span class="o">-</span><span class="nx">size</span><span class="o">:</span><span class="mf">18</span><span class="nx">pt</span><span class="p">;</span><span class="w"> </span><span class="nx">font</span><span class="o">-</span><span class="nx">weight</span><span class="o">:</span><span class="nx">bolder</span><span class="p">;}</span>
<span class="w">   </span>
<span class="w">   </span><span class="nx">div</span><span class="p">.</span><span class="nx">pageblock</span><span class="w"> </span><span class="p">{</span><span class="nx">min</span><span class="o">-</span><span class="nx">width</span><span class="o">:</span><span class="w"> </span><span class="mf">650</span><span class="nx">px</span><span class="p">;</span><span class="w"> </span><span class="nx">max</span><span class="o">-</span><span class="nx">width</span><span class="o">:</span><span class="w"> </span><span class="mf">1000</span><span class="nx">px</span><span class="p">;}</span>
<span class="o">&lt;</span><span class="err">/style&gt;</span>

<span class="c">&lt;!--</span><span class="p">[</span><span class="k">if</span><span class="w"> </span><span class="nx">IE</span><span class="p">]</span><span class="o">&gt;</span>
<span class="w">   </span><span class="o">&lt;</span><span class="nx">style</span><span class="o">&gt;</span>
<span class="w">      </span><span class="nx">div</span><span class="p">.</span><span class="nx">pageblock</span><span class="w"> </span><span class="p">{</span><span class="nx">width</span><span class="o">:</span><span class="w"> </span><span class="nx">expression</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">clientWidth</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">1000</span><span class="o">?</span><span class="w"> </span><span class="s2">&quot;1000px&quot;</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;auto&quot;</span><span class="w"> </span><span class="p">)};</span>
<span class="w">   </span><span class="o">&lt;</span><span class="err">/style&gt;</span>
<span class="o">&lt;!</span><span class="p">[</span><span class="nx">endif</span><span class="p">]</span><span class="o">--&gt;</span><span class="w">   </span>

<span class="o">&lt;</span><span class="err">/head&gt;</span>

<span class="o">&lt;%</span>

<span class="s1">&#39; Connect to the database.</span>
<span class="s1">Set DBConnection = CreateObject(&quot;ADODB.Connection&quot;)</span>
<span class="s1">DBConnection.Open &quot;DSN=MySQL_telem_for_ASP;&quot;</span>

<span class="s1">Set dicTZ = Server.CreateObject(&quot;Scripting.Dictionary&quot;)</span>
<span class="s1">dicTZ.Add &quot;H&quot;,  -4</span>
<span class="s1">dicTZ.Add &quot;AK&quot;, -3</span>
<span class="s1">dicTZ.Add &quot;P&quot;,  -2</span>
<span class="s1">dicTZ.Add &quot;M&quot;,  -1</span>
<span class="s1">dicTZ.Add &quot;C&quot;,   0</span>
<span class="s1">dicTZ.Add &quot;E&quot;,   1</span>
<span class="s1">dicTZ.Add &quot;J&quot;,  15</span>
<span class="s1">dicTZ.Add &quot;NZ&quot;, 18</span>

<span class="s1">serverTimeArray = split(Now(),&quot; &quot;)</span>
<span class="s1">serverTime = serverTimeArray(1)</span>

<span class="s1">&#39;</span><span class="w"> </span><span class="nx">Establish</span><span class="w"> </span><span class="nx">defaults</span>

<span class="s1">&#39; Region_state (hidden) is used to facilitate changing the location to a default value</span>
<span class="s1">&#39;</span><span class="w"> </span><span class="nx">when</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">region</span><span class="w"> </span><span class="nx">is</span><span class="w"> </span><span class="nx">changed</span><span class="p">.</span>
<span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">Request</span><span class="p">.</span><span class="nx">QueryString</span><span class="p">(</span><span class="s2">&quot;Region_state&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span><span class="w"> </span>
<span class="w">   </span><span class="nx">strRegionState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;new&quot;</span>
<span class="nx">Else</span>
<span class="w">   </span><span class="nx">strRegionState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Request</span><span class="p">.</span><span class="nx">QueryString</span><span class="p">(</span><span class="s2">&quot;Region_state&quot;</span><span class="p">)</span>
<span class="nx">End</span><span class="w"> </span><span class="nx">If</span>

<span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">Request</span><span class="p">.</span><span class="nx">QueryString</span><span class="p">(</span><span class="s2">&quot;Region&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span><span class="w"> </span>
<span class="w">   </span><span class="nx">strRegion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;CR&quot;</span>
<span class="nx">Else</span>
<span class="w">   </span><span class="nx">strRegion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Request</span><span class="p">.</span><span class="nx">QueryString</span><span class="p">(</span><span class="s2">&quot;Region&quot;</span><span class="p">)</span>
<span class="nx">End</span><span class="w"> </span><span class="nx">If</span>

<span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">Request</span><span class="p">.</span><span class="nx">QueryString</span><span class="p">(</span><span class="s2">&quot;chk24Hrs&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;on&quot;</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">   </span><span class="nx">str24Hrs_state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;checked&quot;</span>
<span class="nx">Else</span>
<span class="w">   </span><span class="nx">str24Hrs_state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="w"> </span>
<span class="nx">End</span><span class="w"> </span><span class="nx">If</span>

<span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">Request</span><span class="p">.</span><span class="nx">QueryString</span><span class="p">(</span><span class="s2">&quot;chkRA&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;on&quot;</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">   </span><span class="nx">strRA_state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;checked&quot;</span>
<span class="nx">Else</span>
<span class="w">   </span><span class="nx">strRA_state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="w"> </span>
<span class="nx">End</span><span class="w"> </span><span class="nx">If</span>

<span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">Request</span><span class="p">.</span><span class="nx">QueryString</span><span class="p">(</span><span class="s2">&quot;chkTimer&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;on&quot;</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">   </span><span class="nx">strTimer_state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;checked&quot;</span>
<span class="nx">Else</span>
<span class="w">   </span><span class="nx">strTimer_state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<span class="nx">End</span><span class="w"> </span><span class="nx">If</span>

<span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">strTimer_state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;checked&quot;</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">   </span><span class="s1">&#39;Check to see how far off the 5-minute mark. This should serve</span>
<span class="s1">   &#39;</span><span class="nx">to</span><span class="w"> </span><span class="nx">compensate</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">drift</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">client</span><span class="w"> </span><span class="nx">side</span><span class="w"> </span><span class="nx">timer</span><span class="p">.</span>
<span class="w">   </span>
<span class="w">   </span><span class="s1">&#39;Get the seconds and minutes from the server time.</span>
<span class="s1">   intSeconds_FromSeconds = CInt(right(serverTime,2))</span>
<span class="s1">   intMinutes = CInt(Split(serverTime,&quot;:&quot;)(1))</span>
<span class="s1">   </span>
<span class="s1">   &#39;</span><span class="nx">How</span><span class="w"> </span><span class="nx">many</span><span class="w"> </span><span class="nx">five</span><span class="w"> </span><span class="nx">minute</span><span class="w"> </span><span class="nx">chunks</span><span class="p">.</span>
<span class="w">   </span><span class="nx">dblFiveMinutes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">CDbl</span><span class="p">(</span><span class="nx">intMinutes</span><span class="p">)</span><span class="o">/</span><span class="mf">5.0</span>
<span class="w">   </span>
<span class="w">   </span><span class="s1">&#39;Take the fractional part of this and convert to seconds.</span>
<span class="s1">   intSeconds_FromMinutes = CInt(round(300*(dblFiveMinutes - Fix(dblFiveMinutes)),0))</span>
<span class="s1">   </span>
<span class="s1">   &#39;</span><span class="nx">Subtract</span><span class="w"> </span><span class="nx">both</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">these</span><span class="w"> </span><span class="nx">values</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="mf">300</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">get</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">proper</span><span class="w"> </span><span class="nx">delay</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">client</span><span class="p">.</span>
<span class="w">   </span><span class="s1">&#39;Then add 9 to keep it tracking at 10 seconds after the 5-minute mark.</span>
<span class="s1">   intDelay_to_5min = 300 - intSeconds_FromMinutes - intSeconds_FromSeconds + 9</span>
<span class="s1">   strInitializeTimer = &quot;initializeTimer(&quot; &amp; CStr(intDelay_to_5min) &amp; &quot;);&quot;</span>
<span class="s1">   </span>
<span class="s1">Else</span>
<span class="s1">   strInitializeTimer = &quot;&quot;</span>
<span class="s1">End If</span>

<span class="s1">blnPostedDate_default = False</span>
<span class="s1">If (Request.QueryString(&quot;EndDate&quot;) = &quot;&quot;) Then </span>
<span class="s1">   &#39;</span><span class="w"> </span><span class="nx">Use</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">current</span><span class="w"> </span><span class="nx">date</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="k">default</span><span class="p">.</span><span class="w"> </span>
<span class="w">   </span><span class="nx">dtePostedDate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">CStr</span><span class="p">(</span><span class="nb">Date</span><span class="p">())</span>
<span class="w">   </span><span class="nx">blnPostedDate_default</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">True</span>
<span class="nx">Else</span>
<span class="w">   </span><span class="s1">&#39; Split to just get the DATE part of this post.</span>
<span class="s1">   dtePostedDate = split(Request.QueryString(&quot;EndDate&quot;),&quot; &quot;)(0)</span>
<span class="s1">End If</span>

<span class="s1">If (Request.QueryString(&quot;Days&quot;) = &quot;&quot;) Then </span>
<span class="s1">   intDays = 1</span>
<span class="s1">Else</span>
<span class="s1">   intDays = Request.QueryString(&quot;Days&quot;)</span>
<span class="s1">End If</span>

<span class="s1">If (Request.QueryString(&quot;Sensor&quot;) = &quot;&quot;) Then </span>
<span class="s1">   strSensorType = &quot;Wind40&quot;</span>
<span class="s1">Else</span>
<span class="s1">   strSensorType = Request.QueryString(&quot;Sensor&quot;)</span>
<span class="s1">   &#39;</span><span class="w"> </span><span class="nx">Don</span><span class="s1">&#39;t allow request for Delta-P from any region but CR.</span>
<span class="s1">   If (strRegion &lt;&gt; &quot;CR&quot;) And (strSensorType = &quot;DeltaP&quot;) Then</span>
<span class="s1">         strSensorType = &quot;Wind40&quot;</span>
<span class="s1">   End If</span>
<span class="s1">End If</span>

<span class="s1">&#39;</span><span class="w"> </span><span class="nb">Set</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">normalization</span><span class="w"> </span><span class="nx">factor</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">wind</span><span class="w"> </span><span class="nx">direction</span><span class="w"> </span><span class="nx">data</span>
<span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">strSensorType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Wind40&quot;</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span><span class="w"> </span>
<span class="w">   </span><span class="nx">dblWindNormFactor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">40.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">360.0</span>
<span class="nx">Else</span>
<span class="w">   </span><span class="nx">dblWindNormFactor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">10.0</span>
<span class="nx">End</span><span class="w"> </span><span class="nx">If</span>

<span class="s1">&#39; Set a default value for the location if the first time in or if the user changes</span>
<span class="s1">&#39;</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">region</span><span class="p">.</span>
<span class="nx">If</span><span class="w"> </span><span class="p">((</span><span class="nx">Request</span><span class="p">.</span><span class="nx">QueryString</span><span class="p">(</span><span class="s2">&quot;Location&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="w"> </span><span class="nx">or</span><span class="w"> </span><span class="p">(</span><span class="nx">strRegionState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;new&quot;</span><span class="p">))</span><span class="w"> </span><span class="nx">Then</span><span class="w"> </span>
<span class="w">   </span><span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">strRegion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;CR&quot;</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">      </span><span class="nx">strLocation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;PASC&quot;</span>
<span class="w">   </span><span class="nx">ElseIf</span><span class="w"> </span><span class="p">(</span><span class="nx">strRegion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;MN&quot;</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">      </span><span class="nx">strLocation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;KMKT&quot;</span><span class="w">   </span>
<span class="w">   </span><span class="nx">ElseIf</span><span class="w"> </span><span class="p">(</span><span class="nx">strRegion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Misc&quot;</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">      </span><span class="nx">strLocation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;KCQX&quot;</span><span class="w">    </span>
<span class="w">   </span><span class="nx">Else</span>
<span class="w">      </span><span class="nx">strLocation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<span class="w">      </span><span class="nx">RWBR</span><span class="w"> </span><span class="s2">&quot;No match in region branch...&quot;</span>
<span class="w">   </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>
<span class="nx">Else</span>
<span class="w">   </span><span class="nx">strLocation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Request</span><span class="p">.</span><span class="nx">QueryString</span><span class="p">(</span><span class="s2">&quot;Location&quot;</span><span class="p">)</span>
<span class="nx">End</span><span class="w"> </span><span class="nx">If</span>

<span class="nx">If</span><span class="w"> </span><span class="p">((</span><span class="nx">strSensorType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Wind40&quot;</span><span class="p">)</span><span class="w"> </span><span class="nx">OR</span><span class="w"> </span><span class="p">(</span><span class="nx">strSensorType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Wind36&quot;</span><span class="p">))</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">   </span><span class="nx">strShowImages_command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;showImage();showDirections();&quot;</span>
<span class="nx">Else</span>
<span class="w">   </span><span class="nx">strShowImages_command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;showImage();&quot;</span>
<span class="nx">End</span><span class="w"> </span><span class="nx">If</span>

<span class="nx">strTimeZone</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">TimeZone</span><span class="p">(</span><span class="w"> </span><span class="nx">strLocation</span><span class="p">)</span>

<span class="nx">RC</span><span class="w"> </span><span class="s2">&quot;&lt;body onLoad=testJS();&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">strShowImages_command</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">strInitializeTimer</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">      </span><span class="s2">&quot; bgcolor=#FFCC99 link=#008080 vlink=#008080 topmargin=2 style=font-family:Arial;&gt;&quot;</span>

<span class="nx">RC</span><span class="w"> </span><span class="s2">&quot;&lt;div class=&#39;pageblock&#39;&gt;&quot;</span>

<span class="s1">&#39; If the region is specified, then make preparations for populating the table</span>
<span class="s1">&#39;</span><span class="w"> </span><span class="nx">including</span><span class="w"> </span><span class="nx">getting</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">most</span><span class="w"> </span><span class="nx">recent</span><span class="w"> </span><span class="nx">values</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">all</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">sensor</span><span class="w"> </span><span class="nx">data</span><span class="p">.</span>

<span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">Request</span><span class="p">.</span><span class="nx">QueryString</span><span class="p">(</span><span class="s2">&quot;Region&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span>

<span class="w">   </span><span class="s1">&#39; If the end date in the chart request is within daylight savings time, then</span>
<span class="s1">   &#39;</span><span class="w"> </span><span class="nx">set</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">DLS</span><span class="w"> </span><span class="nx">flag</span><span class="p">.</span><span class="w"> </span><span class="nx">Add</span><span class="w"> </span><span class="mf">3</span><span class="w"> </span><span class="nx">hours</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">make</span><span class="w"> </span><span class="nx">sure</span><span class="w"> </span><span class="nx">you</span><span class="w"> </span><span class="nx">evaluate</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">day</span><span class="w"> </span><span class="nx">after</span><span class="w"> </span><span class="nx">the</span>
<span class="w">   </span><span class="s1">&#39; 2am change over point.</span>

<span class="s1">   If (DaylightSavingsTime(dateadd(&quot;h&quot;,3,dtePostedDate))) Then </span>
<span class="s1">      blnDayLightSavingsTime = True</span>
<span class="s1">   End If</span>

<span class="s1">   &#39;</span><span class="w"> </span><span class="nx">Find</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">time</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">most</span><span class="w"> </span><span class="nx">recent</span><span class="w"> </span><span class="nx">station</span><span class="w"> </span><span class="nx">record</span><span class="p">.</span>
<span class="w">   </span><span class="nx">strSQL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;SELECT * FROM FifteenMinData &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">            </span><span class="s2">&quot;WHERE (StationName = &#39;&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">strLocation</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;&#39;) &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">            </span><span class="s2">&quot;ORDER BY DateTimeStamp DESC &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">            </span><span class="s2">&quot;LIMIT 1&quot;</span><span class="w">  </span>

<span class="w">   </span><span class="nb">Set</span><span class="w"> </span><span class="nx">rstMostRecent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Server</span><span class="p">.</span><span class="nx">CreateObject</span><span class="p">(</span><span class="s2">&quot;ADODB.Recordset&quot;</span><span class="p">)</span>
<span class="w">	</span><span class="nx">On</span><span class="w"> </span><span class="ne">Error</span><span class="w"> </span><span class="nx">Resume</span><span class="w"> </span><span class="nx">Next</span>
<span class="w">	</span><span class="nx">rstMostRecent</span><span class="p">.</span><span class="nx">Open</span><span class="w"> </span><span class="nx">strSQL</span><span class="p">,</span><span class="w"> </span><span class="nx">DBConnection</span><span class="p">,</span><span class="w"> </span><span class="nx">adOpenStatic</span><span class="p">,</span><span class="w"> </span><span class="nx">adLockReadOnly</span><span class="p">,</span><span class="w"> </span><span class="nx">adCmdText</span>
<span class="w">	</span><span class="nx">LogError</span><span class="p">(</span><span class="s2">&quot;Recordset = rstTelem, SQL = &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">strSQL_trace</span><span class="p">)</span>
<span class="w">	</span><span class="nx">On</span><span class="w"> </span><span class="ne">Error</span><span class="w"> </span><span class="nx">Goto</span><span class="w"> </span><span class="mf">0</span>

<span class="w">   </span><span class="s1">&#39; Check to see if there are any records before applying the MoveFirst method</span>
<span class="s1">   If (Not rstMostRecent.EOF) Then</span>

<span class="s1">      &#39;</span><span class="w"> </span><span class="nx">If</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="nx">was</span><span class="w"> </span><span class="nx">used</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">posted</span><span class="w"> </span><span class="nx">date</span><span class="p">,</span><span class="w"> </span><span class="nx">correct</span><span class="w"> </span><span class="nx">it</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">posted</span><span class="w"> </span><span class="nx">date</span>
<span class="w">      </span><span class="s1">&#39; is more recent than the most recent data.   </span>
<span class="s1">      If blnPostedDate_default and (DateDiff(&quot;d&quot;, dtePostedDate, rstMostRecent(&quot;TimeMDY&quot;)) &lt; 0) Then</span>
<span class="s1">         dtePostedDate = rstMostRecent(&quot;TimeMDY&quot;)</span>
<span class="s1">      End If</span>
<span class="s1">      </span>
<span class="s1">      &#39;</span><span class="nx">Warning</span><span class="o">:</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="nx">variable</span><span class="w"> </span><span class="nx">changes</span><span class="w"> </span><span class="nx">type</span><span class="w"> </span><span class="nx">here</span><span class="p">.</span>
<span class="w">      </span><span class="nx">strMRTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">rstMostRecent</span><span class="p">(</span><span class="s2">&quot;TimeMDY&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot; &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">rstMostRecent</span><span class="p">(</span><span class="s2">&quot;TimeHr&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;:&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">rstMostRecent</span><span class="p">(</span><span class="s2">&quot;TimeMin&quot;</span><span class="p">)</span>
<span class="w">      </span><span class="nx">strMRTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">FormatDateTime</span><span class="p">(</span><span class="nx">strMRTime</span><span class="p">,</span><span class="w"> </span><span class="nx">vbGeneralDate</span><span class="p">)</span>
<span class="w">      </span>
<span class="w">      </span><span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">rstMostRecent</span><span class="p">(</span><span class="s2">&quot;WindDirection&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mf">10</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">         </span><span class="nx">strMRWindDir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Variable&quot;</span>
<span class="w">      </span><span class="nx">Else</span>
<span class="w">         </span><span class="nx">If</span><span class="w"> </span><span class="nx">IsNull</span><span class="p">(</span><span class="nx">rstMostRecent</span><span class="p">(</span><span class="s2">&quot;WindDirection&quot;</span><span class="p">))</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">            </span><span class="nx">strMRWindDir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;-&quot;</span>
<span class="w">         </span><span class="nx">Else</span>
<span class="w">            </span><span class="nx">strMRWindDir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">rstMostRecent</span><span class="p">(</span><span class="s2">&quot;WindDirection&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">                           </span><span class="s2">&quot; deg. [&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">DirectionLabel</span><span class="p">(</span><span class="nx">rstMostRecent</span><span class="p">(</span><span class="s2">&quot;WindDirection&quot;</span><span class="p">))</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;]&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">                           </span><span class="s2">&quot; [&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">FormatNumber</span><span class="p">(</span><span class="nx">rstMostRecent</span><span class="p">(</span><span class="s2">&quot;WindDirection&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dblWindNormFactor</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;]&quot;</span>
<span class="w">         </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>
<span class="w">      </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span><span class="w">    </span>
<span class="w">      </span><span class="nx">If</span><span class="w"> </span><span class="nx">IsNull</span><span class="p">(</span><span class="nx">rstMostRecent</span><span class="p">(</span><span class="s2">&quot;WindSpeed&quot;</span><span class="p">))</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">         </span><span class="nx">strMRWindAvg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;-&quot;</span><span class="w"> </span>
<span class="w">         </span><span class="nx">strMRWindMax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;-&quot;</span>
<span class="w">      </span><span class="nx">Else</span>
<span class="w">         </span><span class="nx">strMRWindAvg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">rstMostRecent</span><span class="p">(</span><span class="s2">&quot;WindSpeed&quot;</span><span class="p">)</span>
<span class="w">         </span><span class="nx">strMRWindMax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">rstMostRecent</span><span class="p">(</span><span class="s2">&quot;WindGust&quot;</span><span class="p">)</span>
<span class="w">      </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>

<span class="w">      </span><span class="nx">If</span><span class="w"> </span><span class="nx">IsNull</span><span class="p">(</span><span class="nx">rstMostRecent</span><span class="p">(</span><span class="s2">&quot;Pressure&quot;</span><span class="p">))</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">         </span><span class="nx">strMRPressure</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;-&quot;</span>
<span class="w">      </span><span class="nx">Else</span>
<span class="w">         </span><span class="nx">strMRPressure</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">round</span><span class="p">(</span><span class="nx">rstMostRecent</span><span class="p">(</span><span class="s2">&quot;Pressure&quot;</span><span class="p">),</span><span class="mf">2</span><span class="p">)</span>
<span class="w">      </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span><span class="w"> </span>

<span class="w">      </span><span class="nx">strMRTemp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">rstMostRecent</span><span class="p">(</span><span class="s2">&quot;TempAvg&quot;</span><span class="p">)</span>
<span class="w">      </span><span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">IsNull</span><span class="p">(</span><span class="nx">strMRTemp</span><span class="p">))</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">         </span><span class="nx">strMRTemp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;-&quot;</span>
<span class="w">      </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>
<span class="w">      </span>
<span class="w">      </span><span class="nx">strMRDewPoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">rstMostRecent</span><span class="p">(</span><span class="s2">&quot;DewPoint&quot;</span><span class="p">)</span><span class="w"> </span>
<span class="w">      </span><span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">IsNull</span><span class="p">(</span><span class="nx">strMRDewPoint</span><span class="p">))</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">         </span><span class="nx">strMRDewPoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;-&quot;</span>
<span class="w">      </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>
<span class="w">   </span>
<span class="w">   </span><span class="nx">Else</span>
<span class="w">      </span><span class="nx">strMRTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;-&quot;</span>
<span class="w">      </span><span class="nx">strMRWindDir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;-&quot;</span>
<span class="w">      </span><span class="nx">strMRWindAvg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;-&quot;</span>
<span class="w">      </span><span class="nx">strMRWindMax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;-&quot;</span>
<span class="w">      </span><span class="nx">strMRTemp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;-&quot;</span>
<span class="w">      </span><span class="nx">strMRPressure</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;-&quot;</span><span class="w">   </span>
<span class="w">      </span><span class="nx">strMRDewPoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;-&quot;</span><span class="w"> </span>
<span class="w">   </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>
<span class="w">   </span>
<span class="w">   </span><span class="nx">If</span><span class="w"> </span><span class="nx">rstMostRecent</span><span class="p">.</span><span class="nx">State</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">adStateOpen</span><span class="w"> </span><span class="nx">Then</span><span class="w"> </span><span class="nx">rstMostRecent</span><span class="p">.</span><span class="nx">Close</span>
<span class="w">   </span><span class="nb">Set</span><span class="w"> </span><span class="nx">rstMostRecent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Nothing</span>
<span class="w">   </span>
<span class="w">   </span><span class="nx">strButtonLabel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Update&quot;</span>
<span class="w">   </span>
<span class="nx">Else</span>
<span class="w">   </span><span class="nx">dtePostedDate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&quot;</span>

<span class="w">   </span><span class="s1">&#39; Before first post (first time in) just show these dashes in the table...</span>
<span class="s1">   strMRTime = &quot;-&quot;</span>
<span class="s1">   strMRWindDir = &quot;-&quot;</span>
<span class="s1">   strMRWindAvg = &quot;-&quot;</span>
<span class="s1">   strMRWindMax = &quot;-&quot;</span>
<span class="s1">   strMRTemp = &quot;-&quot;</span>
<span class="s1">   strMRPressure = &quot;-&quot;</span>
<span class="s1">   strMRDewPoint = &quot;-&quot; </span>

<span class="s1">   strButtonLabel = &quot;Chart&quot;</span>
<span class="s1">   </span>
<span class="s1">End If</span>

<span class="s1">&#39;</span><span class="o">===========================================================================</span>
<span class="s1">&#39; The current data table and CONTROLS form...</span>
<span class="s1">&#39;</span><span class="o">===========================================================================</span>
<span class="nx">RC</span><span class="w"> </span><span class="s2">&quot;&lt;table border=&#39;1&#39;&gt;&quot;</span>

<span class="s1">&#39; First row</span>

<span class="s1">RC &quot;&lt;tr&gt;&quot;</span>

<span class="s1">RC &quot;&lt;td class=&#39;</span><span class="nx">data</span><span class="s1">&#39; width=&#39;</span><span class="mf">37</span><span class="o">%</span><span class="s1">&#39; rowspan=&#39;</span><span class="mf">3</span><span class="s1">&#39;&gt;&quot;</span>
<span class="s1">&#39;</span><span class="nx">RC</span><span class="w"> </span><span class="s2">&quot;&lt;p align=&#39;center&#39;&gt;&lt;a onmouseover=&quot;&quot;changeRegionAnchorValue(&#39;&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">strRegion</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;&#39;)&quot;&quot; onmouseout=&quot;&quot;changeRegionAnchorValue(&#39;&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">strTitle</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;&#39;)&quot;&quot; name=&#39;regionanchor&#39; id=&#39;regionanchor&#39; class=&#39;noline&#39; href=&#39;&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">strRegionURL</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;&#39;&gt;&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">strTitle</span><span class="w">  </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;&lt;/a&gt;&amp;nbsp;&lt;br&gt;&quot;</span>
<span class="nx">RC</span><span class="w"> </span><span class="s2">&quot;&lt;p align=&#39;center&#39;&gt;&lt;span class=&#39;regionstring&#39;&gt;&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">RegionString</span><span class="p">(</span><span class="w"> </span><span class="nx">strRegion</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;&lt;/span&gt;&lt;br&gt;&quot;</span>
<span class="nx">RC</span><span class="w"> </span><span class="s2">&quot;&lt;a target=&#39;_blank&#39; href=&#39;http://waconia.timetocode.org/FAQ.htm&#39;&gt;&lt;font size=&#39;2&#39; color=&#39;#FF0000&#39;&gt;Help&lt;/font&gt;&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">                     </span><span class="s2">&quot;&lt;font size=&#39;2&#39; color=&#39;#008080&#39;&gt;: FAQs&lt;/font&gt;&lt;/a&gt;&amp;nbsp;&quot;</span>

<span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">strRegion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;MN&quot;</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">   </span><span class="nx">RC</span><span class="w"> </span><span class="s2">&quot;&lt;a href=&#39;pictures/mn_sites.jpg&#39;&gt;&lt;font size=&#39;2&#39; color=&#39;#008080&#39;&gt;Sites&lt;/font&gt;&lt;/a&gt;&amp;nbsp;&quot;</span>
<span class="nx">End</span><span class="w"> </span><span class="nx">If</span>
<span class="nx">RC</span><span class="w"> </span><span class="s2">&quot;&lt;a href=&#39;default.htm&#39;&gt;&lt;font size=&#39;2&#39;&gt;(home)&lt;/font&gt;&lt;/a&gt;&quot;</span>

<span class="s1">&#39; Create a object for working with the image files...</span>
<span class="s1">Set fsoObject = CreateObject(&quot;Scripting.FileSystemObject&quot;)</span>
<span class="s1">&#39;</span><span class="w"> </span><span class="nx">Note</span><span class="o">:</span><span class="w"> </span><span class="nx">path</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">image</span><span class="w"> </span><span class="nx">directory</span><span class="w"> </span><span class="nx">is</span><span class="w"> </span><span class="nx">defined</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">include</span><span class="w"> </span><span class="nx">file</span><span class="p">.</span>
<span class="nb">Set</span><span class="w"> </span><span class="nx">fdrObject</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fsoObject</span><span class="p">.</span><span class="nx">GetFolder</span><span class="p">(</span><span class="nx">strPathToImageDir</span><span class="p">)</span>
<span class="w">         </span>
<span class="s1">&#39; Clean out any old temp image files. This is a new approach that doesn&#39;</span><span class="nx">t</span><span class="w"> </span><span class="nx">depend</span><span class="w"> </span><span class="nx">on</span><span class="w"> </span><span class="nx">script</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nb">global</span><span class="w"> </span><span class="nx">ASA</span>
<span class="nx">intFileCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span>
<span class="nx">For</span><span class="w"> </span><span class="nx">Each</span><span class="w"> </span><span class="nx">filObject</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">fdrObject</span><span class="p">.</span><span class="nx">Files</span>
<span class="w">   </span><span class="nx">Dim</span><span class="w"> </span><span class="nx">fileAge</span><span class="p">,</span><span class="w"> </span><span class="nx">fileDate</span>
<span class="w">   </span><span class="nx">fileDate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">filObject</span><span class="p">.</span><span class="nx">DateLastModified</span>
<span class="w">   </span><span class="nx">fileAge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">DateDiff</span><span class="p">(</span><span class="s2">&quot;h&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">fileDate</span><span class="p">,</span><span class="w"> </span><span class="nx">Now</span><span class="p">())</span>
<span class="w">   </span>
<span class="w">   </span><span class="s1">&#39; Count files that are less than 1 day old.</span>
<span class="s1">   If (fileAge &lt;= 24) Then</span>
<span class="s1">      intFileCount = intFileCount + 1</span>
<span class="s1">   End If</span>
<span class="s1">   </span>
<span class="s1">   &#39;</span><span class="w"> </span><span class="nx">Delete</span><span class="w"> </span><span class="nx">files</span><span class="w"> </span><span class="nx">that</span><span class="w"> </span><span class="nx">are</span><span class="w"> </span><span class="nx">more</span><span class="w"> </span><span class="nx">than</span><span class="w"> </span><span class="nx">three</span><span class="w"> </span><span class="nx">days</span><span class="w"> </span><span class="nx">old</span><span class="p">.</span>
<span class="w">   </span><span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">fileAge</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">72</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">      </span><span class="nx">filObject</span><span class="p">.</span><span class="ow">delete</span>
<span class="w">   </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span><span class="w">  </span>
<span class="nx">Next</span><span class="w">         </span>

<span class="s1">&#39; Write out a count of image files in the directory (1 and 7 day counts).</span>
<span class="s1">&#39;</span><span class="w"> </span><span class="nx">Put</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">serverTime</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nx">span</span><span class="w"> </span><span class="nx">so</span><span class="w"> </span><span class="nx">can</span><span class="w"> </span><span class="nx">access</span><span class="w"> </span><span class="nx">it</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">client</span><span class="w"> </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="nx">needed</span><span class="p">,</span><span class="w"> </span><span class="nx">may</span><span class="w"> </span><span class="nx">not</span><span class="w"> </span><span class="nx">actually</span><span class="w"> </span><span class="nx">use</span><span class="w"> </span><span class="k">this</span><span class="p">).</span><span class="w">          </span>
<span class="nx">RC</span><span class="w"> </span><span class="s2">&quot;&lt;font color=&#39;#008080&#39;  size=&#39;1&#39;&gt;&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">   </span><span class="s2">&quot;&amp;nbsp;&amp;nbsp;&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">intFileCount</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;-(1d)&amp;nbsp;&amp;nbsp;&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">fdrObject</span><span class="p">.</span><span class="nx">Files</span><span class="p">.</span><span class="nx">Count</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;-(3d)&amp;nbsp;&amp;nbsp;&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">   </span><span class="s2">&quot;&lt;span id=&#39;spServerTime&#39; name=&#39;spServerTime&#39;&gt;&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">serverTime</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;&lt;/span&gt;&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">   </span><span class="s2">&quot; (&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">AgeOfData</span><span class="p">(</span><span class="nx">strMRTime</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;)&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">   </span><span class="s2">&quot;&lt;/font&gt;&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">   </span><span class="s2">&quot;&lt;/p&gt;&quot;</span>
<span class="nx">RC</span><span class="w"> </span><span class="s2">&quot;&lt;/td&gt;&quot;</span>

<span class="s1">&#39; Rest of the table headers</span>
<span class="s1">RC &quot;&lt;td width=&#39;</span><span class="mf">23</span><span class="o">%</span><span class="s1">&#39; align=&#39;</span><span class="nx">center</span><span class="s1">&#39; rowspan=&#39;</span><span class="mf">2</span><span class="s1">&#39;&gt;&lt;b&gt;&lt;font color=&#39;</span><span class="n">#FF0000</span><span class="s1">&#39;&gt;Latest&lt;/font&gt;&quot;</span>
<span class="s1">RC &quot;&lt;font color=&#39;</span><span class="err">#</span><span class="mo">00</span><span class="mf">8080</span><span class="s1">&#39;&gt; Reading&quot;</span>
<span class="s1">RC &quot;&lt;/font&gt;&lt;/b&gt;&quot;</span>
<span class="s1">RC &quot;&lt;/td&gt;&quot;</span>

<span class="s1">RC &quot;&lt;td width=&#39;</span><span class="mf">26</span><span class="o">%</span><span class="s1">&#39; align=&#39;</span><span class="nx">center</span><span class="s1">&#39; colspan=&#39;</span><span class="mf">3</span><span class="s1">&#39;&gt;&lt;font color=&#39;</span><span class="err">#</span><span class="mo">00</span><span class="mf">8080</span><span class="s1">&#39;&gt;&lt;b&gt;Wind &lt;/b&gt;&lt;font size=&#39;</span><span class="mf">2</span><span class="s1">&#39;&gt; (mph)&lt;/font&gt;&lt;/font&gt;&lt;/td&gt;&quot;</span>

<span class="s1">RC &quot;&lt;td nowrap width=&#39;</span><span class="mf">6</span><span class="o">%</span><span class="s1">&#39; align=&#39;</span><span class="nx">center</span><span class="s1">&#39; colspan=&#39;</span><span class="mf">2</span><span class="s1">&#39; rowspan=&#39;</span><span class="mf">1</span><span class="s1">&#39;&gt;&lt;font color=&#39;</span><span class="err">#</span><span class="mo">00</span><span class="mf">8080</span><span class="s1">&#39;&gt;&lt;b&gt;Temp&lt;/b&gt;&lt;font size=&#39;</span><span class="mf">2</span><span class="s1">&#39;&gt; (&lt;sup&gt;o&lt;/sup&gt;F)&lt;/font&gt;&lt;/font&gt;&lt;/td&gt;&quot;</span>
<span class="s1">RC &quot;&lt;td width=&#39;</span><span class="mf">8</span><span class="o">%</span><span class="s1">&#39; align=&#39;</span><span class="nx">center</span><span class="s1">&#39; rowspan=&#39;</span><span class="mf">2</span><span class="s1">&#39;&gt;&lt;font color=&#39;</span><span class="err">#</span><span class="mo">00</span><span class="mf">8080</span><span class="s1">&#39;&gt;&lt;b&gt;Pressure&lt;br&gt;&lt;/b&gt;&lt;font size=&#39;</span><span class="mf">2</span><span class="s1">&#39;&gt; (in Hg&quot; &amp; strHGSL &amp; &quot;)&lt;/font&gt;&lt;/font&gt;&lt;/td&gt;&quot;</span>
<span class="s1">RC &quot;&lt;/tr&gt;&quot;</span>

<span class="s1">&#39;</span><span class="w"> </span><span class="nx">Second</span><span class="w"> </span><span class="nx">row</span>

<span class="nx">RC</span><span class="w"> </span><span class="s2">&quot;&lt;tr&gt;&quot;</span>
<span class="nx">RC</span><span class="w"> </span><span class="s2">&quot;&lt;td width=&#39;6%&#39; align=&#39;center&#39;&gt;&lt;font color=&#39;#008080&#39; size=&#39;2&#39;&gt;Avg&lt;/font&gt;&lt;/td&gt;&quot;</span>
<span class="nx">RC</span><span class="w"> </span><span class="s2">&quot;&lt;td width=&#39;5%&#39; align=&#39;center&#39;&gt;&lt;font color=&#39;#008080&#39; size=&#39;2&#39;&gt;Max&lt;/font&gt;&lt;/td&gt;&quot;</span>
<span class="nx">RC</span><span class="w"> </span><span class="s2">&quot;&lt;td width=&#39;18%&#39; align=&#39;center&#39;&gt;&lt;font color=&#39;#008080&#39; size=&#39;2&#39;&gt;Direction&lt;/font&gt;&lt;/td&gt;&quot;</span>
<span class="nx">RC</span><span class="w"> </span><span class="s2">&quot;&lt;td align=&#39;center&#39;&gt;&lt;font color=&#39;#008080&#39; size=&#39;2&#39;&gt;DryBulb&lt;/font&gt;&lt;/td&gt;&quot;</span>
<span class="nx">RC</span><span class="w"> </span><span class="s2">&quot;&lt;td align=&#39;center&#39;&gt;&lt;font color=&#39;#008080&#39; size=&#39;2&#39;&gt;DewPoint&lt;/font&gt;&lt;/td&gt;&quot;</span>
<span class="nx">RC</span><span class="w"> </span><span class="s2">&quot;&lt;/tr&gt;&quot;</span>

<span class="s1">&#39; Third row</span>

<span class="s1">RC &quot;&lt;tr&gt;&quot;</span>
<span class="s1">RC &quot;&lt;td class=&#39;</span><span class="nx">data</span><span class="s1">&#39; width=&#39;</span><span class="mf">20</span><span class="o">%</span><span class="s1">&#39; align=&#39;</span><span class="nx">center</span><span class="s1">&#39;&gt;&lt;font color=&#39;</span><span class="err">#</span><span class="mo">000000</span><span class="s1">&#39; size=&#39;</span><span class="mf">2</span><span class="s1">&#39;&gt;&quot;</span>
<span class="s1">If (strMRTime &lt;&gt; &quot;-&quot;) Then</span>
<span class="s1">   &#39;</span><span class="nx">rwbr</span><span class="w"> </span><span class="s2">&quot;strMRTime = &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">strMRTime</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;, strTimeZone = &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">strTimeZone</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;, DaylightSavingsTime(strMRTime) = &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">DaylightSavingsTime</span><span class="p">(</span><span class="nx">strMRTime</span><span class="p">)</span>
<span class="w">   </span><span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">DaylightSavingsTime</span><span class="p">(</span><span class="nx">strMRTime</span><span class="p">)</span><span class="w"> </span><span class="nx">And</span><span class="w"> </span><span class="p">(</span><span class="nx">strTimeZone</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="s2">&quot;H&quot;</span><span class="p">))</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">      </span><span class="nx">Response</span><span class="p">.</span><span class="nx">Write</span><span class="w"> </span><span class="nx">DateAdd</span><span class="p">(</span><span class="s2">&quot;h&quot;</span><span class="p">,</span><span class="mf">1</span><span class="p">,</span><span class="nx">strMRTime</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot; (&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">strTimeZone</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;DT)&quot;</span>
<span class="w">   </span><span class="nx">Else</span>
<span class="w">      </span><span class="nx">Response</span><span class="p">.</span><span class="nx">Write</span><span class="w">               </span><span class="nx">strMRTime</span><span class="w">  </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot; (&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">strTimeZone</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;ST)&quot;</span>
<span class="w">   </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>
<span class="nx">Else</span>
<span class="w">   </span><span class="nx">Response</span><span class="p">.</span><span class="nx">Write</span><span class="w"> </span><span class="nx">strMRTime</span>
<span class="nx">End</span><span class="w"> </span><span class="nx">If</span>
<span class="nx">RC</span><span class="w"> </span><span class="s2">&quot;&lt;/font&gt;&lt;/td&gt;&quot;</span>
<span class="nx">RC</span><span class="w"> </span><span class="s2">&quot;&lt;td class=&#39;data&#39; width=&#39;6%&#39; align=&#39;center&#39;&gt;&lt;font color=&#39;#000000&#39; size=&#39;2&#39;&gt;&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">strMRWindAvg</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;&lt;/font&gt;&lt;/td&gt;&quot;</span>
<span class="nx">RC</span><span class="w"> </span><span class="s2">&quot;&lt;td class=&#39;data&#39; width=&#39;5%&#39; align=&#39;center&#39;&gt;&lt;font color=&#39;#000000&#39; size=&#39;2&#39;&gt;&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">strMRWindMax</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;&lt;/font&gt;&lt;/td&gt;&quot;</span>
<span class="nx">RC</span><span class="w"> </span><span class="s2">&quot;&lt;td class=&#39;data&#39; width=&#39;18%&#39; align=&#39;center&#39;&gt;&lt;font color=&#39;#000000&#39; size=&#39;2&#39;&gt;&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">strMRWindDir</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;&lt;/font&gt;&lt;/td&gt;&quot;</span>
<span class="nx">RC</span><span class="w"> </span><span class="s2">&quot;&lt;td class=&#39;data&#39; width=&#39;6%&#39; align=&#39;center&#39;&gt;&lt;font color=&#39;#000000&#39; size=&#39;2&#39;&gt;&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">strMRTemp</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;&lt;/font&gt;&lt;/td&gt;&quot;</span>
<span class="nx">RC</span><span class="w"> </span><span class="s2">&quot;&lt;td class=&#39;data&#39; width=&#39;6%&#39; align=&#39;center&#39;&gt;&lt;font color=&#39;#000000&#39; size=&#39;2&#39;&gt;&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">strMRDewPoint</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;&lt;/font&gt;&lt;/td&gt;&quot;</span>
<span class="nx">RC</span><span class="w"> </span><span class="s2">&quot;&lt;td class=&#39;data&#39; width=&#39;8%&#39; align=&#39;center&#39;&gt;&lt;font color=&#39;#000000&#39; size=&#39;2&#39;&gt;&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">strMRPressure</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;&lt;/font&gt;&lt;/td&gt;&quot;</span>
<span class="nx">RC</span><span class="w"> </span><span class="s2">&quot;&lt;/tr&gt;&quot;</span>

<span class="nx">RC</span><span class="w"> </span><span class="s2">&quot;&lt;/table&gt;&quot;</span>

<span class="s1">&#39;=============================================================================</span>
<span class="s1">&#39;</span><span class="w"> </span><span class="nx">Build</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nx">line</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">controls</span>
<span class="s1">&#39;=============================================================================   </span>

<span class="s1">RC &quot;&lt;br&gt;&quot;</span>
<span class="s1">&#39;</span><span class="w"> </span><span class="nx">Note</span><span class="w"> </span><span class="nx">that</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">GET</span><span class="w"> </span><span class="nx">method</span><span class="w"> </span><span class="nx">invokes</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">QueryString</span><span class="w"> </span><span class="nx">approach</span><span class="w"> </span><span class="nx">and</span><span class="w"> </span><span class="nx">submits</span><span class="w"> </span><span class="nx">form</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">URL</span><span class="p">.</span>
<span class="nx">RC</span><span class="w"> </span><span class="s2">&quot;&lt;form method=&#39;GET&#39; accept-charset=&#39;utf-8&#39; action=&#39;rosy-mysql.asp&#39; name=&#39;ChartingParameters&#39; id=&#39;ChartingParameters&#39;&gt;&quot;</span>

<span class="s1">&#39; Removing the &quot;name&quot; parameter here avoids submitting this with the form.</span>
<span class="s1">&#39;</span><span class="w"> </span><span class="nx">Another</span><span class="w"> </span><span class="nx">option</span><span class="w"> </span><span class="nx">is</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">use</span><span class="w"> </span><span class="s2">&quot;button&quot;</span><span class="w"> </span><span class="nx">instead</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="s2">&quot;input&quot;</span><span class="p">.</span>


<span class="s1">&#39; The submit button.</span>

<span class="s1">&#39;</span><span class="nx">RC</span><span class="w"> </span><span class="s2">&quot;&lt;...........................................name=&#39;submit_button&#39;&gt;&quot;</span>
<span class="nx">RC</span><span class="w"> </span><span class="s2">&quot;&lt;input type=&#39;button&#39; title=&#39;Query the database and update the plot.&#39; value=&#39;&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">strButtonLabel</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;&#39; name=&#39;myButton&#39; id=&#39;myButton&#39; style=&#39;width: 90px&#39; onclick=&#39;submitform()&#39;&gt;&quot;</span>


<span class="s1">&#39; Region</span>

<span class="s1">RC &quot;&lt;select title=&#39;</span><span class="nx">Region</span><span class="s1">&#39; size=&#39;</span><span class="mf">1</span><span class="s1">&#39; name=&#39;</span><span class="nx">Region</span><span class="s1">&#39; id=&#39;</span><span class="nx">Region</span><span class="s1">&#39; onChange=&#39;</span><span class="nx">setRegionState</span><span class="p">()</span><span class="s1">&#39;&gt;&quot;</span>
<span class="s1">arrRegions = Array(&quot;MN&quot;,&quot;CR&quot;,&quot;Misc&quot;)</span>
<span class="s1">For each strRegionValue in arrRegions</span>
<span class="s1">   If (strRegionValue = strRegion) Then</span>
<span class="s1">      RC &quot;   &lt;option selected&gt;&quot; &amp; strRegionValue</span>
<span class="s1">   Else</span>
<span class="s1">      RC &quot;   &lt;option&gt;&quot; &amp; strRegionValue</span>
<span class="s1">   End If</span>
<span class="s1">Next</span>
<span class="s1">RC &quot;&lt;/select&gt;&quot;</span>

<span class="s1">&#39;</span><span class="w"> </span><span class="nx">A</span><span class="w"> </span><span class="nx">hidden</span><span class="w"> </span><span class="nx">field</span><span class="w"> </span><span class="nx">that</span><span class="w"> </span><span class="nx">serves</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">indicate</span><span class="w"> </span><span class="nx">whether</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">region</span><span class="w"> </span><span class="nx">has</span><span class="w"> </span><span class="nx">been</span><span class="w"> </span><span class="nx">selected</span><span class="p">.</span><span class="w"> </span><span class="nx">This</span><span class="w"> </span><span class="nx">is</span><span class="w"> </span><span class="nx">needed</span>
<span class="s1">&#39; for determining the default location if the region selection changes.</span>
<span class="s1">RC &quot;&lt;input type=&#39;</span><span class="nx">hidden</span><span class="s1">&#39; name=&#39;</span><span class="nx">Region_state</span><span class="s1">&#39; id= &#39;</span><span class="nx">Region_state</span><span class="s1">&#39; value=&#39;</span><span class="nx">old</span><span class="s1">&#39;&gt;&quot;</span>


<span class="s1">&#39;</span><span class="w"> </span><span class="nx">Location</span>

<span class="nx">strSQL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;SELECT StationNames.Priority, StationNames.StationName, StationNames.NickName FROM StationNames &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">         </span><span class="s2">&quot;WHERE (Region=&#39;&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">strRegion</span><span class="w">  </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;&#39;) &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">         </span><span class="s2">&quot;ORDER BY Priority, NickName&quot;</span>

<span class="nb">Set</span><span class="w"> </span><span class="nx">rstStations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Server</span><span class="p">.</span><span class="nx">CreateObject</span><span class="p">(</span><span class="s2">&quot;ADODB.Recordset&quot;</span><span class="p">)</span>
<span class="nx">On</span><span class="w"> </span><span class="ne">Error</span><span class="w"> </span><span class="nx">Resume</span><span class="w"> </span><span class="nx">Next</span>
<span class="nx">rstStations</span><span class="p">.</span><span class="nx">Open</span><span class="w"> </span><span class="nx">strSQL</span><span class="p">,</span><span class="w"> </span><span class="nx">DBConnection</span><span class="p">,</span><span class="w"> </span><span class="nx">adOpenStatic</span><span class="p">,</span><span class="w"> </span><span class="nx">adLockReadOnly</span><span class="p">,</span><span class="w"> </span><span class="nx">adCmdText</span>
<span class="nx">LogError</span><span class="p">(</span><span class="s2">&quot;Recordset = rstTelem, SQL = &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">strSQL_trace</span><span class="p">)</span>
<span class="nx">On</span><span class="w"> </span><span class="ne">Error</span><span class="w"> </span><span class="nx">Goto</span><span class="w"> </span><span class="mf">0</span>

<span class="nx">RC</span><span class="w"> </span><span class="s2">&quot;&lt;select title=&#39;Location of weather station&#39; size=&#39;1&#39; name=&#39;Location&#39; id=&#39;Location&#39; onChange=&#39;submitform()&#39;&gt;&quot;</span>
<span class="nx">rstStations</span><span class="p">.</span><span class="nx">movefirst</span>
<span class="nx">Do</span><span class="w"> </span><span class="nx">until</span><span class="w"> </span><span class="nx">rstStations</span><span class="p">.</span><span class="nx">EOF</span><span class="w"> </span>
<span class="w">   </span><span class="s1">&#39; Exclude inactive stations from the selection list (marked as &quot;skip&quot; in the database).</span>
<span class="s1">   If (InStr(rstStations(&quot;Priority&quot;),&quot;skip&quot;)=0) Then</span>
<span class="s1">   </span>
<span class="s1">      &#39;</span><span class="nx">Populate</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">list</span><span class="w"> </span><span class="nx">and</span><span class="w"> </span><span class="nx">set</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">selected</span><span class="w"> </span><span class="nx">station</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">two</span><span class="w"> </span><span class="nx">regions</span><span class="p">.</span>
<span class="w">      </span><span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">rstStations</span><span class="p">(</span><span class="s2">&quot;StationName&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="nx">strLocation</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span><span class="w"> </span>
<span class="w">         </span><span class="nx">strNameForPlot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">rstStations</span><span class="p">(</span><span class="s2">&quot;NickName&quot;</span><span class="p">)</span>
<span class="w">         </span><span class="nx">RC</span><span class="w"> </span><span class="s2">&quot;   &lt;option value=&#39;&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">rstStations</span><span class="p">(</span><span class="s2">&quot;StationName&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;&#39; selected&gt;&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">rstStations</span><span class="p">(</span><span class="s2">&quot;NickName&quot;</span><span class="p">)</span><span class="w"> </span>
<span class="w">      </span><span class="nx">Else</span>
<span class="w">         </span><span class="nx">RC</span><span class="w"> </span><span class="s2">&quot;   &lt;option value=&#39;&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">rstStations</span><span class="p">(</span><span class="s2">&quot;StationName&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;&#39;&gt;&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">rstStations</span><span class="p">(</span><span class="s2">&quot;NickName&quot;</span><span class="p">)</span>
<span class="w">      </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>
<span class="w">   </span>
<span class="w">   </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>
<span class="w">   </span><span class="nx">rstStations</span><span class="p">.</span><span class="nx">movenext</span>
<span class="nx">loop</span>
<span class="nx">RC</span><span class="w"> </span><span class="s2">&quot;&lt;/select&gt;&quot;</span>

<span class="nx">If</span><span class="w"> </span><span class="nx">rstStations</span><span class="p">.</span><span class="nx">State</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">adStateOpen</span><span class="w"> </span><span class="nx">Then</span><span class="w"> </span><span class="nx">rstStations</span><span class="p">.</span><span class="nx">Close</span>
<span class="nb">Set</span><span class="w"> </span><span class="nx">rstStations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Nothing</span>

<span class="s1">&#39; Click for next location.</span>
<span class="s1">RC &quot;&lt;INPUT  title=&#39;</span><span class="nx">Click</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">step</span><span class="w"> </span><span class="nx">through</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">list</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">locations</span><span class="p">.</span><span class="s1">&#39; type=&#39;</span><span class="nx">button</span><span class="s1">&#39; style=&#39;</span><span class="nx">WIDTH</span><span class="o">:</span><span class="mf">18</span><span class="nx">px</span><span class="p">;</span><span class="w"> </span><span class="nx">HEIGHT</span><span class="o">:</span><span class="mf">23</span><span class="nx">px</span><span class="p">;</span><span class="w"> </span><span class="nx">COLOR</span><span class="o">:</span><span class="nx">black</span><span class="p">;</span><span class="w"> </span><span class="nx">padding</span><span class="o">-</span><span class="nx">left</span><span class="o">:</span><span class="mf">3</span><span class="nx">px</span><span class="p">;</span><span class="s1">&#39; value=&#39;</span><span class="o">&gt;</span><span class="s1">&#39; id=&#39;</span><span class="nx">btnStepLocationForward</span><span class="s1">&#39; name=&#39;</span><span class="nx">btnStepLocationForward</span><span class="s1">&#39; onClick=&#39;</span><span class="nx">stepLocationForward</span><span class="p">()</span><span class="s1">&#39;&gt;&quot;</span>


<span class="s1">&#39;</span><span class="w"> </span><span class="nx">Sensor</span><span class="w"> </span><span class="nx">type</span>

<span class="nx">WeatherTypes</span><span class="w"> </span><span class="o">=</span><span class="w">     </span><span class="nb">Array</span><span class="p">(</span><span class="s2">&quot;Wind (0-36)&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Wind (0-40)&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Temperature&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Pressure&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Delta-P1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Delta-P2&quot;</span><span class="p">)</span>
<span class="nx">WeatherTypes_URL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Array</span><span class="p">(</span><span class="s2">&quot;Wind36&quot;</span><span class="p">,</span><span class="w">      </span><span class="s2">&quot;Wind40&quot;</span><span class="p">,</span><span class="w">      </span><span class="s2">&quot;Temperature&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Pressure&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;DeltaP1&quot;</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;DeltaP2&quot;</span><span class="p">)</span><span class="w"> </span>
<span class="nx">WeatherTypes_count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">UBound</span><span class="p">(</span><span class="nx">WeatherTypes</span><span class="p">)</span>

<span class="s1">&#39; Don&#39;</span><span class="nx">t</span><span class="w"> </span><span class="nx">offer</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">Delta</span><span class="o">-</span><span class="nx">P</span><span class="w"> </span><span class="nx">plot</span><span class="w"> </span><span class="nx">anywhere</span><span class="w"> </span><span class="nx">but</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">Columbia</span><span class="w"> </span><span class="nx">Basin</span><span class="p">.</span>
<span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">strRegion</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="s2">&quot;CR&quot;</span><span class="p">)</span><span class="w"> </span><span class="nx">then</span>
<span class="w">   </span><span class="nx">WeatherTypes_count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">WeatherTypes_count</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">2</span><span class="w"> </span>
<span class="nx">End</span><span class="w"> </span><span class="nx">If</span>

<span class="nx">RC</span><span class="w"> </span><span class="s2">&quot;&lt;select title=&#39;Sensor type&#39; size=&#39;1&#39; name=&#39;Sensor&#39; id=&#39;Sensor&#39; onChange=&#39;submitform()&#39;&gt;&quot;</span>
<span class="nx">For</span><span class="w"> </span><span class="nx">intJ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">WeatherTypes_count</span><span class="w"> </span>
<span class="w">   </span><span class="nx">If</span><span class="w"> </span><span class="p">((</span><span class="nx">WeatherTypes_URL</span><span class="p">(</span><span class="nx">intJ</span><span class="p">)</span><span class="o">=</span><span class="w"> </span><span class="nx">strSensorType</span><span class="p">)</span><span class="w"> </span><span class="nx">OR</span><span class="w"> </span><span class="p">((</span><span class="nx">strSensorType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="w"> </span><span class="nx">AND</span><span class="w"> </span><span class="p">(</span><span class="nx">WeatherTypes_URL</span><span class="p">(</span><span class="nx">intJ</span><span class="p">)</span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Wind40&quot;</span><span class="p">)))</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">      </span><span class="nx">RC</span><span class="w"> </span><span class="s2">&quot;   &lt;option selected value=&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">WeatherTypes_URL</span><span class="p">(</span><span class="nx">intJ</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot; &gt;&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">WeatherTypes</span><span class="p">(</span><span class="nx">intJ</span><span class="p">)</span>
<span class="w">   </span><span class="nx">Else</span>
<span class="w">      </span><span class="nx">RC</span><span class="w"> </span><span class="s2">&quot;   &lt;option value=&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">WeatherTypes_URL</span><span class="p">(</span><span class="nx">intJ</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot; &gt;&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">WeatherTypes</span><span class="p">(</span><span class="nx">intJ</span><span class="p">)</span>
<span class="w">   </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>
<span class="nx">Next</span>
<span class="nx">RC</span><span class="w"> </span><span class="s2">&quot;&lt;/select&gt;&quot;</span>


<span class="s1">&#39; Select the last day.</span>

<span class="s1">strSQL = &quot;SELECT DISTINCT DaysGleaned.TimeMDY FROM DaysGleaned ORDER BY DaysGleaned.TimeMDY DESC&quot;</span>
<span class="s1">  </span>
<span class="s1">&#39;</span><span class="w"> </span><span class="nx">See</span><span class="w"> </span><span class="nx">IIShelp</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">description</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">parameters</span><span class="o">:</span><span class="w"> </span><span class="nx">Open</span><span class="w"> </span><span class="nx">Method</span><span class="w"> </span><span class="p">(</span><span class="nx">Recordset</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">ADO</span><span class="p">).</span>
<span class="s1">&#39; The AdCmdText just tells it that it is a SQL string in the first parameter.</span>
<span class="s1">&#39;</span><span class="w"> </span><span class="nx">Alternatively</span><span class="w"> </span><span class="nx">you</span><span class="w"> </span><span class="nx">could</span><span class="w"> </span><span class="nx">tell</span><span class="w"> </span><span class="nx">it</span><span class="w"> </span><span class="nx">that</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">first</span><span class="w"> </span><span class="nx">parameter</span><span class="w"> </span><span class="nx">is</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nx">table</span><span class="w"> </span><span class="nx">name</span><span class="p">...</span>

<span class="nb">Set</span><span class="w"> </span><span class="nx">rstDate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Server</span><span class="p">.</span><span class="nx">CreateObject</span><span class="p">(</span><span class="s2">&quot;ADODB.Recordset&quot;</span><span class="p">)</span>
<span class="nx">On</span><span class="w"> </span><span class="ne">Error</span><span class="w"> </span><span class="nx">Resume</span><span class="w"> </span><span class="nx">Next</span>
<span class="nx">rstDate</span><span class="p">.</span><span class="nx">Open</span><span class="w"> </span><span class="nx">strSQL</span><span class="p">,</span><span class="w"> </span><span class="nx">DBConnection</span><span class="p">,</span><span class="w"> </span><span class="nx">adOpenStatic</span><span class="p">,</span><span class="w"> </span><span class="nx">adLockReadOnly</span><span class="p">,</span><span class="w"> </span><span class="nx">adCmdText</span>
<span class="nx">LogError</span><span class="p">(</span><span class="s2">&quot;Recordset = rstTelem, SQL = &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">strSQL_trace</span><span class="p">)</span>
<span class="nx">On</span><span class="w"> </span><span class="ne">Error</span><span class="w"> </span><span class="nx">Goto</span><span class="w"> </span><span class="mf">0</span>

<span class="nx">RC</span><span class="w"> </span><span class="s2">&quot;&lt;select title=&#39;Last day&#39; size=&#39;1&#39; name=&#39;EndDate&#39; id=&#39;EndDate&#39; onChange=&#39;submitform()&#39;&gt;&quot;</span>
<span class="nx">rstDate</span><span class="p">.</span><span class="nx">movefirst</span>
<span class="k">do</span><span class="w"> </span><span class="nx">until</span><span class="w"> </span><span class="nx">rstDate</span><span class="p">.</span><span class="nx">EOF</span>
<span class="w">   </span><span class="s1">&#39; Coerce the date object to a string by using the (&amp; &quot;&quot;)</span>
<span class="s1">   If ((dtePostedDate = (rstDate(&quot;TimeMDY&quot;) &amp; &quot;&quot;)) OR ((dtePostedDate = &quot;&quot;) AND (rstDate(&quot;TimeMDY&quot;) = Date()))) then</span>
<span class="s1">      RC &quot;   &lt;option selected&gt;&quot; &amp; rstDate(&quot;TimeMDY&quot;) &amp; &quot; &quot; &amp; weekdayname(weekday(rstDate(&quot;TimeMDY&quot;)),True)</span>
<span class="s1">   Else</span>
<span class="s1">      RC &quot;   &lt;option&gt;&quot; &amp; rstDate(&quot;TimeMDY&quot;) &amp; &quot; &quot; &amp; weekdayname(weekday(rstDate(&quot;TimeMDY&quot;)),True)</span>
<span class="s1">   End If  </span>
<span class="s1">   rstDate.movenext</span>
<span class="s1">loop</span>
<span class="s1">RC &quot;&lt;/select&gt;&quot;</span>

<span class="s1">If rstDate.State = adStateOpen Then rstDate.Close</span>
<span class="s1">Set rstDate = Nothing</span>


<span class="s1">&#39;</span><span class="w"> </span><span class="nx">Select</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">time</span><span class="w"> </span><span class="nx">range</span><span class="p">.</span>
<span class="w">  </span>
<span class="nx">RC</span><span class="w"> </span><span class="s2">&quot;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;font color=&#39;#008080&#39;&gt;Days:&lt;/font&gt;&quot;</span>

<span class="nx">RC</span><span class="w"> </span><span class="s2">&quot;&lt;select title=&#39;Time range&#39; size=&#39;1&#39; name=&#39;Days&#39; id=&#39;Days&#39; onChange=&#39;submitform()&#39;&gt;&quot;</span>
<span class="nx">DaysChoices</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Array</span><span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">,</span><span class="s2">&quot;2&quot;</span><span class="p">,</span><span class="s2">&quot;3&quot;</span><span class="p">,</span><span class="s2">&quot;4&quot;</span><span class="p">,</span><span class="s2">&quot;5&quot;</span><span class="p">,</span><span class="s2">&quot;6&quot;</span><span class="p">,</span><span class="s2">&quot;7&quot;</span><span class="p">,</span><span class="s2">&quot;8&quot;</span><span class="p">,</span><span class="s2">&quot;9&quot;</span><span class="p">,</span><span class="s2">&quot;10&quot;</span><span class="p">,</span><span class="s2">&quot;14&quot;</span><span class="p">,</span><span class="s2">&quot;25&quot;</span><span class="p">)</span>
<span class="nx">For</span><span class="w"> </span><span class="nx">each</span><span class="w"> </span><span class="nx">DayValue</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">DaysChoices</span>
<span class="w">   </span><span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">DayValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">intDays</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">      </span><span class="nx">RC</span><span class="w"> </span><span class="s2">&quot;   &lt;option selected&gt;&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">DayValue</span>
<span class="w">   </span><span class="nx">Else</span>
<span class="w">      </span><span class="nx">RC</span><span class="w"> </span><span class="s2">&quot;   &lt;option&gt;&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">DayValue</span>
<span class="w">   </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>
<span class="nx">Next</span>
<span class="nx">RC</span><span class="w"> </span><span class="s2">&quot;&lt;/select&gt;&quot;</span>


<span class="s1">&#39; Time steppers</span>

<span class="s1">RC &quot;&lt;INPUT title=&#39;</span><span class="nx">Click</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">step</span><span class="w"> </span><span class="nx">back</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="s1">&#39; type=&#39;</span><span class="nx">button</span><span class="s1">&#39; style=&#39;</span><span class="nx">WIDTH</span><span class="o">:</span><span class="w"> </span><span class="mf">18</span><span class="nx">px</span><span class="p">;</span><span class="w"> </span><span class="nx">HEIGHT</span><span class="o">:</span><span class="w"> </span><span class="mf">23</span><span class="nx">px</span><span class="p">;</span><span class="w"> </span><span class="nx">COLOR</span><span class="o">:</span><span class="w"> </span><span class="nx">black</span><span class="p">;</span><span class="w"> </span><span class="nx">padding</span><span class="o">-</span><span class="nx">left</span><span class="o">:</span><span class="mf">3</span><span class="nx">px</span><span class="p">;</span><span class="s1">&#39; value=&#39;</span><span class="o">&lt;</span><span class="s1">&#39; id=&#39;</span><span class="nx">btnStepBack</span><span class="s1">&#39; name=&#39;</span><span class="nx">btnStepBack</span><span class="s1">&#39; onClick=&#39;</span><span class="nx">stepBack</span><span class="p">()</span><span class="s1">&#39;&gt;&quot;</span>
<span class="s1">RC &quot;&lt;INPUT title=&#39;</span><span class="nx">Click</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">step</span><span class="w"> </span><span class="nx">forward</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="s1">&#39; type=&#39;</span><span class="nx">button</span><span class="s1">&#39; style=&#39;</span><span class="nx">WIDTH</span><span class="o">:</span><span class="w"> </span><span class="mf">18</span><span class="nx">px</span><span class="p">;</span><span class="w"> </span><span class="nx">HEIGHT</span><span class="o">:</span><span class="w"> </span><span class="mf">23</span><span class="nx">px</span><span class="p">;</span><span class="w"> </span><span class="nx">COLOR</span><span class="o">:</span><span class="w"> </span><span class="nx">black</span><span class="p">;</span><span class="w"> </span><span class="nx">padding</span><span class="o">-</span><span class="nx">left</span><span class="o">:</span><span class="mf">3</span><span class="nx">px</span><span class="p">;</span><span class="s1">&#39; value=&#39;</span><span class="o">&gt;</span><span class="s1">&#39; id=&#39;</span><span class="nx">btnStepForward</span><span class="s1">&#39; name=&#39;</span><span class="nx">btnStepForward</span><span class="s1">&#39; onClick=&#39;</span><span class="nx">stepForward</span><span class="p">()</span><span class="s1">&#39;&gt;&quot;</span>


<span class="s1">&#39;</span><span class="w"> </span><span class="nx">The</span><span class="w"> </span><span class="mf">24</span><span class="o">-</span><span class="nx">Hour</span><span class="w"> </span><span class="nx">charting</span><span class="w"> </span><span class="nx">option</span><span class="p">.</span>
<span class="nx">RC</span><span class="w"> </span><span class="s2">&quot;&amp;nbsp;&amp;nbsp;&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">   </span><span class="s2">&quot;&lt;input &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">str24Hrs_state</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot; type=&#39;checkbox&#39; name=&#39;chk24Hrs&#39; &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">   </span><span class="s2">&quot;title=&#39;Select to display 24 hours of the most recent data (including data from yesterday) on the 1-day chart. &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">   </span><span class="s2">&quot;Please refer to the FAQ on the &quot;&quot;24h&quot;&quot; checkbox.&#39; &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">   </span><span class="s2">&quot;onClick=&#39;submitform()&#39;/&gt;&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">   </span><span class="s2">&quot;&lt;font size=&#39;2&#39; color=&#39;#008080&#39;&gt;24h&lt;/font&gt;&quot;</span>
<span class="w">   </span>
<span class="s1">&#39; The Running-average option</span>
<span class="s1">RW &quot;&quot; &amp; _</span>
<span class="s1">   &quot;&lt;input &quot; &amp; strRA_state &amp; &quot; type=&#39;</span><span class="nx">checkbox</span><span class="s1">&#39; name=&#39;</span><span class="nx">chkRA</span><span class="s1">&#39; &quot; &amp; _</span>
<span class="s1">   &quot;title=&#39;</span><span class="nx">Select</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">apply</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nx">running</span><span class="w"> </span><span class="nx">average</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">all</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">data</span><span class="p">.</span><span class="s1">&#39; &quot; &amp; _</span>
<span class="s1">   &quot;onClick=&#39;</span><span class="nx">submitform</span><span class="p">()</span><span class="s1">&#39;/&gt;&quot; &amp; _</span>
<span class="s1">   &quot;&lt;font size=&#39;</span><span class="mf">2</span><span class="s1">&#39; color=&#39;</span><span class="err">#</span><span class="mo">00</span><span class="mf">8080</span><span class="s1">&#39;&gt;RA&lt;/font&gt;&quot;</span>
<span class="s1">   </span>
<span class="s1">&#39;</span><span class="w"> </span><span class="nx">The</span><span class="w"> </span><span class="nx">timer</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">auto</span><span class="o">-</span><span class="nx">plots</span>
<span class="nx">RW</span><span class="w"> </span><span class="s2">&quot;&amp;nbsp;&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">   </span><span class="s2">&quot;&lt;input &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">strTimer_state</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot; type=&#39;checkbox&#39; name=&#39;chkTimer&#39; &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">   </span><span class="s2">&quot;title=&#39;Select to enable a repeating 5-minute countdown timer. This is synchronized with the server to trigger a chart update immediately after &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">   </span><span class="s2">&quot;the database has been updated.&#39; &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">   </span><span class="s2">&quot;onClick=&#39;submitform()&#39;/&gt;&quot;</span>

<span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">strTimer_state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;checked&quot;</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">   </span><span class="s1">&#39; The space in the span is needed for an initial value. The client-sided JavaScript changes this value</span>
<span class="s1">   &#39;</span><span class="w"> </span><span class="nx">every</span><span class="w"> </span><span class="nx">second</span><span class="p">.</span>
<span class="w">   </span><span class="nx">strTimer_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot; &quot;</span>
<span class="nx">Else</span>
<span class="w">   </span><span class="nx">strTimer_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Timer&quot;</span>
<span class="nx">End</span><span class="w"> </span><span class="nx">If</span>
<span class="nx">RW</span><span class="w"> </span><span class="s2">&quot;&lt;span id=&#39;spTimerSec&#39; name=&#39;spTimerSec&#39; style=&#39;color:#008080; font-size:10pt;&#39;&gt;&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">strTimer_value</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;&lt;/span&gt;&quot;</span>


<span class="s1">&#39; A hidden field that serves to test if the client has JavaScript enabled. Some script will</span>
<span class="s1">&#39;</span><span class="w"> </span><span class="k">try</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">change</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="nx">F</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">T</span><span class="p">.</span>
<span class="nx">RC</span><span class="w"> </span><span class="s2">&quot;&lt;input type=&#39;hidden&#39; name=&#39;jS&#39; id=&#39;jS&#39; value=&#39;F&#39;&gt;&quot;</span>

<span class="nx">RC</span><span class="w"> </span><span class="s2">&quot;&lt;/form&gt;&quot;</span>

<span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">Request</span><span class="p">.</span><span class="nx">QueryString</span><span class="p">(</span><span class="s2">&quot;jS&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;F&quot;</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">   </span><span class="nx">RBC</span><span class="w"> </span><span class="s2">&quot;JavaScript is needed to use the charting controls and view a chart image.&quot;</span>
<span class="w">   </span><span class="nx">RBC</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<span class="w">   </span><span class="nx">RBC</span><span class="w"> </span><span class="s2">&quot;Please enable JavaScript in your web browser. If you enable JavaScript, this warning&quot;</span>
<span class="w">   </span><span class="nx">RBC</span><span class="w"> </span><span class="s2">&quot;will clear after your second click of the press-to-chart button.&quot;</span>
<span class="w">   </span><span class="nx">RBC</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<span class="w">   </span><span class="nx">RBC</span><span class="w"> </span><span class="s2">&quot;Note that requesting a chart update before the previous chart has completed is another&quot;</span>
<span class="w">   </span><span class="nx">RBC</span><span class="w"> </span><span class="s2">&quot;possible cause for this error message. Please wait until the image returns from the&quot;</span>
<span class="w">   </span><span class="nx">RBC</span><span class="w"> </span><span class="s2">&quot;server.&quot;</span>
<span class="nx">Else</span>
<span class="w">   </span><span class="s1">&#39;=================================================================================</span>
<span class="s1">   &#39;</span><span class="w"> </span><span class="nx">PLOT</span><span class="w"> </span><span class="nx">THE</span><span class="w"> </span><span class="nx">CHART</span><span class="p">...</span>
<span class="w">   </span><span class="s1">&#39;</span>
<span class="s1">   &#39;</span><span class="w"> </span><span class="nx">If</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">region</span><span class="w"> </span><span class="nx">has</span><span class="w"> </span><span class="nx">been</span><span class="w"> </span><span class="nx">specified</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">query</span><span class="p">,</span><span class="w"> </span><span class="nx">then</span><span class="w"> </span><span class="nx">plot</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">chart</span><span class="p">.</span>
<span class="w">   </span><span class="s1">&#39;</span>
<span class="s1">   &#39;</span><span class="o">=================================================================================</span>
<span class="w">   </span><span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">Request</span><span class="p">.</span><span class="nx">QueryString</span><span class="p">(</span><span class="s2">&quot;Region&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">      </span>
<span class="w">      </span><span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">strMRTime</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="s2">&quot;-&quot;</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">         </span><span class="nx">FetchTheData</span>

<span class="w">         </span><span class="s1">&#39; Close the database connection</span>
<span class="s1">         If IsObject(DBConnection) Then</span>
<span class="s1">            If DBConnection.State &lt;&gt; adStateClosed Then</span>
<span class="s1">               DBConnection.Close</span>
<span class="s1">            End If</span>
<span class="s1">            Set DBConnection = Nothing</span>
<span class="s1">         End If</span>

<span class="s1">         PlotTheChart</span>

<span class="s1">      Else</span>
<span class="s1">         RWBR &quot;No data available for the selected station.&quot;</span>
<span class="s1">      End If</span>

<span class="s1">   Else</span>
<span class="s1">      RWBR &quot;&quot;</span>
<span class="s1">      RWBR &quot;Specifiy a region and then click the chart button.&quot;</span>
<span class="s1">   End If</span>
<span class="s1">End If</span>

<span class="s1">%&gt;</span>

<span class="s1">&lt;!--  Client side script --&gt;</span>

<span class="s1">&lt;SCRIPT LANGUAGE=&quot;javascript&quot;&gt;</span>
<span class="s1">&lt;!--</span>

<span class="s1">// Globals</span>

<span class="s1">var cP = document.getElementById(&#39;</span><span class="nx">ChartingParameters</span><span class="s1">&#39;);</span>

<span class="s1">var cmbEndDate = document.getElementById(&#39;</span><span class="nx">EndDate</span><span class="s1">&#39;);</span>
<span class="s1">var cmbDays = document.getElementById(&#39;</span><span class="nx">Days</span><span class="s1">&#39;);</span>
<span class="s1">var cmbLocation = document.getElementById(&#39;</span><span class="nx">Location</span><span class="s1">&#39;);</span>

<span class="s1">var stepIncrement = cmbDays.options[cmbDays.selectedIndex].text;</span>

<span class="s1">function testJS(){</span>
<span class="s1">   document.getElementById(&#39;</span><span class="nx">jS</span><span class="s1">&#39;).value = &#39;</span><span class="nx">T</span><span class="s1">&#39;;</span>
<span class="s1">}</span>

<span class="s1">function showDirections(){</span>
<span class="s1">   try {</span>
<span class="s1">      var imgDirections = document.getElementById(&#39;</span><span class="nx">directions</span><span class="s1">&#39;);</span>
<span class="s1">      imgDirections.style.visibility = &#39;</span><span class="nx">visible</span><span class="s1">&#39;;</span>
<span class="s1">   }</span>
<span class="s1">   catch(e){}</span>
<span class="s1">}</span>

<span class="s1">function showImage(){</span>
<span class="s1">   try {</span>
<span class="s1">      var imgChartImage = document.getElementById(&#39;</span><span class="nx">chartimage</span><span class="s1">&#39;);</span>
<span class="s1">      imgChartImage.style.visibility = &#39;</span><span class="nx">visible</span><span class="s1">&#39;;</span>
<span class="s1">   }</span>
<span class="s1">   catch(e){}</span>
<span class="s1">}</span>

<span class="s1">function changeColorSubmitButton(){</span>
<span class="s1">   document.getElementById(&#39;</span><span class="nx">myButton</span><span class="s1">&#39;).style.color=&#39;</span><span class="nx">red</span><span class="s1">&#39;;</span>
<span class="s1">}</span>

<span class="s1">function submitform(){</span>
<span class="s1">   //document.getElementById(&#39;</span><span class="nx">Sensor</span><span class="s1">&#39;).style.backgroundColor=&#39;</span><span class="n">#FFE4C4</span><span class="s1">&#39;;</span>
<span class="s1">   document.getElementById(&#39;</span><span class="nx">myButton</span><span class="s1">&#39;).value = &#39;</span><span class="nx">Please</span><span class="w"> </span><span class="nx">Wait</span><span class="s1">&#39;;</span>
<span class="s1">   cP.submit();</span>
<span class="s1">}</span>

<span class="s1">function stepLocationForward(){</span>
<span class="s1">   var targetIndex = cmbLocation.selectedIndex;</span>
<span class="s1">   if (targetIndex &lt; (cmbLocation.length - 1)){</span>
<span class="s1">      cmbLocation.selectedIndex = targetIndex + 1;</span>
<span class="s1">   } else {</span>
<span class="s1">      cmbLocation.selectedIndex = 0;</span>
<span class="s1">   }</span>
<span class="s1">   submitform();</span>
<span class="s1">}</span>

<span class="s1">function stepBack(){</span>
<span class="s1">   var targetIndex = cmbEndDate.selectedIndex + (stepIncrement * 1.0);</span>
<span class="s1">   if (targetIndex &gt; (cmbEndDate.length - 1)){</span>
<span class="s1">      cmbEndDate.selectedIndex = cmbEndDate.selectedIndex;</span>
<span class="s1">   } else {</span>
<span class="s1">      cmbEndDate.selectedIndex = targetIndex;</span>
<span class="s1">   }</span>
<span class="s1">   submitform();   </span>
<span class="s1">}</span>

<span class="s1">function stepForward(){</span>
<span class="s1">   var targetIndex = cmbEndDate.selectedIndex - (stepIncrement * 1.0);</span>
<span class="s1">   if (targetIndex &lt; 0){</span>
<span class="s1">      cmbEndDate.selectedIndex = 0;</span>
<span class="s1">   } else {</span>
<span class="s1">      cmbEndDate.selectedIndex = targetIndex;</span>
<span class="s1">   }</span>
<span class="s1">   submitform();   </span>
<span class="s1">}</span>

<span class="s1">// Timer functions</span>

<span class="s1">var secs;</span>
<span class="s1">var timerID = null;</span>
<span class="s1">var timerRunning = false;</span>
<span class="s1">var delay = 1000;</span>

<span class="s1">function initializeTimer(secsFromChart){</span>

<span class="s1">   // Set the length of the timer, in seconds</span>
<span class="s1">   if (secsFromChart == null){</span>
<span class="s1">      if (timerRunning){</span>
<span class="s1">         secs = secs - 5;</span>
<span class="s1">         if (secs &lt; 0){ </span>
<span class="s1">            secs = 3;</span>
<span class="s1">         }</span>
<span class="s1">      }else{</span>
<span class="s1">         if (secs == null){</span>
<span class="s1">            secs = 298;</span>
<span class="s1">         }</span>
<span class="s1">      }</span>
<span class="s1">   }else{</span>
<span class="s1">      secs = secsFromChart;   </span>
<span class="s1">   }</span>
<span class="s1">    </span>
<span class="s1">   stopTheTimer();</span>
<span class="s1">   startTheTimer();</span>
<span class="s1">}</span>

<span class="s1">function stopTheTimer(){</span>

<span class="s1">   if (timerRunning){</span>
<span class="s1">      clearTimeout(timerID);</span>
<span class="s1">      timerRunning = false; </span>
<span class="s1">      // This color change was used when there was a pause mode.</span>
<span class="s1">      //document.getElementById(&#39;</span><span class="nx">spTimerSec</span><span class="s1">&#39;).style.color = &#39;</span><span class="nx">red</span><span class="s1">&#39;;</span>
<span class="s1">   }</span>
<span class="s1">}</span>

<span class="s1">function startTheTimer(){</span>
<span class="s1">   // Reset the color back to normal.</span>
<span class="s1">   //document.getElementById(&#39;</span><span class="nx">spTimerSec</span><span class="s1">&#39;).style.color = &#39;</span><span class="err">#</span><span class="mo">00</span><span class="mf">8080</span><span class="s1">&#39;;</span>

<span class="s1">   if (secs==0){</span>
<span class="s1">      // Here&#39;</span><span class="nx">s</span><span class="w"> </span><span class="nx">where</span><span class="w"> </span><span class="nx">you</span><span class="w"> </span><span class="nx">put</span><span class="w"> </span><span class="nx">something</span><span class="w"> </span><span class="nx">useful</span><span class="w"> </span><span class="nx">that</span><span class="s1">&#39;s</span>
<span class="s1">      // executes after the allotted time.</span>
<span class="s1">      submitform();</span>
<span class="s1">    </span>
<span class="s1">   }else{</span>
<span class="s1">      self.status = secs;</span>
<span class="s1">      if (secs &lt; 10){</span>
<span class="s1">         secs = &#39;</span><span class="w"> </span><span class="s1">&#39; + secs;</span>
<span class="s1">      }</span>
<span class="s1">      document.getElementById(&#39;</span><span class="nx">spTimerSec</span><span class="s1">&#39;).firstChild.nodeValue = &#39;&#39; + secs + &#39;</span><span class="nx">s</span><span class="p">.</span><span class="s1">&#39;;</span>
<span class="s1">      secs = secs - 1;</span>

<span class="s1">      timerRunning = true;</span>
<span class="s1">      timerID = self.setTimeout(&quot;startTheTimer()&quot;, delay);</span>
<span class="s1">   }</span>
<span class="s1">}</span>

<span class="s1">function changeRegionAnchorValue( theInputString){</span>
<span class="s1">   if (theInputString==&#39;</span><span class="nx">MN</span><span class="s1">&#39;) {</span>
<span class="s1">      document.getElementById(&#39;</span><span class="nx">regionanchor</span><span class="s1">&#39;).firstChild.nodeValue = &#39;</span><span class="nx">Columbia</span><span class="w"> </span><span class="nx">Basin</span><span class="w"> </span><span class="nx">Weather</span><span class="s1">&#39;;</span>
<span class="s1">   } else if (theInputString==&#39;</span><span class="nx">CR</span><span class="s1">&#39;) {</span>
<span class="s1">      document.getElementById(&#39;</span><span class="nx">regionanchor</span><span class="s1">&#39;).firstChild.nodeValue = &#39;</span><span class="nx">Minnesota</span><span class="w"> </span><span class="nx">Weather</span><span class="s1">&#39;;</span>
<span class="s1">   } else {</span>
<span class="s1">      document.getElementById(&#39;</span><span class="nx">regionanchor</span><span class="s1">&#39;).firstChild.nodeValue = theInputString;</span>
<span class="s1">   }</span>
<span class="s1">}</span>

<span class="s1">function setRegionState(){</span>
<span class="s1">   document.getElementById(&#39;</span><span class="nx">Region_state</span><span class="s1">&#39;).value = &#39;</span><span class="ow">new</span><span class="err">&#39;</span><span class="p">;</span>
<span class="w">   </span><span class="nx">submitform</span><span class="p">();</span><span class="w"> </span>
<span class="p">}</span>

<span class="c1">//--&gt;</span>
<span class="o">&lt;</span><span class="err">/SCRIPT&gt;</span>
<span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="o">&lt;</span><span class="err">/body&gt;</span>
<span class="o">&lt;</span><span class="err">/html&gt;</span>
</pre></div>
</body>
</html>
