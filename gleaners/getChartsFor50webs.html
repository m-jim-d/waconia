<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">
<!--
generated by Pygments <https://pygments.org/>
Copyright 2006-2025 by the Pygments team.
Licensed under the BSD license, see LICENSE for details.
-->
<html>
<head>
  <link rel='canonical' href='https://waconia.triquence.org/gleaners/getChartsFor50webs.html' />
  <title>getChartsFor50webs</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <style type="text/css">
/*
generated by Pygments <https://pygments.org/>
Copyright 2006-2025 by the Pygments team.
Licensed under the BSD license, see LICENSE for details.
*/
pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
body .hll { background-color: #49483e }
body { background: #272822; color: #F8F8F2 }
body .c { color: #959077 } /* Comment */
body .err { color: #ED007E; background-color: #1E0010 } /* Error */
body .esc { color: #F8F8F2 } /* Escape */
body .g { color: #F8F8F2 } /* Generic */
body .k { color: #66D9EF } /* Keyword */
body .l { color: #AE81FF } /* Literal */
body .n { color: #F8F8F2 } /* Name */
body .o { color: #FF4689 } /* Operator */
body .x { color: #F8F8F2 } /* Other */
body .p { color: #F8F8F2 } /* Punctuation */
body .ch { color: #959077 } /* Comment.Hashbang */
body .cm { color: #959077 } /* Comment.Multiline */
body .cp { color: #959077 } /* Comment.Preproc */
body .cpf { color: #959077 } /* Comment.PreprocFile */
body .c1 { color: #959077 } /* Comment.Single */
body .cs { color: #959077 } /* Comment.Special */
body .gd { color: #FF4689 } /* Generic.Deleted */
body .ge { color: #F8F8F2; font-style: italic } /* Generic.Emph */
body .ges { color: #F8F8F2; font-weight: bold; font-style: italic } /* Generic.EmphStrong */
body .gr { color: #F8F8F2 } /* Generic.Error */
body .gh { color: #F8F8F2 } /* Generic.Heading */
body .gi { color: #A6E22E } /* Generic.Inserted */
body .go { color: #66D9EF } /* Generic.Output */
body .gp { color: #FF4689; font-weight: bold } /* Generic.Prompt */
body .gs { color: #F8F8F2; font-weight: bold } /* Generic.Strong */
body .gu { color: #959077 } /* Generic.Subheading */
body .gt { color: #F8F8F2 } /* Generic.Traceback */
body .kc { color: #66D9EF } /* Keyword.Constant */
body .kd { color: #66D9EF } /* Keyword.Declaration */
body .kn { color: #FF4689 } /* Keyword.Namespace */
body .kp { color: #66D9EF } /* Keyword.Pseudo */
body .kr { color: #66D9EF } /* Keyword.Reserved */
body .kt { color: #66D9EF } /* Keyword.Type */
body .ld { color: #E6DB74 } /* Literal.Date */
body .m { color: #AE81FF } /* Literal.Number */
body .s { color: #E6DB74 } /* Literal.String */
body .na { color: #A6E22E } /* Name.Attribute */
body .nb { color: #F8F8F2 } /* Name.Builtin */
body .nc { color: #A6E22E } /* Name.Class */
body .no { color: #66D9EF } /* Name.Constant */
body .nd { color: #A6E22E } /* Name.Decorator */
body .ni { color: #F8F8F2 } /* Name.Entity */
body .ne { color: #A6E22E } /* Name.Exception */
body .nf { color: #A6E22E } /* Name.Function */
body .nl { color: #F8F8F2 } /* Name.Label */
body .nn { color: #F8F8F2 } /* Name.Namespace */
body .nx { color: #A6E22E } /* Name.Other */
body .py { color: #F8F8F2 } /* Name.Property */
body .nt { color: #FF4689 } /* Name.Tag */
body .nv { color: #F8F8F2 } /* Name.Variable */
body .ow { color: #FF4689 } /* Operator.Word */
body .pm { color: #F8F8F2 } /* Punctuation.Marker */
body .w { color: #F8F8F2 } /* Text.Whitespace */
body .mb { color: #AE81FF } /* Literal.Number.Bin */
body .mf { color: #AE81FF } /* Literal.Number.Float */
body .mh { color: #AE81FF } /* Literal.Number.Hex */
body .mi { color: #AE81FF } /* Literal.Number.Integer */
body .mo { color: #AE81FF } /* Literal.Number.Oct */
body .sa { color: #E6DB74 } /* Literal.String.Affix */
body .sb { color: #E6DB74 } /* Literal.String.Backtick */
body .sc { color: #E6DB74 } /* Literal.String.Char */
body .dl { color: #E6DB74 } /* Literal.String.Delimiter */
body .sd { color: #E6DB74 } /* Literal.String.Doc */
body .s2 { color: #E6DB74 } /* Literal.String.Double */
body .se { color: #AE81FF } /* Literal.String.Escape */
body .sh { color: #E6DB74 } /* Literal.String.Heredoc */
body .si { color: #E6DB74 } /* Literal.String.Interpol */
body .sx { color: #E6DB74 } /* Literal.String.Other */
body .sr { color: #E6DB74 } /* Literal.String.Regex */
body .s1 { color: #E6DB74 } /* Literal.String.Single */
body .ss { color: #E6DB74 } /* Literal.String.Symbol */
body .bp { color: #F8F8F2 } /* Name.Builtin.Pseudo */
body .fm { color: #A6E22E } /* Name.Function.Magic */
body .vc { color: #F8F8F2 } /* Name.Variable.Class */
body .vg { color: #F8F8F2 } /* Name.Variable.Global */
body .vi { color: #F8F8F2 } /* Name.Variable.Instance */
body .vm { color: #F8F8F2 } /* Name.Variable.Magic */
body .il { color: #AE81FF } /* Literal.Number.Integer.Long */

  </style>
</head>
<body>
<h2></h2>

<div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>

<span class="c1"># Any command line argument will cause this script to run in testing mode. If the</span>
<span class="c1"># argument is &quot;push&quot; all the 25day and 10day images will be pushed to the 50Webs </span>
<span class="c1"># server.</span>

<span class="c1"># To use this file: </span>
<span class="c1">#    Edit (if needed) charts_input_testing.html </span>
<span class="c1">#    Edit (if needed) this file, getChartsFor50webs_testing.py, and run it with a &quot;test&quot; or &quot;push&quot; argument.</span>
<span class="c1">#    Then view the charts_testing.html file on the NUC.</span>
<span class="c1">#    Then finally, run publish.bat </span>

<span class="c1"># The testing version of this file is intended for manual execution. Then, when publish.bat</span>
<span class="c1"># is run, this is copied over the non-testing version which is referred to in the </span>
<span class="c1"># getChartsFor50webs.bat file (The batch file is used by the scheduled task.)</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span><span class="o">,</span><span class="w"> </span><span class="nn">shutil</span><span class="o">,</span><span class="w"> </span><span class="nn">random</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">urllib.request</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ftplib</span><span class="w"> </span><span class="kn">import</span> <span class="n">FTP</span>

<span class="c1">#==Functions====================================================================</span>

<span class="k">def</span><span class="w"> </span><span class="nf">uploadBinaryFile</span><span class="p">(</span><span class="n">serverPath</span><span class="p">,</span> <span class="n">localPath</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
    <span class="n">ftp</span><span class="o">.</span><span class="n">storbinary</span><span class="p">(</span><span class="s1">&#39;STOR &#39;</span> <span class="o">+</span> <span class="n">serverPath</span> <span class="o">+</span> <span class="n">filename</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="n">localPath</span> <span class="o">+</span> <span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">))</span>

<span class="k">def</span><span class="w"> </span><span class="nf">uploadTextFile</span><span class="p">(</span><span class="n">serverPath</span><span class="p">,</span> <span class="n">localPath</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
    <span class="n">ftp</span><span class="o">.</span><span class="n">storlines</span><span class="p">(</span><span class="s1">&#39;STOR &#39;</span> <span class="o">+</span> <span class="n">serverPath</span> <span class="o">+</span> <span class="n">filename</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="n">localPath</span> <span class="o">+</span> <span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
   
<span class="k">def</span><span class="w"> </span><span class="nf">getChart</span><span class="p">(</span> <span class="n">stationRegion</span><span class="p">,</span> <span class="n">stationName</span><span class="p">,</span> <span class="n">sensorName</span><span class="p">,</span> <span class="n">nDays</span><span class="p">,</span> <span class="n">imageFileName</span><span class="p">):</span>
    <span class="c1"># One-day charts will use the 24Hour option.</span>
    <span class="c1"># Use localhost (or 192.168.1.104 for BEE or 192.168.1.106 for NUC)</span>
    <span class="n">webpage_url</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;http://&quot;</span> <span class="o">+</span> <span class="s2">&quot;localhost/&quot;</span> <span class="o">+</span> <span class="n">webSite</span> <span class="o">+</span> <span class="s2">&quot;/rosy.asp?Region=&quot;</span> <span class="o">+</span> <span class="n">stationRegion</span> <span class="o">+</span> 
                   <span class="s2">&quot;&amp;Region_state=old&amp;Location=&quot;</span> <span class="o">+</span> <span class="n">stationName</span> <span class="o">+</span> <span class="s2">&quot;&amp;Sensor=&quot;</span> <span class="o">+</span> <span class="n">sensorName</span> <span class="o">+</span> 
                   <span class="s2">&quot;&amp;Days=&quot;</span> <span class="o">+</span> <span class="n">nDays</span> <span class="o">+</span> <span class="s2">&quot;&amp;chk24Hrs=on&amp;chkRA=on&amp;jS=T&amp;specName=&quot;</span> <span class="o">+</span> <span class="n">imageFileName</span><span class="p">)</span>
    <span class="c1">#print(sensorName, webpage_url)</span>
    <span class="n">request</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="n">webpage_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;User-Agent&#39;</span><span class="p">:</span> <span class="s1">&#39;Mozilla/5.0&#39;</span><span class="p">,</span> <span class="s1">&#39;Accept&#39;</span><span class="p">:</span> <span class="s1">&#39;text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8&#39;</span><span class="p">})</span>
    <span class="n">page</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">page</span>
   
<span class="k">def</span><span class="w"> </span><span class="nf">updateCharts</span><span class="p">(</span><span class="n">station</span><span class="p">):</span>
    <span class="n">stationRegion</span> <span class="o">=</span> <span class="n">station</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">stationName</span> <span class="o">=</span> <span class="n">station</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">newImageLine</span> <span class="o">=</span> <span class="s2">&quot;not found&quot;</span>
    <span class="n">multiDayChartsUpdated</span> <span class="o">=</span> <span class="kc">False</span>
    
    <span class="c1"># Get the wind chart from the local Waconia site.</span>
    <span class="n">windPage24hr</span> <span class="o">=</span> <span class="n">getChart</span><span class="p">(</span> <span class="n">stationRegion</span><span class="p">,</span> <span class="n">stationName</span><span class="p">,</span> <span class="s2">&quot;Wind40&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;WindChart&quot;</span><span class="p">)</span>

    <span class="c1"># Find the div that references the image files.</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">windPage24hr</span><span class="p">:</span>
        <span class="c1">#print(&quot;once per line...&quot;)</span>
        <span class="n">line_str</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>  <span class="c1"># Decode bytes to string</span>
        <span class="k">if</span> <span class="s2">&quot;id=&#39;directions&#39;&quot;</span> <span class="ow">in</span> <span class="n">line_str</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Found the new &#39;directions&#39; line in source file.&quot;</span><span class="p">)</span>
            <span class="n">newImageLine</span> <span class="o">=</span> <span class="n">line_str</span>
   
    <span class="c1"># Get the temperature and pressure charts from the local Waconia site.</span>
    <span class="n">getChart</span><span class="p">(</span> <span class="n">stationRegion</span><span class="p">,</span> <span class="n">stationName</span><span class="p">,</span> <span class="s2">&quot;Temperature&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;TemperatureChart&quot;</span><span class="p">)</span>
    <span class="c1">#getChart( stationRegion, stationName, &quot;Pressure&quot;,    &quot;1&quot;, &quot;PressureChart&quot;)</span>
    
    
    <span class="c1"># Copy the image files to the 50webs-dev site on this server (NUC or BEE).</span>
    <span class="n">pathToSourceFolderForImages</span> <span class="o">=</span> <span class="s1">&#39;C:</span><span class="se">\\</span><span class="s1">Users</span><span class="se">\\</span><span class="s1">Jim</span><span class="se">\\</span><span class="s1">Documents</span><span class="se">\\</span><span class="s1">webcontent</span><span class="se">\\</span><span class="s1">waconia</span><span class="se">\\</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">sitePath</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">chart-images</span><span class="se">\\</span><span class="s1">&#39;</span>
    <span class="n">pathToTargetFolder</span> <span class="o">=</span> <span class="s2">&quot;C:</span><span class="se">\\</span><span class="s2">Users</span><span class="se">\\</span><span class="s2">Jim</span><span class="se">\\</span><span class="s2">Documents</span><span class="se">\\</span><span class="s2">webcontent</span><span class="se">\\</span><span class="s2">waconia</span><span class="se">\\</span><span class="s2">50webs-dev</span><span class="se">\\</span><span class="s2">&quot;</span>
    
    <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">pathToSourceFolderForImages</span> <span class="o">+</span> <span class="s1">&#39;WindChart.jpg&#39;</span><span class="p">,</span> <span class="n">pathToTargetFolder</span> <span class="o">+</span> <span class="s1">&#39;chart-images&#39;</span><span class="p">)</span>
    <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">pathToSourceFolderForImages</span> <span class="o">+</span> <span class="s1">&#39;TemperatureChart.jpg&#39;</span><span class="p">,</span> <span class="n">pathToTargetFolder</span> <span class="o">+</span> <span class="s1">&#39;chart-images&#39;</span><span class="p">)</span>
    <span class="c1">#shutil.copy(pathToSourceFolderForImages + &#39;PressureChart.jpg&#39;, pathToTargetFolder + &#39;chart-images&#39;)</span>
    
    <span class="c1"># Upload the image files to the 50Webs host.</span>
    <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">testingMode</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">webHost</span> <span class="o">==</span> <span class="s2">&quot;50Webs&quot;</span><span class="p">):</span>
        <span class="n">uploadBinaryFile</span><span class="p">(</span><span class="s1">&#39;chart-images/&#39;</span><span class="p">,</span> <span class="n">pathToSourceFolderForImages</span><span class="p">,</span> <span class="s1">&#39;WindChart.jpg&#39;</span><span class="p">)</span>
        <span class="n">uploadBinaryFile</span><span class="p">(</span><span class="s1">&#39;chart-images/&#39;</span><span class="p">,</span> <span class="n">pathToSourceFolderForImages</span><span class="p">,</span> <span class="s1">&#39;TemperatureChart.jpg&#39;</span><span class="p">)</span>
        <span class="c1">#uploadBinaryFile(&#39;chart-images/&#39;, pathToSourceFolderForImages, &#39;PressureChart.jpg&#39;)</span>
    
    <span class="c1"># Get a 25-day pressure chart for Alaska and Barking Sands. Trigger this based on the first location in</span>
    <span class="c1"># the randomized site list. This special trigger will keep this from frequent uploads.</span>
    <span class="c1">#print(&quot;station trigger (PAQT, PHBK) = &quot;, stationList[0][1], stationList[1][1])</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;station trigger (PATQ or RMTN) = &quot;</span><span class="p">,</span> <span class="n">stationName</span><span class="p">)</span>
    
    <span class="c1">#if (stationList[0][1]==&quot;PAQT&quot; and stationList[1][1]==&quot;PHBK&quot;):</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">stationName</span> <span class="o">==</span> <span class="s2">&quot;PATQ&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">stationName</span> <span class="o">==</span> <span class="s2">&quot;RMTN&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">pushImagesToServer</span><span class="p">:</span>
        <span class="n">getChart</span><span class="p">(</span> <span class="s2">&quot;Misc&quot;</span><span class="p">,</span> <span class="s2">&quot;PATQ&quot;</span><span class="p">,</span> <span class="s2">&quot;Pressure&quot;</span><span class="p">,</span>    <span class="s2">&quot;25&quot;</span><span class="p">,</span> <span class="s2">&quot;25DayPressureChart-1&quot;</span><span class="p">)</span>
        <span class="n">getChart</span><span class="p">(</span> <span class="s2">&quot;Misc&quot;</span><span class="p">,</span> <span class="s2">&quot;PATQ&quot;</span><span class="p">,</span> <span class="s2">&quot;Temperature&quot;</span><span class="p">,</span> <span class="s2">&quot;25&quot;</span><span class="p">,</span> <span class="s2">&quot;25DayTemperatureChart&quot;</span><span class="p">)</span>
        <span class="n">getChart</span><span class="p">(</span> <span class="s2">&quot;Misc&quot;</span><span class="p">,</span> <span class="s2">&quot;PATQ&quot;</span><span class="p">,</span> <span class="s2">&quot;Wind40&quot;</span><span class="p">,</span>      <span class="s2">&quot;25&quot;</span><span class="p">,</span> <span class="s2">&quot;25DayWindChart&quot;</span><span class="p">)</span>
        <span class="n">getChart</span><span class="p">(</span> <span class="s2">&quot;CR&quot;</span><span class="p">,</span>   <span class="s2">&quot;300A&quot;</span><span class="p">,</span> <span class="s2">&quot;Pressure&quot;</span>   <span class="p">,</span> <span class="s2">&quot;25&quot;</span><span class="p">,</span> <span class="s2">&quot;25DayPressureChart-2&quot;</span><span class="p">)</span>
        <span class="n">getChart</span><span class="p">(</span> <span class="s2">&quot;Misc&quot;</span><span class="p">,</span> <span class="s2">&quot;PHBK&quot;</span><span class="p">,</span> <span class="s2">&quot;Pressure&quot;</span><span class="p">,</span>    <span class="s2">&quot;25&quot;</span><span class="p">,</span> <span class="s2">&quot;25DayPressureChart-3&quot;</span><span class="p">)</span>
        <span class="c1">#getChart( &quot;CR&quot;,   &quot;KTTD&quot;, &quot;DeltaP2&quot;,     &quot;10&quot;, &quot;DeltaPressureChart&quot;)</span>
        <span class="n">getChart</span><span class="p">(</span> <span class="s2">&quot;CR&quot;</span><span class="p">,</span> <span class="s2">&quot;PORTLAND&quot;</span><span class="p">,</span> <span class="s2">&quot;DeltaP1&quot;</span><span class="p">,</span>    <span class="s2">&quot;10&quot;</span><span class="p">,</span> <span class="s2">&quot;DeltaPressureChart&quot;</span><span class="p">)</span>
        
        <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">pathToSourceFolderForImages</span> <span class="o">+</span> <span class="s1">&#39;25DayPressureChart-1.jpg&#39;</span><span class="p">,</span>  <span class="n">pathToTargetFolder</span> <span class="o">+</span> <span class="s1">&#39;chart-images&#39;</span><span class="p">)</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">pathToSourceFolderForImages</span> <span class="o">+</span> <span class="s1">&#39;25DayTemperatureChart.jpg&#39;</span><span class="p">,</span> <span class="n">pathToTargetFolder</span> <span class="o">+</span> <span class="s1">&#39;chart-images&#39;</span><span class="p">)</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">pathToSourceFolderForImages</span> <span class="o">+</span> <span class="s1">&#39;25DayWindChart.jpg&#39;</span><span class="p">,</span>        <span class="n">pathToTargetFolder</span> <span class="o">+</span> <span class="s1">&#39;chart-images&#39;</span><span class="p">)</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">pathToSourceFolderForImages</span> <span class="o">+</span> <span class="s1">&#39;25DayPressureChart-2.jpg&#39;</span><span class="p">,</span>  <span class="n">pathToTargetFolder</span> <span class="o">+</span> <span class="s1">&#39;chart-images&#39;</span><span class="p">)</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">pathToSourceFolderForImages</span> <span class="o">+</span> <span class="s1">&#39;25DayPressureChart-3.jpg&#39;</span><span class="p">,</span>  <span class="n">pathToTargetFolder</span> <span class="o">+</span> <span class="s1">&#39;chart-images&#39;</span><span class="p">)</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">pathToSourceFolderForImages</span> <span class="o">+</span> <span class="s1">&#39;DeltaPressureChart.jpg&#39;</span><span class="p">,</span>    <span class="n">pathToTargetFolder</span> <span class="o">+</span> <span class="s1">&#39;chart-images&#39;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="p">((</span><span class="ow">not</span> <span class="n">testingMode</span><span class="p">)</span> <span class="ow">or</span> <span class="n">pushImagesToServer</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">webHost</span> <span class="o">==</span> <span class="s2">&quot;50Webs&quot;</span><span class="p">):</span>
            <span class="n">uploadBinaryFile</span><span class="p">(</span><span class="s1">&#39;chart-images/&#39;</span><span class="p">,</span> <span class="n">pathToSourceFolderForImages</span><span class="p">,</span> <span class="s1">&#39;25DayPressureChart-1.jpg&#39;</span><span class="p">)</span>
            <span class="n">uploadBinaryFile</span><span class="p">(</span><span class="s1">&#39;chart-images/&#39;</span><span class="p">,</span> <span class="n">pathToSourceFolderForImages</span><span class="p">,</span> <span class="s1">&#39;25DayTemperatureChart.jpg&#39;</span><span class="p">)</span>
            <span class="n">uploadBinaryFile</span><span class="p">(</span><span class="s1">&#39;chart-images/&#39;</span><span class="p">,</span> <span class="n">pathToSourceFolderForImages</span><span class="p">,</span> <span class="s1">&#39;25DayWindChart.jpg&#39;</span><span class="p">)</span>
            <span class="n">uploadBinaryFile</span><span class="p">(</span><span class="s1">&#39;chart-images/&#39;</span><span class="p">,</span> <span class="n">pathToSourceFolderForImages</span><span class="p">,</span> <span class="s1">&#39;25DayPressureChart-2.jpg&#39;</span><span class="p">)</span>
            <span class="n">uploadBinaryFile</span><span class="p">(</span><span class="s1">&#39;chart-images/&#39;</span><span class="p">,</span> <span class="n">pathToSourceFolderForImages</span><span class="p">,</span> <span class="s1">&#39;25DayPressureChart-3.jpg&#39;</span><span class="p">)</span>
            <span class="n">uploadBinaryFile</span><span class="p">(</span><span class="s1">&#39;chart-images/&#39;</span><span class="p">,</span> <span class="n">pathToSourceFolderForImages</span><span class="p">,</span> <span class="s1">&#39;DeltaPressureChart.jpg&#39;</span><span class="p">)</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;25-day pressure charts have updated.&quot;</span><span class="p">)</span>
        <span class="n">multiDayChartsUpdated</span> <span class="o">=</span> <span class="kc">True</span>
    
    <span class="c1"># Edit the local html file to include the specifics of the div that holds the </span>
    <span class="c1"># two images: chart and second # y-axis scale. Also update the two timestamps.</span>
    
    <span class="n">inputFile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">pathToTargetFolder</span> <span class="o">+</span> <span class="n">inputHTMLFileName</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
    <span class="n">outputFile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">pathToTargetFolder</span> <span class="o">+</span> <span class="n">outputHTMLFileName</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">oldLine</span> <span class="ow">in</span> <span class="n">inputFile</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;id=&#39;directions&#39;&quot;</span> <span class="ow">in</span> <span class="n">oldLine</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">newImageLine</span> <span class="o">!=</span> <span class="s2">&quot;not found&quot;</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Found the &#39;directions&#39; line in input file.&quot;</span><span class="p">)</span>
            <span class="c1">#print(&quot;Old line= &quot;, oldLine)</span>
            <span class="c1">#print(&quot;New line= &quot;, newImageLine)</span>
            <span class="n">outputFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">newImageLine</span><span class="p">)</span>
            
        <span class="k">elif</span> <span class="s2">&quot;24-hour charts&quot;</span> <span class="ow">in</span> <span class="n">oldLine</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Updated the 24hr-charts timestamp.&#39;</span><span class="p">)</span>
            <span class="n">outputFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;(24-hour charts updated &quot;</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%A, %B </span><span class="si">%d</span><span class="s2">, %Y at %I:%M%p&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; Central).</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="k">elif</span> <span class="p">(</span><span class="s2">&quot;Multi-day charts&quot;</span> <span class="ow">in</span> <span class="n">oldLine</span><span class="p">)</span> <span class="ow">and</span> <span class="n">multiDayChartsUpdated</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Updated the multi-day-charts timestamp.&#39;</span><span class="p">)</span>
            <span class="n">outputFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;(Multi-day charts updated &quot;</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%A, %B </span><span class="si">%d</span><span class="s2">, %Y at %I:%M%p&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; Central).</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            
        <span class="k">else</span><span class="p">:</span>
            <span class="n">outputFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">oldLine</span><span class="p">)</span>
            <span class="c1">#print(oldLine)</span>

    <span class="n">inputFile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">outputFile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    
    <span class="c1"># Upload the html file from the 50Webs dev site on the NUC to 50Webs.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">webHost</span> <span class="o">==</span> <span class="s2">&quot;50Webs&quot;</span><span class="p">):</span>
        <span class="n">uploadTextFile</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;C:</span><span class="se">\\</span><span class="s1">Users</span><span class="se">\\</span><span class="s1">Jim</span><span class="se">\\</span><span class="s1">Documents</span><span class="se">\\</span><span class="s1">webcontent</span><span class="se">\\</span><span class="s1">waconia</span><span class="se">\\</span><span class="s1">50webs-dev</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">outputHTMLFileName</span><span class="p">)</span>

    <span class="c1"># Replace the old input file with the newly generated output file. This carries over the prior time-stamp on</span>
    <span class="c1"># the multi-day charts even if they are not updated.</span>
    <span class="n">shutil</span><span class="o">.</span><span class="n">copyfile</span><span class="p">(</span><span class="n">pathToTargetFolder</span> <span class="o">+</span> <span class="n">outputHTMLFileName</span><span class="p">,</span> <span class="n">pathToTargetFolder</span> <span class="o">+</span> <span class="n">inputHTMLFileName</span><span class="p">)</span>
    

<span class="c1">#==Main=========================================================================</span>

<span class="c1"># Generate the image and send the image and page (for all hours after 6am).</span>
<span class="k">if</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">hour</span> <span class="o">&gt;</span> <span class="mi">6</span><span class="p">):</span>

    <span class="c1"># My Firebase and Cloudflare sites sometimes use a scheduled batch file to</span>
    <span class="c1"># publish the image and html files. Other times, I run this script manually</span>
    <span class="c1"># and then publish manually.</span>
    <span class="n">webHost</span> <span class="o">=</span> <span class="s2">&quot;Firebase&quot;</span>  <span class="c1"># &quot;50Webs&quot;</span>

    <span class="n">pushImagesToServer</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># If there is a command line argument, run this in testing mode.</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;In testing mode...&quot;</span><span class="p">)</span>
        <span class="n">testingMode</span> <span class="o">=</span> <span class="kc">True</span>
        
        <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;push&quot;</span><span class="p">:</span>
            <span class="n">pushImagesToServer</span> <span class="o">=</span> <span class="kc">True</span>
        
    <span class="k">else</span><span class="p">:</span>
        <span class="n">testingMode</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># Shift gears if in testing mode. Note: a &quot;push&quot; is always in testing mode and uses the</span>
    <span class="c1"># dev site for ASP runs and images.</span>
    <span class="k">if</span> <span class="n">testingMode</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">webSite</span> <span class="o">=</span> <span class="s2">&quot;waconia-dev&quot;</span>
        <span class="n">inputHTMLFileName</span> <span class="o">=</span> <span class="s2">&quot;charts_input_testing.html&quot;</span>
        <span class="n">outputHTMLFileName</span> <span class="o">=</span> <span class="s2">&quot;charts_testing.html&quot;</span>
        <span class="n">sitePath</span> <span class="o">=</span> <span class="s2">&quot;website-dev&quot;</span>    
    <span class="k">else</span><span class="p">:</span>
        <span class="n">webSite</span> <span class="o">=</span> <span class="s2">&quot;waconia&quot;</span>
        <span class="n">inputHTMLFileName</span> <span class="o">=</span> <span class="s2">&quot;charts_input.html&quot;</span>
        <span class="n">outputHTMLFileName</span> <span class="o">=</span> <span class="s2">&quot;charts.html&quot;</span>
        <span class="n">sitePath</span> <span class="o">=</span> <span class="s2">&quot;website-prod&quot;</span>

        
    <span class="c1"># Connect to the server.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">webHost</span> <span class="o">==</span> <span class="s2">&quot;50Webs&quot;</span><span class="p">):</span>
        <span class="n">ftp</span> <span class="o">=</span> <span class="n">FTP</span><span class="p">(</span><span class="s1">&#39;jimandlaurie.50webs.com&#39;</span><span class="p">)</span>
        <span class="n">ftp</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="s1">&#39;jb_miller&#39;</span><span class="p">,</span> <span class="n">passwd</span><span class="o">=</span><span class="s1">&#39;77d9b54688&#39;</span><span class="p">)</span>
        <span class="n">ftp</span><span class="o">.</span><span class="n">cwd</span><span class="p">(</span><span class="s1">&#39;/waconia.timetocode.org&#39;</span><span class="p">)</span>
        <span class="c1">#ftp.dir()</span>

    <span class="c1"># List of Stations.</span>
    <span class="c1"># Note that RMTN does not have a pressure sensor now.</span>
    <span class="n">stationList</span> <span class="o">=</span> <span class="p">[</span> <span class="p">[</span><span class="s1">&#39;CR&#39;</span><span class="p">,</span><span class="s1">&#39;RMTN&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;CR&#39;</span><span class="p">,</span><span class="s1">&#39;RMTN&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;CR&#39;</span><span class="p">,</span><span class="s1">&#39;KRLD&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;MN&#39;</span><span class="p">,</span><span class="s1">&#39;KMKT.2&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;Misc&#39;</span><span class="p">,</span><span class="s1">&#39;PATQ&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;Misc&#39;</span><span class="p">,</span><span class="s1">&#39;PHOG&#39;</span><span class="p">]</span> <span class="p">]</span>

    <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">stationList</span><span class="p">)</span>
    <span class="n">randomStation</span> <span class="o">=</span> <span class="n">stationList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">randomStation</span><span class="p">)</span>

    <span class="n">updateCharts</span><span class="p">(</span> <span class="n">randomStation</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">webHost</span> <span class="o">==</span> <span class="s2">&quot;50Webs&quot;</span><span class="p">):</span>
        <span class="n">ftp</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
</pre></div>
</body>
</html>
