<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=UTF-8">
<title>Exported from Notepad++</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
	font-weight: bold;
}
.sc1 {
	color: #0000FF;
}
.sc3 {
	color: #FF0000;
}
.sc6 {
	font-weight: bold;
	color: #8000FF;
}
.sc7 {
	font-weight: bold;
	color: #8000FF;
}
.sc8 {
}
.sc9 {
	color: #008000;
}
.sc15 {
	font-weight: bold;
	background: #FFFF00;
}
.sc16 {
	background: #FFC000;
}
.sc40 {
}
.sc41 {
	background: #F2F4FF;
}
.sc43 {
	color: #008000;
	background: #F2F4FF;
}
.sc45 {
	color: #FF0000;
	background: #F2F4FF;
}
.sc46 {
	background: #F2F4FF;
}
.sc47 {
	font-weight: bold;
	font-style: italic;
	color: #000080;
	background: #F2F4FF;
}
.sc48 {
	color: #808080;
	background: #F2F4FF;
}
.sc49 {
	color: #808080;
	background: #F2F4FF;
}
.sc50 {
	font-weight: bold;
	background: #F2F4FF;
}
.sc80 {
}
.sc81 {
	color: #8000FF;
	background: #C4F9FD;
}
.sc82 {
	color: #008000;
	background: #C4F9FD;
}
.sc83 {
	color: #FF0000;
	background: #C4F9FD;
}
.sc84 {
	font-weight: bold;
	color: #000080;
	background: #C4F9FD;
}
.sc85 {
	color: #808080;
	background: #C4F9FD;
}
.sc86 {
	background: #C4F9FD;
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc15">&lt;%@</span><span class="sc16"> Language=VBScript </span><span class="sc15">%&gt;</span><span class="sc0">

</span><span class="sc15">&lt;%</span><span class="sc81"> 
</span><span class="sc84">Option</span><span class="sc81"> </span><span class="sc84">Explicit</span><span class="sc81">

</span><span class="sc82">' Author: Jim Miller</span><span class="sc81">
</span><span class="sc82">' MySQL Version: 1.0</span><span class="sc81">
</span><span class="sc82">' May 17, 2025</span><span class="sc81">

</span><span class="sc82">' Buffer and release all at once...</span><span class="sc81">
</span><span class="sc86">Response.Buffer</span><span class="sc81"> = </span><span class="sc84">True</span><span class="sc81"> 
</span><span class="sc15">%&gt;</span><span class="sc0">

</span><span class="sc9">&lt;!-- #include file="common/headers.asp" --&gt;</span><span class="sc0">
</span><span class="sc9">&lt;!-- #include file="common/utilities.asp" --&gt;</span><span class="sc0">

</span><span class="sc15">&lt;%</span><span class="sc80">
</span><span class="sc82">'==========================================</span><span class="sc81">
</span><span class="sc82">' Common Variables (globals)</span><span class="sc81">
</span><span class="sc82">'==========================================</span><span class="sc81">

</span><span class="sc84">Const</span><span class="sc81"> </span><span class="sc86">adStateOpen</span><span class="sc81"> = </span><span class="sc83">1</span><span class="sc81">
</span><span class="sc84">Const</span><span class="sc81"> </span><span class="sc86">adStateClosed</span><span class="sc81"> = </span><span class="sc83">0</span><span class="sc81">
</span><span class="sc84">Const</span><span class="sc81"> </span><span class="sc86">adOpenStatic</span><span class="sc81"> = </span><span class="sc83">3</span><span class="sc81">
</span><span class="sc84">Const</span><span class="sc81"> </span><span class="sc86">adLockBatchOptimistic</span><span class="sc81"> = </span><span class="sc83">4</span><span class="sc81">
</span><span class="sc84">Const</span><span class="sc81"> </span><span class="sc86">adLockReadOnly</span><span class="sc81"> = </span><span class="sc83">1</span><span class="sc81">
</span><span class="sc84">Const</span><span class="sc81"> </span><span class="sc86">adCmdText</span><span class="sc81"> = </span><span class="sc83">1</span><span class="sc81">

</span><span class="sc84">Dim</span><span class="sc81"> </span><span class="sc86">dicTraceIO</span><span class="sc81">

</span><span class="sc84">Dim</span><span class="sc81"> </span><span class="sc86">DBConnection</span><span class="sc81">, </span><span class="sc86">rstDate</span><span class="sc81">, </span><span class="sc86">rstStations</span><span class="sc81">, </span><span class="sc86">rstLatestDate</span><span class="sc81">, </span><span class="sc86">rstMostRecent</span><span class="sc81">, </span><span class="sc86">rstTimeZone</span><span class="sc81">

</span><span class="sc82">' Arrays for sensor data values</span><span class="sc81">
</span><span class="sc84">Dim</span><span class="sc81"> </span><span class="sc86">dataPoints_WindDirection</span><span class="sc81">, </span><span class="sc86">dataPoints_WindGust</span><span class="sc81">, </span><span class="sc86">dataPoints_WindSpeed</span><span class="sc81">
</span><span class="sc84">Dim</span><span class="sc81"> </span><span class="sc86">dataPoints_Pressure</span><span class="sc81">
</span><span class="sc84">Dim</span><span class="sc81"> </span><span class="sc86">dataPoints_TempAvg</span><span class="sc81">, </span><span class="sc86">dataPoints_TempMax</span><span class="sc81">, </span><span class="sc86">dataPoints_TempMin</span><span class="sc81">, </span><span class="sc86">dataPoints_DewPoint</span><span class="sc81">
</span><span class="sc84">Dim</span><span class="sc81"> </span><span class="sc86">dataPoints_DeltaP_trace_A</span><span class="sc81">, </span><span class="sc86">dataPoints_DeltaP_trace_B</span><span class="sc81">

</span><span class="sc84">Dim</span><span class="sc81"> </span><span class="sc86">dteMaxTimeStamp</span><span class="sc81">
</span><span class="sc84">Dim</span><span class="sc81"> </span><span class="sc86">strSQL</span><span class="sc81">, </span><span class="sc86">strNameForPlot</span><span class="sc81">, </span><span class="sc86">intMaxGust</span><span class="sc81">, </span><span class="sc86">intNonPlottingHeight</span><span class="sc81">, </span><span class="sc86">intTempDiffScalingThreshold</span><span class="sc81">
</span><span class="sc84">Dim</span><span class="sc81"> </span><span class="sc86">strTitle</span><span class="sc81">, </span><span class="sc86">strHGSL</span><span class="sc81">
</span><span class="sc84">Dim</span><span class="sc81"> </span><span class="sc86">sglTempMax</span><span class="sc81">, </span><span class="sc86">sglTempMin</span><span class="sc81">, </span><span class="sc86">sglPressureMin</span><span class="sc81">, </span><span class="sc86">sglPressureMax</span><span class="sc81">, </span><span class="sc86">sglTempRange</span><span class="sc81">, </span><span class="sc86">sglDewPointMin</span><span class="sc81">, </span><span class="sc86">blnDewPointData</span><span class="sc81">
</span><span class="sc84">Dim</span><span class="sc81"> </span><span class="sc86">strMRTime</span><span class="sc81">, </span><span class="sc86">strMRWindAvg</span><span class="sc81">, </span><span class="sc86">strMRWindMax</span><span class="sc81">, </span><span class="sc86">strMRWindDir</span><span class="sc81">, </span><span class="sc86">strMRTemp</span><span class="sc81">, </span><span class="sc86">strMRPressure</span><span class="sc81">, </span><span class="sc86">strMRDewPoint</span><span class="sc81">
</span><span class="sc84">Dim</span><span class="sc81"> </span><span class="sc86">Chart</span><span class="sc81">
</span><span class="sc84">Dim</span><span class="sc81"> </span><span class="sc86">Filename</span><span class="sc81">
</span><span class="sc84">Dim</span><span class="sc81"> </span><span class="sc86">WeatherTypes</span><span class="sc81">, </span><span class="sc86">WeatherTypes_URL</span><span class="sc81">, </span><span class="sc86">WeatherTypes_count</span><span class="sc81">, </span><span class="sc86">DaysChoices</span><span class="sc81">
</span><span class="sc84">Dim</span><span class="sc81"> </span><span class="sc86">dteStartDateTime</span><span class="sc81">, </span><span class="sc86">dteEndDateTime</span><span class="sc81">, </span><span class="sc86">dteStartDate_forLabels</span><span class="sc81">
</span><span class="sc84">Dim</span><span class="sc81"> </span><span class="sc86">TimeLabels</span><span class="sc81">, </span><span class="sc86">TheHour</span><span class="sc81">, </span><span class="sc86">DayValue</span><span class="sc81">, </span><span class="sc86">DaysDecSinceRef</span><span class="sc81">, </span><span class="sc86">intHour</span><span class="sc81">
</span><span class="sc84">Dim</span><span class="sc81"> </span><span class="sc86">blnMinMax</span><span class="sc81">, </span><span class="sc86">blnFoundSomeData</span><span class="sc81">
</span><span class="sc84">Dim</span><span class="sc81"> </span><span class="sc86">intTheColor</span><span class="sc81">
</span><span class="sc84">Dim</span><span class="sc81"> </span><span class="sc86">strRandomNameString</span><span class="sc81">, </span><span class="sc86">strFileName2</span><span class="sc81">, </span><span class="sc86">strOrderBy</span><span class="sc81">, </span><span class="sc86">intColorScaleFactor</span><span class="sc81">
</span><span class="sc84">Dim</span><span class="sc81"> </span><span class="sc86">fsoObject</span><span class="sc81">, </span><span class="sc86">fdrObject</span><span class="sc81">, </span><span class="sc86">filObject</span><span class="sc81">
</span><span class="sc84">Dim</span><span class="sc81"> </span><span class="sc86">intFileCount</span><span class="sc81">
</span><span class="sc84">Dim</span><span class="sc81"> </span><span class="sc86">blnDayLightSavingsTime</span><span class="sc81">
</span><span class="sc84">Dim</span><span class="sc81"> </span><span class="sc86">dtePostedDate</span><span class="sc81">, </span><span class="sc86">blnPostedDate_default</span><span class="sc81">
</span><span class="sc84">Dim</span><span class="sc81"> </span><span class="sc86">intJ</span><span class="sc81">, </span><span class="sc86">intDays</span><span class="sc81">, </span><span class="sc86">intXLabels</span><span class="sc81">, </span><span class="sc86">dblDaysIncrement</span><span class="sc81">, </span><span class="sc86">dblDaysFraction</span><span class="sc81">, </span><span class="sc86">dblFractionalPart</span><span class="sc81">, </span><span class="sc86">dteLabelDate</span><span class="sc81">, </span><span class="sc86">intLabelsPerDay</span><span class="sc81">
</span><span class="sc84">Dim</span><span class="sc81"> </span><span class="sc86">dblDPmin</span><span class="sc81">, </span><span class="sc86">dblDPmax</span><span class="sc81">
</span><span class="sc84">Dim</span><span class="sc81"> </span><span class="sc86">dblWindNormFactor</span><span class="sc81">, </span><span class="sc86">intRed</span><span class="sc81">, </span><span class="sc86">intGreen</span><span class="sc81">, </span><span class="sc86">intBlue</span><span class="sc81">, </span><span class="sc86">intGray</span><span class="sc81">
</span><span class="sc84">Dim</span><span class="sc81"> </span><span class="sc86">strRegionURL</span><span class="sc81">, </span><span class="sc86">strSensorType</span><span class="sc81">, </span><span class="sc86">strInitializeTimer</span><span class="sc81">, </span><span class="sc86">strLocation</span><span class="sc81">
</span><span class="sc84">Dim</span><span class="sc81"> </span><span class="sc86">serverTimeArray</span><span class="sc81">, </span><span class="sc86">serverTime</span><span class="sc81">, </span><span class="sc86">intPixelBottomShift</span><span class="sc81">, </span><span class="sc86">intPixelRightShift</span><span class="sc81">, </span><span class="sc86">intPixelRightShift_tweak</span><span class="sc81">
</span><span class="sc84">Dim</span><span class="sc81"> </span><span class="sc86">strShowImages_command</span><span class="sc81">
</span><span class="sc84">Dim</span><span class="sc81"> </span><span class="sc86">vrtReturnFromMINMAX</span><span class="sc81">
</span><span class="sc84">Dim</span><span class="sc81"> </span><span class="sc86">intMinutes</span><span class="sc81">, </span><span class="sc86">dblFiveMinutes</span><span class="sc81">, </span><span class="sc86">intSeconds_FromMinutes</span><span class="sc81">, </span><span class="sc86">intSeconds_FromSeconds</span><span class="sc81">, </span><span class="sc86">intDelay_to_5min</span><span class="sc81">
</span><span class="sc84">Dim</span><span class="sc81"> </span><span class="sc86">strButtonLabel</span><span class="sc81">
</span><span class="sc84">Dim</span><span class="sc81"> </span><span class="sc86">strTimeZone</span><span class="sc81">, </span><span class="sc86">dicTZ</span><span class="sc81">
</span><span class="sc84">Dim</span><span class="sc81"> </span><span class="sc86">arrRegions</span><span class="sc81">, </span><span class="sc86">strRegionValue</span><span class="sc81">, </span><span class="sc86">strRegion</span><span class="sc81">, </span><span class="sc86">strRegionState</span><span class="sc81">
</span><span class="sc84">Dim</span><span class="sc81"> </span><span class="sc86">strDebugMessage</span><span class="sc81">
</span><span class="sc84">Dim</span><span class="sc81"> </span><span class="sc86">dteNowTime</span><span class="sc81">, </span><span class="sc86">dteStartDateTime_forQuery</span><span class="sc81">
</span><span class="sc84">Dim</span><span class="sc81"> </span><span class="sc86">str24Hrs_state</span><span class="sc81">, </span><span class="sc86">strTimer_state</span><span class="sc81">, </span><span class="sc86">strTimer_value</span><span class="sc81">, </span><span class="sc86">strRA_state</span><span class="sc81">

</span><span class="sc84">Dim</span><span class="sc81"> </span><span class="sc86">useRunningAverage</span><span class="sc81">, </span><span class="sc86">RA_x</span><span class="sc81">, </span><span class="sc86">RA_y</span><span class="sc81">

</span><span class="sc84">Set</span><span class="sc81"> </span><span class="sc86">DBConnection</span><span class="sc81"> = </span><span class="sc84">Nothing</span><span class="sc81">

</span><span class="sc82">'=============================================================================================</span><span class="sc81">
</span><span class="sc82">' Functions and Subroutines</span><span class="sc81">
</span><span class="sc82">'=============================================================================================</span><span class="sc81">


</span><span class="sc82">' Add error logging function that writes to the page</span><span class="sc81">
</span><span class="sc84">Sub</span><span class="sc81"> </span><span class="sc86">LogError</span><span class="sc81">(</span><span class="sc86">location</span><span class="sc81">)
    </span><span class="sc84">If</span><span class="sc81"> </span><span class="sc86">Err.Number</span><span class="sc81"> &lt;&gt; </span><span class="sc83">0</span><span class="sc81"> </span><span class="sc84">Then</span><span class="sc81">
        </span><span class="sc86">Response.Write</span><span class="sc81"> </span><span class="sc85">"&lt;div style='color:red; background-color:#ffe0e0; padding:5px; margin:5px; border:1px solid red'&gt;"</span><span class="sc81">
        </span><span class="sc86">Response.Write</span><span class="sc81"> </span><span class="sc85">"&lt;strong&gt;ERROR at "</span><span class="sc81"> &amp; </span><span class="sc86">location</span><span class="sc81"> &amp; </span><span class="sc85">":&lt;/strong&gt; "</span><span class="sc81"> &amp; </span><span class="sc86">Err.Number</span><span class="sc81"> &amp; </span><span class="sc85">" - "</span><span class="sc81"> &amp; </span><span class="sc86">Err.Description</span><span class="sc81">
        </span><span class="sc86">Response.Write</span><span class="sc81"> </span><span class="sc85">"&lt;/div&gt;"</span><span class="sc81">
        </span><span class="sc86">Err.Clear</span><span class="sc81"> </span><span class="sc82">' Clear the error so we can continue</span><span class="sc81">
    </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">
</span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">Sub</span><span class="sc81">


</span><span class="sc84">Sub</span><span class="sc81"> </span><span class="sc86">RBC</span><span class="sc81">(</span><span class="sc86">strTheString</span><span class="sc81">)
   </span><span class="sc86">Response.Write</span><span class="sc81"> </span><span class="sc86">strTheString</span><span class="sc81"> &amp; </span><span class="sc85">"&lt;BR&gt;"</span><span class="sc81"> &amp; </span><span class="sc86">Chr</span><span class="sc81">(</span><span class="sc83">10</span><span class="sc81">)
</span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">Sub</span><span class="sc81">

</span><span class="sc82">'Alias for RBC</span><span class="sc81">
</span><span class="sc84">Sub</span><span class="sc81"> </span><span class="sc86">RWBR</span><span class="sc81">(</span><span class="sc86">strTheString</span><span class="sc81">)
   </span><span class="sc86">RBC</span><span class="sc81"> </span><span class="sc86">strTheString</span><span class="sc81">
</span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">Sub</span><span class="sc81">

</span><span class="sc84">Sub</span><span class="sc81"> </span><span class="sc86">RC</span><span class="sc81">(</span><span class="sc86">strTheString</span><span class="sc81">)
   </span><span class="sc86">Response.Write</span><span class="sc81"> </span><span class="sc86">strTheString</span><span class="sc81"> &amp; </span><span class="sc86">Chr</span><span class="sc81">(</span><span class="sc83">10</span><span class="sc81">)
</span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">Sub</span><span class="sc81">

</span><span class="sc82">'This will not make a new line in the HTML file.</span><span class="sc81">
</span><span class="sc84">Sub</span><span class="sc81"> </span><span class="sc86">RW</span><span class="sc81">(</span><span class="sc86">strTheString</span><span class="sc81">)
   </span><span class="sc86">Response.Write</span><span class="sc81"> </span><span class="sc86">strTheString</span><span class="sc81">
</span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">Sub</span><span class="sc81">


</span><span class="sc84">Sub</span><span class="sc81"> </span><span class="sc86">MinMax</span><span class="sc81">(</span><span class="sc84">ByVal</span><span class="sc81"> </span><span class="sc86">dblNewValue</span><span class="sc81">, </span><span class="sc84">ByRef</span><span class="sc81"> </span><span class="sc86">dblMax</span><span class="sc81">, </span><span class="sc84">ByRef</span><span class="sc81"> </span><span class="sc86">dblMin</span><span class="sc81">)
   </span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">dblNewValue</span><span class="sc81"> &gt; </span><span class="sc86">dblMax</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
      </span><span class="sc86">dblMax</span><span class="sc81"> = </span><span class="sc86">dblNewValue</span><span class="sc81">
   </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">
   
   </span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">dblNewValue</span><span class="sc81"> &lt; </span><span class="sc86">dblMin</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
      </span><span class="sc86">dblMin</span><span class="sc81"> = </span><span class="sc86">dblNewValue</span><span class="sc81">
   </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">
</span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">Sub</span><span class="sc81">


</span><span class="sc84">Function</span><span class="sc81"> </span><span class="sc86">DaylightTime</span><span class="sc81">(</span><span class="sc86">strMRTime</span><span class="sc81">)
   </span><span class="sc84">Dim</span><span class="sc81"> </span><span class="sc86">strMRTime_DLS</span><span class="sc81">
   </span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">strMRTime</span><span class="sc81"> &lt;&gt; </span><span class="sc85">"-"</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
      </span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">DaylightSavingsTime</span><span class="sc81">(</span><span class="sc86">strMRTime</span><span class="sc81">)) </span><span class="sc84">Then</span><span class="sc81">
         </span><span class="sc86">strMRTime_DLS</span><span class="sc81"> = </span><span class="sc86">DateAdd</span><span class="sc81">(</span><span class="sc85">"h"</span><span class="sc81">,</span><span class="sc83">1</span><span class="sc81">,</span><span class="sc86">strMRTime</span><span class="sc81">)
      </span><span class="sc84">Else</span><span class="sc81">
         </span><span class="sc86">strMRTime_DLS</span><span class="sc81"> = </span><span class="sc86">strMRTime</span><span class="sc81">
      </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">
   </span><span class="sc84">Else</span><span class="sc81">
      </span><span class="sc86">strMRTime_DLS</span><span class="sc81"> = </span><span class="sc85">"-"</span><span class="sc81">
   </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">
   </span><span class="sc86">DaylightTime</span><span class="sc81"> = </span><span class="sc86">strMRTime_DLS</span><span class="sc81">
</span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">Function</span><span class="sc81">


</span><span class="sc84">Function</span><span class="sc81"> </span><span class="sc86">AgeOfData</span><span class="sc81">(</span><span class="sc86">strMRTime</span><span class="sc81">)
   </span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">strMRTime</span><span class="sc81"> &lt;&gt; </span><span class="sc85">"-"</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
      </span><span class="sc82">' The following line works mainly because strMRTime is in standard time. So no problem with HI.</span><span class="sc81">
      </span><span class="sc86">AgeOfData</span><span class="sc81"> = </span><span class="sc86">DateDiff</span><span class="sc81">(</span><span class="sc85">"n"</span><span class="sc81">, </span><span class="sc86">DaylightTime</span><span class="sc81">(</span><span class="sc86">strMRTime</span><span class="sc81">), </span><span class="sc86">Now</span><span class="sc81">()) + </span><span class="sc83">60</span><span class="sc81"> * </span><span class="sc86">dicTZ.item</span><span class="sc81">(</span><span class="sc86">strTimeZone</span><span class="sc81">)
   </span><span class="sc84">Else</span><span class="sc81">
      </span><span class="sc86">AgeOfData</span><span class="sc81"> = </span><span class="sc85">"-"</span><span class="sc81">
   </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">
</span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">Function</span><span class="sc81">


</span><span class="sc84">Function</span><span class="sc81"> </span><span class="sc86">DaysDecSinceRefF</span><span class="sc81">(</span><span class="sc84">byVal</span><span class="sc81"> </span><span class="sc86">timeMDY</span><span class="sc81">, </span><span class="sc84">byVal</span><span class="sc81"> </span><span class="sc86">timeHr</span><span class="sc81">, </span><span class="sc84">byVal</span><span class="sc81"> </span><span class="sc86">timeMin</span><span class="sc81">)
   </span><span class="sc84">Dim</span><span class="sc81"> </span><span class="sc86">dteRecordTime</span><span class="sc81">
   </span><span class="sc84">Dim</span><span class="sc81"> </span><span class="sc86">TheMin</span><span class="sc81">
 
   </span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">intDays</span><span class="sc81"> = </span><span class="sc83">1</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
      </span><span class="sc86">TheMin</span><span class="sc81"> = </span><span class="sc86">timeMin</span><span class="sc81">
   </span><span class="sc84">Else</span><span class="sc81">
      </span><span class="sc86">TheMin</span><span class="sc81"> = </span><span class="sc83">0</span><span class="sc81">
   </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">
 
   </span><span class="sc86">dteRecordTime</span><span class="sc81"> = </span><span class="sc86">timeMDY</span><span class="sc81"> + </span><span class="sc86">TimeSerial</span><span class="sc81">(</span><span class="sc86">timeHr</span><span class="sc81">, </span><span class="sc86">TheMin</span><span class="sc81">, </span><span class="sc83">0</span><span class="sc81">)   
   
   </span><span class="sc86">DaysDecSinceRefF</span><span class="sc81"> = </span><span class="sc84">CDbl</span><span class="sc81">(  </span><span class="sc86">DateDiff</span><span class="sc81">(</span><span class="sc85">"n"</span><span class="sc81">, </span><span class="sc86">dteStartDateTime</span><span class="sc81">, </span><span class="sc86">dteRecordTime</span><span class="sc81">)  ) / </span><span class="sc83">1440</span><span class="sc81"> 
</span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">Function</span><span class="sc81">


</span><span class="sc84">Function</span><span class="sc81"> </span><span class="sc86">DaysDec</span><span class="sc81">( </span><span class="sc86">dteTime</span><span class="sc81">)
   </span><span class="sc82">' 86400 = 24.0*60.0*60.0  (Seconds in a day).</span><span class="sc81">
   </span><span class="sc82">' Decimal day as measured from the midnight start time.</span><span class="sc81">
   </span><span class="sc86">DaysDec</span><span class="sc81"> = </span><span class="sc84">CDbl</span><span class="sc81">( </span><span class="sc86">DateDiff</span><span class="sc81">(</span><span class="sc85">"s"</span><span class="sc81">, </span><span class="sc86">dteStartDateTime</span><span class="sc81">, </span><span class="sc86">dteTime</span><span class="sc81">) ) / </span><span class="sc83">86400.0</span><span class="sc81">
</span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">Function</span><span class="sc81">


</span><span class="sc84">Function</span><span class="sc81"> </span><span class="sc86">DirectionLabel</span><span class="sc81"> (</span><span class="sc86">WindDeg</span><span class="sc81">)
   </span><span class="sc84">If</span><span class="sc81">     (</span><span class="sc86">WindDeg</span><span class="sc81"> &gt; </span><span class="sc83">345</span><span class="sc81"> </span><span class="sc84">And</span><span class="sc81"> </span><span class="sc86">WindDeg</span><span class="sc81"> &lt;= </span><span class="sc83">360</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81"> 
      </span><span class="sc86">DirectionLabel</span><span class="sc81"> = </span><span class="sc85">"North"</span><span class="sc81">
   </span><span class="sc84">ElseIf</span><span class="sc81"> (</span><span class="sc86">WindDeg</span><span class="sc81"> &gt;   </span><span class="sc83">0</span><span class="sc81"> </span><span class="sc84">And</span><span class="sc81"> </span><span class="sc86">WindDeg</span><span class="sc81"> &lt;=  </span><span class="sc83">15</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81"> 
      </span><span class="sc86">DirectionLabel</span><span class="sc81"> = </span><span class="sc85">"North"</span><span class="sc81">
   
   </span><span class="sc84">ElseIf</span><span class="sc81"> (</span><span class="sc86">WindDeg</span><span class="sc81"> &gt;  </span><span class="sc83">15</span><span class="sc81"> </span><span class="sc84">And</span><span class="sc81"> </span><span class="sc86">WindDeg</span><span class="sc81"> &lt;=  </span><span class="sc83">45</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81"> 
      </span><span class="sc86">DirectionLabel</span><span class="sc81"> = </span><span class="sc85">"NNE"</span><span class="sc81">
   </span><span class="sc84">ElseIf</span><span class="sc81"> (</span><span class="sc86">WindDeg</span><span class="sc81"> &gt;  </span><span class="sc83">45</span><span class="sc81"> </span><span class="sc84">And</span><span class="sc81"> </span><span class="sc86">WindDeg</span><span class="sc81"> &lt;=  </span><span class="sc83">75</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81"> 
      </span><span class="sc86">DirectionLabel</span><span class="sc81"> = </span><span class="sc85">"ENE"</span><span class="sc81">
   </span><span class="sc84">ElseIf</span><span class="sc81"> (</span><span class="sc86">WindDeg</span><span class="sc81"> &gt;  </span><span class="sc83">75</span><span class="sc81"> </span><span class="sc84">And</span><span class="sc81"> </span><span class="sc86">WindDeg</span><span class="sc81"> &lt;= </span><span class="sc83">105</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81"> 
      </span><span class="sc86">DirectionLabel</span><span class="sc81"> = </span><span class="sc85">"East"</span><span class="sc81">
   </span><span class="sc84">ElseIf</span><span class="sc81"> (</span><span class="sc86">WindDeg</span><span class="sc81"> &gt; </span><span class="sc83">105</span><span class="sc81"> </span><span class="sc84">And</span><span class="sc81"> </span><span class="sc86">WindDeg</span><span class="sc81"> &lt;= </span><span class="sc83">135</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81"> 
      </span><span class="sc86">DirectionLabel</span><span class="sc81"> = </span><span class="sc85">"ESE"</span><span class="sc81">
   </span><span class="sc84">ElseIf</span><span class="sc81"> (</span><span class="sc86">WindDeg</span><span class="sc81"> &gt; </span><span class="sc83">135</span><span class="sc81"> </span><span class="sc84">And</span><span class="sc81"> </span><span class="sc86">WindDeg</span><span class="sc81"> &lt;= </span><span class="sc83">165</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81"> 
      </span><span class="sc86">DirectionLabel</span><span class="sc81"> = </span><span class="sc85">"SSE"</span><span class="sc81">
   </span><span class="sc84">ElseIf</span><span class="sc81"> (</span><span class="sc86">WindDeg</span><span class="sc81"> &gt; </span><span class="sc83">165</span><span class="sc81"> </span><span class="sc84">And</span><span class="sc81"> </span><span class="sc86">WindDeg</span><span class="sc81"> &lt;= </span><span class="sc83">195</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81"> 
      </span><span class="sc86">DirectionLabel</span><span class="sc81"> = </span><span class="sc85">"South"</span><span class="sc81">
   </span><span class="sc84">ElseIf</span><span class="sc81"> (</span><span class="sc86">WindDeg</span><span class="sc81"> &gt; </span><span class="sc83">195</span><span class="sc81"> </span><span class="sc84">And</span><span class="sc81"> </span><span class="sc86">WindDeg</span><span class="sc81"> &lt;= </span><span class="sc83">225</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81"> 
      </span><span class="sc86">DirectionLabel</span><span class="sc81"> = </span><span class="sc85">"SSW"</span><span class="sc81">
   </span><span class="sc84">ElseIf</span><span class="sc81"> (</span><span class="sc86">WindDeg</span><span class="sc81"> &gt; </span><span class="sc83">225</span><span class="sc81"> </span><span class="sc84">And</span><span class="sc81"> </span><span class="sc86">WindDeg</span><span class="sc81"> &lt;= </span><span class="sc83">255</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81"> 
      </span><span class="sc86">DirectionLabel</span><span class="sc81"> = </span><span class="sc85">"WSW"</span><span class="sc81">
   </span><span class="sc84">ElseIf</span><span class="sc81"> (</span><span class="sc86">WindDeg</span><span class="sc81"> &gt; </span><span class="sc83">255</span><span class="sc81"> </span><span class="sc84">And</span><span class="sc81"> </span><span class="sc86">WindDeg</span><span class="sc81"> &lt;= </span><span class="sc83">285</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81"> 
      </span><span class="sc86">DirectionLabel</span><span class="sc81"> = </span><span class="sc85">"West"</span><span class="sc81">
   </span><span class="sc84">ElseIf</span><span class="sc81"> (</span><span class="sc86">WindDeg</span><span class="sc81"> &gt; </span><span class="sc83">285</span><span class="sc81"> </span><span class="sc84">And</span><span class="sc81"> </span><span class="sc86">WindDeg</span><span class="sc81"> &lt;= </span><span class="sc83">315</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81"> 
      </span><span class="sc86">DirectionLabel</span><span class="sc81"> = </span><span class="sc85">"WNW"</span><span class="sc81">
   </span><span class="sc84">ElseIf</span><span class="sc81"> (</span><span class="sc86">WindDeg</span><span class="sc81"> &gt; </span><span class="sc83">315</span><span class="sc81"> </span><span class="sc84">And</span><span class="sc81"> </span><span class="sc86">WindDeg</span><span class="sc81"> &lt;= </span><span class="sc83">345</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81"> 
      </span><span class="sc86">DirectionLabel</span><span class="sc81"> = </span><span class="sc85">"NNW"</span><span class="sc81">
   </span><span class="sc84">Else</span><span class="sc81"> 
      </span><span class="sc86">DirectionLabel</span><span class="sc81"> = </span><span class="sc85">"Var"</span><span class="sc81">
   </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">
   
   </span><span class="sc84">If</span><span class="sc81">     (</span><span class="sc86">WindDeg</span><span class="sc81"> =  </span><span class="sc83">45</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81"> 
      </span><span class="sc86">DirectionLabel</span><span class="sc81"> = </span><span class="sc85">"NE"</span><span class="sc81">
   </span><span class="sc84">ElseIf</span><span class="sc81"> (</span><span class="sc86">WindDeg</span><span class="sc81"> = </span><span class="sc83">135</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
      </span><span class="sc86">DirectionLabel</span><span class="sc81"> = </span><span class="sc85">"SE"</span><span class="sc81">
   </span><span class="sc84">ElseIf</span><span class="sc81"> (</span><span class="sc86">WindDeg</span><span class="sc81"> = </span><span class="sc83">225</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
      </span><span class="sc86">DirectionLabel</span><span class="sc81"> = </span><span class="sc85">"SW"</span><span class="sc81">
   </span><span class="sc84">ElseIf</span><span class="sc81"> (</span><span class="sc86">WindDeg</span><span class="sc81"> = </span><span class="sc83">315</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
      </span><span class="sc86">DirectionLabel</span><span class="sc81"> = </span><span class="sc85">"NW"</span><span class="sc81">
   </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">
</span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">Function</span><span class="sc81">


</span><span class="sc84">Sub</span><span class="sc81"> </span><span class="sc86">AddHorizontalLine_gray</span><span class="sc81">(</span><span class="sc86">intLineWidth</span><span class="sc81">, </span><span class="sc86">intColor</span><span class="sc81">, </span><span class="sc86">dblYvalue</span><span class="sc81">)
   </span><span class="sc86">Chart.AddSeries</span><span class="sc81"> (</span><span class="sc83">5</span><span class="sc81">)
   </span><span class="sc86">Chart.linewidth</span><span class="sc81"> = </span><span class="sc86">intLineWidth</span><span class="sc81">
   </span><span class="sc86">Chart.SeriesInLegend</span><span class="sc81"> = </span><span class="sc84">false</span><span class="sc81">

   </span><span class="sc82">' The -0.009 extends the line all the way to the left edge of the 1-day chart.</span><span class="sc81">
   </span><span class="sc86">MyChartAddXY</span><span class="sc81">      -</span><span class="sc83">0.009</span><span class="sc81">, </span><span class="sc86">dblYvalue</span><span class="sc81">, </span><span class="sc85">""</span><span class="sc81">, </span><span class="sc86">RGB</span><span class="sc81">(</span><span class="sc86">intColor</span><span class="sc81">, </span><span class="sc86">intColor</span><span class="sc81">, </span><span class="sc86">intColor</span><span class="sc81">)  
   </span><span class="sc86">MyChartAddXY</span><span class="sc81"> </span><span class="sc86">intDays</span><span class="sc81">+</span><span class="sc83">1.0</span><span class="sc81">, </span><span class="sc86">dblYvalue</span><span class="sc81">, </span><span class="sc85">""</span><span class="sc81">, </span><span class="sc86">RGB</span><span class="sc81">(</span><span class="sc86">intColor</span><span class="sc81">, </span><span class="sc86">intColor</span><span class="sc81">, </span><span class="sc86">intColor</span><span class="sc81">)
</span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">Sub</span><span class="sc81">


</span><span class="sc84">Sub</span><span class="sc81"> </span><span class="sc86">AddHorizontalLine_color</span><span class="sc81">(</span><span class="sc86">intLineWidth</span><span class="sc81">, </span><span class="sc86">intRed</span><span class="sc81">, </span><span class="sc86">intGreen</span><span class="sc81">, </span><span class="sc86">intBlue</span><span class="sc81">, </span><span class="sc86">dblYvalue</span><span class="sc81">)
   </span><span class="sc86">Chart.AddSeries</span><span class="sc81"> (</span><span class="sc83">5</span><span class="sc81">)
   </span><span class="sc86">Chart.linewidth</span><span class="sc81"> = </span><span class="sc86">intLineWidth</span><span class="sc81">
   </span><span class="sc86">Chart.SeriesInLegend</span><span class="sc81"> = </span><span class="sc84">false</span><span class="sc81">

   </span><span class="sc86">MyChartAddXY</span><span class="sc81">      -</span><span class="sc83">0.009</span><span class="sc81">, </span><span class="sc86">dblYvalue</span><span class="sc81">, </span><span class="sc85">""</span><span class="sc81">, </span><span class="sc86">RGB</span><span class="sc81">(</span><span class="sc86">intRed</span><span class="sc81">, </span><span class="sc86">intGreen</span><span class="sc81">, </span><span class="sc86">intBlue</span><span class="sc81">)  
   </span><span class="sc86">MyChartAddXY</span><span class="sc81"> </span><span class="sc86">intDays</span><span class="sc81">+</span><span class="sc83">1.0</span><span class="sc81">, </span><span class="sc86">dblYvalue</span><span class="sc81">, </span><span class="sc85">""</span><span class="sc81">, </span><span class="sc86">RGB</span><span class="sc81">(</span><span class="sc86">intRed</span><span class="sc81">, </span><span class="sc86">intGreen</span><span class="sc81">, </span><span class="sc86">intBlue</span><span class="sc81">)
</span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">Sub</span><span class="sc81">


</span><span class="sc84">Sub</span><span class="sc81"> </span><span class="sc86">MyChartAddXY</span><span class="sc81">(</span><span class="sc86">dblXValue</span><span class="sc81">, </span><span class="sc86">dblYValue</span><span class="sc81">, </span><span class="sc86">strXLabel</span><span class="sc81">, </span><span class="sc86">intColor</span><span class="sc81">)
   </span><span class="sc82">' Feed only NON-Null values to the AddXY method.</span><span class="sc81">
   </span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc84">Not</span><span class="sc81"> </span><span class="sc86">IsNull</span><span class="sc81">(</span><span class="sc86">dblYValue</span><span class="sc81">)) </span><span class="sc84">Then</span><span class="sc81">
      </span><span class="sc86">Chart.AddXY</span><span class="sc81"> </span><span class="sc86">dblXValue</span><span class="sc81">, </span><span class="sc86">dblYValue</span><span class="sc81">, </span><span class="sc86">strXLabel</span><span class="sc81">, </span><span class="sc86">intColor</span><span class="sc81">
   </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">
</span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">Sub</span><span class="sc81">


</span><span class="sc82">' Format date for MySQL (YYYY-MM-DD HH:MM:SS)</span><span class="sc81">
</span><span class="sc84">Function</span><span class="sc81"> </span><span class="sc86">MySQLDate</span><span class="sc81">(</span><span class="sc86">dateValue</span><span class="sc81">)
    </span><span class="sc86">MySQLDate</span><span class="sc81"> = </span><span class="sc85">"'"</span><span class="sc81"> &amp; </span><span class="sc86">Year</span><span class="sc81">(</span><span class="sc86">dateValue</span><span class="sc81">) &amp; </span><span class="sc85">"-"</span><span class="sc81"> &amp; </span><span class="sc86">_</span><span class="sc81">
                </span><span class="sc86">Right</span><span class="sc81">(</span><span class="sc85">"0"</span><span class="sc81"> &amp; </span><span class="sc86">Month</span><span class="sc81">(</span><span class="sc86">dateValue</span><span class="sc81">), </span><span class="sc83">2</span><span class="sc81">) &amp; </span><span class="sc85">"-"</span><span class="sc81"> &amp; </span><span class="sc86">_</span><span class="sc81">
                </span><span class="sc86">Right</span><span class="sc81">(</span><span class="sc85">"0"</span><span class="sc81"> &amp; </span><span class="sc86">Day</span><span class="sc81">(</span><span class="sc86">dateValue</span><span class="sc81">), </span><span class="sc83">2</span><span class="sc81">) &amp; </span><span class="sc85">" "</span><span class="sc81"> &amp; </span><span class="sc86">_</span><span class="sc81">
                </span><span class="sc86">Right</span><span class="sc81">(</span><span class="sc85">"0"</span><span class="sc81"> &amp; </span><span class="sc86">Hour</span><span class="sc81">(</span><span class="sc86">dateValue</span><span class="sc81">), </span><span class="sc83">2</span><span class="sc81">) &amp; </span><span class="sc85">":"</span><span class="sc81"> &amp; </span><span class="sc86">_</span><span class="sc81">
                </span><span class="sc86">Right</span><span class="sc81">(</span><span class="sc85">"0"</span><span class="sc81"> &amp; </span><span class="sc86">Minute</span><span class="sc81">(</span><span class="sc86">dateValue</span><span class="sc81">), </span><span class="sc83">2</span><span class="sc81">) &amp; </span><span class="sc85">":"</span><span class="sc81"> &amp; </span><span class="sc86">_</span><span class="sc81">
                </span><span class="sc86">Right</span><span class="sc81">(</span><span class="sc85">"0"</span><span class="sc81"> &amp; </span><span class="sc86">Second</span><span class="sc81">(</span><span class="sc86">dateValue</span><span class="sc81">), </span><span class="sc83">2</span><span class="sc81">) &amp; </span><span class="sc85">"'"</span><span class="sc81">
</span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">Function</span><span class="sc81">


</span><span class="sc84">Sub</span><span class="sc81"> </span><span class="sc86">AddVerticalLine</span><span class="sc81">( </span><span class="sc86">dblXValue</span><span class="sc81">, </span><span class="sc86">intLineWidth</span><span class="sc81">)
   </span><span class="sc84">Dim</span><span class="sc81"> </span><span class="sc86">intColor</span><span class="sc81">, </span><span class="sc86">intGray</span><span class="sc81">, </span><span class="sc86">intColor_Red</span><span class="sc81">, </span><span class="sc86">intColor_Green</span><span class="sc81">, </span><span class="sc86">intColor_Blue</span><span class="sc81">
   
   </span><span class="sc86">Chart.AddSeries</span><span class="sc81"> (</span><span class="sc83">5</span><span class="sc81">)
   </span><span class="sc86">Chart.linewidth</span><span class="sc81"> = </span><span class="sc86">intLineWidth</span><span class="sc81">
   </span><span class="sc86">Chart.SeriesInLegend</span><span class="sc81"> = </span><span class="sc84">false</span><span class="sc81">

   </span><span class="sc86">intGray</span><span class="sc81"> = </span><span class="sc83">75</span><span class="sc81">  </span><span class="sc82">' 0 (black) to 255 (white)</span><span class="sc81">
   
   </span><span class="sc86">intColor_Red</span><span class="sc81"> = </span><span class="sc86">intGray</span><span class="sc81">
   </span><span class="sc86">intColor_Green</span><span class="sc81"> = </span><span class="sc86">intGray</span><span class="sc81">
   </span><span class="sc86">intColor_Blue</span><span class="sc81"> = </span><span class="sc86">intGray</span><span class="sc81">
   
   </span><span class="sc86">intColor</span><span class="sc81"> = </span><span class="sc86">RGB</span><span class="sc81">(</span><span class="sc86">intColor_Red</span><span class="sc81">, </span><span class="sc86">intColor_Green</span><span class="sc81">, </span><span class="sc86">intColor_Blue</span><span class="sc81">)
   </span><span class="sc82">'intColor = vbBlack</span><span class="sc81">
   
   </span><span class="sc86">MyChartAddXY</span><span class="sc81">  </span><span class="sc86">dblXValue</span><span class="sc81">, </span><span class="sc86">Chart.VertAxisMin</span><span class="sc81">, </span><span class="sc85">""</span><span class="sc81">, </span><span class="sc86">intColor</span><span class="sc81">  
   </span><span class="sc86">MyChartAddXY</span><span class="sc81">  </span><span class="sc86">dblXValue</span><span class="sc81">, </span><span class="sc86">Chart.VertAxisMax</span><span class="sc81">, </span><span class="sc85">""</span><span class="sc81">, </span><span class="sc86">intColor</span><span class="sc81">
</span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">Sub</span><span class="sc81">


</span><span class="sc84">Function</span><span class="sc81"> </span><span class="sc86">DeltaP_SQL</span><span class="sc81">(</span><span class="sc84">ByVal</span><span class="sc81"> </span><span class="sc86">intDays</span><span class="sc81">, </span><span class="sc84">ByRef</span><span class="sc81"> </span><span class="sc86">dicTraceIO</span><span class="sc81">)
   </span><span class="sc84">Dim</span><span class="sc81"> </span><span class="sc86">strWestSite</span><span class="sc81">, </span><span class="sc86">strEastSite</span><span class="sc81">
   
   </span><span class="sc86">strWestSite</span><span class="sc81"> = </span><span class="sc86">dicTraceIO.Item</span><span class="sc81">(</span><span class="sc85">"WestSite"</span><span class="sc81">)
   </span><span class="sc86">strEastSite</span><span class="sc81"> = </span><span class="sc86">dicTraceIO.Item</span><span class="sc81">(</span><span class="sc85">"EastSite"</span><span class="sc81">)

   </span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">intDays</span><span class="sc81"> = </span><span class="sc83">1</span><span class="sc81">) </span><span class="sc84">then</span><span class="sc81">
      </span><span class="sc82">' This query uses an interesting trick to accomplish the delta-P</span><span class="sc81">
      </span><span class="sc82">' calculation.  It selects all the needed data from two sites and then</span><span class="sc81">
      </span><span class="sc82">' groups it by time.  It feeds the SUM operator with logic from the IIF</span><span class="sc81">
      </span><span class="sc82">' operator.  That is how the delta is calculated.  The HAVING clause</span><span class="sc81">
      </span><span class="sc82">' insures that only groups with a count of 2 are used.</span><span class="sc81">
      
      </span><span class="sc82">' old MS Access version</span><span class="sc81">
      </span><span class="sc82">'strSQL = "SELECT DateTimeStamp, TimeMDY, TimeHr, TimeMin, SUM(IIf([StationName]='" &amp; strWestSite &amp; "',+[Pressure],-[Pressure])) AS DeltaP " &amp; _</span><span class="sc81">
      </span><span class="sc82">'         "FROM FifteenMinData " &amp; _</span><span class="sc81">
      </span><span class="sc82">'         "WHERE ((StationName) In ('" &amp; strWestSite &amp; "','" &amp; strEastSite &amp; "')) AND " &amp; _</span><span class="sc81">
      </span><span class="sc82">'         "      (DateTimeStamp &lt;=     " &amp; MySQLDate(dteEndDateTime)    &amp; ") AND " &amp; _</span><span class="sc81">
      </span><span class="sc82">'         "      (DateTimeStamp &gt;=     " &amp; MySQLDate(dteStartDateTime_forQuery) &amp; ") " &amp; _</span><span class="sc81">
      </span><span class="sc82">'         "GROUP BY DateTimeStamp, TimeMDY, TimeHr, TimeMin " &amp; _</span><span class="sc81">
      </span><span class="sc82">'         "HAVING (((Count(DateTimeStamp))=2)) " &amp; _</span><span class="sc81">
      </span><span class="sc82">'         "ORDER BY TimeMDY ASC, TimeHr ASC, TimeMin ASC"</span><span class="sc81">
      
      </span><span class="sc82">' MySQL-compatible query (replacing IIf with CASE expression)</span><span class="sc81">
      </span><span class="sc86">strSQL</span><span class="sc81"> = </span><span class="sc85">"SELECT DateTimeStamp, TimeMDY, TimeHr, TimeMin, "</span><span class="sc81"> &amp; </span><span class="sc86">_</span><span class="sc81">
               </span><span class="sc85">"SUM(CASE WHEN StationName = '"</span><span class="sc81"> &amp; </span><span class="sc86">strWestSite</span><span class="sc81"> &amp; </span><span class="sc85">"' THEN Pressure ELSE -Pressure END) AS DeltaP "</span><span class="sc81"> &amp; </span><span class="sc86">_</span><span class="sc81">
               </span><span class="sc85">"FROM FifteenMinData "</span><span class="sc81"> &amp; </span><span class="sc86">_</span><span class="sc81">
               </span><span class="sc85">"WHERE StationName IN ('"</span><span class="sc81"> &amp; </span><span class="sc86">strWestSite</span><span class="sc81"> &amp; </span><span class="sc85">"','"</span><span class="sc81"> &amp; </span><span class="sc86">strEastSite</span><span class="sc81"> &amp; </span><span class="sc85">"') AND "</span><span class="sc81"> &amp; </span><span class="sc86">_</span><span class="sc81">
               </span><span class="sc85">"DateTimeStamp &lt;= "</span><span class="sc81"> &amp; </span><span class="sc86">MySQLDate</span><span class="sc81">(</span><span class="sc86">dteEndDateTime</span><span class="sc81">) &amp; </span><span class="sc85">" AND "</span><span class="sc81"> &amp; </span><span class="sc86">_</span><span class="sc81">
               </span><span class="sc85">"DateTimeStamp &gt;= "</span><span class="sc81"> &amp; </span><span class="sc86">MySQLDate</span><span class="sc81">(</span><span class="sc86">dteStartDateTime_forQuery</span><span class="sc81">) &amp; </span><span class="sc85">" "</span><span class="sc81"> &amp; </span><span class="sc86">_</span><span class="sc81">
               </span><span class="sc85">"GROUP BY DateTimeStamp, TimeMDY, TimeHr, TimeMin "</span><span class="sc81"> &amp; </span><span class="sc86">_</span><span class="sc81">
               </span><span class="sc85">"HAVING COUNT(DISTINCT StationName) = 2 "</span><span class="sc81"> &amp; </span><span class="sc86">_</span><span class="sc81">
               </span><span class="sc85">"ORDER BY TimeMDY ASC, TimeHr ASC, TimeMin ASC"</span><span class="sc81">

   </span><span class="sc84">Else</span><span class="sc81">
      </span><span class="sc82">' Multi-day query</span><span class="sc81">

      </span><span class="sc82">' old MS Access version</span><span class="sc81">
      </span><span class="sc82">'strSQL = "SELECT DateTimeStamp, TimeMDY, TimeHr, TimeMin, SUM(IIf([StationName]='" &amp; strWestSite &amp; "',+[Pressure],-[Pressure])) AS DeltaP1 " &amp; _</span><span class="sc81">
      </span><span class="sc82">'         "FROM FifteenMinData " &amp; _</span><span class="sc81">
      </span><span class="sc82">'         "WHERE ((StationName) In ('" &amp; strWestSite &amp; "','" &amp; strEastSite &amp; "')) AND " &amp; _</span><span class="sc81">
      </span><span class="sc82">'         "      ([DateTimeStamp] &lt;=     #" &amp; dteEndDateTime    &amp; "#) AND " &amp; _</span><span class="sc81">
      </span><span class="sc82">'         "      ([DateTimeStamp] &gt;=     #" &amp; dteStartDateTime_forQuery &amp; "#) " &amp; _</span><span class="sc81">
      </span><span class="sc82">'         "GROUP BY DateTimeStamp, TimeMDY, TimeHr, TimeMin " &amp; _</span><span class="sc81">
      </span><span class="sc82">'         "HAVING (((Count(DateTimeStamp))=2)) " &amp; _</span><span class="sc81">
      </span><span class="sc82">'         "ORDER BY TimeMDY ASC, TimeHr ASC, TimeMin ASC"   </span><span class="sc81">
      </span><span class="sc82">'</span><span class="sc81">
      </span><span class="sc82">' And now we feed the query above into the aggregation query below</span><span class="sc81">
      </span><span class="sc82">' (another interesting SQL trick).</span><span class="sc81">
      </span><span class="sc82">'</span><span class="sc81">
      </span><span class="sc82">'strSQL = "SELECT TimeMDY, TimeHr, AVG(DeltaP1) AS DeltaP " &amp; _</span><span class="sc81">
      </span><span class="sc82">'         "FROM (" &amp; strSQL &amp; ") " &amp; _</span><span class="sc81">
      </span><span class="sc82">'         "GROUP BY TimeMDY, TimeHr " &amp; _</span><span class="sc81">
      </span><span class="sc82">'         "ORDER BY TimeMDY ASC , TimeHr ASC "</span><span class="sc81">

      </span><span class="sc82">' MySQL-compatible query for multi-day</span><span class="sc81">
      </span><span class="sc86">strSQL</span><span class="sc81"> = </span><span class="sc85">"SELECT DateTimeStamp, TimeMDY, TimeHr, TimeMin, "</span><span class="sc81"> &amp; </span><span class="sc86">_</span><span class="sc81">
         </span><span class="sc85">"SUM(CASE WHEN StationName = '"</span><span class="sc81"> &amp; </span><span class="sc86">strWestSite</span><span class="sc81"> &amp; </span><span class="sc85">"' THEN Pressure ELSE -Pressure END) AS DeltaP1 "</span><span class="sc81"> &amp; </span><span class="sc86">_</span><span class="sc81">
         </span><span class="sc85">"FROM FifteenMinData "</span><span class="sc81"> &amp; </span><span class="sc86">_</span><span class="sc81">
         </span><span class="sc85">"WHERE StationName IN ('"</span><span class="sc81"> &amp; </span><span class="sc86">strWestSite</span><span class="sc81"> &amp; </span><span class="sc85">"','"</span><span class="sc81"> &amp; </span><span class="sc86">strEastSite</span><span class="sc81"> &amp; </span><span class="sc85">"') AND "</span><span class="sc81"> &amp; </span><span class="sc86">_</span><span class="sc81">
         </span><span class="sc85">"DateTimeStamp &lt;= "</span><span class="sc81"> &amp; </span><span class="sc86">MySQLDate</span><span class="sc81">(</span><span class="sc86">dteEndDateTime</span><span class="sc81">) &amp; </span><span class="sc85">" AND "</span><span class="sc81"> &amp; </span><span class="sc86">_</span><span class="sc81">
         </span><span class="sc85">"DateTimeStamp &gt;= "</span><span class="sc81"> &amp; </span><span class="sc86">MySQLDate</span><span class="sc81">(</span><span class="sc86">dteStartDateTime_forQuery</span><span class="sc81">) &amp; </span><span class="sc85">" "</span><span class="sc81"> &amp; </span><span class="sc86">_</span><span class="sc81">
         </span><span class="sc85">"GROUP BY DateTimeStamp, TimeMDY, TimeHr, TimeMin "</span><span class="sc81"> &amp; </span><span class="sc86">_</span><span class="sc81">
         </span><span class="sc85">"HAVING COUNT(DISTINCT StationName) = 2 "</span><span class="sc81"> &amp; </span><span class="sc86">_</span><span class="sc81">
         </span><span class="sc85">"ORDER BY TimeMDY ASC, TimeHr ASC, TimeMin ASC"</span><span class="sc81">   

      </span><span class="sc82">' And now we feed the query above into the aggregation query below</span><span class="sc81">
      </span><span class="sc82">' (another interesting SQL trick).</span><span class="sc81">
      </span><span class="sc82">' For MySQL, we need to add an alias for the derived table</span><span class="sc81">

      </span><span class="sc86">strSQL</span><span class="sc81"> = </span><span class="sc85">"SELECT TimeMDY, TimeHr, AVG(DeltaP1) AS DeltaP "</span><span class="sc81"> &amp; </span><span class="sc86">_</span><span class="sc81">
               </span><span class="sc85">"FROM ("</span><span class="sc81"> &amp; </span><span class="sc86">strSQL</span><span class="sc81"> &amp; </span><span class="sc85">") AS derived_table "</span><span class="sc81"> &amp; </span><span class="sc86">_</span><span class="sc81">
               </span><span class="sc85">"GROUP BY TimeMDY, TimeHr "</span><span class="sc81"> &amp; </span><span class="sc86">_</span><span class="sc81">
               </span><span class="sc85">"ORDER BY TimeMDY ASC, TimeHr ASC"</span><span class="sc81">

   </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">

   </span><span class="sc86">DeltaP_SQL</span><span class="sc81"> = </span><span class="sc86">strSQL</span><span class="sc81">
</span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">Function</span><span class="sc81">


</span><span class="sc84">Function</span><span class="sc81"> </span><span class="sc86">CollectTraceData</span><span class="sc81">(</span><span class="sc84">ByVal</span><span class="sc81"> </span><span class="sc86">strSensor_DBName</span><span class="sc81">, </span><span class="sc84">ByVal</span><span class="sc81"> </span><span class="sc86">intColor</span><span class="sc81">, </span><span class="sc84">ByRef</span><span class="sc81"> </span><span class="sc86">dicTraceIO</span><span class="sc81">)
   </span><span class="sc84">Dim</span><span class="sc81"> </span><span class="sc86">strSensorSelectClause</span><span class="sc81">, </span><span class="sc86">strSQL_trace</span><span class="sc81">, </span><span class="sc86">rstTelem</span><span class="sc81">

   </span><span class="sc84">Dim</span><span class="sc81"> </span><span class="sc86">points</span><span class="sc81">(), </span><span class="sc86">points_smoothed</span><span class="sc81">(), </span><span class="sc86">pointCount</span><span class="sc81">, </span><span class="sc86">maxPointCount</span><span class="sc81">, </span><span class="sc86">n_records</span><span class="sc81">

   </span><span class="sc84">Dim</span><span class="sc81"> </span><span class="sc86">dblYMax</span><span class="sc81">, </span><span class="sc86">dblYMin</span><span class="sc81">
   </span><span class="sc84">Dim</span><span class="sc81"> </span><span class="sc86">dblXValue_raw</span><span class="sc81">, </span><span class="sc86">dblXValue</span><span class="sc81"> 
   </span><span class="sc84">Dim</span><span class="sc81"> </span><span class="sc86">dblYValue_raw</span><span class="sc81">, </span><span class="sc86">dblYValue</span><span class="sc81">
   </span><span class="sc84">Dim</span><span class="sc81"> </span><span class="sc86">arrayIndex</span><span class="sc81">

   </span><span class="sc82">' Initialize array</span><span class="sc81">
   </span><span class="sc86">pointCount</span><span class="sc81"> = </span><span class="sc83">0</span><span class="sc81">
   </span><span class="sc84">If</span><span class="sc81"> </span><span class="sc86">intDays</span><span class="sc81"> = </span><span class="sc83">1</span><span class="sc81"> </span><span class="sc84">Then</span><span class="sc81">
      </span><span class="sc82">' Allocate for up to a day of 5-minute data.</span><span class="sc81">
      </span><span class="sc86">maxPointCount</span><span class="sc81"> = (</span><span class="sc86">intDays</span><span class="sc81"> * </span><span class="sc83">24</span><span class="sc81"> * </span><span class="sc83">12</span><span class="sc81">) + </span><span class="sc83">50</span><span class="sc81">
   </span><span class="sc84">Else</span><span class="sc81">
      </span><span class="sc82">' Allocate for up to a day of hourly data.</span><span class="sc81">
      </span><span class="sc86">maxPointCount</span><span class="sc81"> = (</span><span class="sc86">intDays</span><span class="sc81"> * </span><span class="sc83">24</span><span class="sc81">) + </span><span class="sc83">10</span><span class="sc81">
   </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">
   </span><span class="sc84">ReDim</span><span class="sc81"> </span><span class="sc86">points</span><span class="sc81">(</span><span class="sc86">maxPointCount</span><span class="sc81">)
   </span><span class="sc84">ReDim</span><span class="sc81"> </span><span class="sc86">points_smoothed</span><span class="sc81">(</span><span class="sc86">maxPointCount</span><span class="sc81">)
   
   </span><span class="sc86">dblYMax</span><span class="sc81"> = </span><span class="sc86">dicTraceIO.Item</span><span class="sc81">(</span><span class="sc85">"YMax"</span><span class="sc81">) 
   </span><span class="sc86">dblYMin</span><span class="sc81"> = </span><span class="sc86">dicTraceIO.Item</span><span class="sc81">(</span><span class="sc85">"YMin"</span><span class="sc81">) 

   </span><span class="sc86">dicTraceIO.Item</span><span class="sc81">(</span><span class="sc85">"FoundData_ForThisTrace"</span><span class="sc81">) = </span><span class="sc84">False</span><span class="sc81">
   
   </span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">intDays</span><span class="sc81"> = </span><span class="sc83">1</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
      </span><span class="sc82">' Single day query (multiple values per hour)</span><span class="sc81">
      </span><span class="sc84">If</span><span class="sc81"> ((</span><span class="sc86">strMRTime</span><span class="sc81"> &lt;&gt; </span><span class="sc85">"-"</span><span class="sc81">) </span><span class="sc84">And</span><span class="sc81"> (</span><span class="sc86">DaysDec</span><span class="sc81">(</span><span class="sc86">strMRTime</span><span class="sc81">) &gt; </span><span class="sc83">0.0</span><span class="sc81">) </span><span class="sc84">And</span><span class="sc81"> (</span><span class="sc86">DaysDec</span><span class="sc81">( </span><span class="sc86">strMRTime</span><span class="sc81">) &lt; </span><span class="sc83">1.0</span><span class="sc81">) </span><span class="sc84">And</span><span class="sc81"> (</span><span class="sc86">str24Hrs_state</span><span class="sc81"> = </span><span class="sc85">"checked"</span><span class="sc81">)) </span><span class="sc84">Then</span><span class="sc81">
         </span><span class="sc82">' Go back a full day. This modification of dteStartDateTime_forQuery is in support </span><span class="sc81">
         </span><span class="sc82">' of the 24h plot.</span><span class="sc81">
         </span><span class="sc86">dteStartDateTime_forQuery</span><span class="sc81"> = </span><span class="sc86">DateAdd</span><span class="sc81">(</span><span class="sc85">"d"</span><span class="sc81">, -</span><span class="sc83">1</span><span class="sc81">, </span><span class="sc86">DateAdd</span><span class="sc81">(</span><span class="sc85">"n"</span><span class="sc81">, </span><span class="sc83">0</span><span class="sc81">, </span><span class="sc86">strMRTime</span><span class="sc81">))
      </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">
      
      </span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">strSensor_DBName</span><span class="sc81"> = </span><span class="sc85">"DeltaP"</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
         </span><span class="sc86">strSQL_trace</span><span class="sc81"> = </span><span class="sc86">DeltaP_SQL</span><span class="sc81">(</span><span class="sc86">intDays</span><span class="sc81">, </span><span class="sc86">dicTraceIO</span><span class="sc81">)
      </span><span class="sc84">Else</span><span class="sc81">
         </span><span class="sc86">strSQL_trace</span><span class="sc81"> = </span><span class="sc85">"SELECT StationName, DateTimeStamp, TimeMDY, TimeMin, TimeHr, "</span><span class="sc81"> &amp; </span><span class="sc86">strSensor_DBName</span><span class="sc81"> &amp; </span><span class="sc85">" "</span><span class="sc81"> &amp; </span><span class="sc86">_</span><span class="sc81">
                        </span><span class="sc85">"FROM FifteenMinData "</span><span class="sc81"> &amp; </span><span class="sc86">_</span><span class="sc81"> 
                        </span><span class="sc85">"WHERE (StationName = '"</span><span class="sc81"> &amp; </span><span class="sc86">strLocation</span><span class="sc81"> &amp; </span><span class="sc85">"') AND "</span><span class="sc81"> &amp; </span><span class="sc86">_</span><span class="sc81">
                              </span><span class="sc85">"(DateTimeStamp &lt;=     "</span><span class="sc81"> &amp; </span><span class="sc86">MySQLDate</span><span class="sc81">(</span><span class="sc86">dteEndDateTime</span><span class="sc81">)    &amp; </span><span class="sc85">") AND "</span><span class="sc81"> &amp; </span><span class="sc86">_</span><span class="sc81">
                              </span><span class="sc85">"(DateTimeStamp &gt;=     "</span><span class="sc81"> &amp; </span><span class="sc86">MySQLDate</span><span class="sc81">(</span><span class="sc86">dteStartDateTime_forQuery</span><span class="sc81">)     &amp; </span><span class="sc85">") AND "</span><span class="sc81"> &amp; </span><span class="sc86">_</span><span class="sc81">
                              </span><span class="sc85">"("</span><span class="sc81"> &amp; </span><span class="sc86">strSensor_DBName</span><span class="sc81"> &amp; </span><span class="sc85">" IS NOT NULL) "</span><span class="sc81"> &amp; </span><span class="sc86">_</span><span class="sc81">
                        </span><span class="sc85">"ORDER BY TimeMDY ASC, TimeHr ASC, TimeMin ASC"</span><span class="sc81">
      </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">

   </span><span class="sc84">Else</span><span class="sc81">   
      </span><span class="sc82">' Multi-day query (hourly data)</span><span class="sc81">
      </span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">strSensor_DBName</span><span class="sc81"> = </span><span class="sc85">"DeltaP"</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
         </span><span class="sc86">strSQL_trace</span><span class="sc81"> = </span><span class="sc86">DeltaP_SQL</span><span class="sc81">(</span><span class="sc86">intDays</span><span class="sc81">, </span><span class="sc86">dicTraceIO</span><span class="sc81">)
      </span><span class="sc84">Else</span><span class="sc81">
         </span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">strSensor_DBName</span><span class="sc81"> = </span><span class="sc85">"TempMax"</span><span class="sc81">) </span><span class="sc84">or</span><span class="sc81"> (</span><span class="sc86">strSensor_DBName</span><span class="sc81"> = </span><span class="sc85">"WindGust"</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
            </span><span class="sc86">strSensorSelectClause</span><span class="sc81"> = </span><span class="sc85">"MAX(A."</span><span class="sc81"> &amp; </span><span class="sc86">strSensor_DBName</span><span class="sc81"> &amp; </span><span class="sc85">") AS "</span><span class="sc81"> &amp; </span><span class="sc86">strSensor_DBName</span><span class="sc81">
         </span><span class="sc84">ElseIf</span><span class="sc81"> (</span><span class="sc86">strSensor_DBName</span><span class="sc81"> = </span><span class="sc85">"TempMin"</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
            </span><span class="sc86">strSensorSelectClause</span><span class="sc81"> = </span><span class="sc85">"MIN(A."</span><span class="sc81"> &amp; </span><span class="sc86">strSensor_DBName</span><span class="sc81"> &amp; </span><span class="sc85">") AS "</span><span class="sc81"> &amp; </span><span class="sc86">strSensor_DBName</span><span class="sc81">
         </span><span class="sc84">Else</span><span class="sc81">
            </span><span class="sc86">strSensorSelectClause</span><span class="sc81"> = </span><span class="sc85">"AVG(A."</span><span class="sc81"> &amp; </span><span class="sc86">strSensor_DBName</span><span class="sc81"> &amp; </span><span class="sc85">") AS "</span><span class="sc81"> &amp; </span><span class="sc86">strSensor_DBName</span><span class="sc81">
         </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">
         
         </span><span class="sc86">strSQL_trace</span><span class="sc81"> = </span><span class="sc85">"SELECT TimeMDY, TimeHr, MIN(A.StationName) AS StationName, AVG(A.DateTimeStamp) AS DateTimeStamp, "</span><span class="sc81"> &amp; </span><span class="sc86">strSensorSelectClause</span><span class="sc81"> &amp; </span><span class="sc85">" "</span><span class="sc81"> &amp; </span><span class="sc86">_</span><span class="sc81">
                        </span><span class="sc85">"FROM FifteenMinData AS A "</span><span class="sc81"> &amp; </span><span class="sc86">_</span><span class="sc81"> 
                        </span><span class="sc85">"WHERE (StationName = '"</span><span class="sc81"> &amp; </span><span class="sc86">strLocation</span><span class="sc81"> &amp; </span><span class="sc85">"') AND "</span><span class="sc81"> &amp; </span><span class="sc86">_</span><span class="sc81">
                           </span><span class="sc85">"(DateTimeStamp &lt;=     "</span><span class="sc81"> &amp; </span><span class="sc86">MySQLDate</span><span class="sc81">(</span><span class="sc86">dteEndDateTime</span><span class="sc81">)    &amp; </span><span class="sc85">") AND "</span><span class="sc81"> &amp; </span><span class="sc86">_</span><span class="sc81">
                           </span><span class="sc85">"(DateTimeStamp &gt;=     "</span><span class="sc81"> &amp; </span><span class="sc86">MySQLDate</span><span class="sc81">(</span><span class="sc86">dteStartDateTime_forQuery</span><span class="sc81">)     &amp; </span><span class="sc85">") AND "</span><span class="sc81"> &amp; </span><span class="sc86">_</span><span class="sc81">
                           </span><span class="sc85">"("</span><span class="sc81"> &amp; </span><span class="sc86">strSensor_DBName</span><span class="sc81"> &amp; </span><span class="sc85">" IS NOT NULL) "</span><span class="sc81"> &amp; </span><span class="sc86">_</span><span class="sc81">
                        </span><span class="sc85">"GROUP BY TimeMDY, TimeHr "</span><span class="sc81"> &amp; </span><span class="sc86">_</span><span class="sc81">
                        </span><span class="sc85">"ORDER BY TimeMDY ASC, TimeHr ASC"</span><span class="sc81">       
      </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">
   </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">


   </span><span class="sc84">Set</span><span class="sc81"> </span><span class="sc86">rstTelem</span><span class="sc81"> = </span><span class="sc86">Server.CreateObject</span><span class="sc81">(</span><span class="sc85">"ADODB.Recordset"</span><span class="sc81">)
    </span><span class="sc84">On</span><span class="sc81"> </span><span class="sc84">Error</span><span class="sc81"> </span><span class="sc84">Resume</span><span class="sc81"> </span><span class="sc84">Next</span><span class="sc81">
    </span><span class="sc86">rstTelem.Open</span><span class="sc81"> </span><span class="sc86">strSQL_trace</span><span class="sc81">, </span><span class="sc86">DBConnection</span><span class="sc81">, </span><span class="sc86">adOpenStatic</span><span class="sc81">, </span><span class="sc86">adLockReadOnly</span><span class="sc81">, </span><span class="sc86">adCmdText</span><span class="sc81">
    </span><span class="sc86">LogError</span><span class="sc81">(</span><span class="sc85">"Recordset = rstTelem, SQL = "</span><span class="sc81"> &amp; </span><span class="sc86">strSQL_trace</span><span class="sc81">)
    </span><span class="sc84">On</span><span class="sc81"> </span><span class="sc84">Error</span><span class="sc81"> </span><span class="sc84">Goto</span><span class="sc81"> </span><span class="sc83">0</span><span class="sc81">

   </span><span class="sc82">' Collect data into the points array</span><span class="sc81">
   </span><span class="sc84">If</span><span class="sc81"> </span><span class="sc84">Not</span><span class="sc81"> </span><span class="sc86">rstTelem.EOF</span><span class="sc81"> </span><span class="sc84">Then</span><span class="sc81">
      </span><span class="sc86">rstTelem.MoveFirst</span><span class="sc81">
      </span><span class="sc84">Do</span><span class="sc81"> </span><span class="sc84">Until</span><span class="sc81"> </span><span class="sc86">rstTelem.EOF</span><span class="sc81">
         </span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">intDays</span><span class="sc81"> = </span><span class="sc83">1</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
            </span><span class="sc86">dblXValue_raw</span><span class="sc81"> = </span><span class="sc86">DaysDecSinceRefF</span><span class="sc81">(</span><span class="sc86">rstTelem</span><span class="sc81">(</span><span class="sc85">"TimeMDY"</span><span class="sc81">), </span><span class="sc86">rstTelem</span><span class="sc81">(</span><span class="sc85">"TimeHr"</span><span class="sc81">), </span><span class="sc86">rstTelem</span><span class="sc81">(</span><span class="sc85">"TimeMin"</span><span class="sc81">))
         </span><span class="sc84">Else</span><span class="sc81">
            </span><span class="sc86">dblXValue_raw</span><span class="sc81"> = </span><span class="sc86">DaysDecSinceRefF</span><span class="sc81">(</span><span class="sc86">rstTelem</span><span class="sc81">(</span><span class="sc85">"TimeMDY"</span><span class="sc81">), </span><span class="sc86">rstTelem</span><span class="sc81">(</span><span class="sc85">"TimeHr"</span><span class="sc81">), </span><span class="sc83">0</span><span class="sc81">)
         </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">

         </span><span class="sc86">dblYValue_raw</span><span class="sc81"> = </span><span class="sc84">CDbl</span><span class="sc81">(</span><span class="sc86">rstTelem</span><span class="sc81">( </span><span class="sc86">strSensor_DBName</span><span class="sc81">))
         </span><span class="sc82">' If there will the a running average done later, don't scale direction data here. </span><span class="sc81">
         </span><span class="sc82">' Leave it in degrees for now. Scale after the running average (which expects degrees).</span><span class="sc81">
         </span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">strSensor_DBName</span><span class="sc81"> = </span><span class="sc85">"WindDirection"</span><span class="sc81">) </span><span class="sc84">and</span><span class="sc81"> (</span><span class="sc86">strRA_state</span><span class="sc81"> &lt;&gt; </span><span class="sc85">"checked"</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
            </span><span class="sc86">dblYValue</span><span class="sc81"> = </span><span class="sc86">dblYValue_raw</span><span class="sc81"> * </span><span class="sc86">dblWindNormFactor</span><span class="sc81">
         </span><span class="sc84">Else</span><span class="sc81">
            </span><span class="sc86">dblYValue</span><span class="sc81"> = </span><span class="sc86">dblYValue_raw</span><span class="sc81">
         </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">

         </span><span class="sc86">MinMax</span><span class="sc81"> </span><span class="sc86">dblYValue</span><span class="sc81">, </span><span class="sc86">dblYMax</span><span class="sc81">, </span><span class="sc86">dblYMin</span><span class="sc81">

         </span><span class="sc82">' Store in array - format: [day-since-ref, sensor-value]</span><span class="sc81">
         </span><span class="sc86">points</span><span class="sc81">(</span><span class="sc86">pointCount</span><span class="sc81">) = </span><span class="sc86">Array</span><span class="sc81">(</span><span class="sc84">CDbl</span><span class="sc81">(</span><span class="sc86">dblXValue_raw</span><span class="sc81">), </span><span class="sc84">CDbl</span><span class="sc81">(</span><span class="sc86">dblYValue</span><span class="sc81">), </span><span class="sc85">""</span><span class="sc81">, </span><span class="sc86">intColor</span><span class="sc81">)
         </span><span class="sc86">pointCount</span><span class="sc81"> = </span><span class="sc86">pointCount</span><span class="sc81"> + </span><span class="sc83">1</span><span class="sc81">
         
         </span><span class="sc86">rstTelem.MoveNext</span><span class="sc81">
      </span><span class="sc84">Loop</span><span class="sc81">
      
      </span><span class="sc82">' Resize array to actual number of points</span><span class="sc81">
      </span><span class="sc84">If</span><span class="sc81"> </span><span class="sc86">pointCount</span><span class="sc81"> &gt; </span><span class="sc83">0</span><span class="sc81"> </span><span class="sc84">Then</span><span class="sc81">
         </span><span class="sc84">ReDim</span><span class="sc81"> </span><span class="sc84">Preserve</span><span class="sc81"> </span><span class="sc86">points</span><span class="sc81">(</span><span class="sc86">pointCount</span><span class="sc81"> - </span><span class="sc83">1</span><span class="sc81">)
      </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">
   </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">

   </span><span class="sc84">If</span><span class="sc81"> </span><span class="sc86">rstTelem.State</span><span class="sc81"> = </span><span class="sc86">adStateOpen</span><span class="sc81"> </span><span class="sc84">Then</span><span class="sc81"> </span><span class="sc86">rstTelem.Close</span><span class="sc81">
   </span><span class="sc84">Set</span><span class="sc81"> </span><span class="sc86">rstTelem</span><span class="sc81"> = </span><span class="sc84">Nothing</span><span class="sc81">


   </span><span class="sc82">' Smooth the data using a running average (if requested and 5+ data points)</span><span class="sc81">
   </span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">strRA_state</span><span class="sc81"> = </span><span class="sc85">"checked"</span><span class="sc81">) </span><span class="sc84">AND</span><span class="sc81"> (</span><span class="sc86">pointCount</span><span class="sc81"> &gt;= </span><span class="sc83">5</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
      </span><span class="sc82">' Create the running average objects directly here</span><span class="sc81">
      </span><span class="sc84">Dim</span><span class="sc81"> </span><span class="sc86">n_RA_stack</span><span class="sc81">
      </span><span class="sc86">n_RA_stack</span><span class="sc81"> = </span><span class="sc83">3</span><span class="sc81">
      
      </span><span class="sc82">' Initialize running average objects with stack size: n_RA_stack</span><span class="sc81">
   
      </span><span class="sc82">' Create running average objects</span><span class="sc81">
      </span><span class="sc84">Set</span><span class="sc81"> </span><span class="sc86">RA_x</span><span class="sc81"> = </span><span class="sc84">New</span><span class="sc81"> </span><span class="sc86">RunningAverage</span><span class="sc81">
      </span><span class="sc86">RA_x.Initialize</span><span class="sc81"> </span><span class="sc86">n_RA_stack</span><span class="sc81">
      
      </span><span class="sc82">' Reset with the total number of points to properly handle end-of-data logic</span><span class="sc81">
      </span><span class="sc86">RA_x.Reset</span><span class="sc81"> </span><span class="sc86">pointCount</span><span class="sc81">
      
      </span><span class="sc84">If</span><span class="sc81"> </span><span class="sc86">strSensor_DBName</span><span class="sc81"> = </span><span class="sc85">"WindDirection"</span><span class="sc81"> </span><span class="sc84">Then</span><span class="sc81">
         </span><span class="sc84">Set</span><span class="sc81"> </span><span class="sc86">RA_y</span><span class="sc81"> = </span><span class="sc84">New</span><span class="sc81"> </span><span class="sc86">RunningAverage_Dir</span><span class="sc81">
         </span><span class="sc86">RA_y.Initialize</span><span class="sc81"> </span><span class="sc86">n_RA_stack</span><span class="sc81">
         </span><span class="sc86">RA_y.Reset</span><span class="sc81"> </span><span class="sc86">pointCount</span><span class="sc81">
      </span><span class="sc84">Else</span><span class="sc81">
         </span><span class="sc84">Set</span><span class="sc81"> </span><span class="sc86">RA_y</span><span class="sc81"> = </span><span class="sc84">New</span><span class="sc81"> </span><span class="sc86">RunningAverage</span><span class="sc81">
         </span><span class="sc86">RA_y.Initialize</span><span class="sc81"> </span><span class="sc86">n_RA_stack</span><span class="sc81">
         </span><span class="sc86">RA_y.Reset</span><span class="sc81"> </span><span class="sc86">pointCount</span><span class="sc81">
      </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">
      
      </span><span class="sc82">' Smooth the data</span><span class="sc81">
      </span><span class="sc84">For</span><span class="sc81"> </span><span class="sc86">arrayIndex</span><span class="sc81"> = </span><span class="sc83">0</span><span class="sc81"> </span><span class="sc84">To</span><span class="sc81"> </span><span class="sc86">UBound</span><span class="sc81">(</span><span class="sc86">points</span><span class="sc81">)
         </span><span class="sc86">dblXValue_raw</span><span class="sc81"> = </span><span class="sc86">points</span><span class="sc81">(</span><span class="sc86">arrayIndex</span><span class="sc81">)(</span><span class="sc83">0</span><span class="sc81">)
         </span><span class="sc86">dblYValue_raw</span><span class="sc81"> = </span><span class="sc86">points</span><span class="sc81">(</span><span class="sc86">arrayIndex</span><span class="sc81">)(</span><span class="sc83">1</span><span class="sc81">)
         
         </span><span class="sc82">' Apply running average to all points</span><span class="sc81">
         </span><span class="sc82">' The RunningAverage class now handles special cases for endpoints</span><span class="sc81">
         </span><span class="sc86">dblXValue</span><span class="sc81"> = </span><span class="sc86">RA_x.update</span><span class="sc81">(</span><span class="sc86">dblXValue_raw</span><span class="sc81">)
         </span><span class="sc82">' Now, after averaging, scale the direction data to deal with the single-axis chart.</span><span class="sc81">
         </span><span class="sc82">' The RunningAverage_Dir class expects the data in degrees.</span><span class="sc81">
         </span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">strSensor_DBName</span><span class="sc81"> = </span><span class="sc85">"WindDirection"</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
            </span><span class="sc86">dblYValue</span><span class="sc81"> = </span><span class="sc86">RA_y.update</span><span class="sc81">(</span><span class="sc86">dblYValue_raw</span><span class="sc81">) * </span><span class="sc86">dblWindNormFactor</span><span class="sc81">
         </span><span class="sc84">Else</span><span class="sc81">
            </span><span class="sc86">dblYValue</span><span class="sc81"> = </span><span class="sc86">RA_y.update</span><span class="sc81">(</span><span class="sc86">dblYValue_raw</span><span class="sc81">)
         </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">

         </span><span class="sc86">points_smoothed</span><span class="sc81">(</span><span class="sc86">arrayIndex</span><span class="sc81">) = </span><span class="sc86">Array</span><span class="sc81">(</span><span class="sc86">dblXValue</span><span class="sc81">, </span><span class="sc86">dblYValue</span><span class="sc81">, </span><span class="sc85">""</span><span class="sc81">, </span><span class="sc86">intColor</span><span class="sc81">)
      </span><span class="sc84">Next</span><span class="sc81">
      </span><span class="sc84">ReDim</span><span class="sc81"> </span><span class="sc84">Preserve</span><span class="sc81"> </span><span class="sc86">points_smoothed</span><span class="sc81">(</span><span class="sc86">pointCount</span><span class="sc81"> - </span><span class="sc83">1</span><span class="sc81">)      
      
      </span><span class="sc86">useRunningAverage</span><span class="sc81"> = </span><span class="sc84">True</span><span class="sc81">
   </span><span class="sc84">Else</span><span class="sc81">
      </span><span class="sc86">useRunningAverage</span><span class="sc81"> = </span><span class="sc84">False</span><span class="sc81">
   </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">


   </span><span class="sc82">' Note that this assignment can not be made in the call to MinMax. It can't modify the</span><span class="sc81">
   </span><span class="sc82">' dictionary values directly (unless you passed it the whole dictionary).</span><span class="sc81">
   </span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">strSensor_DBName</span><span class="sc81"> &lt;&gt; </span><span class="sc85">"WindDirection"</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
      </span><span class="sc86">dicTraceIO.Item</span><span class="sc81">(</span><span class="sc85">"YMax"</span><span class="sc81">) = </span><span class="sc86">dblYMax</span><span class="sc81">
      </span><span class="sc86">dicTraceIO.Item</span><span class="sc81">(</span><span class="sc85">"YMin"</span><span class="sc81">) = </span><span class="sc86">dblYMin</span><span class="sc81">
   </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">

   </span><span class="sc82">' Return the array</span><span class="sc81">
   </span><span class="sc84">If</span><span class="sc81"> </span><span class="sc86">pointCount</span><span class="sc81"> &gt; </span><span class="sc83">0</span><span class="sc81"> </span><span class="sc84">Then</span><span class="sc81">   
      </span><span class="sc86">dicTraceIO.Item</span><span class="sc81">(</span><span class="sc85">"FoundData"</span><span class="sc81">) = </span><span class="sc84">True</span><span class="sc81">
      </span><span class="sc86">dicTraceIO.Item</span><span class="sc81">(</span><span class="sc85">"FoundData_ForThisTrace"</span><span class="sc81">) = </span><span class="sc84">True</span><span class="sc81">
      
      </span><span class="sc84">If</span><span class="sc81"> </span><span class="sc86">useRunningAverage</span><span class="sc81"> </span><span class="sc84">Then</span><span class="sc81">
         </span><span class="sc86">CollectTraceData</span><span class="sc81"> = </span><span class="sc86">points_smoothed</span><span class="sc81">
      </span><span class="sc84">Else</span><span class="sc81">
         </span><span class="sc86">CollectTraceData</span><span class="sc81"> = </span><span class="sc86">points</span><span class="sc81">
      </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">
   </span><span class="sc84">Else</span><span class="sc81">
      </span><span class="sc86">CollectTraceData</span><span class="sc81"> = </span><span class="sc86">Null</span><span class="sc81">
   </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">
</span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">Function</span><span class="sc81">


</span><span class="sc84">Sub</span><span class="sc81"> </span><span class="sc86">AddTrace</span><span class="sc81">(</span><span class="sc86">strSensorName</span><span class="sc81">, </span><span class="sc86">intSeriesType</span><span class="sc81">, </span><span class="sc86">strSeriesTitle</span><span class="sc81">, </span><span class="sc86">intLineWidth</span><span class="sc81">, </span><span class="sc86">intColor</span><span class="sc81">, </span><span class="sc84">ByRef</span><span class="sc81"> </span><span class="sc86">dicTraceIO</span><span class="sc81">)
   </span><span class="sc84">Dim</span><span class="sc81"> </span><span class="sc86">intTraceArray_index</span><span class="sc81">
   </span><span class="sc84">Dim</span><span class="sc81"> </span><span class="sc86">intYesterdayColor</span><span class="sc81">, </span><span class="sc86">intGray</span><span class="sc81"> 
   </span><span class="sc84">Dim</span><span class="sc81"> </span><span class="sc86">dblYValue</span><span class="sc81">, </span><span class="sc86">dblYValue_raw</span><span class="sc81">
   </span><span class="sc84">Dim</span><span class="sc81"> </span><span class="sc86">dblXValue</span><span class="sc81">, </span><span class="sc86">dblXValue_raw</span><span class="sc81">
   </span><span class="sc84">Dim</span><span class="sc81"> </span><span class="sc86">strSQL_trace</span><span class="sc81">
   </span><span class="sc84">Dim</span><span class="sc81"> </span><span class="sc86">i</span><span class="sc81">
   </span><span class="sc84">Dim</span><span class="sc81"> </span><span class="sc86">pointCount</span><span class="sc81">

   </span><span class="sc84">Dim</span><span class="sc81"> </span><span class="sc86">dataPoints</span><span class="sc81">
   
   </span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">strSensorName</span><span class="sc81"> = </span><span class="sc85">"WindDirection"</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
      </span><span class="sc86">dataPoints</span><span class="sc81"> = </span><span class="sc86">dataPoints_WindDirection</span><span class="sc81">
   </span><span class="sc84">ElseIf</span><span class="sc81"> (</span><span class="sc86">strSensorName</span><span class="sc81"> = </span><span class="sc85">"WindGust"</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
      </span><span class="sc86">dataPoints</span><span class="sc81"> = </span><span class="sc86">dataPoints_WindGust</span><span class="sc81">
   </span><span class="sc84">ElseIf</span><span class="sc81"> (</span><span class="sc86">strSensorName</span><span class="sc81"> = </span><span class="sc85">"WindSpeed"</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
      </span><span class="sc86">dataPoints</span><span class="sc81"> = </span><span class="sc86">dataPoints_WindSpeed</span><span class="sc81">

   </span><span class="sc84">ElseIf</span><span class="sc81"> (</span><span class="sc86">strSensorName</span><span class="sc81"> = </span><span class="sc85">"Pressure"</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
      </span><span class="sc86">dataPoints</span><span class="sc81"> = </span><span class="sc86">dataPoints_Pressure</span><span class="sc81">

   </span><span class="sc84">ElseIf</span><span class="sc81"> (</span><span class="sc86">strSensorName</span><span class="sc81"> = </span><span class="sc85">"DeltaP_trace_A"</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
      </span><span class="sc86">dataPoints</span><span class="sc81"> = </span><span class="sc86">dataPoints_DeltaP_trace_A</span><span class="sc81">
   </span><span class="sc84">ElseIf</span><span class="sc81"> (</span><span class="sc86">strSensorName</span><span class="sc81"> = </span><span class="sc85">"DeltaP_trace_B"</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
      </span><span class="sc86">dataPoints</span><span class="sc81"> = </span><span class="sc86">dataPoints_DeltaP_trace_B</span><span class="sc81">

   </span><span class="sc84">ElseIf</span><span class="sc81"> (</span><span class="sc86">strSensorName</span><span class="sc81"> = </span><span class="sc85">"TempAvg"</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
      </span><span class="sc86">dataPoints</span><span class="sc81"> = </span><span class="sc86">dataPoints_TempAvg</span><span class="sc81">
   </span><span class="sc84">ElseIf</span><span class="sc81"> (</span><span class="sc86">strSensorName</span><span class="sc81"> = </span><span class="sc85">"TempMax"</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
      </span><span class="sc86">dataPoints</span><span class="sc81"> = </span><span class="sc86">dataPoints_TempMax</span><span class="sc81">
   </span><span class="sc84">ElseIf</span><span class="sc81"> (</span><span class="sc86">strSensorName</span><span class="sc81"> = </span><span class="sc85">"TempMin"</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
      </span><span class="sc86">dataPoints</span><span class="sc81"> = </span><span class="sc86">dataPoints_TempMin</span><span class="sc81">
   </span><span class="sc84">ElseIf</span><span class="sc81"> (</span><span class="sc86">strSensorName</span><span class="sc81"> = </span><span class="sc85">"DewPoint"</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
      </span><span class="sc86">dataPoints</span><span class="sc81"> = </span><span class="sc86">dataPoints_DewPoint</span><span class="sc81">
   </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">

   </span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">IsArray</span><span class="sc81">(</span><span class="sc86">dataPoints</span><span class="sc81">)) </span><span class="sc84">Then</span><span class="sc81"> 
      </span><span class="sc86">pointCount</span><span class="sc81"> = </span><span class="sc86">UBound</span><span class="sc81">(</span><span class="sc86">dataPoints</span><span class="sc81">)
      </span><span class="sc86">dicTraceIO.Item</span><span class="sc81">(</span><span class="sc85">"FoundData"</span><span class="sc81">) = </span><span class="sc84">True</span><span class="sc81">
      </span><span class="sc86">dicTraceIO.Item</span><span class="sc81">(</span><span class="sc85">"FoundData_ForThisTrace"</span><span class="sc81">) = </span><span class="sc84">True</span><span class="sc81">
   </span><span class="sc84">Else</span><span class="sc81"> 
      </span><span class="sc86">dicTraceIO.Item</span><span class="sc81">(</span><span class="sc85">"FoundData_ForThisTrace"</span><span class="sc81">) = </span><span class="sc84">False</span><span class="sc81">
      </span><span class="sc84">Exit</span><span class="sc81"> </span><span class="sc84">Sub</span><span class="sc81">
   </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">
   
   </span><span class="sc84">If</span><span class="sc81"> </span><span class="sc86">intSeriesType</span><span class="sc81"> = </span><span class="sc83">6</span><span class="sc81"> </span><span class="sc84">Then</span><span class="sc81">
      </span><span class="sc86">intGray</span><span class="sc81"> = </span><span class="sc83">200</span><span class="sc81">
      </span><span class="sc86">intYesterdayColor</span><span class="sc81"> = </span><span class="sc86">RGB</span><span class="sc81">(</span><span class="sc86">intGray</span><span class="sc81">,</span><span class="sc86">intGray</span><span class="sc81">,</span><span class="sc86">intGray</span><span class="sc81">)
   </span><span class="sc84">Else</span><span class="sc81">
      </span><span class="sc86">intYesterdayColor</span><span class="sc81"> = </span><span class="sc86">intColor</span><span class="sc81">
   </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">
   
   </span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">intDays</span><span class="sc81"> = </span><span class="sc83">1</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
      </span><span class="sc82">' Use the dataPoints array instead of directly accessing the recordset</span><span class="sc81">
      </span><span class="sc84">Dim</span><span class="sc81"> </span><span class="sc86">yesterdayPoints</span><span class="sc81">, </span><span class="sc86">todayPoints</span><span class="sc81">
      </span><span class="sc84">Dim</span><span class="sc81"> </span><span class="sc86">yesterdayCount</span><span class="sc81">, </span><span class="sc86">todayCount</span><span class="sc81">
      
      </span><span class="sc82">' Initialize counters and arrays</span><span class="sc81">
      </span><span class="sc86">yesterdayCount</span><span class="sc81"> = </span><span class="sc83">0</span><span class="sc81">
      </span><span class="sc86">todayCount</span><span class="sc81"> = </span><span class="sc83">0</span><span class="sc81">
      
      </span><span class="sc84">ReDim</span><span class="sc81"> </span><span class="sc86">yesterdayPoints</span><span class="sc81">(</span><span class="sc86">pointCount</span><span class="sc81">)
      </span><span class="sc84">ReDim</span><span class="sc81"> </span><span class="sc86">todayPoints</span><span class="sc81">(</span><span class="sc86">pointCount</span><span class="sc81">)
      
      </span><span class="sc82">' Loop through all data points and separate into yesterday and today (before and after midnight)</span><span class="sc81">
      </span><span class="sc84">For</span><span class="sc81"> </span><span class="sc86">i</span><span class="sc81"> = </span><span class="sc83">0</span><span class="sc81"> </span><span class="sc84">To</span><span class="sc81"> </span><span class="sc86">pointCount</span><span class="sc81">
         </span><span class="sc86">dblXValue</span><span class="sc81"> = </span><span class="sc86">dataPoints</span><span class="sc81">(</span><span class="sc86">i</span><span class="sc81">)(</span><span class="sc83">0</span><span class="sc81">)
         </span><span class="sc86">dblYValue</span><span class="sc81"> = </span><span class="sc86">dataPoints</span><span class="sc81">(</span><span class="sc86">i</span><span class="sc81">)(</span><span class="sc83">1</span><span class="sc81">)
         
         </span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">dblXValue</span><span class="sc81"> &lt; </span><span class="sc83">0.0</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
            </span><span class="sc82">' This is yesterday's data</span><span class="sc81">
            </span><span class="sc82">' Add 1.0 to the x value to move yesterday's points onto today's plot</span><span class="sc81">
            </span><span class="sc86">dblXValue</span><span class="sc81"> = </span><span class="sc86">dblXValue</span><span class="sc81"> + </span><span class="sc83">1.0</span><span class="sc81">
            </span><span class="sc86">yesterdayPoints</span><span class="sc81">(</span><span class="sc86">yesterdayCount</span><span class="sc81">) = </span><span class="sc86">Array</span><span class="sc81">(</span><span class="sc86">dblXValue</span><span class="sc81">, </span><span class="sc86">dblYValue</span><span class="sc81">, </span><span class="sc85">""</span><span class="sc81">, </span><span class="sc86">intYesterdayColor</span><span class="sc81">)
            </span><span class="sc86">yesterdayCount</span><span class="sc81"> = </span><span class="sc86">yesterdayCount</span><span class="sc81"> + </span><span class="sc83">1</span><span class="sc81">
            
         </span><span class="sc84">Else</span><span class="sc81">
            </span><span class="sc82">' This is today's data</span><span class="sc81">
            </span><span class="sc86">todayPoints</span><span class="sc81">(</span><span class="sc86">todayCount</span><span class="sc81">) = </span><span class="sc86">Array</span><span class="sc81">(</span><span class="sc86">dblXValue</span><span class="sc81">, </span><span class="sc86">dblYValue</span><span class="sc81">, </span><span class="sc85">""</span><span class="sc81">, </span><span class="sc86">intColor</span><span class="sc81">)
            </span><span class="sc86">todayCount</span><span class="sc81"> = </span><span class="sc86">todayCount</span><span class="sc81"> + </span><span class="sc83">1</span><span class="sc81">
         </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">
      </span><span class="sc84">Next</span><span class="sc81">

      </span><span class="sc82">' Resize arrays to actual counts</span><span class="sc81">
      </span><span class="sc84">If</span><span class="sc81"> </span><span class="sc86">yesterdayCount</span><span class="sc81"> &gt; </span><span class="sc83">0</span><span class="sc81"> </span><span class="sc84">Then</span><span class="sc81">
         </span><span class="sc84">ReDim</span><span class="sc81"> </span><span class="sc84">Preserve</span><span class="sc81"> </span><span class="sc86">yesterdayPoints</span><span class="sc81">(</span><span class="sc86">yesterdayCount</span><span class="sc81"> - </span><span class="sc83">1</span><span class="sc81">)
      </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">
      
      </span><span class="sc84">If</span><span class="sc81"> </span><span class="sc86">todayCount</span><span class="sc81"> &gt; </span><span class="sc83">0</span><span class="sc81"> </span><span class="sc84">Then</span><span class="sc81">
         </span><span class="sc84">ReDim</span><span class="sc81"> </span><span class="sc84">Preserve</span><span class="sc81"> </span><span class="sc86">todayPoints</span><span class="sc81">(</span><span class="sc86">todayCount</span><span class="sc81"> - </span><span class="sc83">1</span><span class="sc81">)
      </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">
      
      </span><span class="sc82">' Plot yesterday's data</span><span class="sc81">
      </span><span class="sc86">Chart.AddSeries</span><span class="sc81">(</span><span class="sc86">intSeriesType</span><span class="sc81">)
      </span><span class="sc86">Chart.SeriesInLegend</span><span class="sc81"> = </span><span class="sc84">False</span><span class="sc81">
      </span><span class="sc86">Chart.linewidth</span><span class="sc81"> = </span><span class="sc83">1</span><span class="sc81">      
      </span><span class="sc86">Chart.AddXYArray</span><span class="sc81"> </span><span class="sc86">yesterdayPoints</span><span class="sc81">

      </span><span class="sc82">' Plot today's data</span><span class="sc81">
      </span><span class="sc86">Chart.AddSeries</span><span class="sc81">(</span><span class="sc86">intSeriesType</span><span class="sc81">)
      </span><span class="sc86">Chart.linewidth</span><span class="sc81"> = </span><span class="sc86">intLineWidth</span><span class="sc81">
      </span><span class="sc86">Chart.SeriesTitle</span><span class="sc81"> = </span><span class="sc86">strSeriesTitle</span><span class="sc81">
      </span><span class="sc86">Chart.AddXYArray</span><span class="sc81"> </span><span class="sc86">todayPoints</span><span class="sc81">
   
   </span><span class="sc84">Else</span><span class="sc81">
      </span><span class="sc82">' Multi-day chart</span><span class="sc81">
      </span><span class="sc86">Chart.AddSeries</span><span class="sc81">( </span><span class="sc86">intSeriesType</span><span class="sc81">)
      </span><span class="sc86">Chart.linewidth</span><span class="sc81"> = </span><span class="sc86">intLineWidth</span><span class="sc81">
      </span><span class="sc86">Chart.SeriesTitle</span><span class="sc81"> = </span><span class="sc86">strSeriesTitle</span><span class="sc81">
      </span><span class="sc86">Chart.AddXYArray</span><span class="sc81"> </span><span class="sc86">dataPoints</span><span class="sc81">

   </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">
</span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">Sub</span><span class="sc81">


</span><span class="sc84">Sub</span><span class="sc81"> </span><span class="sc86">Initialize_dicTraceIO</span><span class="sc81">()
   </span><span class="sc82">' Use this to facilitate a general ByReference argument to the AddTrace subroutine.</span><span class="sc81">
   </span><span class="sc84">Set</span><span class="sc81"> </span><span class="sc86">dicTraceIO</span><span class="sc81"> = </span><span class="sc86">Server.CreateObject</span><span class="sc81">(</span><span class="sc85">"Scripting.Dictionary"</span><span class="sc81">)
   </span><span class="sc86">dicTraceIO.Add</span><span class="sc81"> </span><span class="sc85">"YMax"</span><span class="sc81">, -</span><span class="sc83">999</span><span class="sc81">
   </span><span class="sc86">dicTraceIO.Add</span><span class="sc81"> </span><span class="sc85">"YMin"</span><span class="sc81">, </span><span class="sc83">999</span><span class="sc81">
   </span><span class="sc86">dicTraceIO.Add</span><span class="sc81"> </span><span class="sc85">"FoundData"</span><span class="sc81">, </span><span class="sc84">False</span><span class="sc81">
   </span><span class="sc86">dicTraceIO.Add</span><span class="sc81"> </span><span class="sc85">"FoundData_ForThisTrace"</span><span class="sc81">, </span><span class="sc84">False</span><span class="sc81">
   </span><span class="sc82">'Used for Delta-P calculations.</span><span class="sc81">
   </span><span class="sc86">dicTraceIO.Add</span><span class="sc81"> </span><span class="sc85">"WestSite"</span><span class="sc81">, </span><span class="sc85">""</span><span class="sc81">
   </span><span class="sc86">dicTraceIO.Add</span><span class="sc81"> </span><span class="sc85">"EastSite"</span><span class="sc81">, </span><span class="sc85">""</span><span class="sc81">
</span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">Sub</span><span class="sc81">


</span><span class="sc84">Sub</span><span class="sc81"> </span><span class="sc86">FetchTheData</span><span class="sc81">()
   </span><span class="sc86">Initialize_dicTraceIO</span><span class="sc81">

   </span><span class="sc82">' Set dteStartDate_forLabels and dteStartDateTime for use in queries and chart labels...</span><span class="sc81">
   </span><span class="sc86">dteStartDate_forLabels</span><span class="sc81"> = </span><span class="sc86">DateAdd</span><span class="sc81">(</span><span class="sc85">"d"</span><span class="sc81">, (</span><span class="sc83">1</span><span class="sc81"> - </span><span class="sc86">intDays</span><span class="sc81">), </span><span class="sc86">dtePostedDate</span><span class="sc81">)
   
   </span><span class="sc82">' The following is a somewhat clumsy way to deal with daylight savings time and </span><span class="sc81">
   </span><span class="sc82">' timezone. Noteworthy here is the way that start and end times are shifted </span><span class="sc81">
   </span><span class="sc82">' back during periods of daylight savings time. This, coupled with the way that </span><span class="sc81">
   </span><span class="sc82">' points are plotted using a decimal day value that is calculated relative to </span><span class="sc81">
   </span><span class="sc82">' the starting point AND using the standard time values that are in the </span><span class="sc81">
   </span><span class="sc82">' database, has the net effect of shifting the standard to DLS values. It's all </span><span class="sc81">
   </span><span class="sc82">' a bit confusing. Not completely sure why I originally did it this way. </span><span class="sc81">
   </span><span class="sc82">' But one advantage is that when aggregating large amounts of data </span><span class="sc81">
   </span><span class="sc82">' (like in the 25 day plot) each data point does not need to be converted. This </span><span class="sc81">
   </span><span class="sc82">' is an efficiency that is probably not noticeable on recent computers (2015), </span><span class="sc81">
   </span><span class="sc82">' but probably was worth considering when I first did this 20-some years ago.</span><span class="sc81">
   
   </span><span class="sc86">dteStartDateTime</span><span class="sc81"> = </span><span class="sc86">DateAdd</span><span class="sc81">(</span><span class="sc85">"d"</span><span class="sc81">, (</span><span class="sc83">1</span><span class="sc81"> - </span><span class="sc86">intDays</span><span class="sc81">), </span><span class="sc86">dtePostedDate</span><span class="sc81">)
   </span><span class="sc86">dteEndDateTime</span><span class="sc81"> = </span><span class="sc86">DateAdd</span><span class="sc81">(</span><span class="sc85">"d"</span><span class="sc81">, </span><span class="sc83">1</span><span class="sc81">, </span><span class="sc86">dtePostedDate</span><span class="sc81">)
   </span><span class="sc86">dteNowTime</span><span class="sc81"> = </span><span class="sc86">DateAdd</span><span class="sc81">( </span><span class="sc85">"h"</span><span class="sc81">, </span><span class="sc86">dicTZ.item</span><span class="sc81">(</span><span class="sc86">strTimeZone</span><span class="sc81">), </span><span class="sc86">Now</span><span class="sc81">())
   </span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">blnDayLightSavingsTime</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
      </span><span class="sc86">dteNowTime</span><span class="sc81"> = </span><span class="sc86">DateAdd</span><span class="sc81">(</span><span class="sc85">"h"</span><span class="sc81">, -</span><span class="sc83">1</span><span class="sc81">, </span><span class="sc86">dteNowTime</span><span class="sc81">) 
      </span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">strTimeZone</span><span class="sc81"> &lt;&gt; </span><span class="sc85">"H"</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
         </span><span class="sc86">dteStartDateTime</span><span class="sc81"> = </span><span class="sc86">DateAdd</span><span class="sc81">(</span><span class="sc85">"h"</span><span class="sc81">, -</span><span class="sc83">1</span><span class="sc81">, </span><span class="sc86">dteStartDateTime</span><span class="sc81">)   
         </span><span class="sc86">dteEndDateTime</span><span class="sc81"> = </span><span class="sc86">DateAdd</span><span class="sc81">(</span><span class="sc85">"h"</span><span class="sc81">, -</span><span class="sc83">1</span><span class="sc81">, </span><span class="sc86">dteEndDateTime</span><span class="sc81">) 
      </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">
   </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">
   
   </span><span class="sc82">' Initialize the start time for the queries. This will later get modified for the 24h</span><span class="sc81">
   </span><span class="sc82">' versions of the 1-day charts.</span><span class="sc81">
   </span><span class="sc86">dteStartDateTime_forQuery</span><span class="sc81"> = </span><span class="sc86">dteStartDateTime</span><span class="sc81">

   </span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">left</span><span class="sc81">(</span><span class="sc86">strSensorType</span><span class="sc81">,</span><span class="sc83">4</span><span class="sc81">) = </span><span class="sc85">"Wind"</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
      </span><span class="sc86">dataPoints_WindDirection</span><span class="sc81"> = </span><span class="sc86">CollectTraceData</span><span class="sc81">(</span><span class="sc85">"WindDirection"</span><span class="sc81">, </span><span class="sc86">vbWhite</span><span class="sc81"> ,</span><span class="sc86">dicTraceIO</span><span class="sc81">)
      </span><span class="sc86">dataPoints_WindGust</span><span class="sc81"> = </span><span class="sc86">CollectTraceData</span><span class="sc81">(</span><span class="sc85">"WindGust"</span><span class="sc81">, </span><span class="sc86">RGB</span><span class="sc81">(&amp;</span><span class="sc86">h00</span><span class="sc81">,&amp;</span><span class="sc86">h80</span><span class="sc81">,&amp;</span><span class="sc86">h80</span><span class="sc81">), </span><span class="sc86">dicTraceIO</span><span class="sc81">)
      </span><span class="sc86">dataPoints_WindSpeed</span><span class="sc81"> = </span><span class="sc86">CollectTraceData</span><span class="sc81">(</span><span class="sc85">"WindSpeed"</span><span class="sc81">, </span><span class="sc86">vbRed</span><span class="sc81">, </span><span class="sc86">dicTraceIO</span><span class="sc81">)

   </span><span class="sc84">ElseIf</span><span class="sc81"> (</span><span class="sc86">strSensorType</span><span class="sc81"> = </span><span class="sc85">"Temperature"</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
      </span><span class="sc86">dataPoints_TempAvg</span><span class="sc81"> = </span><span class="sc86">CollectTraceData</span><span class="sc81">(</span><span class="sc85">"TempAvg"</span><span class="sc81">, </span><span class="sc86">vbRed</span><span class="sc81">, </span><span class="sc86">dicTraceIO</span><span class="sc81">)
      </span><span class="sc86">dataPoints_TempMax</span><span class="sc81"> = </span><span class="sc86">CollectTraceData</span><span class="sc81">(</span><span class="sc85">"TempMax"</span><span class="sc81">, </span><span class="sc86">vbBlack</span><span class="sc81">, </span><span class="sc86">dicTraceIO</span><span class="sc81">)
      </span><span class="sc86">dataPoints_TempMin</span><span class="sc81"> = </span><span class="sc86">CollectTraceData</span><span class="sc81">(</span><span class="sc85">"TempMin"</span><span class="sc81">, </span><span class="sc86">vbBlack</span><span class="sc81">, </span><span class="sc86">dicTraceIO</span><span class="sc81">)
      </span><span class="sc86">dataPoints_DewPoint</span><span class="sc81"> = </span><span class="sc86">CollectTraceData</span><span class="sc81">(</span><span class="sc85">"DewPoint"</span><span class="sc81">, </span><span class="sc86">RGB</span><span class="sc81">(&amp;</span><span class="sc86">h00</span><span class="sc81">,&amp;</span><span class="sc86">h80</span><span class="sc81">,&amp;</span><span class="sc86">h80</span><span class="sc81">), </span><span class="sc86">dicTraceIO</span><span class="sc81">)

   </span><span class="sc84">ElseIf</span><span class="sc81"> (</span><span class="sc86">strSensorType</span><span class="sc81"> = </span><span class="sc85">"Pressure"</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
      </span><span class="sc86">dataPoints_Pressure</span><span class="sc81"> = </span><span class="sc86">CollectTraceData</span><span class="sc81">(</span><span class="sc85">"Pressure"</span><span class="sc81">, </span><span class="sc86">vbRed</span><span class="sc81">, </span><span class="sc86">dicTraceIO</span><span class="sc81">)

   </span><span class="sc84">ElseIf</span><span class="sc81"> (</span><span class="sc86">strSensorType</span><span class="sc81"> = </span><span class="sc85">"DeltaP1"</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
      </span><span class="sc86">dicTraceIO</span><span class="sc81">(</span><span class="sc85">"WestSite"</span><span class="sc81">) = </span><span class="sc85">"PORTLAND"</span><span class="sc81">
      </span><span class="sc86">dicTraceIO</span><span class="sc81">(</span><span class="sc85">"EastSite"</span><span class="sc81">) = </span><span class="sc85">"THE DALLES"</span><span class="sc81">
      </span><span class="sc86">dataPoints_DeltaP_trace_A</span><span class="sc81"> = </span><span class="sc86">CollectTraceData</span><span class="sc81">(</span><span class="sc85">"DeltaP"</span><span class="sc81">, </span><span class="sc86">RGB</span><span class="sc81">(&amp;</span><span class="sc86">h00</span><span class="sc81">,&amp;</span><span class="sc86">h80</span><span class="sc81">,&amp;</span><span class="sc86">h80</span><span class="sc81">), </span><span class="sc86">dicTraceIO</span><span class="sc81">)
      
      </span><span class="sc86">dicTraceIO</span><span class="sc81">(</span><span class="sc85">"WestSite"</span><span class="sc81">) = </span><span class="sc85">"THE DALLES"</span><span class="sc81">
      </span><span class="sc86">dicTraceIO</span><span class="sc81">(</span><span class="sc85">"EastSite"</span><span class="sc81">) = </span><span class="sc85">"PASCO"</span><span class="sc81">
      </span><span class="sc86">dataPoints_DeltaP_trace_B</span><span class="sc81"> = </span><span class="sc86">CollectTraceData</span><span class="sc81">(</span><span class="sc85">"DeltaP"</span><span class="sc81">, </span><span class="sc86">vbRed</span><span class="sc81">, </span><span class="sc86">dicTraceIO</span><span class="sc81">)

   </span><span class="sc84">ElseIf</span><span class="sc81"> (</span><span class="sc86">strSensorType</span><span class="sc81"> = </span><span class="sc85">"DeltaP2"</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
      </span><span class="sc86">dicTraceIO</span><span class="sc81">(</span><span class="sc85">"WestSite"</span><span class="sc81">) = </span><span class="sc85">"KTTD"</span><span class="sc81">
      </span><span class="sc86">dicTraceIO</span><span class="sc81">(</span><span class="sc85">"EastSite"</span><span class="sc81">) = </span><span class="sc85">"KDLS"</span><span class="sc81">
      </span><span class="sc86">dataPoints_DeltaP_trace_A</span><span class="sc81"> = </span><span class="sc86">CollectTraceData</span><span class="sc81">(</span><span class="sc85">"DeltaP"</span><span class="sc81">, </span><span class="sc86">RGB</span><span class="sc81">(&amp;</span><span class="sc86">h00</span><span class="sc81">,&amp;</span><span class="sc86">h80</span><span class="sc81">,&amp;</span><span class="sc86">h80</span><span class="sc81">), </span><span class="sc86">dicTraceIO</span><span class="sc81">)
      
      </span><span class="sc86">dicTraceIO</span><span class="sc81">(</span><span class="sc85">"WestSite"</span><span class="sc81">) = </span><span class="sc85">"KDLS"</span><span class="sc81">
      </span><span class="sc86">dicTraceIO</span><span class="sc81">(</span><span class="sc85">"EastSite"</span><span class="sc81">) = </span><span class="sc85">"KHRI"</span><span class="sc81">
      </span><span class="sc86">dataPoints_DeltaP_trace_B</span><span class="sc81"> = </span><span class="sc86">CollectTraceData</span><span class="sc81">(</span><span class="sc85">"DeltaP"</span><span class="sc81">, </span><span class="sc86">vbRed</span><span class="sc81">, </span><span class="sc86">dicTraceIO</span><span class="sc81">)

   </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">
</span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">Sub</span><span class="sc81">


</span><span class="sc84">Sub</span><span class="sc81"> </span><span class="sc86">PlotTheChart</span><span class="sc81">()
   </span><span class="sc82">' Set the ContentType</span><span class="sc81">
   </span><span class="sc82">'Response.ContentType = "image/JPEG"</span><span class="sc81">

   </span><span class="sc82">' Instantiate the Chart component</span><span class="sc81">
   </span><span class="sc84">Set</span><span class="sc81"> </span><span class="sc86">Chart</span><span class="sc81"> = </span><span class="sc86">Server.CreateObject</span><span class="sc81"> (</span><span class="sc85">"ASPChart.Chart"</span><span class="sc81">)
   </span><span class="sc86">Chart.JPEGQuality</span><span class="sc81"> = </span><span class="sc83">90</span><span class="sc81"> </span><span class="sc82">'80</span><span class="sc81">

   </span><span class="sc84">Dim</span><span class="sc81"> </span><span class="sc86">dblTraceArray</span><span class="sc81">, </span><span class="sc86">intTraceArray_index</span><span class="sc81">, </span><span class="sc86">directAxisScale</span><span class="sc81">
   
   </span><span class="sc82">' Add a separate (pseudo) trace to do the x-axis labeling.  Shift the y</span><span class="sc81">
   </span><span class="sc82">' value by negative 200 so the points don't show on the plot. Also prevent</span><span class="sc81">
   </span><span class="sc82">' it from showing in the legend.</span><span class="sc81">
   </span><span class="sc82">'</span><span class="sc81">
   </span><span class="sc82">' Have tried more direct methods of charting the labels as part of the data</span><span class="sc81">
   </span><span class="sc82">' traces but always ran into problems.  This somewhat indirect (but</span><span class="sc81">
   </span><span class="sc82">' successful) method, offers more control and is general for any numeric</span><span class="sc81">
   </span><span class="sc82">' based x axis.</span><span class="sc81">

   </span><span class="sc86">Chart.AddSeries</span><span class="sc81"> (</span><span class="sc83">5</span><span class="sc81">)
   </span><span class="sc86">Chart.linewidth</span><span class="sc81"> = </span><span class="sc83">0</span><span class="sc81">
   </span><span class="sc86">Chart.SeriesTitle</span><span class="sc81"> = </span><span class="sc85">" "</span><span class="sc81">
   </span><span class="sc86">Chart.SeriesInLegend</span><span class="sc81"> = </span><span class="sc84">False</span><span class="sc81">   
   
   </span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">intDays</span><span class="sc81"> = </span><span class="sc83">1</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
      </span><span class="sc86">TimeLabels</span><span class="sc81"> = </span><span class="sc86">Array</span><span class="sc81">(</span><span class="sc85">"12m"</span><span class="sc81">,</span><span class="sc85">"1"</span><span class="sc81">,</span><span class="sc85">"2"</span><span class="sc81">,</span><span class="sc85">"3"</span><span class="sc81">,</span><span class="sc85">"4"</span><span class="sc81">,</span><span class="sc85">"5"</span><span class="sc81">,</span><span class="sc85">"6am"</span><span class="sc81">,</span><span class="sc85">"7"</span><span class="sc81">,</span><span class="sc85">"8"</span><span class="sc81">,</span><span class="sc85">"9"</span><span class="sc81">,</span><span class="sc85">"10"</span><span class="sc81">,</span><span class="sc85">"11"</span><span class="sc81">,</span><span class="sc85">"12n"</span><span class="sc81">,</span><span class="sc85">"1"</span><span class="sc81">,</span><span class="sc85">"2"</span><span class="sc81">,</span><span class="sc85">"3"</span><span class="sc81">,</span><span class="sc85">"4"</span><span class="sc81">,</span><span class="sc85">"5"</span><span class="sc81">,</span><span class="sc85">"6pm"</span><span class="sc81">,</span><span class="sc85">"7"</span><span class="sc81">,</span><span class="sc85">"8"</span><span class="sc81">,</span><span class="sc85">"9"</span><span class="sc81">,</span><span class="sc85">"10"</span><span class="sc81">,</span><span class="sc85">"11"</span><span class="sc81">,</span><span class="sc85">"12m"</span><span class="sc81">)

      </span><span class="sc84">For</span><span class="sc81"> </span><span class="sc86">intHour</span><span class="sc81"> = </span><span class="sc83">0</span><span class="sc81"> </span><span class="sc84">to</span><span class="sc81"> </span><span class="sc83">24</span><span class="sc81">
         </span><span class="sc82">' The key difference in this dummy trace is that it has a parameter</span><span class="sc81">
         </span><span class="sc82">' for the label.  All the data traces below have an empty string in</span><span class="sc81">
         </span><span class="sc82">' that position.</span><span class="sc81">

         </span><span class="sc86">MyChartAddXY</span><span class="sc81"> (</span><span class="sc84">CDbl</span><span class="sc81">(</span><span class="sc86">intHour</span><span class="sc81">)/</span><span class="sc83">24.0</span><span class="sc81">), </span><span class="sc83">0</span><span class="sc81"> - </span><span class="sc83">200</span><span class="sc81">, </span><span class="sc86">TimeLabels</span><span class="sc81">(</span><span class="sc86">intHour</span><span class="sc81">), </span><span class="sc86">vbWhite</span><span class="sc81">   
      </span><span class="sc84">Next</span><span class="sc81">
      
   </span><span class="sc84">Else</span><span class="sc81">      
      </span><span class="sc82">' Make a special label trace (dummy) for multiple-day charts...</span><span class="sc81">
      
      </span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">intDays</span><span class="sc81"> &gt;= </span><span class="sc83">2</span><span class="sc81">) </span><span class="sc84">AND</span><span class="sc81"> (</span><span class="sc86">intDays</span><span class="sc81"> &lt;= </span><span class="sc83">4</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
         </span><span class="sc86">intLabelsPerDay</span><span class="sc81"> = </span><span class="sc83">4</span><span class="sc81">
      </span><span class="sc84">ElseIf</span><span class="sc81"> (</span><span class="sc86">intDays</span><span class="sc81"> &gt;= </span><span class="sc83">5</span><span class="sc81">) </span><span class="sc84">AND</span><span class="sc81"> (</span><span class="sc86">intDays</span><span class="sc81"> &lt;= </span><span class="sc83">9</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
         </span><span class="sc86">intLabelsPerDay</span><span class="sc81"> = </span><span class="sc83">2</span><span class="sc81">
      </span><span class="sc84">ElseIf</span><span class="sc81"> (</span><span class="sc86">intDays</span><span class="sc81"> &gt;= </span><span class="sc83">10</span><span class="sc81">) </span><span class="sc84">AND</span><span class="sc81"> (</span><span class="sc86">intDays</span><span class="sc81"> &lt;= </span><span class="sc83">25</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
         </span><span class="sc86">intLabelsPerDay</span><span class="sc81"> = </span><span class="sc83">1</span><span class="sc81">
      </span><span class="sc84">Else</span><span class="sc81">
         </span><span class="sc82">' Shouldn't be able to get here...</span><span class="sc81">
      </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">      

      </span><span class="sc86">intXLabels</span><span class="sc81"> = (</span><span class="sc86">intDays</span><span class="sc81"> * </span><span class="sc86">intLabelsPerDay</span><span class="sc81">) + </span><span class="sc83">1</span><span class="sc81">
      </span><span class="sc82">' Dim the dynamic array...</span><span class="sc81">
      </span><span class="sc84">ReDim</span><span class="sc81"> </span><span class="sc86">strTimeLabels</span><span class="sc81">(</span><span class="sc86">intXLabels</span><span class="sc81">)
      </span><span class="sc86">dblDaysIncrement</span><span class="sc81"> = </span><span class="sc83">1</span><span class="sc81"> / </span><span class="sc86">intLabelsPerDay</span><span class="sc81">
         
      </span><span class="sc84">For</span><span class="sc81"> </span><span class="sc86">intJ</span><span class="sc81"> = </span><span class="sc83">0</span><span class="sc81"> </span><span class="sc84">To</span><span class="sc81"> </span><span class="sc86">intXLabels</span><span class="sc81"> - </span><span class="sc83">1</span><span class="sc81">
         </span><span class="sc86">dblDaysFraction</span><span class="sc81"> = </span><span class="sc86">intJ</span><span class="sc81"> * </span><span class="sc86">dblDaysIncrement</span><span class="sc81">
         
         </span><span class="sc82">' Put a Day label on the integer values (midnight)...</span><span class="sc81">
         </span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">dblDaysFraction</span><span class="sc81"> = </span><span class="sc86">Int</span><span class="sc81">(</span><span class="sc86">dblDaysFraction</span><span class="sc81">)) </span><span class="sc84">Then</span><span class="sc81">
            </span><span class="sc86">dteLabelDate</span><span class="sc81"> = </span><span class="sc86">DateAdd</span><span class="sc81">(</span><span class="sc85">"d"</span><span class="sc81">, </span><span class="sc86">Int</span><span class="sc81">(</span><span class="sc86">dblDaysFraction</span><span class="sc81">), </span><span class="sc86">dteStartDate_forLabels</span><span class="sc81">)
            </span><span class="sc86">strTimeLabels</span><span class="sc81">(</span><span class="sc86">intJ</span><span class="sc81">) = </span><span class="sc86">Left</span><span class="sc81">(</span><span class="sc86">WeekDayName</span><span class="sc81">(</span><span class="sc86">WeekDay</span><span class="sc81">(</span><span class="sc86">dteLabelDate</span><span class="sc81">), </span><span class="sc84">True</span><span class="sc81">),</span><span class="sc83">2</span><span class="sc81">) &amp; </span><span class="sc85">"-"</span><span class="sc81"> &amp; </span><span class="sc86">Day</span><span class="sc81">(</span><span class="sc86">dteLabelDate</span><span class="sc81">)
         </span><span class="sc84">Else</span><span class="sc81">
            </span><span class="sc86">dblFractionalPart</span><span class="sc81"> = </span><span class="sc86">dblDaysFraction</span><span class="sc81"> - </span><span class="sc86">Int</span><span class="sc81">(</span><span class="sc86">dblDaysFraction</span><span class="sc81">)
            </span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">dblFractionalPart</span><span class="sc81"> = </span><span class="sc83">0.50</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
               </span><span class="sc82">' Suppress the 12n marks for 7 though 9.</span><span class="sc81">
               </span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">intDays</span><span class="sc81"> &lt;= </span><span class="sc83">6</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
                  </span><span class="sc86">strTimeLabels</span><span class="sc81">(</span><span class="sc86">intJ</span><span class="sc81">) = </span><span class="sc85">"12n"</span><span class="sc81">
               </span><span class="sc84">Else</span><span class="sc81">
                  </span><span class="sc86">strTimeLabels</span><span class="sc81">(</span><span class="sc86">intJ</span><span class="sc81">) = </span><span class="sc85">""</span><span class="sc81">
               </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">
            </span><span class="sc84">Else</span><span class="sc81">
               </span><span class="sc86">strTimeLabels</span><span class="sc81">(</span><span class="sc86">intJ</span><span class="sc81">) = </span><span class="sc85">""</span><span class="sc81"> </span><span class="sc82">'CStr(dblDaysFraction)</span><span class="sc81">
            </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">      
         </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">
      </span><span class="sc84">Next</span><span class="sc81">

      </span><span class="sc82">' Plot the pseudo trace....         </span><span class="sc81">
      </span><span class="sc84">For</span><span class="sc81"> </span><span class="sc86">intJ</span><span class="sc81"> = </span><span class="sc83">0</span><span class="sc81"> </span><span class="sc84">To</span><span class="sc81"> </span><span class="sc86">intXLabels</span><span class="sc81"> - </span><span class="sc83">1</span><span class="sc81">
         </span><span class="sc82">' The key difference in this pseudo trace is that it has a parameter</span><span class="sc81">
         </span><span class="sc82">' for the label. All the data traces below have an empty string in</span><span class="sc81">
         </span><span class="sc82">' that position.</span><span class="sc81">

         </span><span class="sc86">MyChartAddXY</span><span class="sc81"> </span><span class="sc86">intJ</span><span class="sc81"> * </span><span class="sc86">dblDaysIncrement</span><span class="sc81">, </span><span class="sc83">0</span><span class="sc81"> - </span><span class="sc83">200</span><span class="sc81">, </span><span class="sc86">strTimeLabels</span><span class="sc81">(</span><span class="sc86">intJ</span><span class="sc81">), </span><span class="sc86">vbWhite</span><span class="sc81">   
      </span><span class="sc84">Next</span><span class="sc81">      

   </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">

   </span><span class="sc82">'===============================================================================</span><span class="sc81">
   </span><span class="sc82">' Add trace(s) depending on the sensor or plot type...</span><span class="sc81">
   </span><span class="sc82">'===============================================================================  </span><span class="sc81">
   
   </span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">left</span><span class="sc81">(</span><span class="sc86">strSensorType</span><span class="sc81">,</span><span class="sc83">4</span><span class="sc81">) = </span><span class="sc85">"Wind"</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
   
      </span><span class="sc86">intGray</span><span class="sc81"> = </span><span class="sc83">175</span><span class="sc81">
      
      </span><span class="sc82">' Make horizontal lines for the compass points. Do this before adding the</span><span class="sc81">
      </span><span class="sc82">' trace lines so data points will lay on top of this reference lines.</span><span class="sc81">
       
      </span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">strSensorType</span><span class="sc81"> = </span><span class="sc85">"Wind36"</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
         </span><span class="sc86">AddHorizontalLine_gray</span><span class="sc81"> </span><span class="sc83">1</span><span class="sc81">, </span><span class="sc86">intGray</span><span class="sc81">,  </span><span class="sc83">45</span><span class="sc81"> * </span><span class="sc86">dblWindNormFactor</span><span class="sc81">
         </span><span class="sc86">AddHorizontalLine_gray</span><span class="sc81"> </span><span class="sc83">1</span><span class="sc81">, </span><span class="sc86">intGray</span><span class="sc81">, </span><span class="sc83">135</span><span class="sc81"> * </span><span class="sc86">dblWindNormFactor</span><span class="sc81">
         </span><span class="sc86">AddHorizontalLine_gray</span><span class="sc81"> </span><span class="sc83">1</span><span class="sc81">, </span><span class="sc86">intGray</span><span class="sc81">, </span><span class="sc83">225</span><span class="sc81"> * </span><span class="sc86">dblWindNormFactor</span><span class="sc81">
         </span><span class="sc86">AddHorizontalLine_gray</span><span class="sc81"> </span><span class="sc83">1</span><span class="sc81">, </span><span class="sc86">intGray</span><span class="sc81">, </span><span class="sc83">315</span><span class="sc81"> * </span><span class="sc86">dblWindNormFactor</span><span class="sc81">
      </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">
     
      </span><span class="sc82">' These are common to both Wind40 and Wind36</span><span class="sc81">
      </span><span class="sc86">AddHorizontalLine_gray</span><span class="sc81"> </span><span class="sc83">1</span><span class="sc81">, </span><span class="sc86">intGray</span><span class="sc81">,   </span><span class="sc83">0</span><span class="sc81"> * </span><span class="sc86">dblWindNormFactor</span><span class="sc81">
      </span><span class="sc86">AddHorizontalLine_gray</span><span class="sc81"> </span><span class="sc83">1</span><span class="sc81">, </span><span class="sc86">intGray</span><span class="sc81">,  </span><span class="sc83">90</span><span class="sc81"> * </span><span class="sc86">dblWindNormFactor</span><span class="sc81">
      </span><span class="sc86">AddHorizontalLine_gray</span><span class="sc81"> </span><span class="sc83">1</span><span class="sc81">, </span><span class="sc86">intGray</span><span class="sc81">, </span><span class="sc83">180</span><span class="sc81"> * </span><span class="sc86">dblWindNormFactor</span><span class="sc81">
      </span><span class="sc86">AddHorizontalLine_gray</span><span class="sc81"> </span><span class="sc83">1</span><span class="sc81">, </span><span class="sc86">intGray</span><span class="sc81">, </span><span class="sc83">270</span><span class="sc81"> * </span><span class="sc86">dblWindNormFactor</span><span class="sc81">
      </span><span class="sc86">AddHorizontalLine_gray</span><span class="sc81"> </span><span class="sc83">1</span><span class="sc81">, </span><span class="sc86">intGray</span><span class="sc81">, </span><span class="sc83">360</span><span class="sc81"> * </span><span class="sc86">dblWindNormFactor</span><span class="sc81">
      
      </span><span class="sc86">AddTrace</span><span class="sc81"> </span><span class="sc85">"WindDirection"</span><span class="sc81">, </span><span class="sc83">6</span><span class="sc81">, </span><span class="sc85">"Direction               "</span><span class="sc81">,     </span><span class="sc83">3</span><span class="sc81">, </span><span class="sc86">vbWhite</span><span class="sc81">,             </span><span class="sc86">dicTraceIO</span><span class="sc81">
      </span><span class="sc86">AddTrace</span><span class="sc81"> </span><span class="sc85">"WindGust"</span><span class="sc81">,      </span><span class="sc83">5</span><span class="sc81">, </span><span class="sc85">"Maximum Speed"</span><span class="sc81">,                </span><span class="sc83">2</span><span class="sc81">, </span><span class="sc86">RGB</span><span class="sc81">(&amp;</span><span class="sc86">h00</span><span class="sc81">,&amp;</span><span class="sc86">h80</span><span class="sc81">,&amp;</span><span class="sc86">h80</span><span class="sc81">), </span><span class="sc86">dicTraceIO</span><span class="sc81">     
      </span><span class="sc86">intMaxGust</span><span class="sc81"> = </span><span class="sc86">dicTraceIO.Item</span><span class="sc81">(</span><span class="sc85">"YMax"</span><span class="sc81">)
      </span><span class="sc86">AddTrace</span><span class="sc81"> </span><span class="sc85">"WindSpeed"</span><span class="sc81">,     </span><span class="sc83">5</span><span class="sc81">, </span><span class="sc85">"Average Speed"</span><span class="sc81">,                </span><span class="sc83">2</span><span class="sc81">, </span><span class="sc86">vbRed</span><span class="sc81">,               </span><span class="sc86">dicTraceIO</span><span class="sc81">
      
      </span><span class="sc84">If</span><span class="sc81"> </span><span class="sc86">dicTraceIO.Item</span><span class="sc81">(</span><span class="sc85">"FoundData"</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
      
         </span><span class="sc82">' To be consistent with the other sensor charts, putting these scale</span><span class="sc81">
         </span><span class="sc82">' limits here, after the trace filling calls above.</span><span class="sc81">

         </span><span class="sc86">Chart.VertAxisMin</span><span class="sc81"> = </span><span class="sc83">0.0</span><span class="sc81">  </span><span class="sc82">'-10</span><span class="sc81">
         </span><span class="sc84">If</span><span class="sc81">     (</span><span class="sc86">intMaxGust</span><span class="sc81"> &gt; </span><span class="sc83">40</span><span class="sc81">) </span><span class="sc84">then</span><span class="sc81">
            </span><span class="sc86">Chart.VertAxisMax</span><span class="sc81"> = </span><span class="sc84">CDbl</span><span class="sc81">(</span><span class="sc86">intMaxGust</span><span class="sc81">)
         </span><span class="sc84">Else</span><span class="sc81">
            </span><span class="sc86">Chart.VertAxisMax</span><span class="sc81"> = </span><span class="sc83">40.0</span><span class="sc81">
         </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">
               
         </span><span class="sc86">Chart.AddAxisLabel</span><span class="sc81"> </span><span class="sc83">1</span><span class="sc81">, </span><span class="sc85">"Wind Speed (mph)"</span><span class="sc81">

         </span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">intDays</span><span class="sc81"> &gt; </span><span class="sc83">1</span><span class="sc81">) </span><span class="sc84">then</span><span class="sc81">
            </span><span class="sc86">Chart.ChartTitleAdd</span><span class="sc81">  </span><span class="sc85">" Wind at "</span><span class="sc81"> &amp; </span><span class="sc86">strNameForPlot</span><span class="sc81"> 
            </span><span class="sc86">Chart.HorizAxisMin</span><span class="sc81"> = </span><span class="sc83">0.00</span><span class="sc81">      
         </span><span class="sc84">Else</span><span class="sc81">
            </span><span class="sc86">Chart.ChartTitleAdd</span><span class="sc81">  </span><span class="sc85">" Wind at "</span><span class="sc81"> &amp; </span><span class="sc86">strNameForPlot</span><span class="sc81"> &amp; </span><span class="sc85">" on "</span><span class="sc81"> &amp; </span><span class="sc86">WeekDayName</span><span class="sc81">(</span><span class="sc86">WeekDay</span><span class="sc81">(</span><span class="sc86">dtePostedDate</span><span class="sc81">)) &amp; </span><span class="sc85">" "</span><span class="sc81"> &amp; </span><span class="sc86">dtePostedDate</span><span class="sc81">
            </span><span class="sc86">Chart.HorizAxisMin</span><span class="sc81"> = </span><span class="sc83">0.04</span><span class="sc81">      
         </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">

         </span><span class="sc82">' Use tweak of -4 if there is a carriage return after each image element</span><span class="sc81">
         </span><span class="sc82">' in the div.</span><span class="sc81">
         </span><span class="sc86">intPixelRightShift_tweak</span><span class="sc81"> = -</span><span class="sc83">4</span><span class="sc81">
         </span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">intDays</span><span class="sc81"> &gt;= </span><span class="sc83">10</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
            </span><span class="sc86">Chart.Width</span><span class="sc81"> = </span><span class="sc83">1250</span><span class="sc81"> + </span><span class="sc83">61</span><span class="sc81">  </span><span class="sc82">' The 61 helps to get the days to line up with the temperature chart.</span><span class="sc81">
            </span><span class="sc86">intPixelRightShift</span><span class="sc81"> = -</span><span class="sc83">210</span><span class="sc81"> + </span><span class="sc86">intPixelRightShift_tweak</span><span class="sc81"> - </span><span class="sc83">3</span><span class="sc81">  </span><span class="sc82">' The -3 is a secondary tweak needed after I added the 61 in the line above.</span><span class="sc81">
         </span><span class="sc84">Else</span><span class="sc81">
            </span><span class="sc86">Chart.Width</span><span class="sc81"> = </span><span class="sc83">855</span><span class="sc81">
            </span><span class="sc86">intPixelRightShift</span><span class="sc81"> = -</span><span class="sc83">188</span><span class="sc81"> + </span><span class="sc86">intPixelRightShift_tweak</span><span class="sc81">
         </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">

         </span><span class="sc82">' Set the chart height based on the y-axis maximum value.  Scale up the</span><span class="sc81">
         </span><span class="sc82">' plotting area by the ratio of intMaxGust/40.</span><span class="sc81">

         </span><span class="sc86">intNonPlottingHeight</span><span class="sc81"> =  </span><span class="sc83">75</span><span class="sc81"> 
         </span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">intMaxGust</span><span class="sc81"> &gt; </span><span class="sc83">40</span><span class="sc81">) </span><span class="sc84">then</span><span class="sc81">    
            </span><span class="sc86">Chart.Height</span><span class="sc81"> = ((</span><span class="sc83">500</span><span class="sc81"> - </span><span class="sc86">intNonPlottingHeight</span><span class="sc81">) * (</span><span class="sc86">intMaxGust</span><span class="sc81">/</span><span class="sc83">40</span><span class="sc81">)) + </span><span class="sc86">intNonPlottingHeight</span><span class="sc81">
            </span><span class="sc82">' This gets used in the style-sheet the positions the directions-overlay image.</span><span class="sc81">
            </span><span class="sc86">intPixelBottomShift</span><span class="sc81"> = </span><span class="sc86">Fix</span><span class="sc81">((</span><span class="sc86">intMaxGust</span><span class="sc81"> * </span><span class="sc83">0.320</span><span class="sc81">) - </span><span class="sc83">11</span><span class="sc81">)  </span><span class="sc82">'This is always positive.</span><span class="sc81">
            
         </span><span class="sc84">Else</span><span class="sc81">
            </span><span class="sc86">Chart.Height</span><span class="sc81"> = </span><span class="sc83">500</span><span class="sc81">
            </span><span class="sc86">intPixelBottomShift</span><span class="sc81"> = </span><span class="sc83">0</span><span class="sc81">
         </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">
         
         </span><span class="sc86">Chart.LeftAxisIncrement</span><span class="sc81"> = </span><span class="sc83">5</span><span class="sc81">
      
      </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">

   </span><span class="sc84">ElseIf</span><span class="sc81"> (</span><span class="sc86">strSensorType</span><span class="sc81"> = </span><span class="sc85">"Temperature"</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
         
      </span><span class="sc82">' Do this one first. This one should return data for any type</span><span class="sc81">
      </span><span class="sc82">' of temperature plot. If not, don't try the other parts.</span><span class="sc81">
      </span><span class="sc86">AddTrace</span><span class="sc81"> </span><span class="sc85">"TempAvg"</span><span class="sc81">, </span><span class="sc83">5</span><span class="sc81">, </span><span class="sc85">"Dry Bulb"</span><span class="sc81">, </span><span class="sc83">2</span><span class="sc81">, </span><span class="sc86">vbRed</span><span class="sc81">, </span><span class="sc86">dicTraceIO</span><span class="sc81">  

      </span><span class="sc84">If</span><span class="sc81"> </span><span class="sc86">dicTraceIO.Item</span><span class="sc81">(</span><span class="sc85">"FoundData"</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
         
         </span><span class="sc84">If</span><span class="sc81"> </span><span class="sc86">IsArray</span><span class="sc81">(</span><span class="sc86">dataPoints_TempMin</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
            </span><span class="sc86">AddTrace</span><span class="sc81"> </span><span class="sc85">"TempMin"</span><span class="sc81">, </span><span class="sc83">5</span><span class="sc81">, </span><span class="sc85">"  Min"</span><span class="sc81">, </span><span class="sc83">1</span><span class="sc81">, </span><span class="sc86">vbBlack</span><span class="sc81">, </span><span class="sc86">dicTraceIO</span><span class="sc81">
            </span><span class="sc86">AddTrace</span><span class="sc81"> </span><span class="sc85">"TempMax"</span><span class="sc81">, </span><span class="sc83">5</span><span class="sc81">, </span><span class="sc85">"  Max"</span><span class="sc81">, </span><span class="sc83">1</span><span class="sc81">, </span><span class="sc86">vbBlack</span><span class="sc81">, </span><span class="sc86">dicTraceIO</span><span class="sc81">
         </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">
         
         </span><span class="sc84">If</span><span class="sc81"> </span><span class="sc86">IsArray</span><span class="sc81">(</span><span class="sc86">dataPoints_DewPoint</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
            </span><span class="sc86">AddTrace</span><span class="sc81"> </span><span class="sc85">"DewPoint"</span><span class="sc81">, </span><span class="sc83">5</span><span class="sc81">, </span><span class="sc85">"Dew Point"</span><span class="sc81">, </span><span class="sc83">2</span><span class="sc81">, </span><span class="sc86">RGB</span><span class="sc81">(&amp;</span><span class="sc86">h00</span><span class="sc81">,&amp;</span><span class="sc86">h80</span><span class="sc81">,&amp;</span><span class="sc86">h80</span><span class="sc81">), </span><span class="sc86">dicTraceIO</span><span class="sc81">
         </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">
      
         </span><span class="sc82">' Ongoing (overall) Min and Max values are collected in dicTraceIO as each trace</span><span class="sc81">
         </span><span class="sc82">' generated.</span><span class="sc81">
         </span><span class="sc86">sglTempMin</span><span class="sc81"> = </span><span class="sc86">dicTraceIO</span><span class="sc81">(</span><span class="sc85">"YMin"</span><span class="sc81">)
         </span><span class="sc86">sglTempMax</span><span class="sc81"> = </span><span class="sc86">dicTraceIO</span><span class="sc81">(</span><span class="sc85">"YMax"</span><span class="sc81">)
         </span><span class="sc86">sglTempRange</span><span class="sc81"> = </span><span class="sc86">sglTempMax</span><span class="sc81"> - </span><span class="sc86">sglTempMin</span><span class="sc81">
         
         </span><span class="sc82">' To be consistent with the other sensor charts, putting these scale</span><span class="sc81">
         </span><span class="sc82">' limits here, after the trace filling loop above. But seems to work</span><span class="sc81">
         </span><span class="sc82">' either way here...</span><span class="sc81">

         </span><span class="sc86">intTempDiffScalingThreshold</span><span class="sc81"> = </span><span class="sc83">40</span><span class="sc81">
         </span><span class="sc86">intNonPlottingHeight</span><span class="sc81"> = </span><span class="sc83">108</span><span class="sc81">
         </span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">sglTempRange</span><span class="sc81"> &lt; </span><span class="sc86">intTempDiffScalingThreshold</span><span class="sc81">) </span><span class="sc84">then</span><span class="sc81">
            </span><span class="sc86">Chart.VertAxisMin</span><span class="sc81"> = </span><span class="sc86">sglTempMin</span><span class="sc81"> - ((</span><span class="sc86">intTempDiffScalingThreshold</span><span class="sc81"> - </span><span class="sc86">sglTempRange</span><span class="sc81">)/</span><span class="sc83">2</span><span class="sc81">)
            </span><span class="sc86">Chart.VertAxisMax</span><span class="sc81"> = </span><span class="sc86">sglTempMax</span><span class="sc81"> + ((</span><span class="sc86">intTempDiffScalingThreshold</span><span class="sc81"> - </span><span class="sc86">sglTempRange</span><span class="sc81">)/</span><span class="sc83">2</span><span class="sc81">)
            </span><span class="sc86">Chart.Height</span><span class="sc81"> = </span><span class="sc83">500</span><span class="sc81">
         </span><span class="sc84">Else</span><span class="sc81">
            </span><span class="sc82">' The 0.2 keeps the max and min data from being obscured by the outer</span><span class="sc81">
            </span><span class="sc82">' boundaries of the charting area.</span><span class="sc81">
            </span><span class="sc86">Chart.VertAxisMin</span><span class="sc81"> = </span><span class="sc86">sglTempMin</span><span class="sc81"> - </span><span class="sc83">0.2</span><span class="sc81">     
            </span><span class="sc86">Chart.VertAxisMax</span><span class="sc81"> = </span><span class="sc86">sglTempMax</span><span class="sc81"> + </span><span class="sc83">0.2</span><span class="sc81">
            </span><span class="sc86">Chart.Height</span><span class="sc81"> = ((</span><span class="sc83">500</span><span class="sc81"> - </span><span class="sc86">intNonPlottingHeight</span><span class="sc81">) * (</span><span class="sc86">sglTempRange</span><span class="sc81">/</span><span class="sc86">intTempDiffScalingThreshold</span><span class="sc81">)) + </span><span class="sc86">intNonPlottingHeight</span><span class="sc81">    
         </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">

         </span><span class="sc86">Chart.LeftAxisIncrement</span><span class="sc81"> = </span><span class="sc83">5</span><span class="sc81">
         
         
         </span><span class="sc82">' Y axis label</span><span class="sc81">
         </span><span class="sc86">Chart.AddAxisLabel</span><span class="sc81"> </span><span class="sc83">1</span><span class="sc81">, </span><span class="sc85">"Temperature (F)"</span><span class="sc81">
             
         </span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">intDays</span><span class="sc81"> &gt; </span><span class="sc83">1</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
            </span><span class="sc86">Chart.ChartTitleAdd</span><span class="sc81">  </span><span class="sc85">" Temperature at "</span><span class="sc81"> &amp; </span><span class="sc86">strNameForPlot</span><span class="sc81">
         </span><span class="sc84">Else</span><span class="sc81">
            </span><span class="sc86">Chart.ChartTitleAdd</span><span class="sc81">  </span><span class="sc85">" Temperature at "</span><span class="sc81"> &amp; </span><span class="sc86">strNameForPlot</span><span class="sc81"> &amp; </span><span class="sc85">" on "</span><span class="sc81"> &amp; </span><span class="sc86">WeekDayName</span><span class="sc81">(</span><span class="sc86">WeekDay</span><span class="sc81">(</span><span class="sc86">dtePostedDate</span><span class="sc81">)) &amp; </span><span class="sc85">" "</span><span class="sc81"> &amp; </span><span class="sc86">dtePostedDate</span><span class="sc81">
         </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">    

         </span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">intDays</span><span class="sc81"> &gt;= </span><span class="sc83">10</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
            </span><span class="sc86">Chart.Width</span><span class="sc81"> = </span><span class="sc83">1250</span><span class="sc81">
         </span><span class="sc84">Else</span><span class="sc81">
            </span><span class="sc86">Chart.Width</span><span class="sc81"> = </span><span class="sc83">791</span><span class="sc81">  </span><span class="sc82">'780            </span><span class="sc81">
         </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">

      </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">
      
   </span><span class="sc84">ElseIf</span><span class="sc81"> (</span><span class="sc86">strSensorType</span><span class="sc81"> = </span><span class="sc85">"Pressure"</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">

      </span><span class="sc86">AddTrace</span><span class="sc81"> </span><span class="sc85">"Pressure"</span><span class="sc81">, </span><span class="sc83">5</span><span class="sc81">, </span><span class="sc85">"no trace label"</span><span class="sc81">, </span><span class="sc83">2</span><span class="sc81">, </span><span class="sc86">vbRed</span><span class="sc81">, </span><span class="sc86">dicTraceIO</span><span class="sc81">
      
      </span><span class="sc84">If</span><span class="sc81"> </span><span class="sc86">dicTraceIO.Item</span><span class="sc81">(</span><span class="sc85">"FoundData"</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
      
         </span><span class="sc86">Chart.SeriesInLegend</span><span class="sc81"> = </span><span class="sc84">False</span><span class="sc81">
         </span><span class="sc86">sglPressureMin</span><span class="sc81"> = </span><span class="sc86">dicTraceIO.Item</span><span class="sc81">(</span><span class="sc85">"YMin"</span><span class="sc81">)
         </span><span class="sc86">sglPressureMax</span><span class="sc81"> = </span><span class="sc86">dicTraceIO.Item</span><span class="sc81">(</span><span class="sc85">"YMax"</span><span class="sc81">)
         
         </span><span class="sc86">Chart.AddAxisLabel</span><span class="sc81"> </span><span class="sc83">1</span><span class="sc81">, </span><span class="sc85">"Pressure (Inches Hg)"</span><span class="sc81">
                  
         </span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">intDays</span><span class="sc81"> &gt; </span><span class="sc83">1</span><span class="sc81">) </span><span class="sc84">then</span><span class="sc81">
            </span><span class="sc86">Chart.ChartTitleAdd</span><span class="sc81">  </span><span class="sc85">" Barometer at "</span><span class="sc81"> &amp; </span><span class="sc86">strNameForPlot</span><span class="sc81">
         </span><span class="sc84">Else</span><span class="sc81">
            </span><span class="sc86">Chart.ChartTitleAdd</span><span class="sc81">  </span><span class="sc85">" Barometer at "</span><span class="sc81"> &amp; </span><span class="sc86">strNameForPlot</span><span class="sc81"> &amp; </span><span class="sc85">" on "</span><span class="sc81"> &amp; </span><span class="sc86">WeekDayName</span><span class="sc81">(</span><span class="sc86">WeekDay</span><span class="sc81">(</span><span class="sc86">dtePostedDate</span><span class="sc81">)) &amp; </span><span class="sc85">" "</span><span class="sc81"> &amp; </span><span class="sc86">dtePostedDate</span><span class="sc81">
         </span><span class="sc84">end</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">    
      
         </span><span class="sc82">' Note: these axis limits only work if they come after</span><span class="sc81">
         </span><span class="sc82">' the chart filling loop above...</span><span class="sc81">

         </span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">sglPressureMin</span><span class="sc81"> &lt; </span><span class="sc83">29.42</span><span class="sc81">) </span><span class="sc84">then</span><span class="sc81"> 
            </span><span class="sc86">Chart.VertAxisMin</span><span class="sc81"> = </span><span class="sc86">sglPressureMin</span><span class="sc81"> - </span><span class="sc83">0.005</span><span class="sc81">
         </span><span class="sc84">Else</span><span class="sc81">
            </span><span class="sc86">Chart.VertAxisMin</span><span class="sc81"> = </span><span class="sc83">29.41</span><span class="sc81">
         </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">    
         
         </span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">sglPressureMax</span><span class="sc81"> &gt; </span><span class="sc83">30.42</span><span class="sc81">) </span><span class="sc84">then</span><span class="sc81"> 
            </span><span class="sc86">Chart.VertAxisMax</span><span class="sc81"> = </span><span class="sc86">sglPressureMax</span><span class="sc81"> + </span><span class="sc83">0.005</span><span class="sc81">
         </span><span class="sc84">Else</span><span class="sc81">
            </span><span class="sc86">Chart.VertAxisMax</span><span class="sc81"> = </span><span class="sc83">30.43</span><span class="sc81">
         </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">        
            
         </span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">sglPressureMin</span><span class="sc81"> = </span><span class="sc83">0</span><span class="sc81">) </span><span class="sc84">then</span><span class="sc81">
            </span><span class="sc86">Chart.VertAxisMin</span><span class="sc81"> = -</span><span class="sc83">0.5</span><span class="sc81">
            </span><span class="sc86">Chart.VertAxisMax</span><span class="sc81"> =  </span><span class="sc83">0.5</span><span class="sc81">   
         </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">
         
         </span><span class="sc86">Chart.LeftAxisIncrement</span><span class="sc81"> = </span><span class="sc83">0.1</span><span class="sc81">
         
         </span><span class="sc82">'Chart.AddAxisLabel 1, "Pressure (Inches Hg)"</span><span class="sc81">
         
         </span><span class="sc86">Chart.Height</span><span class="sc81"> = </span><span class="sc83">500</span><span class="sc81">
         </span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">intDays</span><span class="sc81"> &gt;= </span><span class="sc83">10</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
            </span><span class="sc86">Chart.Width</span><span class="sc81"> = </span><span class="sc83">1128</span><span class="sc81">
         </span><span class="sc84">Else</span><span class="sc81">
            </span><span class="sc86">Chart.Width</span><span class="sc81"> = </span><span class="sc83">685</span><span class="sc81">
         </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">

      </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">
  
   </span><span class="sc84">ElseIf</span><span class="sc81"> (</span><span class="sc86">Left</span><span class="sc81">(</span><span class="sc86">strSensorType</span><span class="sc81">,</span><span class="sc83">6</span><span class="sc81">) = </span><span class="sc85">"DeltaP"</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
      
      </span><span class="sc82">' Add some horizontal lines</span><span class="sc81">
      </span><span class="sc86">Chart.AddSeries</span><span class="sc81"> (</span><span class="sc83">5</span><span class="sc81">)
      </span><span class="sc86">Chart.linewidth</span><span class="sc81"> = </span><span class="sc83">2</span><span class="sc81">
      </span><span class="sc86">Chart.SeriesInLegend</span><span class="sc81"> = </span><span class="sc84">False</span><span class="sc81">
      </span><span class="sc86">MyChartAddXY</span><span class="sc81"> </span><span class="sc83">0</span><span class="sc81">, </span><span class="sc83">0</span><span class="sc81">, </span><span class="sc85">""</span><span class="sc81">, </span><span class="sc86">vbBlack</span><span class="sc81">   
      </span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">Request.QueryString</span><span class="sc81">(</span><span class="sc85">"specName"</span><span class="sc81">) = </span><span class="sc85">""</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
         </span><span class="sc86">MyChartAddXY</span><span class="sc81"> </span><span class="sc86">intDays</span><span class="sc81">+</span><span class="sc83">1</span><span class="sc81">, </span><span class="sc83">0</span><span class="sc81">, </span><span class="sc85">""</span><span class="sc81">, </span><span class="sc86">vbWhite</span><span class="sc81">
      </span><span class="sc84">Else</span><span class="sc81">
         </span><span class="sc82">' Gray line (if request is for the 50Webs example chart page).</span><span class="sc81">
         </span><span class="sc86">MyChartAddXY</span><span class="sc81"> </span><span class="sc86">intDays</span><span class="sc81">+</span><span class="sc83">1</span><span class="sc81">, </span><span class="sc83">0</span><span class="sc81">, </span><span class="sc85">""</span><span class="sc81">, </span><span class="sc86">RGB</span><span class="sc81">(&amp;</span><span class="sc86">hB5</span><span class="sc81">,&amp;</span><span class="sc86">hB5</span><span class="sc81">,&amp;</span><span class="sc86">hB5</span><span class="sc81">)     
      </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">
      
      </span><span class="sc82">' Add the delta-P traces.</span><span class="sc81">
      
      </span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">strSensorType</span><span class="sc81"> = </span><span class="sc85">"DeltaP1"</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
               
         </span><span class="sc86">dicTraceIO</span><span class="sc81">(</span><span class="sc85">"WestSite"</span><span class="sc81">) = </span><span class="sc85">"PORTLAND"</span><span class="sc81">
         </span><span class="sc86">dicTraceIO</span><span class="sc81">(</span><span class="sc85">"EastSite"</span><span class="sc81">) = </span><span class="sc85">"THE DALLES"</span><span class="sc81">
         </span><span class="sc86">AddTrace</span><span class="sc81"> </span><span class="sc85">"DeltaP_trace_A"</span><span class="sc81">, </span><span class="sc83">5</span><span class="sc81">, </span><span class="sc85">"Portland - The Dalles "</span><span class="sc81">, </span><span class="sc83">2</span><span class="sc81">, </span><span class="sc86">RGB</span><span class="sc81">(&amp;</span><span class="sc86">h00</span><span class="sc81">,&amp;</span><span class="sc86">h80</span><span class="sc81">,&amp;</span><span class="sc86">h80</span><span class="sc81">), </span><span class="sc86">dicTraceIO</span><span class="sc81">
         
         </span><span class="sc86">dicTraceIO</span><span class="sc81">(</span><span class="sc85">"WestSite"</span><span class="sc81">) = </span><span class="sc85">"THE DALLES"</span><span class="sc81">
         </span><span class="sc86">dicTraceIO</span><span class="sc81">(</span><span class="sc85">"EastSite"</span><span class="sc81">) = </span><span class="sc85">"PASCO"</span><span class="sc81">
         </span><span class="sc86">AddTrace</span><span class="sc81"> </span><span class="sc85">"DeltaP_trace_B"</span><span class="sc81">, </span><span class="sc83">5</span><span class="sc81">, </span><span class="sc85">"The Dalles - Pasco"</span><span class="sc81">, </span><span class="sc83">2</span><span class="sc81">, </span><span class="sc86">vbRed</span><span class="sc81">, </span><span class="sc86">dicTraceIO</span><span class="sc81">
         
         </span><span class="sc82">'"NORTH BEND", "PASCO"</span><span class="sc81">
               
      </span><span class="sc84">ElseIf</span><span class="sc81"> (</span><span class="sc86">strSensorType</span><span class="sc81"> = </span><span class="sc85">"DeltaP2"</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
         
         </span><span class="sc86">dicTraceIO</span><span class="sc81">(</span><span class="sc85">"WestSite"</span><span class="sc81">) = </span><span class="sc85">"KTTD"</span><span class="sc81">
         </span><span class="sc86">dicTraceIO</span><span class="sc81">(</span><span class="sc85">"EastSite"</span><span class="sc81">) = </span><span class="sc85">"KDLS"</span><span class="sc81">
         </span><span class="sc86">AddTrace</span><span class="sc81"> </span><span class="sc85">"DeltaP_trace_A"</span><span class="sc81">, </span><span class="sc83">5</span><span class="sc81">, </span><span class="sc85">"Troutdale - The Dalles"</span><span class="sc81">, </span><span class="sc83">2</span><span class="sc81">, </span><span class="sc86">RGB</span><span class="sc81">(&amp;</span><span class="sc86">h00</span><span class="sc81">,&amp;</span><span class="sc86">h80</span><span class="sc81">,&amp;</span><span class="sc86">h80</span><span class="sc81">), </span><span class="sc86">dicTraceIO</span><span class="sc81">
         
         </span><span class="sc86">dicTraceIO</span><span class="sc81">(</span><span class="sc85">"WestSite"</span><span class="sc81">) = </span><span class="sc85">"KDLS"</span><span class="sc81">
         </span><span class="sc86">dicTraceIO</span><span class="sc81">(</span><span class="sc85">"EastSite"</span><span class="sc81">) = </span><span class="sc85">"KHRI"</span><span class="sc81">
         </span><span class="sc86">AddTrace</span><span class="sc81"> </span><span class="sc85">"DeltaP_trace_B"</span><span class="sc81">, </span><span class="sc83">5</span><span class="sc81">, </span><span class="sc85">"The Dalles - Hermiston"</span><span class="sc81">, </span><span class="sc83">2</span><span class="sc81">, </span><span class="sc86">vbRed</span><span class="sc81">, </span><span class="sc86">dicTraceIO</span><span class="sc81">
         
         </span><span class="sc82">' dicTraceIO("WestSite") = "KTTD"</span><span class="sc81">
         </span><span class="sc82">' dicTraceIO("EastSite") = "KHRI"</span><span class="sc81">
         </span><span class="sc82">' AddTrace "DeltaP_trace_B", 5, "Troutdale - Hermiston", 2, vbBlue, dicTraceIO</span><span class="sc81">

      </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">
      
      </span><span class="sc84">If</span><span class="sc81"> </span><span class="sc86">dicTraceIO.Item</span><span class="sc81">(</span><span class="sc85">"FoundData"</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
         </span><span class="sc82">' Force limits on the Y axis for the Delta-P chart.</span><span class="sc81">
         </span><span class="sc86">dblDPmin</span><span class="sc81"> = </span><span class="sc86">dicTraceIO</span><span class="sc81">(</span><span class="sc85">"YMin"</span><span class="sc81">)
         </span><span class="sc86">dblDPmax</span><span class="sc81"> = </span><span class="sc86">dicTraceIO</span><span class="sc81">(</span><span class="sc85">"YMax"</span><span class="sc81">)
         
         </span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">dblDPmin</span><span class="sc81"> &lt; -</span><span class="sc83">0.08</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
            </span><span class="sc86">Chart.VertAxisMin</span><span class="sc81"> = </span><span class="sc86">dblDPmin</span><span class="sc81"> - .</span><span class="sc83">001</span><span class="sc81">
         </span><span class="sc84">Else</span><span class="sc81">
            </span><span class="sc86">Chart.VertAxisMin</span><span class="sc81"> = -</span><span class="sc83">0.08</span><span class="sc81">
         </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">
         
         </span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">dblDPmax</span><span class="sc81"> &gt; </span><span class="sc83">0.18</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
            </span><span class="sc86">Chart.VertAxisMax</span><span class="sc81"> = </span><span class="sc86">dblDPmax</span><span class="sc81"> + </span><span class="sc83">0.001</span><span class="sc81">
         </span><span class="sc84">Else</span><span class="sc81">
            </span><span class="sc86">Chart.VertAxisMax</span><span class="sc81"> = </span><span class="sc83">0.18</span><span class="sc81">
         </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">
           
           
         </span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">intDays</span><span class="sc81"> &gt; </span><span class="sc83">1</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
            </span><span class="sc86">Chart.ChartTitleAdd</span><span class="sc81">  </span><span class="sc85">"Delta-P"</span><span class="sc81">
         </span><span class="sc84">Else</span><span class="sc81">
            </span><span class="sc86">Chart.ChartTitleAdd</span><span class="sc81">  </span><span class="sc85">"Delta-P on "</span><span class="sc81"> &amp; </span><span class="sc86">WeekDayName</span><span class="sc81">(</span><span class="sc86">WeekDay</span><span class="sc81">(</span><span class="sc86">dtePostedDate</span><span class="sc81">)) &amp; </span><span class="sc85">" "</span><span class="sc81"> &amp; </span><span class="sc86">dtePostedDate</span><span class="sc81">
         </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">    
         
         </span><span class="sc86">Chart.LeftAxisIncrement</span><span class="sc81"> = </span><span class="sc83">0.05</span><span class="sc81">
         
         </span><span class="sc86">Chart.AddAxisLabel</span><span class="sc81"> </span><span class="sc83">1</span><span class="sc81">, </span><span class="sc85">"Pressure Differential (Inches Hg)"</span><span class="sc81">
         
         </span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">intDays</span><span class="sc81"> &gt;= </span><span class="sc83">10</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
            </span><span class="sc86">Chart.Width</span><span class="sc81"> = </span><span class="sc83">1270</span><span class="sc81">
         </span><span class="sc84">Else</span><span class="sc81">
            </span><span class="sc86">Chart.Width</span><span class="sc81"> = </span><span class="sc83">875</span><span class="sc81">
         </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">
         
         </span><span class="sc82">' Scale the height of the image if the y range is larger than the default of 0.26.</span><span class="sc81">
         </span><span class="sc86">intNonPlottingHeight</span><span class="sc81"> = </span><span class="sc83">90</span><span class="sc81">
         </span><span class="sc84">If</span><span class="sc81"> ((</span><span class="sc86">Chart.VertAxisMax</span><span class="sc81"> - </span><span class="sc86">Chart.VertAxisMin</span><span class="sc81">) &gt; </span><span class="sc83">0.26</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">    
            </span><span class="sc86">Chart.Height</span><span class="sc81"> = ((</span><span class="sc83">510</span><span class="sc81"> - </span><span class="sc86">intNonPlottingHeight</span><span class="sc81">) * ((</span><span class="sc86">Chart.VertAxisMax</span><span class="sc81"> - </span><span class="sc86">Chart.VertAxisMin</span><span class="sc81">)/</span><span class="sc83">0.26</span><span class="sc81">)) + </span><span class="sc86">intNonPlottingHeight</span><span class="sc81">
         </span><span class="sc84">Else</span><span class="sc81">
            </span><span class="sc86">Chart.Height</span><span class="sc81"> = </span><span class="sc83">510</span><span class="sc81">
         </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">         
         
      </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">
   
   </span><span class="sc84">Else</span><span class="sc81">
      </span><span class="sc82">' Shouldn't ever get here...</span><span class="sc81">
      </span><span class="sc86">RBC</span><span class="sc81"> </span><span class="sc85">"No data or no match found for the specified sensor type."</span><span class="sc81"> 
   </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81"> 

   </span><span class="sc82">'=============================================================================</span><span class="sc81">
   </span><span class="sc82">' Control chart axes and labeling...</span><span class="sc81">
   </span><span class="sc82">' (This is done for every type of plot)</span><span class="sc81">
   </span><span class="sc82">'=============================================================================</span><span class="sc81">

   </span><span class="sc84">If</span><span class="sc81"> </span><span class="sc86">dicTraceIO.Item</span><span class="sc81">(</span><span class="sc85">"FoundData"</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
      
      </span><span class="sc82">' Plot the LatestRecord and the NOW lines.</span><span class="sc81">
      </span><span class="sc84">If</span><span class="sc81"> ((</span><span class="sc86">intDays</span><span class="sc81"> = </span><span class="sc83">1</span><span class="sc81">) </span><span class="sc84">and</span><span class="sc81"> (</span><span class="sc86">str24Hrs_state</span><span class="sc81"> = </span><span class="sc85">"checked"</span><span class="sc81">)) </span><span class="sc84">Then</span><span class="sc81">
         </span><span class="sc86">AddVerticalLine</span><span class="sc81"> </span><span class="sc86">DaysDec</span><span class="sc81">( </span><span class="sc86">strMRTime</span><span class="sc81">),  </span><span class="sc83">1</span><span class="sc81">
         </span><span class="sc86">AddVerticalLine</span><span class="sc81"> </span><span class="sc86">DaysDec</span><span class="sc81">( </span><span class="sc86">dteNowTime</span><span class="sc81">), </span><span class="sc83">1</span><span class="sc81">
      </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">
        
      </span><span class="sc86">Chart.HorizAxisMax</span><span class="sc81"> = </span><span class="sc86">intDays</span><span class="sc81">
      </span><span class="sc86">Chart.ShowMinorTicks</span><span class="sc81"> </span><span class="sc84">false</span><span class="sc81">, </span><span class="sc84">false</span><span class="sc81">  
        
      </span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">intDays</span><span class="sc81"> &gt; </span><span class="sc83">1</span><span class="sc81">) </span><span class="sc84">then</span><span class="sc81">
         </span><span class="sc82">' Set Horizontal Axis Label Style to: Axis Scales (2)</span><span class="sc81">
         </span><span class="sc86">Chart.HLabelStyle</span><span class="sc81"> = </span><span class="sc83">0</span><span class="sc81">
                  
         </span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">blnDayLightSavingsTime</span><span class="sc81"> </span><span class="sc84">And</span><span class="sc81"> (</span><span class="sc86">strTimeZone</span><span class="sc81"> &lt;&gt; </span><span class="sc85">"H"</span><span class="sc81">)) </span><span class="sc84">Then</span><span class="sc81">
            </span><span class="sc86">Chart.AddAxisLabel</span><span class="sc81"> </span><span class="sc83">2</span><span class="sc81">, </span><span class="sc85">"Days Starting with "</span><span class="sc81"> &amp; </span><span class="sc86">WeekDayName</span><span class="sc81">(</span><span class="sc86">WeekDay</span><span class="sc81">(</span><span class="sc86">dteStartDate_forLabels</span><span class="sc81">)) &amp; </span><span class="sc85">" "</span><span class="sc81"> &amp; </span><span class="sc86">FormatDateTime</span><span class="sc81">(</span><span class="sc86">dteStartDate_forLabels</span><span class="sc81">, </span><span class="sc86">vbShortDate</span><span class="sc81">) &amp; </span><span class="sc85">" ("</span><span class="sc81"> &amp; </span><span class="sc86">strTimeZone</span><span class="sc81"> &amp; </span><span class="sc85">"DT)"</span><span class="sc81">
         </span><span class="sc84">Else</span><span class="sc81">
            </span><span class="sc86">Chart.AddAxisLabel</span><span class="sc81"> </span><span class="sc83">2</span><span class="sc81">, </span><span class="sc85">"Days Starting with "</span><span class="sc81"> &amp; </span><span class="sc86">WeekDayName</span><span class="sc81">(</span><span class="sc86">WeekDay</span><span class="sc81">(</span><span class="sc86">dteStartDate_forLabels</span><span class="sc81">)) &amp; </span><span class="sc85">" "</span><span class="sc81"> &amp; </span><span class="sc86">FormatDateTime</span><span class="sc81">(</span><span class="sc86">dteStartDate_forLabels</span><span class="sc81">, </span><span class="sc86">vbShortDate</span><span class="sc81">) &amp; </span><span class="sc85">" ("</span><span class="sc81"> &amp; </span><span class="sc86">strTimeZone</span><span class="sc81"> &amp; </span><span class="sc85">"ST)"</span><span class="sc81">
         </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">
         </span><span class="sc86">Chart.HorizAxisMin</span><span class="sc81"> = </span><span class="sc83">0.0</span><span class="sc81">     
      </span><span class="sc84">Else</span><span class="sc81">
         </span><span class="sc82">' Set Horizontal Axis Label Style to: Automatic (0)      </span><span class="sc81">
         </span><span class="sc86">Chart.HLabelStyle</span><span class="sc81"> = </span><span class="sc83">0</span><span class="sc81">
             
         </span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">blnDayLightSavingsTime</span><span class="sc81"> </span><span class="sc84">And</span><span class="sc81"> (</span><span class="sc86">strTimeZone</span><span class="sc81"> &lt;&gt; </span><span class="sc85">"H"</span><span class="sc81">)) </span><span class="sc84">Then</span><span class="sc81">
            </span><span class="sc86">Chart.AddAxisLabel</span><span class="sc81"> </span><span class="sc83">2</span><span class="sc81">, </span><span class="sc85">"Hour of the Day ("</span><span class="sc81"> &amp; </span><span class="sc86">strTimeZone</span><span class="sc81"> &amp; </span><span class="sc85">"DT)"</span><span class="sc81">
         </span><span class="sc84">Else</span><span class="sc81">
            </span><span class="sc86">Chart.AddAxisLabel</span><span class="sc81"> </span><span class="sc83">2</span><span class="sc81">, </span><span class="sc85">"Hour of the Day ("</span><span class="sc81"> &amp; </span><span class="sc86">strTimeZone</span><span class="sc81"> &amp; </span><span class="sc85">"ST)"</span><span class="sc81">
         </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">
         
         </span><span class="sc82">' Make a little more room on the y axis for the last point from yesterday. The</span><span class="sc81">
         </span><span class="sc82">' square boxes (markers) for the direction trace enforce a little more room on </span><span class="sc81">
         </span><span class="sc82">' their own, so the non-wind plots require a little more wiggle room on each </span><span class="sc81">
         </span><span class="sc82">' end of the x-axis.</span><span class="sc81">
         </span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">left</span><span class="sc81">(</span><span class="sc86">strSensorType</span><span class="sc81">,</span><span class="sc83">4</span><span class="sc81">) = </span><span class="sc85">"Wind"</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
            </span><span class="sc86">Chart.HorizAxisMin</span><span class="sc81"> = -</span><span class="sc83">0.001</span><span class="sc81">
            </span><span class="sc86">Chart.HorizAxisMax</span><span class="sc81"> = </span><span class="sc86">intDays</span><span class="sc81"> + </span><span class="sc83">0.001</span><span class="sc81">
         </span><span class="sc84">Else</span><span class="sc81">
            </span><span class="sc82">'Chart.HorizAxisMin = 0.00</span><span class="sc81">
            </span><span class="sc86">Chart.HorizAxisMin</span><span class="sc81"> = -</span><span class="sc83">0.003</span><span class="sc81">  
            </span><span class="sc86">Chart.HorizAxisMax</span><span class="sc81"> = </span><span class="sc86">intDays</span><span class="sc81"> + </span><span class="sc83">0.003</span><span class="sc81">            
         </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">
      </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">

      </span><span class="sc86">Chart.ChartTitleFont.Size</span><span class="sc81"> = </span><span class="sc83">16</span><span class="sc81">
      </span><span class="sc86">Chart.ChartTitleFont.Name</span><span class="sc81"> = </span><span class="sc85">"Arial"</span><span class="sc81">    
      </span><span class="sc82">'Chart.ChartTitleFontColor = vbBlue</span><span class="sc81">
      </span><span class="sc86">Chart.ChartTitleFontColor</span><span class="sc81"> = </span><span class="sc86">RGB</span><span class="sc81">(&amp;</span><span class="sc86">h00</span><span class="sc81">,&amp;</span><span class="sc86">h80</span><span class="sc81">,&amp;</span><span class="sc86">h80</span><span class="sc81">)    
      </span><span class="sc86">Chart.LegendFont.Size</span><span class="sc81"> = </span><span class="sc83">10</span><span class="sc81">
      </span><span class="sc86">Chart.AxisLabelFontBottom.Size</span><span class="sc81"> = </span><span class="sc83">10</span><span class="sc81">
      </span><span class="sc86">Chart.AxisLabelFontLeft.Size</span><span class="sc81"> = </span><span class="sc83">10</span><span class="sc81">
        
      </span><span class="sc86">Chart.BevelOuter</span><span class="sc81"> = </span><span class="sc84">false</span><span class="sc81">
      
      </span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">Request.QueryString</span><span class="sc81">(</span><span class="sc85">"specName"</span><span class="sc81">) &lt;&gt; </span><span class="sc85">""</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
         </span><span class="sc86">Chart.GradientVisible</span><span class="sc81"> = </span><span class="sc84">false</span><span class="sc81">
      </span><span class="sc84">Else</span><span class="sc81">
         </span><span class="sc86">Chart.GradientVisible</span><span class="sc81"> = </span><span class="sc84">true</span><span class="sc81">
      </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">
      </span><span class="sc86">Chart.GradientStartColor</span><span class="sc81"> = </span><span class="sc86">RGB</span><span class="sc81">(&amp;</span><span class="sc86">hff</span><span class="sc81">,&amp;</span><span class="sc86">hcc</span><span class="sc81">,&amp;</span><span class="sc86">h99</span><span class="sc81">)
      </span><span class="sc86">Chart.GradientEndColor</span><span class="sc81"> = </span><span class="sc86">vbWhite</span><span class="sc81">
      
      </span><span class="sc86">Chart.PanelColor</span><span class="sc81"> = </span><span class="sc86">vbWhite</span><span class="sc81">
      </span><span class="sc86">Chart.View3D</span><span class="sc81"> = </span><span class="sc84">false</span><span class="sc81">
      </span><span class="sc86">Chart.LegendVisible</span><span class="sc81"> = </span><span class="sc84">true</span><span class="sc81">
      </span><span class="sc86">Chart.LegendStyle</span><span class="sc81"> = </span><span class="sc83">1</span><span class="sc81">

      </span><span class="sc82">' Set the filename, save the image and write the image tag.</span><span class="sc81">
        
      </span><span class="sc82">' Do this with sessionID and random name generated via the</span><span class="sc81">
      </span><span class="sc82">' FileSystemObject. First make a string with a random name in it. Use</span><span class="sc81">
      </span><span class="sc82">' split here to get rid of the txt extension that normally is returned.</span><span class="sc81">

      </span><span class="sc86">strRandomNameString</span><span class="sc81"> = </span><span class="sc86">Split</span><span class="sc81">(</span><span class="sc86">Server.CreateObject</span><span class="sc81">(</span><span class="sc85">"Scripting.FileSystemObject"</span><span class="sc81">).</span><span class="sc86">GetTempName</span><span class="sc81">,</span><span class="sc85">"."</span><span class="sc81">)(</span><span class="sc83">0</span><span class="sc81">)
      </span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">Request.QueryString</span><span class="sc81">(</span><span class="sc85">"specName"</span><span class="sc81">) &lt;&gt; </span><span class="sc85">""</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
         </span><span class="sc86">strFileName2</span><span class="sc81"> = </span><span class="sc86">Request.QueryString</span><span class="sc81">(</span><span class="sc85">"specName"</span><span class="sc81">) &amp; </span><span class="sc85">".jpg"</span><span class="sc81">
      </span><span class="sc84">Else</span><span class="sc81">
         </span><span class="sc86">strFileName2</span><span class="sc81"> = </span><span class="sc85">"S"</span><span class="sc81"> &amp; </span><span class="sc85">"_"</span><span class="sc81"> &amp; </span><span class="sc86">Session.SessionID</span><span class="sc81"> &amp; </span><span class="sc85">"_"</span><span class="sc81"> &amp; </span><span class="sc86">strRandomNameString</span><span class="sc81"> &amp; </span><span class="sc85">".jpg"</span><span class="sc81"> 
      </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">

      </span><span class="sc82">'Response.Write "filename = " &amp; strPathToImageDir &amp; strFileName2</span><span class="sc81">
        
      </span><span class="sc86">Chart.FileName</span><span class="sc81"> = </span><span class="sc86">strPathToImageDir</span><span class="sc81"> &amp; </span><span class="sc86">strFileName2</span><span class="sc81">
      </span><span class="sc86">Chart.SaveChart</span><span class="sc81">
      </span><span class="sc84">Set</span><span class="sc81"> </span><span class="sc86">Chart</span><span class="sc81"> = </span><span class="sc84">nothing</span><span class="sc81">  
     
      </span><span class="sc82">' Put these two images into a DIV element that doesn't wrap! Then</span><span class="sc81">
      </span><span class="sc82">' position the directions overlay relative to the original chart image.</span><span class="sc81">

      </span><span class="sc86">RC</span><span class="sc81"> </span><span class="sc85">"&lt;div style='white-space:nowrap;'&gt;"</span><span class="sc81">
      </span><span class="sc86">RC</span><span class="sc81"> </span><span class="sc85">"&lt;img id='chartimage' style='visibility:hidden' src='"</span><span class="sc81"> &amp; </span><span class="sc86">strURLPathToImageDir</span><span class="sc81"> &amp; </span><span class="sc86">strFileName2</span><span class="sc81"> &amp; </span><span class="sc85">"'&gt;"</span><span class="sc81">
      
      </span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">Left</span><span class="sc81">(</span><span class="sc86">strSensorType</span><span class="sc81">,</span><span class="sc83">4</span><span class="sc81">) = </span><span class="sc85">"Wind"</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
         </span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">strSensorType</span><span class="sc81"> = </span><span class="sc85">"Wind40"</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
            </span><span class="sc86">directAxisScale</span><span class="sc81"> = </span><span class="sc85">"'pictures/directions_40.gif'"</span><span class="sc81">
         </span><span class="sc84">ElseIf</span><span class="sc81"> (</span><span class="sc86">strSensorType</span><span class="sc81"> = </span><span class="sc85">"Wind36"</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
            </span><span class="sc86">directAxisScale</span><span class="sc81"> = </span><span class="sc85">"'pictures/directions_36.gif'"</span><span class="sc81">
         </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">
         </span><span class="sc86">RC</span><span class="sc81"> </span><span class="sc85">"&lt;img id='directions' src="</span><span class="sc81"> &amp; </span><span class="sc86">directAxisScale</span><span class="sc81"> &amp; </span><span class="sc86">_</span><span class="sc81">
            </span><span class="sc85">"style='visibility:hidden; position:relative; left:"</span><span class="sc81"> &amp; </span><span class="sc86">intPixelRightShift</span><span class="sc81"> &amp; </span><span class="sc85">"px; bottom:"</span><span class="sc81"> &amp; </span><span class="sc86">intPixelBottomShift</span><span class="sc81"> &amp; </span><span class="sc85">"px'&gt;"</span><span class="sc81">
      </span><span class="sc84">Else</span><span class="sc81">
         </span><span class="sc82">' Could add secondary images for other sensors types here...</span><span class="sc81">
      </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">
      
      </span><span class="sc86">RC</span><span class="sc81"> </span><span class="sc85">"&lt;/div&gt;"</span><span class="sc81">
        
   </span><span class="sc84">Else</span><span class="sc81">
      </span><span class="sc86">Response.Write</span><span class="sc81"> </span><span class="sc85">"The query has returned no data for the selected sensor, location, and time period."</span><span class="sc81">
   </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">
</span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">Sub</span><span class="sc81">


</span><span class="sc84">Function</span><span class="sc81"> </span><span class="sc86">TimeZone</span><span class="sc81">( </span><span class="sc86">strStationName</span><span class="sc81">)
   </span><span class="sc86">strSQL</span><span class="sc81"> = </span><span class="sc85">"SELECT StationNames.StationName, StationNames.NickName, StationNames.TimeZone FROM StationNames "</span><span class="sc81"> &amp; </span><span class="sc86">_</span><span class="sc81">
            </span><span class="sc85">"WHERE (StationName = '"</span><span class="sc81"> &amp; </span><span class="sc86">strStationName</span><span class="sc81">  &amp; </span><span class="sc85">"') "</span><span class="sc81">
   
   </span><span class="sc84">Set</span><span class="sc81"> </span><span class="sc86">rstTimeZone</span><span class="sc81"> = </span><span class="sc86">Server.CreateObject</span><span class="sc81">(</span><span class="sc85">"ADODB.Recordset"</span><span class="sc81">)
    </span><span class="sc84">On</span><span class="sc81"> </span><span class="sc84">Error</span><span class="sc81"> </span><span class="sc84">Resume</span><span class="sc81"> </span><span class="sc84">Next</span><span class="sc81">
    </span><span class="sc86">rstTimeZone.Open</span><span class="sc81"> </span><span class="sc86">strSQL</span><span class="sc81">, </span><span class="sc86">DBConnection</span><span class="sc81">, </span><span class="sc86">adOpenStatic</span><span class="sc81">, </span><span class="sc86">adLockReadOnly</span><span class="sc81">, </span><span class="sc86">adCmdText</span><span class="sc81">
    </span><span class="sc86">LogError</span><span class="sc81">(</span><span class="sc85">"Recordset = rstTelem, SQL = "</span><span class="sc81"> &amp; </span><span class="sc86">strSQL_trace</span><span class="sc81">)
    </span><span class="sc84">On</span><span class="sc81"> </span><span class="sc84">Error</span><span class="sc81"> </span><span class="sc84">Goto</span><span class="sc81"> </span><span class="sc83">0</span><span class="sc81">

   </span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">rstTimeZone.RecordCount</span><span class="sc81"> = </span><span class="sc83">0</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
      </span><span class="sc86">TimeZone</span><span class="sc81"> = </span><span class="sc85">"?"</span><span class="sc81">
   </span><span class="sc84">Else</span><span class="sc81"> 
      </span><span class="sc86">rstTimeZone.MoveFirst</span><span class="sc81">
      </span><span class="sc86">TimeZone</span><span class="sc81"> = </span><span class="sc86">rstTimeZone</span><span class="sc81">(</span><span class="sc85">"TimeZone"</span><span class="sc81">)
   </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">

   </span><span class="sc84">If</span><span class="sc81"> </span><span class="sc86">rstTimeZone.State</span><span class="sc81"> = </span><span class="sc86">adStateOpen</span><span class="sc81"> </span><span class="sc84">Then</span><span class="sc81"> </span><span class="sc86">rstTimeZone.Close</span><span class="sc81">
   </span><span class="sc84">Set</span><span class="sc81"> </span><span class="sc86">rstTimeZone</span><span class="sc81"> = </span><span class="sc84">Nothing</span><span class="sc81">
</span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">Function</span><span class="sc81">


</span><span class="sc84">Function</span><span class="sc81"> </span><span class="sc86">RegionString</span><span class="sc81">( </span><span class="sc86">strRegion</span><span class="sc81">)
   </span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">strRegion</span><span class="sc81"> = </span><span class="sc85">"MN"</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
      </span><span class="sc86">RegionString</span><span class="sc81"> = </span><span class="sc85">"Minnesota Weather"</span><span class="sc81">
   </span><span class="sc84">ElseIf</span><span class="sc81"> (</span><span class="sc86">strRegion</span><span class="sc81"> = </span><span class="sc85">"CR"</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
      </span><span class="sc86">RegionString</span><span class="sc81"> = </span><span class="sc85">"Columbia Basin Weather"</span><span class="sc81">
   </span><span class="sc84">ElseIf</span><span class="sc81"> (</span><span class="sc86">strRegion</span><span class="sc81"> = </span><span class="sc85">"Misc"</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
      </span><span class="sc86">RegionString</span><span class="sc81"> = </span><span class="sc85">"Misc. Weather Stations"</span><span class="sc81">
   </span><span class="sc84">Else</span><span class="sc81">
      </span><span class="sc86">RWBR</span><span class="sc81"> </span><span class="sc85">"No match when branching on Region."</span><span class="sc81">
   </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">
</span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">Function</span><span class="sc81">


</span><span class="sc82">'=======================================================================================</span><span class="sc81">
</span><span class="sc82">' Main program body (start here and execute every time in)</span><span class="sc81">
</span><span class="sc82">'=======================================================================================</span><span class="sc81">
  
</span><span class="sc82">' Build the page</span><span class="sc81">
</span><span class="sc15">%&gt;</span><span class="sc0">

</span><span class="sc1">&lt;html&gt;</span><span class="sc0">
</span><span class="sc1">&lt;head&gt;</span><span class="sc0">
</span><span class="sc1">&lt;meta</span><span class="sc8"> </span><span class="sc3">name</span><span class="sc8">=</span><span class="sc7">'Author'</span><span class="sc8"> </span><span class="sc3">content</span><span class="sc8">=</span><span class="sc7">'Jim Miller'</span><span class="sc1">&gt;</span><span class="sc0">
</span><span class="sc1">&lt;meta</span><span class="sc8"> </span><span class="sc3">name</span><span class="sc8">=</span><span class="sc7">'keywords'</span><span class="sc8"> 
      </span><span class="sc3">content</span><span class="sc8">=</span><span class="sc7">'WA,Washington,OR,Orgeon,MN,Minnesota,columbia,basin,weather,chart,plot,roosevelt,
               windsurfing,gorge,richland,wind,temperature,pressure,dewpoint'</span><span class="sc1">&gt;</span><span class="sc0">             
</span><span class="sc1">&lt;meta</span><span class="sc8"> </span><span class="sc3">charset</span><span class="sc8">=</span><span class="sc6">"UTF-8"</span><span class="sc1">&gt;</span><span class="sc0">

</span><span class="sc9">&lt;!-- Icon for browsers using Waconia.  --&gt;</span><span class="sc0"> 
</span><span class="sc1">&lt;link</span><span class="sc8"> </span><span class="sc3">rel</span><span class="sc8">=</span><span class="sc7">'SHORTCUT ICON'</span><span class="sc8"> </span><span class="sc3">href</span><span class="sc8">=</span><span class="sc7">'pictures/favicon.ico'</span><span class="sc1">&gt;</span><span class="sc0">
</span><span class="sc1">&lt;title&gt;</span><span class="sc0">Waconia Weather Database</span><span class="sc1">&lt;/title&gt;</span><span class="sc0">

</span><span class="sc1">&lt;style&gt;</span><span class="sc0">
   TD {font-family: Times;}
   TD.data {font-family: Arial;}

   A         {color:#008080; text-decoration:underline}
   A:hover   {color:#008080; text-decoration:none; background:#FFF1E3}

   A.noline       {color:#008080; text-decoration:none;      font-size:18pt; font-weight:bolder;                   }
   A.noline:hover {color:#008080; text-decoration:underline; font-size:18pt; font-weight:bolder; background:#FFCC99}
   
   span.regionstring {color:#008080; font-size:18pt; font-weight:bolder;}
   
   div.pageblock {min-width: 650px; max-width: 1000px;}
</span><span class="sc1">&lt;/style&gt;</span><span class="sc0">

</span><span class="sc9">&lt;!--[if IE]&gt;
   &lt;style&gt;
      div.pageblock {width: expression(document.body.clientWidth &gt; 1000? "1000px": "auto" )};
   &lt;/style&gt;
&lt;![endif]--&gt;</span><span class="sc0">   

</span><span class="sc1">&lt;/head&gt;</span><span class="sc0">

</span><span class="sc15">&lt;%</span><span class="sc80">

</span><span class="sc82">' Connect to the database.</span><span class="sc81">
</span><span class="sc84">Set</span><span class="sc81"> </span><span class="sc86">DBConnection</span><span class="sc81"> = </span><span class="sc86">CreateObject</span><span class="sc81">(</span><span class="sc85">"ADODB.Connection"</span><span class="sc81">)
</span><span class="sc82">' Open a connection to MySQL (telem schema) using 32-bit system DSN (MySQL ODBC 5.3 Unicode Driver)</span><span class="sc81">
</span><span class="sc86">DBConnection.Open</span><span class="sc81"> </span><span class="sc85">"DSN=MySQL_telem_for_ASP;"</span><span class="sc81">

</span><span class="sc84">Set</span><span class="sc81"> </span><span class="sc86">dicTZ</span><span class="sc81"> = </span><span class="sc86">Server.CreateObject</span><span class="sc81">(</span><span class="sc85">"Scripting.Dictionary"</span><span class="sc81">)
</span><span class="sc86">dicTZ.Add</span><span class="sc81"> </span><span class="sc85">"H"</span><span class="sc81">,  -</span><span class="sc83">4</span><span class="sc81">
</span><span class="sc86">dicTZ.Add</span><span class="sc81"> </span><span class="sc85">"AK"</span><span class="sc81">, -</span><span class="sc83">3</span><span class="sc81">
</span><span class="sc86">dicTZ.Add</span><span class="sc81"> </span><span class="sc85">"P"</span><span class="sc81">,  -</span><span class="sc83">2</span><span class="sc81">
</span><span class="sc86">dicTZ.Add</span><span class="sc81"> </span><span class="sc85">"M"</span><span class="sc81">,  -</span><span class="sc83">1</span><span class="sc81">
</span><span class="sc86">dicTZ.Add</span><span class="sc81"> </span><span class="sc85">"C"</span><span class="sc81">,   </span><span class="sc83">0</span><span class="sc81">
</span><span class="sc86">dicTZ.Add</span><span class="sc81"> </span><span class="sc85">"E"</span><span class="sc81">,   </span><span class="sc83">1</span><span class="sc81">
</span><span class="sc86">dicTZ.Add</span><span class="sc81"> </span><span class="sc85">"J"</span><span class="sc81">,  </span><span class="sc83">15</span><span class="sc81">
</span><span class="sc86">dicTZ.Add</span><span class="sc81"> </span><span class="sc85">"NZ"</span><span class="sc81">, </span><span class="sc83">18</span><span class="sc81">

</span><span class="sc86">serverTimeArray</span><span class="sc81"> = </span><span class="sc86">split</span><span class="sc81">(</span><span class="sc86">Now</span><span class="sc81">(),</span><span class="sc85">" "</span><span class="sc81">)
</span><span class="sc86">serverTime</span><span class="sc81"> = </span><span class="sc86">serverTimeArray</span><span class="sc81">(</span><span class="sc83">1</span><span class="sc81">)

</span><span class="sc82">' Establish defaults</span><span class="sc81">

</span><span class="sc82">' Region_state (hidden) is used to facilitate changing the location to a default value</span><span class="sc81">
</span><span class="sc82">' when the region is changed.</span><span class="sc81">
</span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">Request.QueryString</span><span class="sc81">(</span><span class="sc85">"Region_state"</span><span class="sc81">) = </span><span class="sc85">""</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81"> 
   </span><span class="sc86">strRegionState</span><span class="sc81"> = </span><span class="sc85">"new"</span><span class="sc81">
</span><span class="sc84">Else</span><span class="sc81">
   </span><span class="sc86">strRegionState</span><span class="sc81"> = </span><span class="sc86">Request.QueryString</span><span class="sc81">(</span><span class="sc85">"Region_state"</span><span class="sc81">)
</span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">

</span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">Request.QueryString</span><span class="sc81">(</span><span class="sc85">"Region"</span><span class="sc81">) = </span><span class="sc85">""</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81"> 
   </span><span class="sc86">strRegion</span><span class="sc81"> = </span><span class="sc85">"CR"</span><span class="sc81">
</span><span class="sc84">Else</span><span class="sc81">
   </span><span class="sc86">strRegion</span><span class="sc81"> = </span><span class="sc86">Request.QueryString</span><span class="sc81">(</span><span class="sc85">"Region"</span><span class="sc81">)
</span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">

</span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">Request.QueryString</span><span class="sc81">(</span><span class="sc85">"chk24Hrs"</span><span class="sc81">) = </span><span class="sc85">"on"</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
   </span><span class="sc86">str24Hrs_state</span><span class="sc81"> = </span><span class="sc85">"checked"</span><span class="sc81">
</span><span class="sc84">Else</span><span class="sc81">
   </span><span class="sc86">str24Hrs_state</span><span class="sc81"> = </span><span class="sc85">""</span><span class="sc81"> 
</span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">

</span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">Request.QueryString</span><span class="sc81">(</span><span class="sc85">"chkRA"</span><span class="sc81">) = </span><span class="sc85">"on"</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
   </span><span class="sc86">strRA_state</span><span class="sc81"> = </span><span class="sc85">"checked"</span><span class="sc81">
</span><span class="sc84">Else</span><span class="sc81">
   </span><span class="sc86">strRA_state</span><span class="sc81"> = </span><span class="sc85">""</span><span class="sc81"> 
</span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">

</span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">Request.QueryString</span><span class="sc81">(</span><span class="sc85">"chkTimer"</span><span class="sc81">) = </span><span class="sc85">"on"</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
   </span><span class="sc86">strTimer_state</span><span class="sc81"> = </span><span class="sc85">"checked"</span><span class="sc81">
</span><span class="sc84">Else</span><span class="sc81">
   </span><span class="sc86">strTimer_state</span><span class="sc81"> = </span><span class="sc85">""</span><span class="sc81">
</span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">

</span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">strTimer_state</span><span class="sc81"> = </span><span class="sc85">"checked"</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
   </span><span class="sc82">'Check to see how far off the 5-minute mark. This should serve</span><span class="sc81">
   </span><span class="sc82">'to compensate for the drift in the client side timer.</span><span class="sc81">
   
   </span><span class="sc82">'Get the seconds and minutes from the server time.</span><span class="sc81">
   </span><span class="sc86">intSeconds_FromSeconds</span><span class="sc81"> = </span><span class="sc84">CInt</span><span class="sc81">(</span><span class="sc86">right</span><span class="sc81">(</span><span class="sc86">serverTime</span><span class="sc81">,</span><span class="sc83">2</span><span class="sc81">))
   </span><span class="sc86">intMinutes</span><span class="sc81"> = </span><span class="sc84">CInt</span><span class="sc81">(</span><span class="sc86">Split</span><span class="sc81">(</span><span class="sc86">serverTime</span><span class="sc81">,</span><span class="sc85">":"</span><span class="sc81">)(</span><span class="sc83">1</span><span class="sc81">))
   
   </span><span class="sc82">'How many five minute chunks.</span><span class="sc81">
   </span><span class="sc86">dblFiveMinutes</span><span class="sc81"> = </span><span class="sc84">CDbl</span><span class="sc81">(</span><span class="sc86">intMinutes</span><span class="sc81">)/</span><span class="sc83">5.0</span><span class="sc81">
   
   </span><span class="sc82">'Take the fractional part of this and convert to seconds.</span><span class="sc81">
   </span><span class="sc86">intSeconds_FromMinutes</span><span class="sc81"> = </span><span class="sc84">CInt</span><span class="sc81">(</span><span class="sc86">round</span><span class="sc81">(</span><span class="sc83">300</span><span class="sc81">*(</span><span class="sc86">dblFiveMinutes</span><span class="sc81"> - </span><span class="sc86">Fix</span><span class="sc81">(</span><span class="sc86">dblFiveMinutes</span><span class="sc81">)),</span><span class="sc83">0</span><span class="sc81">))
   
   </span><span class="sc82">'Subtract both of these values from 300 to get the proper delay for the client.</span><span class="sc81">
   </span><span class="sc82">'Then add 9 to keep it tracking at 10 seconds after the 5-minute mark.</span><span class="sc81">
   </span><span class="sc86">intDelay_to_5min</span><span class="sc81"> = </span><span class="sc83">300</span><span class="sc81"> - </span><span class="sc86">intSeconds_FromMinutes</span><span class="sc81"> - </span><span class="sc86">intSeconds_FromSeconds</span><span class="sc81"> + </span><span class="sc83">9</span><span class="sc81">
   </span><span class="sc86">strInitializeTimer</span><span class="sc81"> = </span><span class="sc85">"initializeTimer("</span><span class="sc81"> &amp; </span><span class="sc84">CStr</span><span class="sc81">(</span><span class="sc86">intDelay_to_5min</span><span class="sc81">) &amp; </span><span class="sc85">");"</span><span class="sc81">
   
</span><span class="sc84">Else</span><span class="sc81">
   </span><span class="sc86">strInitializeTimer</span><span class="sc81"> = </span><span class="sc85">""</span><span class="sc81">
</span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">

</span><span class="sc86">blnPostedDate_default</span><span class="sc81"> = </span><span class="sc84">False</span><span class="sc81">
</span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">Request.QueryString</span><span class="sc81">(</span><span class="sc85">"EndDate"</span><span class="sc81">) = </span><span class="sc85">""</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81"> 
   </span><span class="sc82">' Use the current date for a default. </span><span class="sc81">
   </span><span class="sc86">dtePostedDate</span><span class="sc81"> = </span><span class="sc84">CStr</span><span class="sc81">(</span><span class="sc84">Date</span><span class="sc81">())
   </span><span class="sc86">blnPostedDate_default</span><span class="sc81"> = </span><span class="sc84">True</span><span class="sc81">
</span><span class="sc84">Else</span><span class="sc81">
   </span><span class="sc82">' Split to just get the DATE part of this post.</span><span class="sc81">
   </span><span class="sc86">dtePostedDate</span><span class="sc81"> = </span><span class="sc86">split</span><span class="sc81">(</span><span class="sc86">Request.QueryString</span><span class="sc81">(</span><span class="sc85">"EndDate"</span><span class="sc81">),</span><span class="sc85">" "</span><span class="sc81">)(</span><span class="sc83">0</span><span class="sc81">)
</span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">

</span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">Request.QueryString</span><span class="sc81">(</span><span class="sc85">"Days"</span><span class="sc81">) = </span><span class="sc85">""</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81"> 
   </span><span class="sc86">intDays</span><span class="sc81"> = </span><span class="sc83">1</span><span class="sc81">
</span><span class="sc84">Else</span><span class="sc81">
   </span><span class="sc86">intDays</span><span class="sc81"> = </span><span class="sc86">Request.QueryString</span><span class="sc81">(</span><span class="sc85">"Days"</span><span class="sc81">)
</span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">

</span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">Request.QueryString</span><span class="sc81">(</span><span class="sc85">"Sensor"</span><span class="sc81">) = </span><span class="sc85">""</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81"> 
   </span><span class="sc86">strSensorType</span><span class="sc81"> = </span><span class="sc85">"Wind40"</span><span class="sc81">
</span><span class="sc84">Else</span><span class="sc81">
   </span><span class="sc86">strSensorType</span><span class="sc81"> = </span><span class="sc86">Request.QueryString</span><span class="sc81">(</span><span class="sc85">"Sensor"</span><span class="sc81">)
   </span><span class="sc82">' Don't allow request for Delta-P from any region but CR.</span><span class="sc81">
   </span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">strRegion</span><span class="sc81"> &lt;&gt; </span><span class="sc85">"CR"</span><span class="sc81">) </span><span class="sc84">And</span><span class="sc81"> (</span><span class="sc86">strSensorType</span><span class="sc81"> = </span><span class="sc85">"DeltaP"</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
         </span><span class="sc86">strSensorType</span><span class="sc81"> = </span><span class="sc85">"Wind40"</span><span class="sc81">
   </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">
</span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">

</span><span class="sc82">' Set the normalization factor for the wind direction data</span><span class="sc81">
</span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">strSensorType</span><span class="sc81"> = </span><span class="sc85">"Wind40"</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81"> 
   </span><span class="sc86">dblWindNormFactor</span><span class="sc81"> = </span><span class="sc83">40.0</span><span class="sc81"> / </span><span class="sc83">360.0</span><span class="sc81">
</span><span class="sc84">Else</span><span class="sc81">
   </span><span class="sc86">dblWindNormFactor</span><span class="sc81"> = </span><span class="sc83">1.0</span><span class="sc81"> / </span><span class="sc83">10.0</span><span class="sc81">
</span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">

</span><span class="sc82">' Set a default value for the location if the first time in or if the user changes</span><span class="sc81">
</span><span class="sc82">' the region.</span><span class="sc81">
</span><span class="sc84">If</span><span class="sc81"> ((</span><span class="sc86">Request.QueryString</span><span class="sc81">(</span><span class="sc85">"Location"</span><span class="sc81">) = </span><span class="sc85">""</span><span class="sc81">) </span><span class="sc84">or</span><span class="sc81"> (</span><span class="sc86">strRegionState</span><span class="sc81"> = </span><span class="sc85">"new"</span><span class="sc81">)) </span><span class="sc84">Then</span><span class="sc81"> 
   </span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">strRegion</span><span class="sc81"> = </span><span class="sc85">"CR"</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
      </span><span class="sc86">strLocation</span><span class="sc81"> = </span><span class="sc85">"PASC"</span><span class="sc81">
   </span><span class="sc84">ElseIf</span><span class="sc81"> (</span><span class="sc86">strRegion</span><span class="sc81"> = </span><span class="sc85">"MN"</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
      </span><span class="sc86">strLocation</span><span class="sc81"> = </span><span class="sc85">"KMKT"</span><span class="sc81">   
   </span><span class="sc84">ElseIf</span><span class="sc81"> (</span><span class="sc86">strRegion</span><span class="sc81"> = </span><span class="sc85">"Misc"</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
      </span><span class="sc86">strLocation</span><span class="sc81"> = </span><span class="sc85">"KCQX"</span><span class="sc81">    
   </span><span class="sc84">Else</span><span class="sc81">
      </span><span class="sc86">strLocation</span><span class="sc81"> = </span><span class="sc85">""</span><span class="sc81">
      </span><span class="sc86">RWBR</span><span class="sc81"> </span><span class="sc85">"No match in region branch..."</span><span class="sc81">
   </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">
</span><span class="sc84">Else</span><span class="sc81">
   </span><span class="sc86">strLocation</span><span class="sc81"> = </span><span class="sc86">Request.QueryString</span><span class="sc81">(</span><span class="sc85">"Location"</span><span class="sc81">)
</span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">

</span><span class="sc84">If</span><span class="sc81"> ((</span><span class="sc86">strSensorType</span><span class="sc81"> = </span><span class="sc85">"Wind40"</span><span class="sc81">) </span><span class="sc84">OR</span><span class="sc81"> (</span><span class="sc86">strSensorType</span><span class="sc81"> = </span><span class="sc85">"Wind36"</span><span class="sc81">)) </span><span class="sc84">Then</span><span class="sc81">
   </span><span class="sc86">strShowImages_command</span><span class="sc81"> = </span><span class="sc85">"showImage();showDirections();"</span><span class="sc81">
</span><span class="sc84">Else</span><span class="sc81">
   </span><span class="sc86">strShowImages_command</span><span class="sc81"> = </span><span class="sc85">"showImage();"</span><span class="sc81">
</span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">

</span><span class="sc86">strTimeZone</span><span class="sc81"> = </span><span class="sc86">TimeZone</span><span class="sc81">( </span><span class="sc86">strLocation</span><span class="sc81">)

</span><span class="sc86">RC</span><span class="sc81"> </span><span class="sc85">"&lt;body onLoad=testJS();"</span><span class="sc81"> &amp; </span><span class="sc86">strShowImages_command</span><span class="sc81"> &amp; </span><span class="sc86">strInitializeTimer</span><span class="sc81"> &amp; </span><span class="sc86">_</span><span class="sc81">
      </span><span class="sc85">" bgcolor=#FFCC99 link=#008080 vlink=#008080 topmargin=2 style=font-family:Arial;&gt;"</span><span class="sc81">

</span><span class="sc86">RC</span><span class="sc81"> </span><span class="sc85">"&lt;div class='pageblock'&gt;"</span><span class="sc81">

</span><span class="sc82">' If the region is specified, then make preparations for populating the table</span><span class="sc81">
</span><span class="sc82">' including getting the most recent values for all the sensor data.</span><span class="sc81">

</span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">Request.QueryString</span><span class="sc81">(</span><span class="sc85">"Region"</span><span class="sc81">) &lt;&gt; </span><span class="sc85">""</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">

   </span><span class="sc82">' If the end date in the chart request is within daylight savings time, then</span><span class="sc81">
   </span><span class="sc82">' set the DLS flag. Add 3 hours to make sure you evaluate the day after the</span><span class="sc81">
   </span><span class="sc82">' 2am change over point.</span><span class="sc81">

   </span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">DaylightSavingsTime</span><span class="sc81">(</span><span class="sc86">dateadd</span><span class="sc81">(</span><span class="sc85">"h"</span><span class="sc81">,</span><span class="sc83">3</span><span class="sc81">,</span><span class="sc86">dtePostedDate</span><span class="sc81">))) </span><span class="sc84">Then</span><span class="sc81"> 
      </span><span class="sc86">blnDayLightSavingsTime</span><span class="sc81"> = </span><span class="sc84">True</span><span class="sc81">
   </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">

   </span><span class="sc82">' Find the time of the most recent station record.</span><span class="sc81">
   </span><span class="sc86">strSQL</span><span class="sc81"> = </span><span class="sc85">"SELECT * FROM FifteenMinData "</span><span class="sc81"> &amp; </span><span class="sc86">_</span><span class="sc81">
            </span><span class="sc85">"WHERE (StationName = '"</span><span class="sc81"> &amp; </span><span class="sc86">strLocation</span><span class="sc81"> &amp; </span><span class="sc85">"') "</span><span class="sc81"> &amp; </span><span class="sc86">_</span><span class="sc81">
            </span><span class="sc85">"ORDER BY DateTimeStamp DESC "</span><span class="sc81"> &amp; </span><span class="sc86">_</span><span class="sc81">
            </span><span class="sc85">"LIMIT 1"</span><span class="sc81">  

   </span><span class="sc84">Set</span><span class="sc81"> </span><span class="sc86">rstMostRecent</span><span class="sc81"> = </span><span class="sc86">Server.CreateObject</span><span class="sc81">(</span><span class="sc85">"ADODB.Recordset"</span><span class="sc81">)
    </span><span class="sc84">On</span><span class="sc81"> </span><span class="sc84">Error</span><span class="sc81"> </span><span class="sc84">Resume</span><span class="sc81"> </span><span class="sc84">Next</span><span class="sc81">
    </span><span class="sc86">rstMostRecent.Open</span><span class="sc81"> </span><span class="sc86">strSQL</span><span class="sc81">, </span><span class="sc86">DBConnection</span><span class="sc81">, </span><span class="sc86">adOpenStatic</span><span class="sc81">, </span><span class="sc86">adLockReadOnly</span><span class="sc81">, </span><span class="sc86">adCmdText</span><span class="sc81">
    </span><span class="sc86">LogError</span><span class="sc81">(</span><span class="sc85">"Recordset = rstTelem, SQL = "</span><span class="sc81"> &amp; </span><span class="sc86">strSQL_trace</span><span class="sc81">)
    </span><span class="sc84">On</span><span class="sc81"> </span><span class="sc84">Error</span><span class="sc81"> </span><span class="sc84">Goto</span><span class="sc81"> </span><span class="sc83">0</span><span class="sc81">

   </span><span class="sc82">' Check to see if there are any records before applying the MoveFirst method</span><span class="sc81">
   </span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc84">Not</span><span class="sc81"> </span><span class="sc86">rstMostRecent.EOF</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">

      </span><span class="sc82">' If a default value was used for the posted date, correct it if the posted date</span><span class="sc81">
      </span><span class="sc82">' is more recent than the most recent data.   </span><span class="sc81">
      </span><span class="sc84">If</span><span class="sc81"> </span><span class="sc86">blnPostedDate_default</span><span class="sc81"> </span><span class="sc84">and</span><span class="sc81"> (</span><span class="sc86">DateDiff</span><span class="sc81">(</span><span class="sc85">"d"</span><span class="sc81">, </span><span class="sc86">dtePostedDate</span><span class="sc81">, </span><span class="sc86">rstMostRecent</span><span class="sc81">(</span><span class="sc85">"TimeMDY"</span><span class="sc81">)) &lt; </span><span class="sc83">0</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
         </span><span class="sc86">dtePostedDate</span><span class="sc81"> = </span><span class="sc86">rstMostRecent</span><span class="sc81">(</span><span class="sc85">"TimeMDY"</span><span class="sc81">)
      </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">
      
      </span><span class="sc82">'Warning: this variable changes type here.</span><span class="sc81">
      </span><span class="sc86">strMRTime</span><span class="sc81"> = </span><span class="sc86">rstMostRecent</span><span class="sc81">(</span><span class="sc85">"TimeMDY"</span><span class="sc81">) &amp; </span><span class="sc85">" "</span><span class="sc81"> &amp; </span><span class="sc86">rstMostRecent</span><span class="sc81">(</span><span class="sc85">"TimeHr"</span><span class="sc81">) &amp; </span><span class="sc85">":"</span><span class="sc81"> &amp; </span><span class="sc86">rstMostRecent</span><span class="sc81">(</span><span class="sc85">"TimeMin"</span><span class="sc81">)
      </span><span class="sc86">strMRTime</span><span class="sc81"> = </span><span class="sc86">FormatDateTime</span><span class="sc81">(</span><span class="sc86">strMRTime</span><span class="sc81">, </span><span class="sc86">vbGeneralDate</span><span class="sc81">)
      
      </span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">rstMostRecent</span><span class="sc81">(</span><span class="sc85">"WindDirection"</span><span class="sc81">) = -</span><span class="sc83">10</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
         </span><span class="sc86">strMRWindDir</span><span class="sc81"> = </span><span class="sc85">"Variable"</span><span class="sc81">
      </span><span class="sc84">Else</span><span class="sc81">
         </span><span class="sc84">If</span><span class="sc81"> </span><span class="sc86">IsNull</span><span class="sc81">(</span><span class="sc86">rstMostRecent</span><span class="sc81">(</span><span class="sc85">"WindDirection"</span><span class="sc81">)) </span><span class="sc84">Then</span><span class="sc81">
            </span><span class="sc86">strMRWindDir</span><span class="sc81"> = </span><span class="sc85">"-"</span><span class="sc81">
         </span><span class="sc84">Else</span><span class="sc81">
            </span><span class="sc86">strMRWindDir</span><span class="sc81"> = </span><span class="sc86">rstMostRecent</span><span class="sc81">(</span><span class="sc85">"WindDirection"</span><span class="sc81">) &amp; </span><span class="sc86">_</span><span class="sc81">
                           </span><span class="sc85">" deg. ["</span><span class="sc81"> &amp; </span><span class="sc86">DirectionLabel</span><span class="sc81">(</span><span class="sc86">rstMostRecent</span><span class="sc81">(</span><span class="sc85">"WindDirection"</span><span class="sc81">)) &amp; </span><span class="sc85">"]"</span><span class="sc81"> &amp; </span><span class="sc86">_</span><span class="sc81">
                           </span><span class="sc85">" ["</span><span class="sc81"> &amp; </span><span class="sc86">FormatNumber</span><span class="sc81">(</span><span class="sc86">rstMostRecent</span><span class="sc81">(</span><span class="sc85">"WindDirection"</span><span class="sc81">) * </span><span class="sc86">dblWindNormFactor</span><span class="sc81">, </span><span class="sc83">1</span><span class="sc81">) &amp; </span><span class="sc85">"]"</span><span class="sc81">
         </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">
      </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">    
      </span><span class="sc84">If</span><span class="sc81"> </span><span class="sc86">IsNull</span><span class="sc81">(</span><span class="sc86">rstMostRecent</span><span class="sc81">(</span><span class="sc85">"WindSpeed"</span><span class="sc81">)) </span><span class="sc84">Then</span><span class="sc81">
         </span><span class="sc86">strMRWindAvg</span><span class="sc81"> = </span><span class="sc85">"-"</span><span class="sc81"> 
         </span><span class="sc86">strMRWindMax</span><span class="sc81"> = </span><span class="sc85">"-"</span><span class="sc81">
      </span><span class="sc84">Else</span><span class="sc81">
         </span><span class="sc86">strMRWindAvg</span><span class="sc81"> = </span><span class="sc86">rstMostRecent</span><span class="sc81">(</span><span class="sc85">"WindSpeed"</span><span class="sc81">)
         </span><span class="sc86">strMRWindMax</span><span class="sc81"> = </span><span class="sc86">rstMostRecent</span><span class="sc81">(</span><span class="sc85">"WindGust"</span><span class="sc81">)
      </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">

      </span><span class="sc84">If</span><span class="sc81"> </span><span class="sc86">IsNull</span><span class="sc81">(</span><span class="sc86">rstMostRecent</span><span class="sc81">(</span><span class="sc85">"Pressure"</span><span class="sc81">)) </span><span class="sc84">Then</span><span class="sc81">
         </span><span class="sc86">strMRPressure</span><span class="sc81"> = </span><span class="sc85">"-"</span><span class="sc81">
      </span><span class="sc84">Else</span><span class="sc81">
         </span><span class="sc86">strMRPressure</span><span class="sc81"> = </span><span class="sc86">round</span><span class="sc81">(</span><span class="sc86">rstMostRecent</span><span class="sc81">(</span><span class="sc85">"Pressure"</span><span class="sc81">),</span><span class="sc83">2</span><span class="sc81">)
      </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81"> 

      </span><span class="sc86">strMRTemp</span><span class="sc81"> = </span><span class="sc86">rstMostRecent</span><span class="sc81">(</span><span class="sc85">"TempAvg"</span><span class="sc81">)
      </span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">IsNull</span><span class="sc81">(</span><span class="sc86">strMRTemp</span><span class="sc81">)) </span><span class="sc84">Then</span><span class="sc81">
         </span><span class="sc86">strMRTemp</span><span class="sc81"> = </span><span class="sc85">"-"</span><span class="sc81">
      </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">
      
      </span><span class="sc86">strMRDewPoint</span><span class="sc81"> = </span><span class="sc86">rstMostRecent</span><span class="sc81">(</span><span class="sc85">"DewPoint"</span><span class="sc81">) 
      </span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">IsNull</span><span class="sc81">(</span><span class="sc86">strMRDewPoint</span><span class="sc81">)) </span><span class="sc84">Then</span><span class="sc81">
         </span><span class="sc86">strMRDewPoint</span><span class="sc81"> = </span><span class="sc85">"-"</span><span class="sc81">
      </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">
   
   </span><span class="sc84">Else</span><span class="sc81">
      </span><span class="sc86">strMRTime</span><span class="sc81"> = </span><span class="sc85">"-"</span><span class="sc81">
      </span><span class="sc86">strMRWindDir</span><span class="sc81"> = </span><span class="sc85">"-"</span><span class="sc81">
      </span><span class="sc86">strMRWindAvg</span><span class="sc81"> = </span><span class="sc85">"-"</span><span class="sc81">
      </span><span class="sc86">strMRWindMax</span><span class="sc81"> = </span><span class="sc85">"-"</span><span class="sc81">
      </span><span class="sc86">strMRTemp</span><span class="sc81"> = </span><span class="sc85">"-"</span><span class="sc81">
      </span><span class="sc86">strMRPressure</span><span class="sc81"> = </span><span class="sc85">"-"</span><span class="sc81">   
      </span><span class="sc86">strMRDewPoint</span><span class="sc81"> = </span><span class="sc85">"-"</span><span class="sc81"> 
   </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">
   
   </span><span class="sc84">If</span><span class="sc81"> </span><span class="sc86">rstMostRecent.State</span><span class="sc81"> = </span><span class="sc86">adStateOpen</span><span class="sc81"> </span><span class="sc84">Then</span><span class="sc81"> </span><span class="sc86">rstMostRecent.Close</span><span class="sc81">
   </span><span class="sc84">Set</span><span class="sc81"> </span><span class="sc86">rstMostRecent</span><span class="sc81"> = </span><span class="sc84">Nothing</span><span class="sc81">
   
   </span><span class="sc86">strButtonLabel</span><span class="sc81"> = </span><span class="sc85">"Update"</span><span class="sc81">
   
</span><span class="sc84">Else</span><span class="sc81">
   </span><span class="sc86">dtePostedDate</span><span class="sc81"> = </span><span class="sc85">""</span><span class="sc81">

   </span><span class="sc82">' Before first post (first time in) just show these dashes in the table...</span><span class="sc81">
   </span><span class="sc86">strMRTime</span><span class="sc81"> = </span><span class="sc85">"-"</span><span class="sc81">
   </span><span class="sc86">strMRWindDir</span><span class="sc81"> = </span><span class="sc85">"-"</span><span class="sc81">
   </span><span class="sc86">strMRWindAvg</span><span class="sc81"> = </span><span class="sc85">"-"</span><span class="sc81">
   </span><span class="sc86">strMRWindMax</span><span class="sc81"> = </span><span class="sc85">"-"</span><span class="sc81">
   </span><span class="sc86">strMRTemp</span><span class="sc81"> = </span><span class="sc85">"-"</span><span class="sc81">
   </span><span class="sc86">strMRPressure</span><span class="sc81"> = </span><span class="sc85">"-"</span><span class="sc81">
   </span><span class="sc86">strMRDewPoint</span><span class="sc81"> = </span><span class="sc85">"-"</span><span class="sc81"> 

   </span><span class="sc86">strButtonLabel</span><span class="sc81"> = </span><span class="sc85">"Chart"</span><span class="sc81">
   
</span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">

</span><span class="sc82">'===========================================================================</span><span class="sc81">
</span><span class="sc82">' The current data table and CONTROLS form...</span><span class="sc81">
</span><span class="sc82">'===========================================================================</span><span class="sc81">
</span><span class="sc86">RC</span><span class="sc81"> </span><span class="sc85">"&lt;table border='1'&gt;"</span><span class="sc81">

</span><span class="sc82">' First row</span><span class="sc81">

</span><span class="sc86">RC</span><span class="sc81"> </span><span class="sc85">"&lt;tr&gt;"</span><span class="sc81">

</span><span class="sc86">RC</span><span class="sc81"> </span><span class="sc85">"&lt;td class='data' width='37%' rowspan='3'&gt;"</span><span class="sc81">
</span><span class="sc82">'RC "&lt;p align='center'&gt;&lt;a onmouseover=""changeRegionAnchorValue('" &amp; strRegion &amp; "')"" onmouseout=""changeRegionAnchorValue('" &amp; strTitle &amp; "')"" name='regionanchor' id='regionanchor' class='noline' href='" &amp; strRegionURL &amp; "'&gt;" &amp; strTitle  &amp; "&lt;/a&gt;&amp;nbsp;&lt;br&gt;"</span><span class="sc81">
</span><span class="sc86">RC</span><span class="sc81"> </span><span class="sc85">"&lt;p align='center'&gt;&lt;span class='regionstring'&gt;"</span><span class="sc81"> &amp; </span><span class="sc86">RegionString</span><span class="sc81">( </span><span class="sc86">strRegion</span><span class="sc81">) &amp; </span><span class="sc85">"&lt;/span&gt;&lt;br&gt;"</span><span class="sc81">
</span><span class="sc86">RC</span><span class="sc81"> </span><span class="sc85">"&lt;a target='_blank' href='http://waconia.timetocode.org/FAQ.htm'&gt;&lt;font size='2' color='#FF0000'&gt;Help&lt;/font&gt;"</span><span class="sc81"> &amp; </span><span class="sc86">_</span><span class="sc81">
                     </span><span class="sc85">"&lt;font size='2' color='#008080'&gt;: FAQs&lt;/font&gt;&lt;/a&gt;&amp;nbsp;"</span><span class="sc81">

</span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">strRegion</span><span class="sc81"> = </span><span class="sc85">"MN"</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
   </span><span class="sc86">RC</span><span class="sc81"> </span><span class="sc85">"&lt;a href='pictures/mn_sites.jpg'&gt;&lt;font size='2' color='#008080'&gt;Sites&lt;/font&gt;&lt;/a&gt;&amp;nbsp;"</span><span class="sc81">
</span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">
</span><span class="sc86">RC</span><span class="sc81"> </span><span class="sc85">"&lt;a href='default.htm'&gt;&lt;font size='2'&gt;(home)&lt;/font&gt;&lt;/a&gt;"</span><span class="sc81">

</span><span class="sc82">' Create a object for working with the image files...</span><span class="sc81">
</span><span class="sc84">Set</span><span class="sc81"> </span><span class="sc86">fsoObject</span><span class="sc81"> = </span><span class="sc86">CreateObject</span><span class="sc81">(</span><span class="sc85">"Scripting.FileSystemObject"</span><span class="sc81">)
</span><span class="sc82">' Note: path to image directory is defined in include file.</span><span class="sc81">
</span><span class="sc84">Set</span><span class="sc81"> </span><span class="sc86">fdrObject</span><span class="sc81"> = </span><span class="sc86">fsoObject.GetFolder</span><span class="sc81">(</span><span class="sc86">strPathToImageDir</span><span class="sc81">)
         
</span><span class="sc82">' Clean out any old temp image files. This is a new approach that doesn't depend on script in the global ASA</span><span class="sc81">
</span><span class="sc86">intFileCount</span><span class="sc81"> = </span><span class="sc83">0</span><span class="sc81">
</span><span class="sc84">For</span><span class="sc81"> </span><span class="sc84">Each</span><span class="sc81"> </span><span class="sc86">filObject</span><span class="sc81"> </span><span class="sc84">in</span><span class="sc81"> </span><span class="sc86">fdrObject.Files</span><span class="sc81">
   </span><span class="sc84">Dim</span><span class="sc81"> </span><span class="sc86">fileAge</span><span class="sc81">, </span><span class="sc86">fileDate</span><span class="sc81">
   </span><span class="sc86">fileDate</span><span class="sc81"> = </span><span class="sc86">filObject.DateLastModified</span><span class="sc81">
   </span><span class="sc86">fileAge</span><span class="sc81"> = </span><span class="sc86">DateDiff</span><span class="sc81">(</span><span class="sc85">"h"</span><span class="sc81">, </span><span class="sc86">fileDate</span><span class="sc81">, </span><span class="sc86">Now</span><span class="sc81">())
   
   </span><span class="sc82">' Count files that are less than 1 day old.</span><span class="sc81">
   </span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">fileAge</span><span class="sc81"> &lt;= </span><span class="sc83">24</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
      </span><span class="sc86">intFileCount</span><span class="sc81"> = </span><span class="sc86">intFileCount</span><span class="sc81"> + </span><span class="sc83">1</span><span class="sc81">
   </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">
   
   </span><span class="sc82">' Delete files that are more than three days old.</span><span class="sc81">
   </span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">fileAge</span><span class="sc81"> &gt; </span><span class="sc83">72</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
      </span><span class="sc86">filObject.delete</span><span class="sc81">
   </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">  
</span><span class="sc84">Next</span><span class="sc81">         

</span><span class="sc82">' Write out a count of image files in the directory (1 and 7 day counts).</span><span class="sc81">
</span><span class="sc82">' Put the serverTime in a span so can access it from the client (if needed, may not actually use this).          </span><span class="sc81">
</span><span class="sc86">RC</span><span class="sc81"> </span><span class="sc85">"&lt;font color='#008080'  size='1'&gt;"</span><span class="sc81"> &amp; </span><span class="sc86">_</span><span class="sc81">
   </span><span class="sc85">"&amp;nbsp;&amp;nbsp;"</span><span class="sc81"> &amp; </span><span class="sc86">intFileCount</span><span class="sc81"> &amp; </span><span class="sc85">"-(1d)&amp;nbsp;&amp;nbsp;"</span><span class="sc81"> &amp; </span><span class="sc86">fdrObject.Files.Count</span><span class="sc81"> &amp; </span><span class="sc85">"-(3d)&amp;nbsp;&amp;nbsp;"</span><span class="sc81"> &amp; </span><span class="sc86">_</span><span class="sc81">
   </span><span class="sc85">"&lt;span id='spServerTime' name='spServerTime'&gt;"</span><span class="sc81"> &amp; </span><span class="sc86">serverTime</span><span class="sc81"> &amp; </span><span class="sc85">"&lt;/span&gt;"</span><span class="sc81"> &amp; </span><span class="sc86">_</span><span class="sc81">
   </span><span class="sc85">" ("</span><span class="sc81"> &amp; </span><span class="sc86">AgeOfData</span><span class="sc81">(</span><span class="sc86">strMRTime</span><span class="sc81">) &amp; </span><span class="sc85">")"</span><span class="sc81"> &amp; </span><span class="sc86">_</span><span class="sc81">
   </span><span class="sc85">"&lt;/font&gt;"</span><span class="sc81"> &amp; </span><span class="sc86">_</span><span class="sc81">
   </span><span class="sc85">"&lt;/p&gt;"</span><span class="sc81">
</span><span class="sc86">RC</span><span class="sc81"> </span><span class="sc85">"&lt;/td&gt;"</span><span class="sc81">

</span><span class="sc82">' Rest of the table headers</span><span class="sc81">
</span><span class="sc86">RC</span><span class="sc81"> </span><span class="sc85">"&lt;td width='23%' align='center' rowspan='2'&gt;&lt;b&gt;&lt;font color='#FF0000'&gt;Latest&lt;/font&gt;"</span><span class="sc81">
</span><span class="sc86">RC</span><span class="sc81"> </span><span class="sc85">"&lt;font color='#008080'&gt; Reading"</span><span class="sc81">
</span><span class="sc86">RC</span><span class="sc81"> </span><span class="sc85">"&lt;/font&gt;&lt;/b&gt;"</span><span class="sc81">
</span><span class="sc86">RC</span><span class="sc81"> </span><span class="sc85">"&lt;/td&gt;"</span><span class="sc81">

</span><span class="sc86">RC</span><span class="sc81"> </span><span class="sc85">"&lt;td width='26%' align='center' colspan='3'&gt;&lt;font color='#008080'&gt;&lt;b&gt;Wind &lt;/b&gt;&lt;font size='2'&gt; (mph)&lt;/font&gt;&lt;/font&gt;&lt;/td&gt;"</span><span class="sc81">

</span><span class="sc86">RC</span><span class="sc81"> </span><span class="sc85">"&lt;td nowrap width='6%' align='center' colspan='2' rowspan='1'&gt;&lt;font color='#008080'&gt;&lt;b&gt;Temp&lt;/b&gt;&lt;font size='2'&gt; (&lt;sup&gt;o&lt;/sup&gt;F)&lt;/font&gt;&lt;/font&gt;&lt;/td&gt;"</span><span class="sc81">
</span><span class="sc86">RC</span><span class="sc81"> </span><span class="sc85">"&lt;td width='8%' align='center' rowspan='2'&gt;&lt;font color='#008080'&gt;&lt;b&gt;Pressure&lt;br&gt;&lt;/b&gt;&lt;font size='2'&gt; (in Hg"</span><span class="sc81"> &amp; </span><span class="sc86">strHGSL</span><span class="sc81"> &amp; </span><span class="sc85">")&lt;/font&gt;&lt;/font&gt;&lt;/td&gt;"</span><span class="sc81">
</span><span class="sc86">RC</span><span class="sc81"> </span><span class="sc85">"&lt;/tr&gt;"</span><span class="sc81">

</span><span class="sc82">' Second row</span><span class="sc81">

</span><span class="sc86">RC</span><span class="sc81"> </span><span class="sc85">"&lt;tr&gt;"</span><span class="sc81">
</span><span class="sc86">RC</span><span class="sc81"> </span><span class="sc85">"&lt;td width='6%' align='center'&gt;&lt;font color='#008080' size='2'&gt;Avg&lt;/font&gt;&lt;/td&gt;"</span><span class="sc81">
</span><span class="sc86">RC</span><span class="sc81"> </span><span class="sc85">"&lt;td width='5%' align='center'&gt;&lt;font color='#008080' size='2'&gt;Max&lt;/font&gt;&lt;/td&gt;"</span><span class="sc81">
</span><span class="sc86">RC</span><span class="sc81"> </span><span class="sc85">"&lt;td width='18%' align='center'&gt;&lt;font color='#008080' size='2'&gt;Direction&lt;/font&gt;&lt;/td&gt;"</span><span class="sc81">
</span><span class="sc86">RC</span><span class="sc81"> </span><span class="sc85">"&lt;td align='center'&gt;&lt;font color='#008080' size='2'&gt;DryBulb&lt;/font&gt;&lt;/td&gt;"</span><span class="sc81">
</span><span class="sc86">RC</span><span class="sc81"> </span><span class="sc85">"&lt;td align='center'&gt;&lt;font color='#008080' size='2'&gt;DewPoint&lt;/font&gt;&lt;/td&gt;"</span><span class="sc81">
</span><span class="sc86">RC</span><span class="sc81"> </span><span class="sc85">"&lt;/tr&gt;"</span><span class="sc81">

</span><span class="sc82">' Third row</span><span class="sc81">

</span><span class="sc86">RC</span><span class="sc81"> </span><span class="sc85">"&lt;tr&gt;"</span><span class="sc81">
</span><span class="sc86">RC</span><span class="sc81"> </span><span class="sc85">"&lt;td class='data' width='20%' align='center'&gt;&lt;font color='#000000' size='2'&gt;"</span><span class="sc81">
</span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">strMRTime</span><span class="sc81"> &lt;&gt; </span><span class="sc85">"-"</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
   </span><span class="sc82">'rwbr "strMRTime = " &amp; strMRTime &amp; ", strTimeZone = " &amp; strTimeZone &amp; ", DaylightSavingsTime(strMRTime) = " &amp; DaylightSavingsTime(strMRTime)</span><span class="sc81">
   </span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">DaylightSavingsTime</span><span class="sc81">(</span><span class="sc86">strMRTime</span><span class="sc81">) </span><span class="sc84">And</span><span class="sc81"> (</span><span class="sc86">strTimeZone</span><span class="sc81"> &lt;&gt; </span><span class="sc85">"H"</span><span class="sc81">)) </span><span class="sc84">Then</span><span class="sc81">
      </span><span class="sc86">Response.Write</span><span class="sc81"> </span><span class="sc86">DateAdd</span><span class="sc81">(</span><span class="sc85">"h"</span><span class="sc81">,</span><span class="sc83">1</span><span class="sc81">,</span><span class="sc86">strMRTime</span><span class="sc81">) &amp; </span><span class="sc85">" ("</span><span class="sc81"> &amp; </span><span class="sc86">strTimeZone</span><span class="sc81"> &amp; </span><span class="sc85">"DT)"</span><span class="sc81">
   </span><span class="sc84">Else</span><span class="sc81">
      </span><span class="sc86">Response.Write</span><span class="sc81">               </span><span class="sc86">strMRTime</span><span class="sc81">  &amp; </span><span class="sc85">" ("</span><span class="sc81"> &amp; </span><span class="sc86">strTimeZone</span><span class="sc81"> &amp; </span><span class="sc85">"ST)"</span><span class="sc81">
   </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">
</span><span class="sc84">Else</span><span class="sc81">
   </span><span class="sc86">Response.Write</span><span class="sc81"> </span><span class="sc86">strMRTime</span><span class="sc81">
</span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">
</span><span class="sc86">RC</span><span class="sc81"> </span><span class="sc85">"&lt;/font&gt;&lt;/td&gt;"</span><span class="sc81">
</span><span class="sc86">RC</span><span class="sc81"> </span><span class="sc85">"&lt;td class='data' width='6%' align='center'&gt;&lt;font color='#000000' size='2'&gt;"</span><span class="sc81"> &amp; </span><span class="sc86">strMRWindAvg</span><span class="sc81"> &amp; </span><span class="sc85">"&lt;/font&gt;&lt;/td&gt;"</span><span class="sc81">
</span><span class="sc86">RC</span><span class="sc81"> </span><span class="sc85">"&lt;td class='data' width='5%' align='center'&gt;&lt;font color='#000000' size='2'&gt;"</span><span class="sc81"> &amp; </span><span class="sc86">strMRWindMax</span><span class="sc81"> &amp; </span><span class="sc85">"&lt;/font&gt;&lt;/td&gt;"</span><span class="sc81">
</span><span class="sc86">RC</span><span class="sc81"> </span><span class="sc85">"&lt;td class='data' width='18%' align='center'&gt;&lt;font color='#000000' size='2'&gt;"</span><span class="sc81"> &amp; </span><span class="sc86">strMRWindDir</span><span class="sc81"> &amp; </span><span class="sc85">"&lt;/font&gt;&lt;/td&gt;"</span><span class="sc81">
</span><span class="sc86">RC</span><span class="sc81"> </span><span class="sc85">"&lt;td class='data' width='6%' align='center'&gt;&lt;font color='#000000' size='2'&gt;"</span><span class="sc81"> &amp; </span><span class="sc86">strMRTemp</span><span class="sc81"> &amp; </span><span class="sc85">"&lt;/font&gt;&lt;/td&gt;"</span><span class="sc81">
</span><span class="sc86">RC</span><span class="sc81"> </span><span class="sc85">"&lt;td class='data' width='6%' align='center'&gt;&lt;font color='#000000' size='2'&gt;"</span><span class="sc81"> &amp; </span><span class="sc86">strMRDewPoint</span><span class="sc81"> &amp; </span><span class="sc85">"&lt;/font&gt;&lt;/td&gt;"</span><span class="sc81">
</span><span class="sc86">RC</span><span class="sc81"> </span><span class="sc85">"&lt;td class='data' width='8%' align='center'&gt;&lt;font color='#000000' size='2'&gt;"</span><span class="sc81"> &amp; </span><span class="sc86">strMRPressure</span><span class="sc81"> &amp; </span><span class="sc85">"&lt;/font&gt;&lt;/td&gt;"</span><span class="sc81">
</span><span class="sc86">RC</span><span class="sc81"> </span><span class="sc85">"&lt;/tr&gt;"</span><span class="sc81">

</span><span class="sc86">RC</span><span class="sc81"> </span><span class="sc85">"&lt;/table&gt;"</span><span class="sc81">

</span><span class="sc82">'=============================================================================</span><span class="sc81">
</span><span class="sc82">' Build a line of controls</span><span class="sc81">
</span><span class="sc82">'=============================================================================   </span><span class="sc81">

</span><span class="sc86">RC</span><span class="sc81"> </span><span class="sc85">"&lt;br&gt;"</span><span class="sc81">
</span><span class="sc82">' Note that the GET method invokes the QueryString approach and submits form data in the URL.</span><span class="sc81">
</span><span class="sc86">RC</span><span class="sc81"> </span><span class="sc85">"&lt;form method='GET' accept-charset='utf-8' action='rosy.asp' name='ChartingParameters' id='ChartingParameters'&gt;"</span><span class="sc81">

</span><span class="sc82">' Removing the "name" parameter here avoids submitting this with the form.</span><span class="sc81">
</span><span class="sc82">' Another option is to use "button" instead of "input".</span><span class="sc81">


</span><span class="sc82">' The submit button.</span><span class="sc81">

</span><span class="sc82">'RC "&lt;...........................................name='submit_button'&gt;"</span><span class="sc81">
</span><span class="sc86">RC</span><span class="sc81"> </span><span class="sc85">"&lt;input type='button' title='Query the database and update the plot.' value='"</span><span class="sc81"> &amp; </span><span class="sc86">strButtonLabel</span><span class="sc81"> &amp; </span><span class="sc85">"' name='myButton' id='myButton' style='width: 90px' onclick='submitform()'&gt;"</span><span class="sc81">


</span><span class="sc82">' Region</span><span class="sc81">

</span><span class="sc86">RC</span><span class="sc81"> </span><span class="sc85">"&lt;select title='Region' size='1' name='Region' id='Region' onChange='setRegionState()'&gt;"</span><span class="sc81">
</span><span class="sc86">arrRegions</span><span class="sc81"> = </span><span class="sc86">Array</span><span class="sc81">(</span><span class="sc85">"MN"</span><span class="sc81">,</span><span class="sc85">"CR"</span><span class="sc81">,</span><span class="sc85">"Misc"</span><span class="sc81">)
</span><span class="sc84">For</span><span class="sc81"> </span><span class="sc84">each</span><span class="sc81"> </span><span class="sc86">strRegionValue</span><span class="sc81"> </span><span class="sc84">in</span><span class="sc81"> </span><span class="sc86">arrRegions</span><span class="sc81">
   </span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">strRegionValue</span><span class="sc81"> = </span><span class="sc86">strRegion</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
      </span><span class="sc86">RC</span><span class="sc81"> </span><span class="sc85">"   &lt;option selected&gt;"</span><span class="sc81"> &amp; </span><span class="sc86">strRegionValue</span><span class="sc81">
   </span><span class="sc84">Else</span><span class="sc81">
      </span><span class="sc86">RC</span><span class="sc81"> </span><span class="sc85">"   &lt;option&gt;"</span><span class="sc81"> &amp; </span><span class="sc86">strRegionValue</span><span class="sc81">
   </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">
</span><span class="sc84">Next</span><span class="sc81">
</span><span class="sc86">RC</span><span class="sc81"> </span><span class="sc85">"&lt;/select&gt;"</span><span class="sc81">

</span><span class="sc82">' A hidden field that serves to indicate whether a new region has been selected. This is needed</span><span class="sc81">
</span><span class="sc82">' for determining the default location if the region selection changes.</span><span class="sc81">
</span><span class="sc86">RC</span><span class="sc81"> </span><span class="sc85">"&lt;input type='hidden' name='Region_state' id= 'Region_state' value='old'&gt;"</span><span class="sc81">


</span><span class="sc82">' Location</span><span class="sc81">

</span><span class="sc86">strSQL</span><span class="sc81"> = </span><span class="sc85">"SELECT StationNames.Priority, StationNames.StationName, StationNames.NickName FROM StationNames "</span><span class="sc81"> &amp; </span><span class="sc86">_</span><span class="sc81">
         </span><span class="sc85">"WHERE (Region='"</span><span class="sc81"> &amp; </span><span class="sc86">strRegion</span><span class="sc81">  &amp; </span><span class="sc85">"') "</span><span class="sc81"> &amp; </span><span class="sc86">_</span><span class="sc81">
         </span><span class="sc85">"ORDER BY Priority, NickName"</span><span class="sc81">

</span><span class="sc84">Set</span><span class="sc81"> </span><span class="sc86">rstStations</span><span class="sc81"> = </span><span class="sc86">Server.CreateObject</span><span class="sc81">(</span><span class="sc85">"ADODB.Recordset"</span><span class="sc81">)
</span><span class="sc84">On</span><span class="sc81"> </span><span class="sc84">Error</span><span class="sc81"> </span><span class="sc84">Resume</span><span class="sc81"> </span><span class="sc84">Next</span><span class="sc81">
</span><span class="sc86">rstStations.Open</span><span class="sc81"> </span><span class="sc86">strSQL</span><span class="sc81">, </span><span class="sc86">DBConnection</span><span class="sc81">, </span><span class="sc86">adOpenStatic</span><span class="sc81">, </span><span class="sc86">adLockReadOnly</span><span class="sc81">, </span><span class="sc86">adCmdText</span><span class="sc81">
</span><span class="sc86">LogError</span><span class="sc81">(</span><span class="sc85">"Recordset = rstTelem, SQL = "</span><span class="sc81"> &amp; </span><span class="sc86">strSQL_trace</span><span class="sc81">)
</span><span class="sc84">On</span><span class="sc81"> </span><span class="sc84">Error</span><span class="sc81"> </span><span class="sc84">Goto</span><span class="sc81"> </span><span class="sc83">0</span><span class="sc81">

</span><span class="sc86">RC</span><span class="sc81"> </span><span class="sc85">"&lt;select title='Location of weather station' size='1' name='Location' id='Location' onChange='submitform()'&gt;"</span><span class="sc81">
</span><span class="sc86">rstStations.movefirst</span><span class="sc81">
</span><span class="sc84">Do</span><span class="sc81"> </span><span class="sc84">until</span><span class="sc81"> </span><span class="sc86">rstStations.EOF</span><span class="sc81"> 
   </span><span class="sc82">' Exclude inactive stations from the selection list (marked as "skip" in the database).</span><span class="sc81">
   </span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">InStr</span><span class="sc81">(</span><span class="sc86">rstStations</span><span class="sc81">(</span><span class="sc85">"Priority"</span><span class="sc81">),</span><span class="sc85">"skip"</span><span class="sc81">)=</span><span class="sc83">0</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
   
      </span><span class="sc82">'Populate the list and set the selected station for the two regions.</span><span class="sc81">
      </span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">rstStations</span><span class="sc81">(</span><span class="sc85">"StationName"</span><span class="sc81">) =  </span><span class="sc86">strLocation</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81"> 
         </span><span class="sc86">strNameForPlot</span><span class="sc81"> = </span><span class="sc86">rstStations</span><span class="sc81">(</span><span class="sc85">"NickName"</span><span class="sc81">)
         </span><span class="sc86">RC</span><span class="sc81"> </span><span class="sc85">"   &lt;option value='"</span><span class="sc81"> &amp; </span><span class="sc86">rstStations</span><span class="sc81">(</span><span class="sc85">"StationName"</span><span class="sc81">) &amp; </span><span class="sc85">"' selected&gt;"</span><span class="sc81"> &amp; </span><span class="sc86">rstStations</span><span class="sc81">(</span><span class="sc85">"NickName"</span><span class="sc81">) 
      </span><span class="sc84">Else</span><span class="sc81">
         </span><span class="sc86">RC</span><span class="sc81"> </span><span class="sc85">"   &lt;option value='"</span><span class="sc81"> &amp; </span><span class="sc86">rstStations</span><span class="sc81">(</span><span class="sc85">"StationName"</span><span class="sc81">) &amp; </span><span class="sc85">"'&gt;"</span><span class="sc81"> &amp; </span><span class="sc86">rstStations</span><span class="sc81">(</span><span class="sc85">"NickName"</span><span class="sc81">)
      </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">
   
   </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">
   </span><span class="sc86">rstStations.movenext</span><span class="sc81">
</span><span class="sc84">loop</span><span class="sc81">
</span><span class="sc86">RC</span><span class="sc81"> </span><span class="sc85">"&lt;/select&gt;"</span><span class="sc81">

</span><span class="sc84">If</span><span class="sc81"> </span><span class="sc86">rstStations.State</span><span class="sc81"> = </span><span class="sc86">adStateOpen</span><span class="sc81"> </span><span class="sc84">Then</span><span class="sc81"> </span><span class="sc86">rstStations.Close</span><span class="sc81">
</span><span class="sc84">Set</span><span class="sc81"> </span><span class="sc86">rstStations</span><span class="sc81"> = </span><span class="sc84">Nothing</span><span class="sc81">

</span><span class="sc82">' Click for next location.</span><span class="sc81">
</span><span class="sc86">RC</span><span class="sc81"> </span><span class="sc85">"&lt;INPUT  title='Click to step through the list of locations.' type='button' style='WIDTH:18px; HEIGHT:23px; COLOR:black; padding-left:3px;' value='&gt;' id='btnStepLocationForward' name='btnStepLocationForward' onClick='stepLocationForward()'&gt;"</span><span class="sc81">


</span><span class="sc82">' Sensor type</span><span class="sc81">

</span><span class="sc86">WeatherTypes</span><span class="sc81"> =     </span><span class="sc86">Array</span><span class="sc81">(</span><span class="sc85">"Wind (0-36)"</span><span class="sc81">, </span><span class="sc85">"Wind (0-40)"</span><span class="sc81">, </span><span class="sc85">"Temperature"</span><span class="sc81">, </span><span class="sc85">"Pressure"</span><span class="sc81">, </span><span class="sc85">"Delta-P1"</span><span class="sc81">, </span><span class="sc85">"Delta-P2"</span><span class="sc81">)
</span><span class="sc86">WeatherTypes_URL</span><span class="sc81"> = </span><span class="sc86">Array</span><span class="sc81">(</span><span class="sc85">"Wind36"</span><span class="sc81">,      </span><span class="sc85">"Wind40"</span><span class="sc81">,      </span><span class="sc85">"Temperature"</span><span class="sc81">, </span><span class="sc85">"Pressure"</span><span class="sc81">, </span><span class="sc85">"DeltaP1"</span><span class="sc81"> , </span><span class="sc85">"DeltaP2"</span><span class="sc81">) 
</span><span class="sc86">WeatherTypes_count</span><span class="sc81"> = </span><span class="sc86">UBound</span><span class="sc81">(</span><span class="sc86">WeatherTypes</span><span class="sc81">)

</span><span class="sc82">' Don't offer the Delta-P plot anywhere but in the Columbia Basin.</span><span class="sc81">
</span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">strRegion</span><span class="sc81"> &lt;&gt; </span><span class="sc85">"CR"</span><span class="sc81">) </span><span class="sc84">then</span><span class="sc81">
   </span><span class="sc86">WeatherTypes_count</span><span class="sc81"> = </span><span class="sc86">WeatherTypes_count</span><span class="sc81"> - </span><span class="sc83">2</span><span class="sc81"> 
</span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">

</span><span class="sc86">RC</span><span class="sc81"> </span><span class="sc85">"&lt;select title='Sensor type' size='1' name='Sensor' id='Sensor' onChange='submitform()'&gt;"</span><span class="sc81">
</span><span class="sc84">For</span><span class="sc81"> </span><span class="sc86">intJ</span><span class="sc81"> = </span><span class="sc83">0</span><span class="sc81"> </span><span class="sc84">to</span><span class="sc81"> </span><span class="sc86">WeatherTypes_count</span><span class="sc81"> 
   </span><span class="sc84">If</span><span class="sc81"> ((</span><span class="sc86">WeatherTypes_URL</span><span class="sc81">(</span><span class="sc86">intJ</span><span class="sc81">)= </span><span class="sc86">strSensorType</span><span class="sc81">) </span><span class="sc84">OR</span><span class="sc81"> ((</span><span class="sc86">strSensorType</span><span class="sc81"> = </span><span class="sc85">""</span><span class="sc81">) </span><span class="sc84">AND</span><span class="sc81"> (</span><span class="sc86">WeatherTypes_URL</span><span class="sc81">(</span><span class="sc86">intJ</span><span class="sc81">)= </span><span class="sc85">"Wind40"</span><span class="sc81">))) </span><span class="sc84">Then</span><span class="sc81">
      </span><span class="sc86">RC</span><span class="sc81"> </span><span class="sc85">"   &lt;option selected value="</span><span class="sc81"> &amp; </span><span class="sc86">WeatherTypes_URL</span><span class="sc81">(</span><span class="sc86">intJ</span><span class="sc81">) &amp; </span><span class="sc85">" &gt;"</span><span class="sc81"> &amp; </span><span class="sc86">WeatherTypes</span><span class="sc81">(</span><span class="sc86">intJ</span><span class="sc81">)
   </span><span class="sc84">Else</span><span class="sc81">
      </span><span class="sc86">RC</span><span class="sc81"> </span><span class="sc85">"   &lt;option value="</span><span class="sc81"> &amp; </span><span class="sc86">WeatherTypes_URL</span><span class="sc81">(</span><span class="sc86">intJ</span><span class="sc81">) &amp; </span><span class="sc85">" &gt;"</span><span class="sc81"> &amp; </span><span class="sc86">WeatherTypes</span><span class="sc81">(</span><span class="sc86">intJ</span><span class="sc81">)
   </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">
</span><span class="sc84">Next</span><span class="sc81">
</span><span class="sc86">RC</span><span class="sc81"> </span><span class="sc85">"&lt;/select&gt;"</span><span class="sc81">


</span><span class="sc82">' Select the last day.</span><span class="sc81">

</span><span class="sc86">strSQL</span><span class="sc81"> = </span><span class="sc85">"SELECT DISTINCT DaysGleaned.TimeMDY FROM DaysGleaned ORDER BY DaysGleaned.TimeMDY DESC"</span><span class="sc81">
  
</span><span class="sc82">' See IIShelp for description of parameters: Open Method (Recordset - ADO).</span><span class="sc81">
</span><span class="sc82">' The AdCmdText just tells it that it is a SQL string in the first parameter.</span><span class="sc81">
</span><span class="sc82">' Alternatively you could tell it that the first parameter is a table name...</span><span class="sc81">

</span><span class="sc84">Set</span><span class="sc81"> </span><span class="sc86">rstDate</span><span class="sc81"> = </span><span class="sc86">Server.CreateObject</span><span class="sc81">(</span><span class="sc85">"ADODB.Recordset"</span><span class="sc81">)
</span><span class="sc84">On</span><span class="sc81"> </span><span class="sc84">Error</span><span class="sc81"> </span><span class="sc84">Resume</span><span class="sc81"> </span><span class="sc84">Next</span><span class="sc81">
</span><span class="sc86">rstDate.Open</span><span class="sc81"> </span><span class="sc86">strSQL</span><span class="sc81">, </span><span class="sc86">DBConnection</span><span class="sc81">, </span><span class="sc86">adOpenStatic</span><span class="sc81">, </span><span class="sc86">adLockReadOnly</span><span class="sc81">, </span><span class="sc86">adCmdText</span><span class="sc81">
</span><span class="sc86">LogError</span><span class="sc81">(</span><span class="sc85">"Recordset = rstTelem, SQL = "</span><span class="sc81"> &amp; </span><span class="sc86">strSQL_trace</span><span class="sc81">)
</span><span class="sc84">On</span><span class="sc81"> </span><span class="sc84">Error</span><span class="sc81"> </span><span class="sc84">Goto</span><span class="sc81"> </span><span class="sc83">0</span><span class="sc81">

</span><span class="sc86">RC</span><span class="sc81"> </span><span class="sc85">"&lt;select title='Last day' size='1' name='EndDate' id='EndDate' onChange='submitform()'&gt;"</span><span class="sc81">
</span><span class="sc86">rstDate.movefirst</span><span class="sc81">
</span><span class="sc84">do</span><span class="sc81"> </span><span class="sc84">until</span><span class="sc81"> </span><span class="sc86">rstDate.EOF</span><span class="sc81">
   </span><span class="sc82">' Coerce the date object to a string by using the (&amp; "")</span><span class="sc81">
   </span><span class="sc84">If</span><span class="sc81"> ((</span><span class="sc86">dtePostedDate</span><span class="sc81"> = (</span><span class="sc86">rstDate</span><span class="sc81">(</span><span class="sc85">"TimeMDY"</span><span class="sc81">) &amp; </span><span class="sc85">""</span><span class="sc81">)) </span><span class="sc84">OR</span><span class="sc81"> ((</span><span class="sc86">dtePostedDate</span><span class="sc81"> = </span><span class="sc85">""</span><span class="sc81">) </span><span class="sc84">AND</span><span class="sc81"> (</span><span class="sc86">rstDate</span><span class="sc81">(</span><span class="sc85">"TimeMDY"</span><span class="sc81">) = </span><span class="sc84">Date</span><span class="sc81">()))) </span><span class="sc84">then</span><span class="sc81">
      </span><span class="sc86">RC</span><span class="sc81"> </span><span class="sc85">"   &lt;option selected&gt;"</span><span class="sc81"> &amp; </span><span class="sc86">rstDate</span><span class="sc81">(</span><span class="sc85">"TimeMDY"</span><span class="sc81">) &amp; </span><span class="sc85">" "</span><span class="sc81"> &amp; </span><span class="sc86">weekdayname</span><span class="sc81">(</span><span class="sc86">weekday</span><span class="sc81">(</span><span class="sc86">rstDate</span><span class="sc81">(</span><span class="sc85">"TimeMDY"</span><span class="sc81">)),</span><span class="sc84">True</span><span class="sc81">)
   </span><span class="sc84">Else</span><span class="sc81">
      </span><span class="sc86">RC</span><span class="sc81"> </span><span class="sc85">"   &lt;option&gt;"</span><span class="sc81"> &amp; </span><span class="sc86">rstDate</span><span class="sc81">(</span><span class="sc85">"TimeMDY"</span><span class="sc81">) &amp; </span><span class="sc85">" "</span><span class="sc81"> &amp; </span><span class="sc86">weekdayname</span><span class="sc81">(</span><span class="sc86">weekday</span><span class="sc81">(</span><span class="sc86">rstDate</span><span class="sc81">(</span><span class="sc85">"TimeMDY"</span><span class="sc81">)),</span><span class="sc84">True</span><span class="sc81">)
   </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">  
   </span><span class="sc86">rstDate.movenext</span><span class="sc81">
</span><span class="sc84">loop</span><span class="sc81">
</span><span class="sc86">RC</span><span class="sc81"> </span><span class="sc85">"&lt;/select&gt;"</span><span class="sc81">

</span><span class="sc84">If</span><span class="sc81"> </span><span class="sc86">rstDate.State</span><span class="sc81"> = </span><span class="sc86">adStateOpen</span><span class="sc81"> </span><span class="sc84">Then</span><span class="sc81"> </span><span class="sc86">rstDate.Close</span><span class="sc81">
</span><span class="sc84">Set</span><span class="sc81"> </span><span class="sc86">rstDate</span><span class="sc81"> = </span><span class="sc84">Nothing</span><span class="sc81">


</span><span class="sc82">' Select the time range.</span><span class="sc81">
  
</span><span class="sc86">RC</span><span class="sc81"> </span><span class="sc85">"&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;font color='#008080'&gt;Days:&lt;/font&gt;"</span><span class="sc81">

</span><span class="sc86">RC</span><span class="sc81"> </span><span class="sc85">"&lt;select title='Time range' size='1' name='Days' id='Days' onChange='submitform()'&gt;"</span><span class="sc81">
</span><span class="sc86">DaysChoices</span><span class="sc81"> = </span><span class="sc86">Array</span><span class="sc81">(</span><span class="sc85">"1"</span><span class="sc81">,</span><span class="sc85">"2"</span><span class="sc81">,</span><span class="sc85">"3"</span><span class="sc81">,</span><span class="sc85">"4"</span><span class="sc81">,</span><span class="sc85">"5"</span><span class="sc81">,</span><span class="sc85">"6"</span><span class="sc81">,</span><span class="sc85">"7"</span><span class="sc81">,</span><span class="sc85">"8"</span><span class="sc81">,</span><span class="sc85">"9"</span><span class="sc81">,</span><span class="sc85">"10"</span><span class="sc81">,</span><span class="sc85">"14"</span><span class="sc81">,</span><span class="sc85">"25"</span><span class="sc81">)
</span><span class="sc84">For</span><span class="sc81"> </span><span class="sc84">each</span><span class="sc81"> </span><span class="sc86">DayValue</span><span class="sc81"> </span><span class="sc84">in</span><span class="sc81"> </span><span class="sc86">DaysChoices</span><span class="sc81">
   </span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">DayValue</span><span class="sc81"> = </span><span class="sc86">intDays</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
      </span><span class="sc86">RC</span><span class="sc81"> </span><span class="sc85">"   &lt;option selected&gt;"</span><span class="sc81"> &amp; </span><span class="sc86">DayValue</span><span class="sc81">
   </span><span class="sc84">Else</span><span class="sc81">
      </span><span class="sc86">RC</span><span class="sc81"> </span><span class="sc85">"   &lt;option&gt;"</span><span class="sc81"> &amp; </span><span class="sc86">DayValue</span><span class="sc81">
   </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">
</span><span class="sc84">Next</span><span class="sc81">
</span><span class="sc86">RC</span><span class="sc81"> </span><span class="sc85">"&lt;/select&gt;"</span><span class="sc81">


</span><span class="sc82">' Time steppers</span><span class="sc81">

</span><span class="sc86">RC</span><span class="sc81"> </span><span class="sc85">"&lt;INPUT title='Click to step back in time.' type='button' style='WIDTH: 18px; HEIGHT: 23px; COLOR: black; padding-left:3px;' value='&lt;' id='btnStepBack' name='btnStepBack' onClick='stepBack()'&gt;"</span><span class="sc81">
</span><span class="sc86">RC</span><span class="sc81"> </span><span class="sc85">"&lt;INPUT title='Click to step forward in time.' type='button' style='WIDTH: 18px; HEIGHT: 23px; COLOR: black; padding-left:3px;' value='&gt;' id='btnStepForward' name='btnStepForward' onClick='stepForward()'&gt;"</span><span class="sc81">


</span><span class="sc82">' The 24-Hour charting option.</span><span class="sc81">
</span><span class="sc86">RC</span><span class="sc81"> </span><span class="sc85">"&amp;nbsp;&amp;nbsp;"</span><span class="sc81"> &amp; </span><span class="sc86">_</span><span class="sc81">
   </span><span class="sc85">"&lt;input "</span><span class="sc81"> &amp; </span><span class="sc86">str24Hrs_state</span><span class="sc81"> &amp; </span><span class="sc85">" type='checkbox' name='chk24Hrs' "</span><span class="sc81"> &amp; </span><span class="sc86">_</span><span class="sc81">
   </span><span class="sc85">"title='Select to display 24 hours of the most recent data (including data from yesterday) on the 1-day chart. "</span><span class="sc81"> &amp; </span><span class="sc86">_</span><span class="sc81">
   </span><span class="sc85">"Please refer to the FAQ on the ""24h"" checkbox.' "</span><span class="sc81"> &amp; </span><span class="sc86">_</span><span class="sc81">
   </span><span class="sc85">"onClick='submitform()'/&gt;"</span><span class="sc81"> &amp; </span><span class="sc86">_</span><span class="sc81">
   </span><span class="sc85">"&lt;font size='2' color='#008080'&gt;24h&lt;/font&gt;"</span><span class="sc81">
   
</span><span class="sc82">' The Running-average option</span><span class="sc81">
</span><span class="sc86">RW</span><span class="sc81"> </span><span class="sc85">""</span><span class="sc81"> &amp; </span><span class="sc86">_</span><span class="sc81">
   </span><span class="sc85">"&lt;input "</span><span class="sc81"> &amp; </span><span class="sc86">strRA_state</span><span class="sc81"> &amp; </span><span class="sc85">" type='checkbox' name='chkRA' "</span><span class="sc81"> &amp; </span><span class="sc86">_</span><span class="sc81">
   </span><span class="sc85">"title='Select to apply a running average to all the data.' "</span><span class="sc81"> &amp; </span><span class="sc86">_</span><span class="sc81">
   </span><span class="sc85">"onClick='submitform()'/&gt;"</span><span class="sc81"> &amp; </span><span class="sc86">_</span><span class="sc81">
   </span><span class="sc85">"&lt;font size='2' color='#008080'&gt;RA&lt;/font&gt;"</span><span class="sc81">
   
</span><span class="sc82">' The timer for auto-plots</span><span class="sc81">
</span><span class="sc86">RW</span><span class="sc81"> </span><span class="sc85">"&amp;nbsp;"</span><span class="sc81"> &amp; </span><span class="sc86">_</span><span class="sc81">
   </span><span class="sc85">"&lt;input "</span><span class="sc81"> &amp; </span><span class="sc86">strTimer_state</span><span class="sc81"> &amp; </span><span class="sc85">" type='checkbox' name='chkTimer' "</span><span class="sc81"> &amp; </span><span class="sc86">_</span><span class="sc81">
   </span><span class="sc85">"title='Select to enable a repeating 5-minute countdown timer. This is synchronized with the server to trigger a chart update immediately after "</span><span class="sc81"> &amp; </span><span class="sc86">_</span><span class="sc81">
   </span><span class="sc85">"the database has been updated.' "</span><span class="sc81"> &amp; </span><span class="sc86">_</span><span class="sc81">
   </span><span class="sc85">"onClick='submitform()'/&gt;"</span><span class="sc81">

</span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">strTimer_state</span><span class="sc81"> = </span><span class="sc85">"checked"</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
   </span><span class="sc82">' The space in the span is needed for an initial value. The client-sided JavaScript changes this value</span><span class="sc81">
   </span><span class="sc82">' every second.</span><span class="sc81">
   </span><span class="sc86">strTimer_value</span><span class="sc81"> = </span><span class="sc85">" "</span><span class="sc81">
</span><span class="sc84">Else</span><span class="sc81">
   </span><span class="sc86">strTimer_value</span><span class="sc81"> = </span><span class="sc85">"Timer"</span><span class="sc81">
</span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">
</span><span class="sc86">RW</span><span class="sc81"> </span><span class="sc85">"&lt;span id='spTimerSec' name='spTimerSec' style='color:#008080; font-size:10pt;'&gt;"</span><span class="sc81"> &amp; </span><span class="sc86">strTimer_value</span><span class="sc81"> &amp; </span><span class="sc85">"&lt;/span&gt;"</span><span class="sc81">


</span><span class="sc82">' A hidden field that serves to test if the client has JavaScript enabled. Some script will</span><span class="sc81">
</span><span class="sc82">' try to change this value from F to T.</span><span class="sc81">
</span><span class="sc86">RC</span><span class="sc81"> </span><span class="sc85">"&lt;input type='hidden' name='jS' id='jS' value='F'&gt;"</span><span class="sc81">

</span><span class="sc86">RC</span><span class="sc81"> </span><span class="sc85">"&lt;/form&gt;"</span><span class="sc81">

</span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">Request.QueryString</span><span class="sc81">(</span><span class="sc85">"jS"</span><span class="sc81">) = </span><span class="sc85">"F"</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
   </span><span class="sc86">RBC</span><span class="sc81"> </span><span class="sc85">"JavaScript is needed to use the charting controls and view a chart image."</span><span class="sc81">
   </span><span class="sc86">RBC</span><span class="sc81"> </span><span class="sc85">""</span><span class="sc81">
   </span><span class="sc86">RBC</span><span class="sc81"> </span><span class="sc85">"Please enable JavaScript in your web browser. If you enable JavaScript, this warning"</span><span class="sc81">
   </span><span class="sc86">RBC</span><span class="sc81"> </span><span class="sc85">"will clear after your second click of the press-to-chart button."</span><span class="sc81">
   </span><span class="sc86">RBC</span><span class="sc81"> </span><span class="sc85">""</span><span class="sc81">
   </span><span class="sc86">RBC</span><span class="sc81"> </span><span class="sc85">"Note that requesting a chart update before the previous chart has completed is another"</span><span class="sc81">
   </span><span class="sc86">RBC</span><span class="sc81"> </span><span class="sc85">"possible cause for this error message. Please wait until the image returns from the"</span><span class="sc81">
   </span><span class="sc86">RBC</span><span class="sc81"> </span><span class="sc85">"server."</span><span class="sc81">
</span><span class="sc84">Else</span><span class="sc81">
   </span><span class="sc82">'=================================================================================</span><span class="sc81">
   </span><span class="sc82">' PLOT THE CHART...</span><span class="sc81">
   </span><span class="sc82">'</span><span class="sc81">
   </span><span class="sc82">' If the region has been specified in the query, then plot the chart.</span><span class="sc81">
   </span><span class="sc82">'</span><span class="sc81">
   </span><span class="sc82">'=================================================================================</span><span class="sc81">
   </span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">Request.QueryString</span><span class="sc81">(</span><span class="sc85">"Region"</span><span class="sc81">) &lt;&gt; </span><span class="sc85">""</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
      
      </span><span class="sc84">If</span><span class="sc81"> (</span><span class="sc86">strMRTime</span><span class="sc81"> &lt;&gt; </span><span class="sc85">"-"</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
         </span><span class="sc86">FetchTheData</span><span class="sc81">

         </span><span class="sc82">' Close the database connection</span><span class="sc81">
         </span><span class="sc84">If</span><span class="sc81"> </span><span class="sc86">IsObject</span><span class="sc81">(</span><span class="sc86">DBConnection</span><span class="sc81">) </span><span class="sc84">Then</span><span class="sc81">
            </span><span class="sc84">If</span><span class="sc81"> </span><span class="sc86">DBConnection.State</span><span class="sc81"> &lt;&gt; </span><span class="sc86">adStateClosed</span><span class="sc81"> </span><span class="sc84">Then</span><span class="sc81">
               </span><span class="sc86">DBConnection.Close</span><span class="sc81">
            </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">
            </span><span class="sc84">Set</span><span class="sc81"> </span><span class="sc86">DBConnection</span><span class="sc81"> = </span><span class="sc84">Nothing</span><span class="sc81">
         </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">

         </span><span class="sc86">PlotTheChart</span><span class="sc81">

      </span><span class="sc84">Else</span><span class="sc81">
         </span><span class="sc86">RWBR</span><span class="sc81"> </span><span class="sc85">"No data available for the selected station."</span><span class="sc81">
      </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">

   </span><span class="sc84">Else</span><span class="sc81">
      </span><span class="sc86">RWBR</span><span class="sc81"> </span><span class="sc85">""</span><span class="sc81">
      </span><span class="sc86">RWBR</span><span class="sc81"> </span><span class="sc85">"Specifiy a region and then click the chart button."</span><span class="sc81">
   </span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">
</span><span class="sc84">End</span><span class="sc81"> </span><span class="sc84">If</span><span class="sc81">

</span><span class="sc15">%&gt;</span><span class="sc0">

</span><span class="sc9">&lt;!--  Client side script --&gt;</span><span class="sc0">

</span><span class="sc1">&lt;SCRIPT</span><span class="sc8"> </span><span class="sc3">LANGUAGE</span><span class="sc8">=</span><span class="sc6">"javascript"</span><span class="sc1">&gt;</span><span class="sc40">
</span><span class="sc43">&lt;!--</span><span class="sc41">

</span><span class="sc43">// Globals</span><span class="sc41">

</span><span class="sc47">var</span><span class="sc41"> </span><span class="sc46">cP</span><span class="sc41"> </span><span class="sc50">=</span><span class="sc41"> </span><span class="sc46">document.getElementById</span><span class="sc50">(</span><span class="sc49">'ChartingParameters'</span><span class="sc50">);</span><span class="sc41">

</span><span class="sc47">var</span><span class="sc41"> </span><span class="sc46">cmbEndDate</span><span class="sc41"> </span><span class="sc50">=</span><span class="sc41"> </span><span class="sc46">document.getElementById</span><span class="sc50">(</span><span class="sc49">'EndDate'</span><span class="sc50">);</span><span class="sc41">
</span><span class="sc47">var</span><span class="sc41"> </span><span class="sc46">cmbDays</span><span class="sc41"> </span><span class="sc50">=</span><span class="sc41"> </span><span class="sc46">document.getElementById</span><span class="sc50">(</span><span class="sc49">'Days'</span><span class="sc50">);</span><span class="sc41">
</span><span class="sc47">var</span><span class="sc41"> </span><span class="sc46">cmbLocation</span><span class="sc41"> </span><span class="sc50">=</span><span class="sc41"> </span><span class="sc46">document.getElementById</span><span class="sc50">(</span><span class="sc49">'Location'</span><span class="sc50">);</span><span class="sc41">

</span><span class="sc47">var</span><span class="sc41"> </span><span class="sc46">stepIncrement</span><span class="sc41"> </span><span class="sc50">=</span><span class="sc41"> </span><span class="sc46">cmbDays.options</span><span class="sc50">[</span><span class="sc46">cmbDays.selectedIndex</span><span class="sc50">].</span><span class="sc46">text</span><span class="sc50">;</span><span class="sc41">

</span><span class="sc47">function</span><span class="sc41"> </span><span class="sc46">testJS</span><span class="sc50">(){</span><span class="sc41">
   </span><span class="sc46">document.getElementById</span><span class="sc50">(</span><span class="sc49">'jS'</span><span class="sc50">).</span><span class="sc46">value</span><span class="sc41"> </span><span class="sc50">=</span><span class="sc41"> </span><span class="sc49">'T'</span><span class="sc50">;</span><span class="sc41">
</span><span class="sc50">}</span><span class="sc41">

</span><span class="sc47">function</span><span class="sc41"> </span><span class="sc46">showDirections</span><span class="sc50">(){</span><span class="sc41">
   </span><span class="sc47">try</span><span class="sc41"> </span><span class="sc50">{</span><span class="sc41">
      </span><span class="sc47">var</span><span class="sc41"> </span><span class="sc46">imgDirections</span><span class="sc41"> </span><span class="sc50">=</span><span class="sc41"> </span><span class="sc46">document.getElementById</span><span class="sc50">(</span><span class="sc49">'directions'</span><span class="sc50">);</span><span class="sc41">
      </span><span class="sc46">imgDirections.style.visibility</span><span class="sc41"> </span><span class="sc50">=</span><span class="sc41"> </span><span class="sc49">'visible'</span><span class="sc50">;</span><span class="sc41">
   </span><span class="sc50">}</span><span class="sc41">
   </span><span class="sc47">catch</span><span class="sc50">(</span><span class="sc46">e</span><span class="sc50">){}</span><span class="sc41">
</span><span class="sc50">}</span><span class="sc41">

</span><span class="sc47">function</span><span class="sc41"> </span><span class="sc46">showImage</span><span class="sc50">(){</span><span class="sc41">
   </span><span class="sc47">try</span><span class="sc41"> </span><span class="sc50">{</span><span class="sc41">
      </span><span class="sc47">var</span><span class="sc41"> </span><span class="sc46">imgChartImage</span><span class="sc41"> </span><span class="sc50">=</span><span class="sc41"> </span><span class="sc46">document.getElementById</span><span class="sc50">(</span><span class="sc49">'chartimage'</span><span class="sc50">);</span><span class="sc41">
      </span><span class="sc46">imgChartImage.style.visibility</span><span class="sc41"> </span><span class="sc50">=</span><span class="sc41"> </span><span class="sc49">'visible'</span><span class="sc50">;</span><span class="sc41">
   </span><span class="sc50">}</span><span class="sc41">
   </span><span class="sc47">catch</span><span class="sc50">(</span><span class="sc46">e</span><span class="sc50">){}</span><span class="sc41">
</span><span class="sc50">}</span><span class="sc41">

</span><span class="sc47">function</span><span class="sc41"> </span><span class="sc46">changeColorSubmitButton</span><span class="sc50">(){</span><span class="sc41">
   </span><span class="sc46">document.getElementById</span><span class="sc50">(</span><span class="sc49">'myButton'</span><span class="sc50">).</span><span class="sc46">style.color</span><span class="sc50">=</span><span class="sc49">'red'</span><span class="sc50">;</span><span class="sc41">
</span><span class="sc50">}</span><span class="sc41">

</span><span class="sc47">function</span><span class="sc41"> </span><span class="sc46">submitform</span><span class="sc50">(){</span><span class="sc41">
   </span><span class="sc43">//document.getElementById('Sensor').style.backgroundColor='#FFE4C4';</span><span class="sc41">
   </span><span class="sc46">document.getElementById</span><span class="sc50">(</span><span class="sc49">'myButton'</span><span class="sc50">).</span><span class="sc46">value</span><span class="sc41"> </span><span class="sc50">=</span><span class="sc41"> </span><span class="sc49">'Please Wait'</span><span class="sc50">;</span><span class="sc41">
   </span><span class="sc46">cP.submit</span><span class="sc50">();</span><span class="sc41">
</span><span class="sc50">}</span><span class="sc41">

</span><span class="sc47">function</span><span class="sc41"> </span><span class="sc46">stepLocationForward</span><span class="sc50">(){</span><span class="sc41">
   </span><span class="sc47">var</span><span class="sc41"> </span><span class="sc46">targetIndex</span><span class="sc41"> </span><span class="sc50">=</span><span class="sc41"> </span><span class="sc46">cmbLocation.selectedIndex</span><span class="sc50">;</span><span class="sc41">
   </span><span class="sc47">if</span><span class="sc41"> </span><span class="sc50">(</span><span class="sc46">targetIndex</span><span class="sc41"> </span><span class="sc50">&lt;</span><span class="sc41"> </span><span class="sc50">(</span><span class="sc46">cmbLocation.length</span><span class="sc41"> </span><span class="sc50">-</span><span class="sc41"> </span><span class="sc45">1</span><span class="sc50">)){</span><span class="sc41">
      </span><span class="sc46">cmbLocation.selectedIndex</span><span class="sc41"> </span><span class="sc50">=</span><span class="sc41"> </span><span class="sc46">targetIndex</span><span class="sc41"> </span><span class="sc50">+</span><span class="sc41"> </span><span class="sc45">1</span><span class="sc50">;</span><span class="sc41">
   </span><span class="sc50">}</span><span class="sc41"> </span><span class="sc47">else</span><span class="sc41"> </span><span class="sc50">{</span><span class="sc41">
      </span><span class="sc46">cmbLocation.selectedIndex</span><span class="sc41"> </span><span class="sc50">=</span><span class="sc41"> </span><span class="sc45">0</span><span class="sc50">;</span><span class="sc41">
   </span><span class="sc50">}</span><span class="sc41">
   </span><span class="sc46">submitform</span><span class="sc50">();</span><span class="sc41">
</span><span class="sc50">}</span><span class="sc41">

</span><span class="sc47">function</span><span class="sc41"> </span><span class="sc46">stepBack</span><span class="sc50">(){</span><span class="sc41">
   </span><span class="sc47">var</span><span class="sc41"> </span><span class="sc46">targetIndex</span><span class="sc41"> </span><span class="sc50">=</span><span class="sc41"> </span><span class="sc46">cmbEndDate.selectedIndex</span><span class="sc41"> </span><span class="sc50">+</span><span class="sc41"> </span><span class="sc50">(</span><span class="sc46">stepIncrement</span><span class="sc41"> </span><span class="sc50">*</span><span class="sc41"> </span><span class="sc45">1.0</span><span class="sc50">);</span><span class="sc41">
   </span><span class="sc47">if</span><span class="sc41"> </span><span class="sc50">(</span><span class="sc46">targetIndex</span><span class="sc41"> </span><span class="sc50">&gt;</span><span class="sc41"> </span><span class="sc50">(</span><span class="sc46">cmbEndDate.length</span><span class="sc41"> </span><span class="sc50">-</span><span class="sc41"> </span><span class="sc45">1</span><span class="sc50">)){</span><span class="sc41">
      </span><span class="sc46">cmbEndDate.selectedIndex</span><span class="sc41"> </span><span class="sc50">=</span><span class="sc41"> </span><span class="sc46">cmbEndDate.selectedIndex</span><span class="sc50">;</span><span class="sc41">
   </span><span class="sc50">}</span><span class="sc41"> </span><span class="sc47">else</span><span class="sc41"> </span><span class="sc50">{</span><span class="sc41">
      </span><span class="sc46">cmbEndDate.selectedIndex</span><span class="sc41"> </span><span class="sc50">=</span><span class="sc41"> </span><span class="sc46">targetIndex</span><span class="sc50">;</span><span class="sc41">
   </span><span class="sc50">}</span><span class="sc41">
   </span><span class="sc46">submitform</span><span class="sc50">();</span><span class="sc41">   
</span><span class="sc50">}</span><span class="sc41">

</span><span class="sc47">function</span><span class="sc41"> </span><span class="sc46">stepForward</span><span class="sc50">(){</span><span class="sc41">
   </span><span class="sc47">var</span><span class="sc41"> </span><span class="sc46">targetIndex</span><span class="sc41"> </span><span class="sc50">=</span><span class="sc41"> </span><span class="sc46">cmbEndDate.selectedIndex</span><span class="sc41"> </span><span class="sc50">-</span><span class="sc41"> </span><span class="sc50">(</span><span class="sc46">stepIncrement</span><span class="sc41"> </span><span class="sc50">*</span><span class="sc41"> </span><span class="sc45">1.0</span><span class="sc50">);</span><span class="sc41">
   </span><span class="sc47">if</span><span class="sc41"> </span><span class="sc50">(</span><span class="sc46">targetIndex</span><span class="sc41"> </span><span class="sc50">&lt;</span><span class="sc41"> </span><span class="sc45">0</span><span class="sc50">){</span><span class="sc41">
      </span><span class="sc46">cmbEndDate.selectedIndex</span><span class="sc41"> </span><span class="sc50">=</span><span class="sc41"> </span><span class="sc45">0</span><span class="sc50">;</span><span class="sc41">
   </span><span class="sc50">}</span><span class="sc41"> </span><span class="sc47">else</span><span class="sc41"> </span><span class="sc50">{</span><span class="sc41">
      </span><span class="sc46">cmbEndDate.selectedIndex</span><span class="sc41"> </span><span class="sc50">=</span><span class="sc41"> </span><span class="sc46">targetIndex</span><span class="sc50">;</span><span class="sc41">
   </span><span class="sc50">}</span><span class="sc41">
   </span><span class="sc46">submitform</span><span class="sc50">();</span><span class="sc41">   
</span><span class="sc50">}</span><span class="sc41">

</span><span class="sc43">// Timer functions</span><span class="sc41">

</span><span class="sc47">var</span><span class="sc41"> </span><span class="sc46">secs</span><span class="sc50">;</span><span class="sc41">
</span><span class="sc47">var</span><span class="sc41"> </span><span class="sc46">timerID</span><span class="sc41"> </span><span class="sc50">=</span><span class="sc41"> </span><span class="sc47">null</span><span class="sc50">;</span><span class="sc41">
</span><span class="sc47">var</span><span class="sc41"> </span><span class="sc46">timerRunning</span><span class="sc41"> </span><span class="sc50">=</span><span class="sc41"> </span><span class="sc47">false</span><span class="sc50">;</span><span class="sc41">
</span><span class="sc47">var</span><span class="sc41"> </span><span class="sc46">delay</span><span class="sc41"> </span><span class="sc50">=</span><span class="sc41"> </span><span class="sc45">1000</span><span class="sc50">;</span><span class="sc41">

</span><span class="sc47">function</span><span class="sc41"> </span><span class="sc46">initializeTimer</span><span class="sc50">(</span><span class="sc46">secsFromChart</span><span class="sc50">){</span><span class="sc41">

   </span><span class="sc43">// Set the length of the timer, in seconds</span><span class="sc41">
   </span><span class="sc47">if</span><span class="sc41"> </span><span class="sc50">(</span><span class="sc46">secsFromChart</span><span class="sc41"> </span><span class="sc50">==</span><span class="sc41"> </span><span class="sc47">null</span><span class="sc50">){</span><span class="sc41">
      </span><span class="sc47">if</span><span class="sc41"> </span><span class="sc50">(</span><span class="sc46">timerRunning</span><span class="sc50">){</span><span class="sc41">
         </span><span class="sc46">secs</span><span class="sc41"> </span><span class="sc50">=</span><span class="sc41"> </span><span class="sc46">secs</span><span class="sc41"> </span><span class="sc50">-</span><span class="sc41"> </span><span class="sc45">5</span><span class="sc50">;</span><span class="sc41">
         </span><span class="sc47">if</span><span class="sc41"> </span><span class="sc50">(</span><span class="sc46">secs</span><span class="sc41"> </span><span class="sc50">&lt;</span><span class="sc41"> </span><span class="sc45">0</span><span class="sc50">){</span><span class="sc41"> 
            </span><span class="sc46">secs</span><span class="sc41"> </span><span class="sc50">=</span><span class="sc41"> </span><span class="sc45">3</span><span class="sc50">;</span><span class="sc41">
         </span><span class="sc50">}</span><span class="sc41">
      </span><span class="sc50">}</span><span class="sc47">else</span><span class="sc50">{</span><span class="sc41">
         </span><span class="sc47">if</span><span class="sc41"> </span><span class="sc50">(</span><span class="sc46">secs</span><span class="sc41"> </span><span class="sc50">==</span><span class="sc41"> </span><span class="sc47">null</span><span class="sc50">){</span><span class="sc41">
            </span><span class="sc46">secs</span><span class="sc41"> </span><span class="sc50">=</span><span class="sc41"> </span><span class="sc45">298</span><span class="sc50">;</span><span class="sc41">
         </span><span class="sc50">}</span><span class="sc41">
      </span><span class="sc50">}</span><span class="sc41">
   </span><span class="sc50">}</span><span class="sc47">else</span><span class="sc50">{</span><span class="sc41">
      </span><span class="sc46">secs</span><span class="sc41"> </span><span class="sc50">=</span><span class="sc41"> </span><span class="sc46">secsFromChart</span><span class="sc50">;</span><span class="sc41">   
   </span><span class="sc50">}</span><span class="sc41">
    
   </span><span class="sc46">stopTheTimer</span><span class="sc50">();</span><span class="sc41">
   </span><span class="sc46">startTheTimer</span><span class="sc50">();</span><span class="sc41">
</span><span class="sc50">}</span><span class="sc41">

</span><span class="sc47">function</span><span class="sc41"> </span><span class="sc46">stopTheTimer</span><span class="sc50">(){</span><span class="sc41">

   </span><span class="sc47">if</span><span class="sc41"> </span><span class="sc50">(</span><span class="sc46">timerRunning</span><span class="sc50">){</span><span class="sc41">
      </span><span class="sc46">clearTimeout</span><span class="sc50">(</span><span class="sc46">timerID</span><span class="sc50">);</span><span class="sc41">
      </span><span class="sc46">timerRunning</span><span class="sc41"> </span><span class="sc50">=</span><span class="sc41"> </span><span class="sc47">false</span><span class="sc50">;</span><span class="sc41"> 
      </span><span class="sc43">// This color change was used when there was a pause mode.</span><span class="sc41">
      </span><span class="sc43">//document.getElementById('spTimerSec').style.color = 'red';</span><span class="sc41">
   </span><span class="sc50">}</span><span class="sc41">
</span><span class="sc50">}</span><span class="sc41">

</span><span class="sc47">function</span><span class="sc41"> </span><span class="sc46">startTheTimer</span><span class="sc50">(){</span><span class="sc41">
   </span><span class="sc43">// Reset the color back to normal.</span><span class="sc41">
   </span><span class="sc43">//document.getElementById('spTimerSec').style.color = '#008080';</span><span class="sc41">

   </span><span class="sc47">if</span><span class="sc41"> </span><span class="sc50">(</span><span class="sc46">secs</span><span class="sc50">==</span><span class="sc45">0</span><span class="sc50">){</span><span class="sc41">
      </span><span class="sc43">// Here's where you put something useful that's</span><span class="sc41">
      </span><span class="sc43">// executes after the allotted time.</span><span class="sc41">
      </span><span class="sc46">submitform</span><span class="sc50">();</span><span class="sc41">
    
   </span><span class="sc50">}</span><span class="sc47">else</span><span class="sc50">{</span><span class="sc41">
      </span><span class="sc46">self.status</span><span class="sc41"> </span><span class="sc50">=</span><span class="sc41"> </span><span class="sc46">secs</span><span class="sc50">;</span><span class="sc41">
      </span><span class="sc47">if</span><span class="sc41"> </span><span class="sc50">(</span><span class="sc46">secs</span><span class="sc41"> </span><span class="sc50">&lt;</span><span class="sc41"> </span><span class="sc45">10</span><span class="sc50">){</span><span class="sc41">
         </span><span class="sc46">secs</span><span class="sc41"> </span><span class="sc50">=</span><span class="sc41"> </span><span class="sc49">' '</span><span class="sc41"> </span><span class="sc50">+</span><span class="sc41"> </span><span class="sc46">secs</span><span class="sc50">;</span><span class="sc41">
      </span><span class="sc50">}</span><span class="sc41">
      </span><span class="sc46">document.getElementById</span><span class="sc50">(</span><span class="sc49">'spTimerSec'</span><span class="sc50">).</span><span class="sc46">firstChild.nodeValue</span><span class="sc41"> </span><span class="sc50">=</span><span class="sc41"> </span><span class="sc49">''</span><span class="sc41"> </span><span class="sc50">+</span><span class="sc41"> </span><span class="sc46">secs</span><span class="sc41"> </span><span class="sc50">+</span><span class="sc41"> </span><span class="sc49">'s.'</span><span class="sc50">;</span><span class="sc41">
      </span><span class="sc46">secs</span><span class="sc41"> </span><span class="sc50">=</span><span class="sc41"> </span><span class="sc46">secs</span><span class="sc41"> </span><span class="sc50">-</span><span class="sc41"> </span><span class="sc45">1</span><span class="sc50">;</span><span class="sc41">

      </span><span class="sc46">timerRunning</span><span class="sc41"> </span><span class="sc50">=</span><span class="sc41"> </span><span class="sc47">true</span><span class="sc50">;</span><span class="sc41">
      </span><span class="sc46">timerID</span><span class="sc41"> </span><span class="sc50">=</span><span class="sc41"> </span><span class="sc46">self.setTimeout</span><span class="sc50">(</span><span class="sc48">"startTheTimer()"</span><span class="sc50">,</span><span class="sc41"> </span><span class="sc46">delay</span><span class="sc50">);</span><span class="sc41">
   </span><span class="sc50">}</span><span class="sc41">
</span><span class="sc50">}</span><span class="sc41">

</span><span class="sc47">function</span><span class="sc41"> </span><span class="sc46">changeRegionAnchorValue</span><span class="sc50">(</span><span class="sc41"> </span><span class="sc46">theInputString</span><span class="sc50">){</span><span class="sc41">
   </span><span class="sc47">if</span><span class="sc41"> </span><span class="sc50">(</span><span class="sc46">theInputString</span><span class="sc50">==</span><span class="sc49">'MN'</span><span class="sc50">)</span><span class="sc41"> </span><span class="sc50">{</span><span class="sc41">
      </span><span class="sc46">document.getElementById</span><span class="sc50">(</span><span class="sc49">'regionanchor'</span><span class="sc50">).</span><span class="sc46">firstChild.nodeValue</span><span class="sc41"> </span><span class="sc50">=</span><span class="sc41"> </span><span class="sc49">'Columbia Basin Weather'</span><span class="sc50">;</span><span class="sc41">
   </span><span class="sc50">}</span><span class="sc41"> </span><span class="sc47">else</span><span class="sc41"> </span><span class="sc47">if</span><span class="sc41"> </span><span class="sc50">(</span><span class="sc46">theInputString</span><span class="sc50">==</span><span class="sc49">'CR'</span><span class="sc50">)</span><span class="sc41"> </span><span class="sc50">{</span><span class="sc41">
      </span><span class="sc46">document.getElementById</span><span class="sc50">(</span><span class="sc49">'regionanchor'</span><span class="sc50">).</span><span class="sc46">firstChild.nodeValue</span><span class="sc41"> </span><span class="sc50">=</span><span class="sc41"> </span><span class="sc49">'Minnesota Weather'</span><span class="sc50">;</span><span class="sc41">
   </span><span class="sc50">}</span><span class="sc41"> </span><span class="sc47">else</span><span class="sc41"> </span><span class="sc50">{</span><span class="sc41">
      </span><span class="sc46">document.getElementById</span><span class="sc50">(</span><span class="sc49">'regionanchor'</span><span class="sc50">).</span><span class="sc46">firstChild.nodeValue</span><span class="sc41"> </span><span class="sc50">=</span><span class="sc41"> </span><span class="sc46">theInputString</span><span class="sc50">;</span><span class="sc41">
   </span><span class="sc50">}</span><span class="sc41">
</span><span class="sc50">}</span><span class="sc41">

</span><span class="sc47">function</span><span class="sc41"> </span><span class="sc46">setRegionState</span><span class="sc50">(){</span><span class="sc41">
   </span><span class="sc46">document.getElementById</span><span class="sc50">(</span><span class="sc49">'Region_state'</span><span class="sc50">).</span><span class="sc46">value</span><span class="sc41"> </span><span class="sc50">=</span><span class="sc41"> </span><span class="sc49">'new'</span><span class="sc50">;</span><span class="sc41">
   </span><span class="sc46">submitform</span><span class="sc50">();</span><span class="sc41"> 
</span><span class="sc50">}</span><span class="sc41">

</span><span class="sc43">//--&gt;</span><span class="sc41">
</span><span class="sc1">&lt;/SCRIPT&gt;</span><span class="sc0">
</span><span class="sc1">&lt;/div&gt;</span><span class="sc0">
</span><span class="sc1">&lt;/body&gt;</span><span class="sc0">
</span><span class="sc1">&lt;/html&gt;</span></div></body>
</html>
