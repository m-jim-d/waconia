<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=UTF-8">
<title>Exported from Notepad++</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #E0E2E4;
}
.sc0 {
}
.sc1 {
	color: #66747B;
}
.sc2 {
	color: #FFCD22;
}
.sc3 {
	font-weight: bold;
	color: #93C763;
}
.sc4 {
	color: #EC7600;
}
.sc6 {
	color: #E8E2B7;
}
.sc7 {
}
.sc8 {
}
.sc9 {
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #293134; "><span class="sc6">&lt;%</span><span class="sc0">@ </span><span class="sc7">Language</span><span class="sc6">=</span><span class="sc7">VBScript</span><span class="sc0"> </span><span class="sc6">%&gt;</span><span class="sc0">

</span><span class="sc6">&lt;%</span><span class="sc0"> 
</span><span class="sc3">Option</span><span class="sc0"> </span><span class="sc3">Explicit</span><span class="sc0">

</span><span class="sc1">' rosy.asp
' Author: Jim Miller
' MySQL Version: 1.0
' May 17, 2025
</span><span class="sc0">
</span><span class="sc1">' Buffer and release all at once...
</span><span class="sc7">Response.Buffer</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc3">True</span><span class="sc0"> 
</span><span class="sc6">%&gt;</span><span class="sc0">

</span><span class="sc6">&lt;!--</span><span class="sc0"> </span><span class="sc9">#include file="rosy_utilities.asp" --&gt;
</span><span class="sc0">
</span><span class="sc6">&lt;%</span><span class="sc0">
</span><span class="sc1">'==========================================
' Common Variables (globals)
'==========================================
</span><span class="sc0">
</span><span class="sc1">' From the old headers.asp file...
</span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">strServerName</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">strPathToImageDir</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">strURLPathToImageDir</span><span class="sc0">

</span><span class="sc3">Const</span><span class="sc0"> </span><span class="sc7">adStateOpen</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">
</span><span class="sc3">Const</span><span class="sc0"> </span><span class="sc7">adStateClosed</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc3">Const</span><span class="sc0"> </span><span class="sc7">adOpenStatic</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">3</span><span class="sc0">
</span><span class="sc3">Const</span><span class="sc0"> </span><span class="sc7">adLockBatchOptimistic</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">
</span><span class="sc3">Const</span><span class="sc0"> </span><span class="sc7">adLockReadOnly</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">
</span><span class="sc3">Const</span><span class="sc0"> </span><span class="sc7">adCmdText</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">

</span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">dicTraceIO</span><span class="sc0">

</span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">DBConnection</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">rstDate</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">rstStations</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">rstLatestDate</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">rstMostRecent</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">rstTimeZone</span><span class="sc0">

</span><span class="sc1">' Arrays for sensor data values
</span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">dataPoints_WindDirection</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">dataPoints_WindGust</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">dataPoints_WindSpeed</span><span class="sc0">
</span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">dataPoints_Pressure</span><span class="sc0">
</span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">dataPoints_TempAvg</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">dataPoints_TempMax</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">dataPoints_TempMin</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">dataPoints_DewPoint</span><span class="sc0">
</span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">dataPoints_DeltaP_trace_A</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">dataPoints_DeltaP_trace_B</span><span class="sc0">

</span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">dteMaxTimeStamp</span><span class="sc0">
</span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">strSQL</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">strNameForPlot</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">intMaxGust</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">intNonPlottingHeight</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">intTempDiffScalingThreshold</span><span class="sc0">
</span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">strTitle</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">strHGSL</span><span class="sc0">
</span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">sglTempMax</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">sglTempMin</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">sglPressureMin</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">sglPressureMax</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">sglTempRange</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">sglDewPointMin</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">blnDewPointData</span><span class="sc0">
</span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">strMRTime</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">strMRWindAvg</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">strMRWindMax</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">strMRWindDir</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">strMRTemp</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">strMRPressure</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">strMRDewPoint</span><span class="sc0">
</span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">Chart</span><span class="sc0">
</span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">Filename</span><span class="sc0">
</span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">WeatherTypes</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">WeatherTypes_URL</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">WeatherTypes_count</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">DaysChoices</span><span class="sc0">
</span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">dteStartDateTime</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">dteEndDateTime</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">dteStartDate_forLabels</span><span class="sc0">
</span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">TimeLabels</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">TheHour</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">DayValue</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">DaysDecSinceRef</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">intHour</span><span class="sc0">
</span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">blnMinMax</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">blnFoundSomeData</span><span class="sc0">
</span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">intTheColor</span><span class="sc0">
</span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">strRandomNameString</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">strFileName2</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">strOrderBy</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">intColorScaleFactor</span><span class="sc0">
</span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">fsoObject</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">fdrObject</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">filObject</span><span class="sc0">
</span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">intFileCount</span><span class="sc0">
</span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">blnDayLightSavingsTime</span><span class="sc0">
</span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">dtePostedDate</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">blnPostedDate_default</span><span class="sc0">
</span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">intJ</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">intDays</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">intXLabels</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">dblDaysIncrement</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">dblDaysFraction</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">dblFractionalPart</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">dteLabelDate</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">intLabelsPerDay</span><span class="sc0">
</span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">dblDPmin</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">dblDPmax</span><span class="sc0">
</span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">dblWindNormFactor</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">intRed</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">intGreen</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">intBlue</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">intGray</span><span class="sc0">
</span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">strRegionURL</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">strSensorType</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">strInitializeTimer</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">strLocation</span><span class="sc0">
</span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">serverTimeArray</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">serverTime</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">intPixelBottomShift</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">intPixelRightShift</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">intPixelRightShift_tweak</span><span class="sc0">
</span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">strShowImages_command</span><span class="sc0">
</span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">vrtReturnFromMINMAX</span><span class="sc0">
</span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">intMinutes</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">dblFiveMinutes</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">intSeconds_FromMinutes</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">intSeconds_FromSeconds</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">intDelay_to_5min</span><span class="sc0">
</span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">strButtonLabel</span><span class="sc0">
</span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">strTimeZone</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">dicTZ</span><span class="sc0">
</span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">arrRegions</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">strRegionValue</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">strRegion</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">strRegionState</span><span class="sc0">
</span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">strDebugMessage</span><span class="sc0">
</span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">dteNowTime</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">dteStartDateTime_forQuery</span><span class="sc0">
</span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">str24Hrs_state</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">strTimer_state</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">strTimer_value</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">strRA_state</span><span class="sc0">

</span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">useRunningAverage</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">RA_x</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">RA_y</span><span class="sc0">

</span><span class="sc3">Set</span><span class="sc0"> </span><span class="sc7">DBConnection</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc3">Nothing</span><span class="sc0">

</span><span class="sc1">'=============================================================================================
' Functions and Subroutines
'=============================================================================================
</span><span class="sc0">

</span><span class="sc1">' Add error logging function that writes to the page
</span><span class="sc3">Sub</span><span class="sc0"> </span><span class="sc7">LogError</span><span class="sc6">(</span><span class="sc7">location</span><span class="sc6">)</span><span class="sc0">
    </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc7">Err.Number</span><span class="sc0"> </span><span class="sc6">&lt;&gt;</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
        </span><span class="sc7">Response.Write</span><span class="sc0"> </span><span class="sc4">"&lt;div style='color:red; background-color:#ffe0e0; padding:5px; margin:5px; border:1px solid red'&gt;"</span><span class="sc0">
        </span><span class="sc7">Response.Write</span><span class="sc0"> </span><span class="sc4">"&lt;strong&gt;ERROR at "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">location</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">":&lt;/strong&gt; "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">Err.Number</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">" - "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">Err.Description</span><span class="sc0">
        </span><span class="sc7">Response.Write</span><span class="sc0"> </span><span class="sc4">"&lt;/div&gt;"</span><span class="sc0">
        </span><span class="sc7">Err.Clear</span><span class="sc0"> </span><span class="sc1">' Clear the error so we can continue
</span><span class="sc0">    </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">Sub</span><span class="sc0">


</span><span class="sc3">Sub</span><span class="sc0"> </span><span class="sc7">RBC</span><span class="sc6">(</span><span class="sc7">strTheString</span><span class="sc6">)</span><span class="sc0">
   </span><span class="sc7">Response.Write</span><span class="sc0"> </span><span class="sc7">strTheString</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">"&lt;BR&gt;"</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">Chr</span><span class="sc6">(</span><span class="sc2">10</span><span class="sc6">)</span><span class="sc0">
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">Sub</span><span class="sc0">

</span><span class="sc1">'Alias for RBC
</span><span class="sc3">Sub</span><span class="sc0"> </span><span class="sc7">RWBR</span><span class="sc6">(</span><span class="sc7">strTheString</span><span class="sc6">)</span><span class="sc0">
   </span><span class="sc7">RBC</span><span class="sc0"> </span><span class="sc7">strTheString</span><span class="sc0">
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">Sub</span><span class="sc0">

</span><span class="sc3">Sub</span><span class="sc0"> </span><span class="sc7">RC</span><span class="sc6">(</span><span class="sc7">strTheString</span><span class="sc6">)</span><span class="sc0">
   </span><span class="sc7">Response.Write</span><span class="sc0"> </span><span class="sc7">strTheString</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">Chr</span><span class="sc6">(</span><span class="sc2">10</span><span class="sc6">)</span><span class="sc0">
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">Sub</span><span class="sc0">

</span><span class="sc1">'This will not make a new line in the HTML file.
</span><span class="sc3">Sub</span><span class="sc0"> </span><span class="sc7">RW</span><span class="sc6">(</span><span class="sc7">strTheString</span><span class="sc6">)</span><span class="sc0">
   </span><span class="sc7">Response.Write</span><span class="sc0"> </span><span class="sc7">strTheString</span><span class="sc0">
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">Sub</span><span class="sc0">


</span><span class="sc3">Sub</span><span class="sc0"> </span><span class="sc7">MinMax</span><span class="sc6">(</span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">dblNewValue</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc3">ByRef</span><span class="sc0"> </span><span class="sc7">dblMax</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc3">ByRef</span><span class="sc0"> </span><span class="sc7">dblMin</span><span class="sc6">)</span><span class="sc0">
   </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">dblNewValue</span><span class="sc0"> </span><span class="sc6">&gt;</span><span class="sc0"> </span><span class="sc7">dblMax</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
      </span><span class="sc7">dblMax</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">dblNewValue</span><span class="sc0">
   </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
   
   </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">dblNewValue</span><span class="sc0"> </span><span class="sc6">&lt;</span><span class="sc0"> </span><span class="sc7">dblMin</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
      </span><span class="sc7">dblMin</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">dblNewValue</span><span class="sc0">
   </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">Sub</span><span class="sc0">


</span><span class="sc3">Function</span><span class="sc0"> </span><span class="sc7">DaylightTime</span><span class="sc6">(</span><span class="sc7">strMRTime</span><span class="sc6">)</span><span class="sc0">
   </span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">strMRTime_DLS</span><span class="sc0">
   </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">strMRTime</span><span class="sc0"> </span><span class="sc6">&lt;&gt;</span><span class="sc0"> </span><span class="sc4">"-"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
      </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">DaylightSavingsTime</span><span class="sc6">(</span><span class="sc7">strMRTime</span><span class="sc6">))</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
         </span><span class="sc7">strMRTime_DLS</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">DateAdd</span><span class="sc6">(</span><span class="sc4">"h"</span><span class="sc6">,</span><span class="sc2">1</span><span class="sc6">,</span><span class="sc7">strMRTime</span><span class="sc6">)</span><span class="sc0">
      </span><span class="sc3">Else</span><span class="sc0">
         </span><span class="sc7">strMRTime_DLS</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">strMRTime</span><span class="sc0">
      </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
   </span><span class="sc3">Else</span><span class="sc0">
      </span><span class="sc7">strMRTime_DLS</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"-"</span><span class="sc0">
   </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
   </span><span class="sc7">DaylightTime</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">strMRTime_DLS</span><span class="sc0">
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0">


</span><span class="sc3">Function</span><span class="sc0"> </span><span class="sc7">AgeOfData</span><span class="sc6">(</span><span class="sc7">strMRTime</span><span class="sc6">)</span><span class="sc0">
   </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">strMRTime</span><span class="sc0"> </span><span class="sc6">&lt;&gt;</span><span class="sc0"> </span><span class="sc4">"-"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
      </span><span class="sc1">' The following line works mainly because strMRTime is in standard time. So no problem with HI.
</span><span class="sc0">      </span><span class="sc7">AgeOfData</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">DateDiff</span><span class="sc6">(</span><span class="sc4">"n"</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">DaylightTime</span><span class="sc6">(</span><span class="sc7">strMRTime</span><span class="sc6">),</span><span class="sc0"> </span><span class="sc7">Now</span><span class="sc6">())</span><span class="sc0"> </span><span class="sc6">+</span><span class="sc0"> </span><span class="sc2">60</span><span class="sc0"> </span><span class="sc6">*</span><span class="sc0"> </span><span class="sc7">dicTZ.item</span><span class="sc6">(</span><span class="sc7">strTimeZone</span><span class="sc6">)</span><span class="sc0">
   </span><span class="sc3">Else</span><span class="sc0">
      </span><span class="sc7">AgeOfData</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"-"</span><span class="sc0">
   </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0">


</span><span class="sc3">Function</span><span class="sc0"> </span><span class="sc7">DaysDecSinceRefF</span><span class="sc6">(</span><span class="sc3">byVal</span><span class="sc0"> </span><span class="sc7">timeMDY</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc3">byVal</span><span class="sc0"> </span><span class="sc7">timeHr</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc3">byVal</span><span class="sc0"> </span><span class="sc7">timeMin</span><span class="sc6">)</span><span class="sc0">
   </span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">dteRecordTime</span><span class="sc0">
   </span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">TheMin</span><span class="sc0">
 
   </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">intDays</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
      </span><span class="sc7">TheMin</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">timeMin</span><span class="sc0">
   </span><span class="sc3">Else</span><span class="sc0">
      </span><span class="sc7">TheMin</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
 
   </span><span class="sc7">dteRecordTime</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">timeMDY</span><span class="sc0"> </span><span class="sc6">+</span><span class="sc0"> </span><span class="sc7">TimeSerial</span><span class="sc6">(</span><span class="sc7">timeHr</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">TheMin</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc6">)</span><span class="sc0">   
   
   </span><span class="sc7">DaysDecSinceRefF</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc3">CDbl</span><span class="sc6">(</span><span class="sc0">  </span><span class="sc7">DateDiff</span><span class="sc6">(</span><span class="sc4">"n"</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">dteStartDateTime</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">dteRecordTime</span><span class="sc6">)</span><span class="sc0">  </span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">/</span><span class="sc0"> </span><span class="sc2">1440</span><span class="sc0"> 
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0">


</span><span class="sc3">Function</span><span class="sc0"> </span><span class="sc7">DaysDec</span><span class="sc6">(</span><span class="sc0"> </span><span class="sc7">dteTime</span><span class="sc6">)</span><span class="sc0">
   </span><span class="sc1">' 86400 = 24.0*60.0*60.0  (Seconds in a day).
</span><span class="sc0">   </span><span class="sc1">' Decimal day as measured from the midnight start time.
</span><span class="sc0">   </span><span class="sc7">DaysDec</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc3">CDbl</span><span class="sc6">(</span><span class="sc0"> </span><span class="sc7">DateDiff</span><span class="sc6">(</span><span class="sc4">"s"</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">dteStartDateTime</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">dteTime</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">/</span><span class="sc0"> </span><span class="sc2">86400.0</span><span class="sc0">
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0">


</span><span class="sc3">Function</span><span class="sc0"> </span><span class="sc7">DirectionLabel</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">WindDeg</span><span class="sc6">)</span><span class="sc0">
   </span><span class="sc3">If</span><span class="sc0">     </span><span class="sc6">(</span><span class="sc7">WindDeg</span><span class="sc0"> </span><span class="sc6">&gt;</span><span class="sc0"> </span><span class="sc2">345</span><span class="sc0"> </span><span class="sc3">And</span><span class="sc0"> </span><span class="sc7">WindDeg</span><span class="sc0"> </span><span class="sc6">&lt;=</span><span class="sc0"> </span><span class="sc2">360</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0"> 
      </span><span class="sc7">DirectionLabel</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"North"</span><span class="sc0">
   </span><span class="sc3">ElseIf</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">WindDeg</span><span class="sc0"> </span><span class="sc6">&gt;</span><span class="sc0">   </span><span class="sc2">0</span><span class="sc0"> </span><span class="sc3">And</span><span class="sc0"> </span><span class="sc7">WindDeg</span><span class="sc0"> </span><span class="sc6">&lt;=</span><span class="sc0">  </span><span class="sc2">15</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0"> 
      </span><span class="sc7">DirectionLabel</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"North"</span><span class="sc0">
   
   </span><span class="sc3">ElseIf</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">WindDeg</span><span class="sc0"> </span><span class="sc6">&gt;</span><span class="sc0">  </span><span class="sc2">15</span><span class="sc0"> </span><span class="sc3">And</span><span class="sc0"> </span><span class="sc7">WindDeg</span><span class="sc0"> </span><span class="sc6">&lt;=</span><span class="sc0">  </span><span class="sc2">45</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0"> 
      </span><span class="sc7">DirectionLabel</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"NNE"</span><span class="sc0">
   </span><span class="sc3">ElseIf</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">WindDeg</span><span class="sc0"> </span><span class="sc6">&gt;</span><span class="sc0">  </span><span class="sc2">45</span><span class="sc0"> </span><span class="sc3">And</span><span class="sc0"> </span><span class="sc7">WindDeg</span><span class="sc0"> </span><span class="sc6">&lt;=</span><span class="sc0">  </span><span class="sc2">75</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0"> 
      </span><span class="sc7">DirectionLabel</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"ENE"</span><span class="sc0">
   </span><span class="sc3">ElseIf</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">WindDeg</span><span class="sc0"> </span><span class="sc6">&gt;</span><span class="sc0">  </span><span class="sc2">75</span><span class="sc0"> </span><span class="sc3">And</span><span class="sc0"> </span><span class="sc7">WindDeg</span><span class="sc0"> </span><span class="sc6">&lt;=</span><span class="sc0"> </span><span class="sc2">105</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0"> 
      </span><span class="sc7">DirectionLabel</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"East"</span><span class="sc0">
   </span><span class="sc3">ElseIf</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">WindDeg</span><span class="sc0"> </span><span class="sc6">&gt;</span><span class="sc0"> </span><span class="sc2">105</span><span class="sc0"> </span><span class="sc3">And</span><span class="sc0"> </span><span class="sc7">WindDeg</span><span class="sc0"> </span><span class="sc6">&lt;=</span><span class="sc0"> </span><span class="sc2">135</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0"> 
      </span><span class="sc7">DirectionLabel</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"ESE"</span><span class="sc0">
   </span><span class="sc3">ElseIf</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">WindDeg</span><span class="sc0"> </span><span class="sc6">&gt;</span><span class="sc0"> </span><span class="sc2">135</span><span class="sc0"> </span><span class="sc3">And</span><span class="sc0"> </span><span class="sc7">WindDeg</span><span class="sc0"> </span><span class="sc6">&lt;=</span><span class="sc0"> </span><span class="sc2">165</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0"> 
      </span><span class="sc7">DirectionLabel</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"SSE"</span><span class="sc0">
   </span><span class="sc3">ElseIf</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">WindDeg</span><span class="sc0"> </span><span class="sc6">&gt;</span><span class="sc0"> </span><span class="sc2">165</span><span class="sc0"> </span><span class="sc3">And</span><span class="sc0"> </span><span class="sc7">WindDeg</span><span class="sc0"> </span><span class="sc6">&lt;=</span><span class="sc0"> </span><span class="sc2">195</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0"> 
      </span><span class="sc7">DirectionLabel</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"South"</span><span class="sc0">
   </span><span class="sc3">ElseIf</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">WindDeg</span><span class="sc0"> </span><span class="sc6">&gt;</span><span class="sc0"> </span><span class="sc2">195</span><span class="sc0"> </span><span class="sc3">And</span><span class="sc0"> </span><span class="sc7">WindDeg</span><span class="sc0"> </span><span class="sc6">&lt;=</span><span class="sc0"> </span><span class="sc2">225</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0"> 
      </span><span class="sc7">DirectionLabel</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"SSW"</span><span class="sc0">
   </span><span class="sc3">ElseIf</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">WindDeg</span><span class="sc0"> </span><span class="sc6">&gt;</span><span class="sc0"> </span><span class="sc2">225</span><span class="sc0"> </span><span class="sc3">And</span><span class="sc0"> </span><span class="sc7">WindDeg</span><span class="sc0"> </span><span class="sc6">&lt;=</span><span class="sc0"> </span><span class="sc2">255</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0"> 
      </span><span class="sc7">DirectionLabel</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"WSW"</span><span class="sc0">
   </span><span class="sc3">ElseIf</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">WindDeg</span><span class="sc0"> </span><span class="sc6">&gt;</span><span class="sc0"> </span><span class="sc2">255</span><span class="sc0"> </span><span class="sc3">And</span><span class="sc0"> </span><span class="sc7">WindDeg</span><span class="sc0"> </span><span class="sc6">&lt;=</span><span class="sc0"> </span><span class="sc2">285</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0"> 
      </span><span class="sc7">DirectionLabel</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"West"</span><span class="sc0">
   </span><span class="sc3">ElseIf</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">WindDeg</span><span class="sc0"> </span><span class="sc6">&gt;</span><span class="sc0"> </span><span class="sc2">285</span><span class="sc0"> </span><span class="sc3">And</span><span class="sc0"> </span><span class="sc7">WindDeg</span><span class="sc0"> </span><span class="sc6">&lt;=</span><span class="sc0"> </span><span class="sc2">315</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0"> 
      </span><span class="sc7">DirectionLabel</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"WNW"</span><span class="sc0">
   </span><span class="sc3">ElseIf</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">WindDeg</span><span class="sc0"> </span><span class="sc6">&gt;</span><span class="sc0"> </span><span class="sc2">315</span><span class="sc0"> </span><span class="sc3">And</span><span class="sc0"> </span><span class="sc7">WindDeg</span><span class="sc0"> </span><span class="sc6">&lt;=</span><span class="sc0"> </span><span class="sc2">345</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0"> 
      </span><span class="sc7">DirectionLabel</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"NNW"</span><span class="sc0">
   </span><span class="sc3">Else</span><span class="sc0"> 
      </span><span class="sc7">DirectionLabel</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"Var"</span><span class="sc0">
   </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
   
   </span><span class="sc3">If</span><span class="sc0">     </span><span class="sc6">(</span><span class="sc7">WindDeg</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0">  </span><span class="sc2">45</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0"> 
      </span><span class="sc7">DirectionLabel</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"NE"</span><span class="sc0">
   </span><span class="sc3">ElseIf</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">WindDeg</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">135</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
      </span><span class="sc7">DirectionLabel</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"SE"</span><span class="sc0">
   </span><span class="sc3">ElseIf</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">WindDeg</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">225</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
      </span><span class="sc7">DirectionLabel</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"SW"</span><span class="sc0">
   </span><span class="sc3">ElseIf</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">WindDeg</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">315</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
      </span><span class="sc7">DirectionLabel</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"NW"</span><span class="sc0">
   </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0">


</span><span class="sc3">Sub</span><span class="sc0"> </span><span class="sc7">AddHorizontalLine_gray</span><span class="sc6">(</span><span class="sc7">intLineWidth</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">intColor</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">dblYvalue</span><span class="sc6">)</span><span class="sc0">
   </span><span class="sc7">Chart.AddSeries</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc2">5</span><span class="sc6">)</span><span class="sc0">
   </span><span class="sc7">Chart.linewidth</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">intLineWidth</span><span class="sc0">
   </span><span class="sc7">Chart.SeriesInLegend</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc3">false</span><span class="sc0">

   </span><span class="sc1">' The -0.009 extends the line all the way to the left edge of the 1-day chart.
</span><span class="sc0">   </span><span class="sc7">MyChartAddXY</span><span class="sc0">      </span><span class="sc6">-</span><span class="sc2">0.009</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">dblYvalue</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc4">""</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">RGB</span><span class="sc6">(</span><span class="sc7">intColor</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">intColor</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">intColor</span><span class="sc6">)</span><span class="sc0">  
   </span><span class="sc7">MyChartAddXY</span><span class="sc0"> </span><span class="sc7">intDays</span><span class="sc6">+</span><span class="sc2">1.0</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">dblYvalue</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc4">""</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">RGB</span><span class="sc6">(</span><span class="sc7">intColor</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">intColor</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">intColor</span><span class="sc6">)</span><span class="sc0">
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">Sub</span><span class="sc0">


</span><span class="sc3">Sub</span><span class="sc0"> </span><span class="sc7">AddHorizontalLine_color</span><span class="sc6">(</span><span class="sc7">intLineWidth</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">intRed</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">intGreen</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">intBlue</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">dblYvalue</span><span class="sc6">)</span><span class="sc0">
   </span><span class="sc7">Chart.AddSeries</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc2">5</span><span class="sc6">)</span><span class="sc0">
   </span><span class="sc7">Chart.linewidth</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">intLineWidth</span><span class="sc0">
   </span><span class="sc7">Chart.SeriesInLegend</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc3">false</span><span class="sc0">

   </span><span class="sc7">MyChartAddXY</span><span class="sc0">      </span><span class="sc6">-</span><span class="sc2">0.009</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">dblYvalue</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc4">""</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">RGB</span><span class="sc6">(</span><span class="sc7">intRed</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">intGreen</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">intBlue</span><span class="sc6">)</span><span class="sc0">  
   </span><span class="sc7">MyChartAddXY</span><span class="sc0"> </span><span class="sc7">intDays</span><span class="sc6">+</span><span class="sc2">1.0</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">dblYvalue</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc4">""</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">RGB</span><span class="sc6">(</span><span class="sc7">intRed</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">intGreen</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">intBlue</span><span class="sc6">)</span><span class="sc0">
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">Sub</span><span class="sc0">


</span><span class="sc3">Sub</span><span class="sc0"> </span><span class="sc7">MyChartAddXY</span><span class="sc6">(</span><span class="sc7">dblXValue</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">dblYValue</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">strXLabel</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">intColor</span><span class="sc6">)</span><span class="sc0">
   </span><span class="sc1">' Feed only NON-Null values to the AddXY method.
</span><span class="sc0">   </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc3">Not</span><span class="sc0"> </span><span class="sc7">IsNull</span><span class="sc6">(</span><span class="sc7">dblYValue</span><span class="sc6">))</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
      </span><span class="sc7">Chart.AddXY</span><span class="sc0"> </span><span class="sc7">dblXValue</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">dblYValue</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">strXLabel</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">intColor</span><span class="sc0">
   </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">Sub</span><span class="sc0">


</span><span class="sc1">' Format date for MySQL (YYYY-MM-DD HH:MM:SS)
</span><span class="sc3">Function</span><span class="sc0"> </span><span class="sc7">MySQLDate</span><span class="sc6">(</span><span class="sc7">dateValue</span><span class="sc6">)</span><span class="sc0">
    </span><span class="sc7">MySQLDate</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"'"</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">Year</span><span class="sc6">(</span><span class="sc7">dateValue</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">"-"</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">_</span><span class="sc0">
                </span><span class="sc7">Right</span><span class="sc6">(</span><span class="sc4">"0"</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">Month</span><span class="sc6">(</span><span class="sc7">dateValue</span><span class="sc6">),</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">"-"</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">_</span><span class="sc0">
                </span><span class="sc7">Right</span><span class="sc6">(</span><span class="sc4">"0"</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">Day</span><span class="sc6">(</span><span class="sc7">dateValue</span><span class="sc6">),</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">" "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">_</span><span class="sc0">
                </span><span class="sc7">Right</span><span class="sc6">(</span><span class="sc4">"0"</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">Hour</span><span class="sc6">(</span><span class="sc7">dateValue</span><span class="sc6">),</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">":"</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">_</span><span class="sc0">
                </span><span class="sc7">Right</span><span class="sc6">(</span><span class="sc4">"0"</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">Minute</span><span class="sc6">(</span><span class="sc7">dateValue</span><span class="sc6">),</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">":"</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">_</span><span class="sc0">
                </span><span class="sc7">Right</span><span class="sc6">(</span><span class="sc4">"0"</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">Second</span><span class="sc6">(</span><span class="sc7">dateValue</span><span class="sc6">),</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">"'"</span><span class="sc0">
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0">


</span><span class="sc3">Sub</span><span class="sc0"> </span><span class="sc7">AddVerticalLine</span><span class="sc6">(</span><span class="sc0"> </span><span class="sc7">dblXValue</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">intLineWidth</span><span class="sc6">)</span><span class="sc0">
   </span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">intColor</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">intGray</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">intColor_Red</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">intColor_Green</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">intColor_Blue</span><span class="sc0">
   
   </span><span class="sc7">Chart.AddSeries</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc2">5</span><span class="sc6">)</span><span class="sc0">
   </span><span class="sc7">Chart.linewidth</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">intLineWidth</span><span class="sc0">
   </span><span class="sc7">Chart.SeriesInLegend</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc3">false</span><span class="sc0">

   </span><span class="sc7">intGray</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">75</span><span class="sc0">  </span><span class="sc1">' 0 (black) to 255 (white)
</span><span class="sc0">   
   </span><span class="sc7">intColor_Red</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">intGray</span><span class="sc0">
   </span><span class="sc7">intColor_Green</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">intGray</span><span class="sc0">
   </span><span class="sc7">intColor_Blue</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">intGray</span><span class="sc0">
   
   </span><span class="sc7">intColor</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">RGB</span><span class="sc6">(</span><span class="sc7">intColor_Red</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">intColor_Green</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">intColor_Blue</span><span class="sc6">)</span><span class="sc0">
   </span><span class="sc1">'intColor = vbBlack
</span><span class="sc0">   
   </span><span class="sc7">MyChartAddXY</span><span class="sc0">  </span><span class="sc7">dblXValue</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">Chart.VertAxisMin</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc4">""</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">intColor</span><span class="sc0">  
   </span><span class="sc7">MyChartAddXY</span><span class="sc0">  </span><span class="sc7">dblXValue</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">Chart.VertAxisMax</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc4">""</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">intColor</span><span class="sc0">
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">Sub</span><span class="sc0">


</span><span class="sc3">Function</span><span class="sc0"> </span><span class="sc7">DeltaP_SQL</span><span class="sc6">(</span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">intDays</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc3">ByRef</span><span class="sc0"> </span><span class="sc7">dicTraceIO</span><span class="sc6">)</span><span class="sc0">
   </span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">strWestSite</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">strEastSite</span><span class="sc0">
   
   </span><span class="sc7">strWestSite</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">dicTraceIO.Item</span><span class="sc6">(</span><span class="sc4">"WestSite"</span><span class="sc6">)</span><span class="sc0">
   </span><span class="sc7">strEastSite</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">dicTraceIO.Item</span><span class="sc6">(</span><span class="sc4">"EastSite"</span><span class="sc6">)</span><span class="sc0">

   </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">intDays</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">then</span><span class="sc0">
      </span><span class="sc1">' This query uses an interesting trick to accomplish the delta-P
</span><span class="sc0">      </span><span class="sc1">' calculation.  It selects all the needed data from two sites and then
</span><span class="sc0">      </span><span class="sc1">' groups it by time.  It feeds the SUM operator with logic from the IIF
</span><span class="sc0">      </span><span class="sc1">' operator.  That is how the delta is calculated.  The HAVING clause
</span><span class="sc0">      </span><span class="sc1">' insures that only groups with a count of 2 are used.
</span><span class="sc0">      
      </span><span class="sc1">' old MS Access version
</span><span class="sc0">      </span><span class="sc1">'strSQL = "SELECT DateTimeStamp, TimeMDY, TimeHr, TimeMin, SUM(IIf([StationName]='" &amp; strWestSite &amp; "',+[Pressure],-[Pressure])) AS DeltaP " &amp; _
</span><span class="sc0">      </span><span class="sc1">'         "FROM FifteenMinData " &amp; _
</span><span class="sc0">      </span><span class="sc1">'         "WHERE ((StationName) In ('" &amp; strWestSite &amp; "','" &amp; strEastSite &amp; "')) AND " &amp; _
</span><span class="sc0">      </span><span class="sc1">'         "      (DateTimeStamp &lt;=     " &amp; MySQLDate(dteEndDateTime)    &amp; ") AND " &amp; _
</span><span class="sc0">      </span><span class="sc1">'         "      (DateTimeStamp &gt;=     " &amp; MySQLDate(dteStartDateTime_forQuery) &amp; ") " &amp; _
</span><span class="sc0">      </span><span class="sc1">'         "GROUP BY DateTimeStamp, TimeMDY, TimeHr, TimeMin " &amp; _
</span><span class="sc0">      </span><span class="sc1">'         "HAVING (((Count(DateTimeStamp))=2)) " &amp; _
</span><span class="sc0">      </span><span class="sc1">'         "ORDER BY TimeMDY ASC, TimeHr ASC, TimeMin ASC"
</span><span class="sc0">      
      </span><span class="sc1">' MySQL-compatible query (replacing IIf with CASE expression)
</span><span class="sc0">      </span><span class="sc7">strSQL</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"SELECT DateTimeStamp, TimeMDY, TimeHr, TimeMin, "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">_</span><span class="sc0">
               </span><span class="sc4">"SUM(CASE WHEN StationName = '"</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">strWestSite</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">"' THEN Pressure ELSE -Pressure END) AS DeltaP "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">_</span><span class="sc0">
               </span><span class="sc4">"FROM FifteenMinData "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">_</span><span class="sc0">
               </span><span class="sc4">"WHERE StationName IN ('"</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">strWestSite</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">"','"</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">strEastSite</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">"') AND "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">_</span><span class="sc0">
               </span><span class="sc4">"DateTimeStamp &lt;= "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">MySQLDate</span><span class="sc6">(</span><span class="sc7">dteEndDateTime</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">" AND "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">_</span><span class="sc0">
               </span><span class="sc4">"DateTimeStamp &gt;= "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">MySQLDate</span><span class="sc6">(</span><span class="sc7">dteStartDateTime_forQuery</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">" "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">_</span><span class="sc0">
               </span><span class="sc4">"GROUP BY DateTimeStamp, TimeMDY, TimeHr, TimeMin "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">_</span><span class="sc0">
               </span><span class="sc4">"HAVING COUNT(DISTINCT StationName) = 2 "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">_</span><span class="sc0">
               </span><span class="sc4">"ORDER BY TimeMDY ASC, TimeHr ASC, TimeMin ASC"</span><span class="sc0">

   </span><span class="sc3">Else</span><span class="sc0">
      </span><span class="sc1">' Multi-day query
</span><span class="sc0">
      </span><span class="sc1">' old MS Access version
</span><span class="sc0">      </span><span class="sc1">'strSQL = "SELECT DateTimeStamp, TimeMDY, TimeHr, TimeMin, SUM(IIf([StationName]='" &amp; strWestSite &amp; "',+[Pressure],-[Pressure])) AS DeltaP1 " &amp; _
</span><span class="sc0">      </span><span class="sc1">'         "FROM FifteenMinData " &amp; _
</span><span class="sc0">      </span><span class="sc1">'         "WHERE ((StationName) In ('" &amp; strWestSite &amp; "','" &amp; strEastSite &amp; "')) AND " &amp; _
</span><span class="sc0">      </span><span class="sc1">'         "      ([DateTimeStamp] &lt;=     #" &amp; dteEndDateTime    &amp; "#) AND " &amp; _
</span><span class="sc0">      </span><span class="sc1">'         "      ([DateTimeStamp] &gt;=     #" &amp; dteStartDateTime_forQuery &amp; "#) " &amp; _
</span><span class="sc0">      </span><span class="sc1">'         "GROUP BY DateTimeStamp, TimeMDY, TimeHr, TimeMin " &amp; _
</span><span class="sc0">      </span><span class="sc1">'         "HAVING (((Count(DateTimeStamp))=2)) " &amp; _
</span><span class="sc0">      </span><span class="sc1">'         "ORDER BY TimeMDY ASC, TimeHr ASC, TimeMin ASC"   
</span><span class="sc0">      </span><span class="sc1">'
</span><span class="sc0">      </span><span class="sc1">' And now we feed the query above into the aggregation query below
</span><span class="sc0">      </span><span class="sc1">' (another interesting SQL trick).
</span><span class="sc0">      </span><span class="sc1">'
</span><span class="sc0">      </span><span class="sc1">'strSQL = "SELECT TimeMDY, TimeHr, AVG(DeltaP1) AS DeltaP " &amp; _
</span><span class="sc0">      </span><span class="sc1">'         "FROM (" &amp; strSQL &amp; ") " &amp; _
</span><span class="sc0">      </span><span class="sc1">'         "GROUP BY TimeMDY, TimeHr " &amp; _
</span><span class="sc0">      </span><span class="sc1">'         "ORDER BY TimeMDY ASC , TimeHr ASC "
</span><span class="sc0">
      </span><span class="sc1">' MySQL-compatible query for multi-day
</span><span class="sc0">      </span><span class="sc7">strSQL</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"SELECT DateTimeStamp, TimeMDY, TimeHr, TimeMin, "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">_</span><span class="sc0">
         </span><span class="sc4">"SUM(CASE WHEN StationName = '"</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">strWestSite</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">"' THEN Pressure ELSE -Pressure END) AS DeltaP1 "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">_</span><span class="sc0">
         </span><span class="sc4">"FROM FifteenMinData "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">_</span><span class="sc0">
         </span><span class="sc4">"WHERE StationName IN ('"</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">strWestSite</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">"','"</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">strEastSite</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">"') AND "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">_</span><span class="sc0">
         </span><span class="sc4">"DateTimeStamp &lt;= "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">MySQLDate</span><span class="sc6">(</span><span class="sc7">dteEndDateTime</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">" AND "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">_</span><span class="sc0">
         </span><span class="sc4">"DateTimeStamp &gt;= "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">MySQLDate</span><span class="sc6">(</span><span class="sc7">dteStartDateTime_forQuery</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">" "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">_</span><span class="sc0">
         </span><span class="sc4">"GROUP BY DateTimeStamp, TimeMDY, TimeHr, TimeMin "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">_</span><span class="sc0">
         </span><span class="sc4">"HAVING COUNT(DISTINCT StationName) = 2 "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">_</span><span class="sc0">
         </span><span class="sc4">"ORDER BY TimeMDY ASC, TimeHr ASC, TimeMin ASC"</span><span class="sc0">   

      </span><span class="sc1">' And now we feed the query above into the aggregation query below
</span><span class="sc0">      </span><span class="sc1">' (another interesting SQL trick).
</span><span class="sc0">      </span><span class="sc1">' For MySQL, we need to add an alias for the derived table
</span><span class="sc0">
      </span><span class="sc7">strSQL</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"SELECT TimeMDY, TimeHr, AVG(DeltaP1) AS DeltaP "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">_</span><span class="sc0">
               </span><span class="sc4">"FROM ("</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">strSQL</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">") AS derived_table "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">_</span><span class="sc0">
               </span><span class="sc4">"GROUP BY TimeMDY, TimeHr "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">_</span><span class="sc0">
               </span><span class="sc4">"ORDER BY TimeMDY ASC, TimeHr ASC"</span><span class="sc0">

   </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">

   </span><span class="sc7">DeltaP_SQL</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">strSQL</span><span class="sc0">
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0">


</span><span class="sc3">Function</span><span class="sc0"> </span><span class="sc7">CollectTraceData</span><span class="sc6">(</span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">strSensor_DBName</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc3">ByVal</span><span class="sc0"> </span><span class="sc7">intColor</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc3">ByRef</span><span class="sc0"> </span><span class="sc7">dicTraceIO</span><span class="sc6">)</span><span class="sc0">
   </span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">strSensorSelectClause</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">strSQL_trace</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">rstTelem</span><span class="sc0">

   </span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">points</span><span class="sc6">(),</span><span class="sc0"> </span><span class="sc7">points_smoothed</span><span class="sc6">(),</span><span class="sc0"> </span><span class="sc7">pointCount</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">maxPointCount</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">n_records</span><span class="sc0">

   </span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">dblYMax</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">dblYMin</span><span class="sc0">
   </span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">dblXValue_raw</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">dblXValue</span><span class="sc0"> 
   </span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">dblYValue_raw</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">dblYValue</span><span class="sc0">
   </span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">arrayIndex</span><span class="sc0">

   </span><span class="sc1">' Initialize array
</span><span class="sc0">   </span><span class="sc7">pointCount</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc7">intDays</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
      </span><span class="sc1">' Allocate for up to a day of 5-minute data.
</span><span class="sc0">      </span><span class="sc7">maxPointCount</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">intDays</span><span class="sc0"> </span><span class="sc6">*</span><span class="sc0"> </span><span class="sc2">24</span><span class="sc0"> </span><span class="sc6">*</span><span class="sc0"> </span><span class="sc2">12</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">+</span><span class="sc0"> </span><span class="sc2">50</span><span class="sc0">
   </span><span class="sc3">Else</span><span class="sc0">
      </span><span class="sc1">' Allocate for up to a day of hourly data.
</span><span class="sc0">      </span><span class="sc7">maxPointCount</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">intDays</span><span class="sc0"> </span><span class="sc6">*</span><span class="sc0"> </span><span class="sc2">24</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">+</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc0">
   </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
   </span><span class="sc3">ReDim</span><span class="sc0"> </span><span class="sc7">points</span><span class="sc6">(</span><span class="sc7">maxPointCount</span><span class="sc6">)</span><span class="sc0">
   </span><span class="sc3">ReDim</span><span class="sc0"> </span><span class="sc7">points_smoothed</span><span class="sc6">(</span><span class="sc7">maxPointCount</span><span class="sc6">)</span><span class="sc0">
   
   </span><span class="sc7">dblYMax</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">dicTraceIO.Item</span><span class="sc6">(</span><span class="sc4">"YMax"</span><span class="sc6">)</span><span class="sc0"> 
   </span><span class="sc7">dblYMin</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">dicTraceIO.Item</span><span class="sc6">(</span><span class="sc4">"YMin"</span><span class="sc6">)</span><span class="sc0"> 

   </span><span class="sc7">dicTraceIO.Item</span><span class="sc6">(</span><span class="sc4">"FoundData_ForThisTrace"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc3">False</span><span class="sc0">
   
   </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">intDays</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
      </span><span class="sc1">' Single day query (multiple values per hour)
</span><span class="sc0">      </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">((</span><span class="sc7">strMRTime</span><span class="sc0"> </span><span class="sc6">&lt;&gt;</span><span class="sc0"> </span><span class="sc4">"-"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">And</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">DaysDec</span><span class="sc6">(</span><span class="sc7">strMRTime</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">&gt;</span><span class="sc0"> </span><span class="sc2">0.0</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">And</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">DaysDec</span><span class="sc6">(</span><span class="sc0"> </span><span class="sc7">strMRTime</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">&lt;</span><span class="sc0"> </span><span class="sc2">1.0</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">And</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">str24Hrs_state</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"checked"</span><span class="sc6">))</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
         </span><span class="sc1">' Go back a full day. This modification of dteStartDateTime_forQuery is in support 
</span><span class="sc0">         </span><span class="sc1">' of the 24h plot.
</span><span class="sc0">         </span><span class="sc7">dteStartDateTime_forQuery</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">DateAdd</span><span class="sc6">(</span><span class="sc4">"d"</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc6">-</span><span class="sc2">1</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">DateAdd</span><span class="sc6">(</span><span class="sc4">"n"</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">strMRTime</span><span class="sc6">))</span><span class="sc0">
      </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
      
      </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">strSensor_DBName</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"DeltaP"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
         </span><span class="sc7">strSQL_trace</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">DeltaP_SQL</span><span class="sc6">(</span><span class="sc7">intDays</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">dicTraceIO</span><span class="sc6">)</span><span class="sc0">
      </span><span class="sc3">Else</span><span class="sc0">
         </span><span class="sc7">strSQL_trace</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"SELECT StationName, DateTimeStamp, TimeMDY, TimeMin, TimeHr, "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">strSensor_DBName</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">" "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">_</span><span class="sc0">
                        </span><span class="sc4">"FROM FifteenMinData "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">_</span><span class="sc0"> 
                        </span><span class="sc4">"WHERE (StationName = '"</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">strLocation</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">"') AND "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">_</span><span class="sc0">
                              </span><span class="sc4">"(DateTimeStamp &lt;=     "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">MySQLDate</span><span class="sc6">(</span><span class="sc7">dteEndDateTime</span><span class="sc6">)</span><span class="sc0">    </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">") AND "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">_</span><span class="sc0">
                              </span><span class="sc4">"(DateTimeStamp &gt;=     "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">MySQLDate</span><span class="sc6">(</span><span class="sc7">dteStartDateTime_forQuery</span><span class="sc6">)</span><span class="sc0">     </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">") AND "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">_</span><span class="sc0">
                              </span><span class="sc4">"("</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">strSensor_DBName</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">" IS NOT NULL) "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">_</span><span class="sc0">
                        </span><span class="sc4">"ORDER BY TimeMDY ASC, TimeHr ASC, TimeMin ASC"</span><span class="sc0">
      </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">

   </span><span class="sc3">Else</span><span class="sc0">   
      </span><span class="sc1">' Multi-day query (hourly data)
</span><span class="sc0">      </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">strSensor_DBName</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"DeltaP"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
         </span><span class="sc7">strSQL_trace</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">DeltaP_SQL</span><span class="sc6">(</span><span class="sc7">intDays</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">dicTraceIO</span><span class="sc6">)</span><span class="sc0">
      </span><span class="sc3">Else</span><span class="sc0">
         </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">strSensor_DBName</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"TempMax"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">or</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">strSensor_DBName</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"WindGust"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
            </span><span class="sc7">strSensorSelectClause</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"MAX(A."</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">strSensor_DBName</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">") AS "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">strSensor_DBName</span><span class="sc0">
         </span><span class="sc3">ElseIf</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">strSensor_DBName</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"TempMin"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
            </span><span class="sc7">strSensorSelectClause</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"MIN(A."</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">strSensor_DBName</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">") AS "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">strSensor_DBName</span><span class="sc0">
         </span><span class="sc3">Else</span><span class="sc0">
            </span><span class="sc7">strSensorSelectClause</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"AVG(A."</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">strSensor_DBName</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">") AS "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">strSensor_DBName</span><span class="sc0">
         </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
         
         </span><span class="sc7">strSQL_trace</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"SELECT TimeMDY, TimeHr, MIN(A.StationName) AS StationName, AVG(A.DateTimeStamp) AS DateTimeStamp, "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">strSensorSelectClause</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">" "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">_</span><span class="sc0">
                        </span><span class="sc4">"FROM FifteenMinData AS A "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">_</span><span class="sc0"> 
                        </span><span class="sc4">"WHERE (StationName = '"</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">strLocation</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">"') AND "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">_</span><span class="sc0">
                           </span><span class="sc4">"(DateTimeStamp &lt;=     "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">MySQLDate</span><span class="sc6">(</span><span class="sc7">dteEndDateTime</span><span class="sc6">)</span><span class="sc0">    </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">") AND "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">_</span><span class="sc0">
                           </span><span class="sc4">"(DateTimeStamp &gt;=     "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">MySQLDate</span><span class="sc6">(</span><span class="sc7">dteStartDateTime_forQuery</span><span class="sc6">)</span><span class="sc0">     </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">") AND "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">_</span><span class="sc0">
                           </span><span class="sc4">"("</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">strSensor_DBName</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">" IS NOT NULL) "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">_</span><span class="sc0">
                        </span><span class="sc4">"GROUP BY TimeMDY, TimeHr "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">_</span><span class="sc0">
                        </span><span class="sc4">"ORDER BY TimeMDY ASC, TimeHr ASC"</span><span class="sc0">       
      </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
   </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">


   </span><span class="sc3">Set</span><span class="sc0"> </span><span class="sc7">rstTelem</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">Server.CreateObject</span><span class="sc6">(</span><span class="sc4">"ADODB.Recordset"</span><span class="sc6">)</span><span class="sc0">
    </span><span class="sc3">On</span><span class="sc0"> </span><span class="sc3">Error</span><span class="sc0"> </span><span class="sc3">Resume</span><span class="sc0"> </span><span class="sc3">Next</span><span class="sc0">
    </span><span class="sc7">rstTelem.Open</span><span class="sc0"> </span><span class="sc7">strSQL_trace</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">DBConnection</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">adOpenStatic</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">adLockReadOnly</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">adCmdText</span><span class="sc0">
    </span><span class="sc7">LogError</span><span class="sc6">(</span><span class="sc4">"Recordset = rstTelem, SQL = "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">strSQL_trace</span><span class="sc6">)</span><span class="sc0">
    </span><span class="sc3">On</span><span class="sc0"> </span><span class="sc3">Error</span><span class="sc0"> </span><span class="sc3">Goto</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">

   </span><span class="sc1">' Collect data into the points array
</span><span class="sc0">   </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc3">Not</span><span class="sc0"> </span><span class="sc7">rstTelem.EOF</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
      </span><span class="sc7">rstTelem.MoveFirst</span><span class="sc0">
      </span><span class="sc3">Do</span><span class="sc0"> </span><span class="sc3">Until</span><span class="sc0"> </span><span class="sc7">rstTelem.EOF</span><span class="sc0">
         </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">intDays</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
            </span><span class="sc7">dblXValue_raw</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">DaysDecSinceRefF</span><span class="sc6">(</span><span class="sc7">rstTelem</span><span class="sc6">(</span><span class="sc4">"TimeMDY"</span><span class="sc6">),</span><span class="sc0"> </span><span class="sc7">rstTelem</span><span class="sc6">(</span><span class="sc4">"TimeHr"</span><span class="sc6">),</span><span class="sc0"> </span><span class="sc7">rstTelem</span><span class="sc6">(</span><span class="sc4">"TimeMin"</span><span class="sc6">))</span><span class="sc0">
         </span><span class="sc3">Else</span><span class="sc0">
            </span><span class="sc7">dblXValue_raw</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">DaysDecSinceRefF</span><span class="sc6">(</span><span class="sc7">rstTelem</span><span class="sc6">(</span><span class="sc4">"TimeMDY"</span><span class="sc6">),</span><span class="sc0"> </span><span class="sc7">rstTelem</span><span class="sc6">(</span><span class="sc4">"TimeHr"</span><span class="sc6">),</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc6">)</span><span class="sc0">
         </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">

         </span><span class="sc7">dblYValue_raw</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc3">CDbl</span><span class="sc6">(</span><span class="sc7">rstTelem</span><span class="sc6">(</span><span class="sc0"> </span><span class="sc7">strSensor_DBName</span><span class="sc6">))</span><span class="sc0">
         </span><span class="sc1">' If there will the a running average done later, don't scale direction data here. 
</span><span class="sc0">         </span><span class="sc1">' Leave it in degrees for now. Scale after the running average (which expects degrees).
</span><span class="sc0">         </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">strSensor_DBName</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"WindDirection"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">and</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">strRA_state</span><span class="sc0"> </span><span class="sc6">&lt;&gt;</span><span class="sc0"> </span><span class="sc4">"checked"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
            </span><span class="sc7">dblYValue</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">dblYValue_raw</span><span class="sc0"> </span><span class="sc6">*</span><span class="sc0"> </span><span class="sc7">dblWindNormFactor</span><span class="sc0">
         </span><span class="sc3">Else</span><span class="sc0">
            </span><span class="sc7">dblYValue</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">dblYValue_raw</span><span class="sc0">
         </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">

         </span><span class="sc7">MinMax</span><span class="sc0"> </span><span class="sc7">dblYValue</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">dblYMax</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">dblYMin</span><span class="sc0">

         </span><span class="sc1">' Store in array - format: [day-since-ref, sensor-value]
</span><span class="sc0">         </span><span class="sc7">points</span><span class="sc6">(</span><span class="sc7">pointCount</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">Array</span><span class="sc6">(</span><span class="sc3">CDbl</span><span class="sc6">(</span><span class="sc7">dblXValue_raw</span><span class="sc6">),</span><span class="sc0"> </span><span class="sc3">CDbl</span><span class="sc6">(</span><span class="sc7">dblYValue</span><span class="sc6">),</span><span class="sc0"> </span><span class="sc4">""</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">intColor</span><span class="sc6">)</span><span class="sc0">
         </span><span class="sc7">pointCount</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">pointCount</span><span class="sc0"> </span><span class="sc6">+</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">
         
         </span><span class="sc7">rstTelem.MoveNext</span><span class="sc0">
      </span><span class="sc3">Loop</span><span class="sc0">
      
      </span><span class="sc1">' Resize array to actual number of points
</span><span class="sc0">      </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc7">pointCount</span><span class="sc0"> </span><span class="sc6">&gt;</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
         </span><span class="sc3">ReDim</span><span class="sc0"> </span><span class="sc3">Preserve</span><span class="sc0"> </span><span class="sc7">points</span><span class="sc6">(</span><span class="sc7">pointCount</span><span class="sc0"> </span><span class="sc6">-</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc6">)</span><span class="sc0">
      </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
   </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">

   </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc7">rstTelem.State</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">adStateOpen</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0"> </span><span class="sc7">rstTelem.Close</span><span class="sc0">
   </span><span class="sc3">Set</span><span class="sc0"> </span><span class="sc7">rstTelem</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc3">Nothing</span><span class="sc0">


   </span><span class="sc1">' Smooth the data using a running average (if requested and 5+ data points)
</span><span class="sc0">   </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">strRA_state</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"checked"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">AND</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">pointCount</span><span class="sc0"> </span><span class="sc6">&gt;=</span><span class="sc0"> </span><span class="sc2">5</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
      </span><span class="sc1">' Create the running average objects directly here
</span><span class="sc0">      </span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">n_RA_stack</span><span class="sc0">
      </span><span class="sc7">n_RA_stack</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">3</span><span class="sc0">
      
      </span><span class="sc1">' Initialize running average objects with stack size: n_RA_stack
</span><span class="sc0">   
      </span><span class="sc1">' Create running average objects
</span><span class="sc0">      </span><span class="sc3">Set</span><span class="sc0"> </span><span class="sc7">RA_x</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc3">New</span><span class="sc0"> </span><span class="sc7">RunningAverage</span><span class="sc0">
      </span><span class="sc7">RA_x.Initialize</span><span class="sc0"> </span><span class="sc7">n_RA_stack</span><span class="sc0">
      
      </span><span class="sc1">' Reset with the total number of points to properly handle end-of-data logic
</span><span class="sc0">      </span><span class="sc7">RA_x.Reset</span><span class="sc0"> </span><span class="sc7">pointCount</span><span class="sc0">
      
      </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc7">strSensor_DBName</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"WindDirection"</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
         </span><span class="sc3">Set</span><span class="sc0"> </span><span class="sc7">RA_y</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc3">New</span><span class="sc0"> </span><span class="sc7">RunningAverage_Dir</span><span class="sc0">
         </span><span class="sc7">RA_y.Initialize</span><span class="sc0"> </span><span class="sc7">n_RA_stack</span><span class="sc0">
         </span><span class="sc7">RA_y.Reset</span><span class="sc0"> </span><span class="sc7">pointCount</span><span class="sc0">
      </span><span class="sc3">Else</span><span class="sc0">
         </span><span class="sc3">Set</span><span class="sc0"> </span><span class="sc7">RA_y</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc3">New</span><span class="sc0"> </span><span class="sc7">RunningAverage</span><span class="sc0">
         </span><span class="sc7">RA_y.Initialize</span><span class="sc0"> </span><span class="sc7">n_RA_stack</span><span class="sc0">
         </span><span class="sc7">RA_y.Reset</span><span class="sc0"> </span><span class="sc7">pointCount</span><span class="sc0">
      </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
      
      </span><span class="sc1">' Smooth the data
</span><span class="sc0">      </span><span class="sc3">For</span><span class="sc0"> </span><span class="sc7">arrayIndex</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0"> </span><span class="sc3">To</span><span class="sc0"> </span><span class="sc7">UBound</span><span class="sc6">(</span><span class="sc7">points</span><span class="sc6">)</span><span class="sc0">
         </span><span class="sc7">dblXValue_raw</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">points</span><span class="sc6">(</span><span class="sc7">arrayIndex</span><span class="sc6">)(</span><span class="sc2">0</span><span class="sc6">)</span><span class="sc0">
         </span><span class="sc7">dblYValue_raw</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">points</span><span class="sc6">(</span><span class="sc7">arrayIndex</span><span class="sc6">)(</span><span class="sc2">1</span><span class="sc6">)</span><span class="sc0">
         
         </span><span class="sc1">' Apply running average to all points
</span><span class="sc0">         </span><span class="sc1">' The RunningAverage class now handles special cases for endpoints
</span><span class="sc0">         </span><span class="sc7">dblXValue</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">RA_x.update</span><span class="sc6">(</span><span class="sc7">dblXValue_raw</span><span class="sc6">)</span><span class="sc0">
         </span><span class="sc1">' Now, after averaging, scale the direction data to deal with the single-axis chart.
</span><span class="sc0">         </span><span class="sc1">' The RunningAverage_Dir class expects the data in degrees.
</span><span class="sc0">         </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">strSensor_DBName</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"WindDirection"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
            </span><span class="sc7">dblYValue</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">RA_y.update</span><span class="sc6">(</span><span class="sc7">dblYValue_raw</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">*</span><span class="sc0"> </span><span class="sc7">dblWindNormFactor</span><span class="sc0">
         </span><span class="sc3">Else</span><span class="sc0">
            </span><span class="sc7">dblYValue</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">RA_y.update</span><span class="sc6">(</span><span class="sc7">dblYValue_raw</span><span class="sc6">)</span><span class="sc0">
         </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">

         </span><span class="sc7">points_smoothed</span><span class="sc6">(</span><span class="sc7">arrayIndex</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">Array</span><span class="sc6">(</span><span class="sc7">dblXValue</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">dblYValue</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc4">""</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">intColor</span><span class="sc6">)</span><span class="sc0">
      </span><span class="sc3">Next</span><span class="sc0">
      </span><span class="sc3">ReDim</span><span class="sc0"> </span><span class="sc3">Preserve</span><span class="sc0"> </span><span class="sc7">points_smoothed</span><span class="sc6">(</span><span class="sc7">pointCount</span><span class="sc0"> </span><span class="sc6">-</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc6">)</span><span class="sc0">      
      
      </span><span class="sc7">useRunningAverage</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc3">True</span><span class="sc0">
   </span><span class="sc3">Else</span><span class="sc0">
      </span><span class="sc7">useRunningAverage</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc3">False</span><span class="sc0">
   </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">


   </span><span class="sc1">' Note that this assignment can not be made in the call to MinMax. It can't modify the
</span><span class="sc0">   </span><span class="sc1">' dictionary values directly (unless you passed it the whole dictionary).
</span><span class="sc0">   </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">strSensor_DBName</span><span class="sc0"> </span><span class="sc6">&lt;&gt;</span><span class="sc0"> </span><span class="sc4">"WindDirection"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
      </span><span class="sc7">dicTraceIO.Item</span><span class="sc6">(</span><span class="sc4">"YMax"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">dblYMax</span><span class="sc0">
      </span><span class="sc7">dicTraceIO.Item</span><span class="sc6">(</span><span class="sc4">"YMin"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">dblYMin</span><span class="sc0">
   </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">

   </span><span class="sc1">' Return the array
</span><span class="sc0">   </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc7">pointCount</span><span class="sc0"> </span><span class="sc6">&gt;</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">   
      </span><span class="sc7">dicTraceIO.Item</span><span class="sc6">(</span><span class="sc4">"FoundData"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc3">True</span><span class="sc0">
      </span><span class="sc7">dicTraceIO.Item</span><span class="sc6">(</span><span class="sc4">"FoundData_ForThisTrace"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc3">True</span><span class="sc0">
      
      </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc7">useRunningAverage</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
         </span><span class="sc7">CollectTraceData</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">points_smoothed</span><span class="sc0">
      </span><span class="sc3">Else</span><span class="sc0">
         </span><span class="sc7">CollectTraceData</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">points</span><span class="sc0">
      </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
   </span><span class="sc3">Else</span><span class="sc0">
      </span><span class="sc7">CollectTraceData</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">Null</span><span class="sc0">
   </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0">


</span><span class="sc3">Sub</span><span class="sc0"> </span><span class="sc7">AddTrace</span><span class="sc6">(</span><span class="sc7">strSensorName</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">intSeriesType</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">strSeriesTitle</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">intLineWidth</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">intColor</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc3">ByRef</span><span class="sc0"> </span><span class="sc7">dicTraceIO</span><span class="sc6">)</span><span class="sc0">
   </span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">intTraceArray_index</span><span class="sc0">
   </span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">intYesterdayColor</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">intGray</span><span class="sc0"> 
   </span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">dblYValue</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">dblYValue_raw</span><span class="sc0">
   </span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">dblXValue</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">dblXValue_raw</span><span class="sc0">
   </span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">strSQL_trace</span><span class="sc0">
   </span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">i</span><span class="sc0">
   </span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">pointCount</span><span class="sc0">

   </span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">dataPoints</span><span class="sc0">
   
   </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">strSensorName</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"WindDirection"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
      </span><span class="sc7">dataPoints</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">dataPoints_WindDirection</span><span class="sc0">
   </span><span class="sc3">ElseIf</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">strSensorName</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"WindGust"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
      </span><span class="sc7">dataPoints</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">dataPoints_WindGust</span><span class="sc0">
   </span><span class="sc3">ElseIf</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">strSensorName</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"WindSpeed"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
      </span><span class="sc7">dataPoints</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">dataPoints_WindSpeed</span><span class="sc0">

   </span><span class="sc3">ElseIf</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">strSensorName</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"Pressure"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
      </span><span class="sc7">dataPoints</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">dataPoints_Pressure</span><span class="sc0">

   </span><span class="sc3">ElseIf</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">strSensorName</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"DeltaP_trace_A"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
      </span><span class="sc7">dataPoints</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">dataPoints_DeltaP_trace_A</span><span class="sc0">
   </span><span class="sc3">ElseIf</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">strSensorName</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"DeltaP_trace_B"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
      </span><span class="sc7">dataPoints</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">dataPoints_DeltaP_trace_B</span><span class="sc0">

   </span><span class="sc3">ElseIf</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">strSensorName</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"TempAvg"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
      </span><span class="sc7">dataPoints</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">dataPoints_TempAvg</span><span class="sc0">
   </span><span class="sc3">ElseIf</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">strSensorName</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"TempMax"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
      </span><span class="sc7">dataPoints</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">dataPoints_TempMax</span><span class="sc0">
   </span><span class="sc3">ElseIf</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">strSensorName</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"TempMin"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
      </span><span class="sc7">dataPoints</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">dataPoints_TempMin</span><span class="sc0">
   </span><span class="sc3">ElseIf</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">strSensorName</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"DewPoint"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
      </span><span class="sc7">dataPoints</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">dataPoints_DewPoint</span><span class="sc0">
   </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">

   </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">IsArray</span><span class="sc6">(</span><span class="sc7">dataPoints</span><span class="sc6">))</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0"> 
      </span><span class="sc7">pointCount</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">UBound</span><span class="sc6">(</span><span class="sc7">dataPoints</span><span class="sc6">)</span><span class="sc0">
      </span><span class="sc7">dicTraceIO.Item</span><span class="sc6">(</span><span class="sc4">"FoundData"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc3">True</span><span class="sc0">
      </span><span class="sc7">dicTraceIO.Item</span><span class="sc6">(</span><span class="sc4">"FoundData_ForThisTrace"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc3">True</span><span class="sc0">
   </span><span class="sc3">Else</span><span class="sc0"> 
      </span><span class="sc7">dicTraceIO.Item</span><span class="sc6">(</span><span class="sc4">"FoundData_ForThisTrace"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc3">False</span><span class="sc0">
      </span><span class="sc3">Exit</span><span class="sc0"> </span><span class="sc3">Sub</span><span class="sc0">
   </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
   
   </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc7">intSeriesType</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">6</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
      </span><span class="sc7">intGray</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">200</span><span class="sc0">
      </span><span class="sc7">intYesterdayColor</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">RGB</span><span class="sc6">(</span><span class="sc7">intGray</span><span class="sc6">,</span><span class="sc7">intGray</span><span class="sc6">,</span><span class="sc7">intGray</span><span class="sc6">)</span><span class="sc0">
   </span><span class="sc3">Else</span><span class="sc0">
      </span><span class="sc7">intYesterdayColor</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">intColor</span><span class="sc0">
   </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
   
   </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">intDays</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
      </span><span class="sc1">' Use the dataPoints array instead of directly accessing the recordset
</span><span class="sc0">      </span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">yesterdayPoints</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">todayPoints</span><span class="sc0">
      </span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">yesterdayCount</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">todayCount</span><span class="sc0">
      
      </span><span class="sc1">' Initialize counters and arrays
</span><span class="sc0">      </span><span class="sc7">yesterdayCount</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
      </span><span class="sc7">todayCount</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
      
      </span><span class="sc3">ReDim</span><span class="sc0"> </span><span class="sc7">yesterdayPoints</span><span class="sc6">(</span><span class="sc7">pointCount</span><span class="sc6">)</span><span class="sc0">
      </span><span class="sc3">ReDim</span><span class="sc0"> </span><span class="sc7">todayPoints</span><span class="sc6">(</span><span class="sc7">pointCount</span><span class="sc6">)</span><span class="sc0">
      
      </span><span class="sc1">' Loop through all data points and separate into yesterday and today (before and after midnight)
</span><span class="sc0">      </span><span class="sc3">For</span><span class="sc0"> </span><span class="sc7">i</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0"> </span><span class="sc3">To</span><span class="sc0"> </span><span class="sc7">pointCount</span><span class="sc0">
         </span><span class="sc7">dblXValue</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">dataPoints</span><span class="sc6">(</span><span class="sc7">i</span><span class="sc6">)(</span><span class="sc2">0</span><span class="sc6">)</span><span class="sc0">
         </span><span class="sc7">dblYValue</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">dataPoints</span><span class="sc6">(</span><span class="sc7">i</span><span class="sc6">)(</span><span class="sc2">1</span><span class="sc6">)</span><span class="sc0">
         
         </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">dblXValue</span><span class="sc0"> </span><span class="sc6">&lt;</span><span class="sc0"> </span><span class="sc2">0.0</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
            </span><span class="sc1">' This is yesterday's data
</span><span class="sc0">            </span><span class="sc1">' Add 1.0 to the x value to move yesterday's points onto today's plot
</span><span class="sc0">            </span><span class="sc7">dblXValue</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">dblXValue</span><span class="sc0"> </span><span class="sc6">+</span><span class="sc0"> </span><span class="sc2">1.0</span><span class="sc0">
            </span><span class="sc7">yesterdayPoints</span><span class="sc6">(</span><span class="sc7">yesterdayCount</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">Array</span><span class="sc6">(</span><span class="sc7">dblXValue</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">dblYValue</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc4">""</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">intYesterdayColor</span><span class="sc6">)</span><span class="sc0">
            </span><span class="sc7">yesterdayCount</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">yesterdayCount</span><span class="sc0"> </span><span class="sc6">+</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">
            
         </span><span class="sc3">Else</span><span class="sc0">
            </span><span class="sc1">' This is today's data
</span><span class="sc0">            </span><span class="sc7">todayPoints</span><span class="sc6">(</span><span class="sc7">todayCount</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">Array</span><span class="sc6">(</span><span class="sc7">dblXValue</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">dblYValue</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc4">""</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">intColor</span><span class="sc6">)</span><span class="sc0">
            </span><span class="sc7">todayCount</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">todayCount</span><span class="sc0"> </span><span class="sc6">+</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">
         </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
      </span><span class="sc3">Next</span><span class="sc0">

      </span><span class="sc1">' Resize arrays to actual counts
</span><span class="sc0">      </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc7">yesterdayCount</span><span class="sc0"> </span><span class="sc6">&gt;</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
         </span><span class="sc3">ReDim</span><span class="sc0"> </span><span class="sc3">Preserve</span><span class="sc0"> </span><span class="sc7">yesterdayPoints</span><span class="sc6">(</span><span class="sc7">yesterdayCount</span><span class="sc0"> </span><span class="sc6">-</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc6">)</span><span class="sc0">
      </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
      
      </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc7">todayCount</span><span class="sc0"> </span><span class="sc6">&gt;</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
         </span><span class="sc3">ReDim</span><span class="sc0"> </span><span class="sc3">Preserve</span><span class="sc0"> </span><span class="sc7">todayPoints</span><span class="sc6">(</span><span class="sc7">todayCount</span><span class="sc0"> </span><span class="sc6">-</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc6">)</span><span class="sc0">
      </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
      
      </span><span class="sc1">' Plot yesterday's data
</span><span class="sc0">      </span><span class="sc7">Chart.AddSeries</span><span class="sc6">(</span><span class="sc7">intSeriesType</span><span class="sc6">)</span><span class="sc0">
      </span><span class="sc7">Chart.SeriesInLegend</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc3">False</span><span class="sc0">
      </span><span class="sc7">Chart.linewidth</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">      
      </span><span class="sc7">Chart.AddXYArray</span><span class="sc0"> </span><span class="sc7">yesterdayPoints</span><span class="sc0">

      </span><span class="sc1">' Plot today's data
</span><span class="sc0">      </span><span class="sc7">Chart.AddSeries</span><span class="sc6">(</span><span class="sc7">intSeriesType</span><span class="sc6">)</span><span class="sc0">
      </span><span class="sc7">Chart.linewidth</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">intLineWidth</span><span class="sc0">
      </span><span class="sc7">Chart.SeriesTitle</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">strSeriesTitle</span><span class="sc0">
      </span><span class="sc7">Chart.AddXYArray</span><span class="sc0"> </span><span class="sc7">todayPoints</span><span class="sc0">
   
   </span><span class="sc3">Else</span><span class="sc0">
      </span><span class="sc1">' Multi-day chart
</span><span class="sc0">      </span><span class="sc7">Chart.AddSeries</span><span class="sc6">(</span><span class="sc0"> </span><span class="sc7">intSeriesType</span><span class="sc6">)</span><span class="sc0">
      </span><span class="sc7">Chart.linewidth</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">intLineWidth</span><span class="sc0">
      </span><span class="sc7">Chart.SeriesTitle</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">strSeriesTitle</span><span class="sc0">
      </span><span class="sc7">Chart.AddXYArray</span><span class="sc0"> </span><span class="sc7">dataPoints</span><span class="sc0">

   </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">Sub</span><span class="sc0">


</span><span class="sc3">Sub</span><span class="sc0"> </span><span class="sc7">Initialize_dicTraceIO</span><span class="sc6">()</span><span class="sc0">
   </span><span class="sc1">' Use this to facilitate a general ByReference argument to the AddTrace subroutine.
</span><span class="sc0">   </span><span class="sc3">Set</span><span class="sc0"> </span><span class="sc7">dicTraceIO</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">Server.CreateObject</span><span class="sc6">(</span><span class="sc4">"Scripting.Dictionary"</span><span class="sc6">)</span><span class="sc0">
   </span><span class="sc7">dicTraceIO.Add</span><span class="sc0"> </span><span class="sc4">"YMax"</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc6">-</span><span class="sc2">999</span><span class="sc0">
   </span><span class="sc7">dicTraceIO.Add</span><span class="sc0"> </span><span class="sc4">"YMin"</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc2">999</span><span class="sc0">
   </span><span class="sc7">dicTraceIO.Add</span><span class="sc0"> </span><span class="sc4">"FoundData"</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc3">False</span><span class="sc0">
   </span><span class="sc7">dicTraceIO.Add</span><span class="sc0"> </span><span class="sc4">"FoundData_ForThisTrace"</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc3">False</span><span class="sc0">
   </span><span class="sc1">'Used for Delta-P calculations.
</span><span class="sc0">   </span><span class="sc7">dicTraceIO.Add</span><span class="sc0"> </span><span class="sc4">"WestSite"</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc4">""</span><span class="sc0">
   </span><span class="sc7">dicTraceIO.Add</span><span class="sc0"> </span><span class="sc4">"EastSite"</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc4">""</span><span class="sc0">
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">Sub</span><span class="sc0">


</span><span class="sc3">Sub</span><span class="sc0"> </span><span class="sc7">FetchTheData</span><span class="sc6">()</span><span class="sc0">
   </span><span class="sc7">Initialize_dicTraceIO</span><span class="sc0">

   </span><span class="sc1">' Set dteStartDate_forLabels and dteStartDateTime for use in queries and chart labels...
</span><span class="sc0">   </span><span class="sc7">dteStartDate_forLabels</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">DateAdd</span><span class="sc6">(</span><span class="sc4">"d"</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc2">1</span><span class="sc0"> </span><span class="sc6">-</span><span class="sc0"> </span><span class="sc7">intDays</span><span class="sc6">),</span><span class="sc0"> </span><span class="sc7">dtePostedDate</span><span class="sc6">)</span><span class="sc0">
   
   </span><span class="sc1">' The following is a somewhat clumsy way to deal with daylight savings time and 
</span><span class="sc0">   </span><span class="sc1">' timezone. Noteworthy here is the way that start and end times are shifted 
</span><span class="sc0">   </span><span class="sc1">' back during periods of daylight savings time. This, coupled with the way that 
</span><span class="sc0">   </span><span class="sc1">' points are plotted using a decimal day value that is calculated relative to 
</span><span class="sc0">   </span><span class="sc1">' the starting point AND using the standard time values that are in the 
</span><span class="sc0">   </span><span class="sc1">' database, has the net effect of shifting the standard to DLS values. It's all 
</span><span class="sc0">   </span><span class="sc1">' a bit confusing. Not completely sure why I originally did it this way. 
</span><span class="sc0">   </span><span class="sc1">' But one advantage is that when aggregating large amounts of data 
</span><span class="sc0">   </span><span class="sc1">' (like in the 25 day plot) each data point does not need to be converted. This 
</span><span class="sc0">   </span><span class="sc1">' is an efficiency that is probably not noticeable on recent computers (2015), 
</span><span class="sc0">   </span><span class="sc1">' but probably was worth considering when I first did this 20-some years ago.
</span><span class="sc0">   
   </span><span class="sc7">dteStartDateTime</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">DateAdd</span><span class="sc6">(</span><span class="sc4">"d"</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc2">1</span><span class="sc0"> </span><span class="sc6">-</span><span class="sc0"> </span><span class="sc7">intDays</span><span class="sc6">),</span><span class="sc0"> </span><span class="sc7">dtePostedDate</span><span class="sc6">)</span><span class="sc0">
   </span><span class="sc7">dteEndDateTime</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">DateAdd</span><span class="sc6">(</span><span class="sc4">"d"</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">dtePostedDate</span><span class="sc6">)</span><span class="sc0">
   </span><span class="sc7">dteNowTime</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">DateAdd</span><span class="sc6">(</span><span class="sc0"> </span><span class="sc4">"h"</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">dicTZ.item</span><span class="sc6">(</span><span class="sc7">strTimeZone</span><span class="sc6">),</span><span class="sc0"> </span><span class="sc7">Now</span><span class="sc6">())</span><span class="sc0">
   </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">blnDayLightSavingsTime</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
      </span><span class="sc7">dteNowTime</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">DateAdd</span><span class="sc6">(</span><span class="sc4">"h"</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc6">-</span><span class="sc2">1</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">dteNowTime</span><span class="sc6">)</span><span class="sc0"> 
      </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">strTimeZone</span><span class="sc0"> </span><span class="sc6">&lt;&gt;</span><span class="sc0"> </span><span class="sc4">"H"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
         </span><span class="sc7">dteStartDateTime</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">DateAdd</span><span class="sc6">(</span><span class="sc4">"h"</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc6">-</span><span class="sc2">1</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">dteStartDateTime</span><span class="sc6">)</span><span class="sc0">   
         </span><span class="sc7">dteEndDateTime</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">DateAdd</span><span class="sc6">(</span><span class="sc4">"h"</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc6">-</span><span class="sc2">1</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">dteEndDateTime</span><span class="sc6">)</span><span class="sc0"> 
      </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
   </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
   
   </span><span class="sc1">' Initialize the start time for the queries. This will later get modified for the 24h
</span><span class="sc0">   </span><span class="sc1">' versions of the 1-day charts.
</span><span class="sc0">   </span><span class="sc7">dteStartDateTime_forQuery</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">dteStartDateTime</span><span class="sc0">

   </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">left</span><span class="sc6">(</span><span class="sc7">strSensorType</span><span class="sc6">,</span><span class="sc2">4</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"Wind"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
      </span><span class="sc7">dataPoints_WindDirection</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">CollectTraceData</span><span class="sc6">(</span><span class="sc4">"WindDirection"</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">vbWhite</span><span class="sc0"> </span><span class="sc6">,</span><span class="sc7">dicTraceIO</span><span class="sc6">)</span><span class="sc0">
      </span><span class="sc7">dataPoints_WindGust</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">CollectTraceData</span><span class="sc6">(</span><span class="sc4">"WindGust"</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">RGB</span><span class="sc6">(</span><span class="sc2">&amp;h00</span><span class="sc6">,</span><span class="sc2">&amp;h80</span><span class="sc6">,</span><span class="sc2">&amp;h80</span><span class="sc6">),</span><span class="sc0"> </span><span class="sc7">dicTraceIO</span><span class="sc6">)</span><span class="sc0">
      </span><span class="sc7">dataPoints_WindSpeed</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">CollectTraceData</span><span class="sc6">(</span><span class="sc4">"WindSpeed"</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">vbRed</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">dicTraceIO</span><span class="sc6">)</span><span class="sc0">

   </span><span class="sc3">ElseIf</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">strSensorType</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"Temperature"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
      </span><span class="sc7">dataPoints_TempAvg</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">CollectTraceData</span><span class="sc6">(</span><span class="sc4">"TempAvg"</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">vbRed</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">dicTraceIO</span><span class="sc6">)</span><span class="sc0">
      </span><span class="sc7">dataPoints_TempMax</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">CollectTraceData</span><span class="sc6">(</span><span class="sc4">"TempMax"</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">vbBlack</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">dicTraceIO</span><span class="sc6">)</span><span class="sc0">
      </span><span class="sc7">dataPoints_TempMin</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">CollectTraceData</span><span class="sc6">(</span><span class="sc4">"TempMin"</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">vbBlack</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">dicTraceIO</span><span class="sc6">)</span><span class="sc0">
      </span><span class="sc7">dataPoints_DewPoint</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">CollectTraceData</span><span class="sc6">(</span><span class="sc4">"DewPoint"</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">RGB</span><span class="sc6">(</span><span class="sc2">&amp;h00</span><span class="sc6">,</span><span class="sc2">&amp;h80</span><span class="sc6">,</span><span class="sc2">&amp;h80</span><span class="sc6">),</span><span class="sc0"> </span><span class="sc7">dicTraceIO</span><span class="sc6">)</span><span class="sc0">

   </span><span class="sc3">ElseIf</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">strSensorType</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"Pressure"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
      </span><span class="sc7">dataPoints_Pressure</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">CollectTraceData</span><span class="sc6">(</span><span class="sc4">"Pressure"</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">vbRed</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">dicTraceIO</span><span class="sc6">)</span><span class="sc0">

   </span><span class="sc3">ElseIf</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">strSensorType</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"DeltaP1"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
      </span><span class="sc7">dicTraceIO</span><span class="sc6">(</span><span class="sc4">"WestSite"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"PORTLAND"</span><span class="sc0">
      </span><span class="sc7">dicTraceIO</span><span class="sc6">(</span><span class="sc4">"EastSite"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"THE DALLES"</span><span class="sc0">
      </span><span class="sc7">dataPoints_DeltaP_trace_A</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">CollectTraceData</span><span class="sc6">(</span><span class="sc4">"DeltaP"</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">RGB</span><span class="sc6">(</span><span class="sc2">&amp;h00</span><span class="sc6">,</span><span class="sc2">&amp;h80</span><span class="sc6">,</span><span class="sc2">&amp;h80</span><span class="sc6">),</span><span class="sc0"> </span><span class="sc7">dicTraceIO</span><span class="sc6">)</span><span class="sc0">
      
      </span><span class="sc7">dicTraceIO</span><span class="sc6">(</span><span class="sc4">"WestSite"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"THE DALLES"</span><span class="sc0">
      </span><span class="sc7">dicTraceIO</span><span class="sc6">(</span><span class="sc4">"EastSite"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"PASCO"</span><span class="sc0">
      </span><span class="sc7">dataPoints_DeltaP_trace_B</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">CollectTraceData</span><span class="sc6">(</span><span class="sc4">"DeltaP"</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">vbRed</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">dicTraceIO</span><span class="sc6">)</span><span class="sc0">

   </span><span class="sc3">ElseIf</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">strSensorType</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"DeltaP2"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
      </span><span class="sc7">dicTraceIO</span><span class="sc6">(</span><span class="sc4">"WestSite"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"KTTD"</span><span class="sc0">
      </span><span class="sc7">dicTraceIO</span><span class="sc6">(</span><span class="sc4">"EastSite"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"KDLS"</span><span class="sc0">
      </span><span class="sc7">dataPoints_DeltaP_trace_A</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">CollectTraceData</span><span class="sc6">(</span><span class="sc4">"DeltaP"</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">RGB</span><span class="sc6">(</span><span class="sc2">&amp;h00</span><span class="sc6">,</span><span class="sc2">&amp;h80</span><span class="sc6">,</span><span class="sc2">&amp;h80</span><span class="sc6">),</span><span class="sc0"> </span><span class="sc7">dicTraceIO</span><span class="sc6">)</span><span class="sc0">
      
      </span><span class="sc7">dicTraceIO</span><span class="sc6">(</span><span class="sc4">"WestSite"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"KDLS"</span><span class="sc0">
      </span><span class="sc7">dicTraceIO</span><span class="sc6">(</span><span class="sc4">"EastSite"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"KHRI"</span><span class="sc0">
      </span><span class="sc7">dataPoints_DeltaP_trace_B</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">CollectTraceData</span><span class="sc6">(</span><span class="sc4">"DeltaP"</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">vbRed</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">dicTraceIO</span><span class="sc6">)</span><span class="sc0">

   </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">Sub</span><span class="sc0">


</span><span class="sc3">Sub</span><span class="sc0"> </span><span class="sc7">PlotTheChart</span><span class="sc6">()</span><span class="sc0">
   </span><span class="sc1">' Set the ContentType
</span><span class="sc0">   </span><span class="sc1">'Response.ContentType = "image/JPEG"
</span><span class="sc0">
   </span><span class="sc1">' Instantiate the Chart component
</span><span class="sc0">   </span><span class="sc3">Set</span><span class="sc0"> </span><span class="sc7">Chart</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">Server.CreateObject</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc4">"ASPChart.Chart"</span><span class="sc6">)</span><span class="sc0">
   </span><span class="sc7">Chart.JPEGQuality</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">90</span><span class="sc0"> </span><span class="sc1">'80
</span><span class="sc0">
   </span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">dblTraceArray</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">intTraceArray_index</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">directAxisScale</span><span class="sc0">
   
   </span><span class="sc1">' Add a separate (pseudo) trace to do the x-axis labeling.  Shift the y
</span><span class="sc0">   </span><span class="sc1">' value by negative 200 so the points don't show on the plot. Also prevent
</span><span class="sc0">   </span><span class="sc1">' it from showing in the legend.
</span><span class="sc0">   </span><span class="sc1">'
</span><span class="sc0">   </span><span class="sc1">' Have tried more direct methods of charting the labels as part of the data
</span><span class="sc0">   </span><span class="sc1">' traces but always ran into problems.  This somewhat indirect (but
</span><span class="sc0">   </span><span class="sc1">' successful) method, offers more control and is general for any numeric
</span><span class="sc0">   </span><span class="sc1">' based x axis.
</span><span class="sc0">
   </span><span class="sc7">Chart.AddSeries</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc2">5</span><span class="sc6">)</span><span class="sc0">
   </span><span class="sc7">Chart.linewidth</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
   </span><span class="sc7">Chart.SeriesTitle</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">" "</span><span class="sc0">
   </span><span class="sc7">Chart.SeriesInLegend</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc3">False</span><span class="sc0">   
   
   </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">intDays</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
      </span><span class="sc7">TimeLabels</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">Array</span><span class="sc6">(</span><span class="sc4">"12m"</span><span class="sc6">,</span><span class="sc4">"1"</span><span class="sc6">,</span><span class="sc4">"2"</span><span class="sc6">,</span><span class="sc4">"3"</span><span class="sc6">,</span><span class="sc4">"4"</span><span class="sc6">,</span><span class="sc4">"5"</span><span class="sc6">,</span><span class="sc4">"6am"</span><span class="sc6">,</span><span class="sc4">"7"</span><span class="sc6">,</span><span class="sc4">"8"</span><span class="sc6">,</span><span class="sc4">"9"</span><span class="sc6">,</span><span class="sc4">"10"</span><span class="sc6">,</span><span class="sc4">"11"</span><span class="sc6">,</span><span class="sc4">"12n"</span><span class="sc6">,</span><span class="sc4">"1"</span><span class="sc6">,</span><span class="sc4">"2"</span><span class="sc6">,</span><span class="sc4">"3"</span><span class="sc6">,</span><span class="sc4">"4"</span><span class="sc6">,</span><span class="sc4">"5"</span><span class="sc6">,</span><span class="sc4">"6pm"</span><span class="sc6">,</span><span class="sc4">"7"</span><span class="sc6">,</span><span class="sc4">"8"</span><span class="sc6">,</span><span class="sc4">"9"</span><span class="sc6">,</span><span class="sc4">"10"</span><span class="sc6">,</span><span class="sc4">"11"</span><span class="sc6">,</span><span class="sc4">"12m"</span><span class="sc6">)</span><span class="sc0">

      </span><span class="sc3">For</span><span class="sc0"> </span><span class="sc7">intHour</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0"> </span><span class="sc3">to</span><span class="sc0"> </span><span class="sc2">24</span><span class="sc0">
         </span><span class="sc1">' The key difference in this dummy trace is that it has a parameter
</span><span class="sc0">         </span><span class="sc1">' for the label.  All the data traces below have an empty string in
</span><span class="sc0">         </span><span class="sc1">' that position.
</span><span class="sc0">
         </span><span class="sc7">MyChartAddXY</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc3">CDbl</span><span class="sc6">(</span><span class="sc7">intHour</span><span class="sc6">)/</span><span class="sc2">24.0</span><span class="sc6">),</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0"> </span><span class="sc6">-</span><span class="sc0"> </span><span class="sc2">200</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">TimeLabels</span><span class="sc6">(</span><span class="sc7">intHour</span><span class="sc6">),</span><span class="sc0"> </span><span class="sc7">vbWhite</span><span class="sc0">   
      </span><span class="sc3">Next</span><span class="sc0">
      
   </span><span class="sc3">Else</span><span class="sc0">      
      </span><span class="sc1">' Make a special label trace (dummy) for multiple-day charts...
</span><span class="sc0">      
      </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">intDays</span><span class="sc0"> </span><span class="sc6">&gt;=</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">AND</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">intDays</span><span class="sc0"> </span><span class="sc6">&lt;=</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
         </span><span class="sc7">intLabelsPerDay</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">4</span><span class="sc0">
      </span><span class="sc3">ElseIf</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">intDays</span><span class="sc0"> </span><span class="sc6">&gt;=</span><span class="sc0"> </span><span class="sc2">5</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">AND</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">intDays</span><span class="sc0"> </span><span class="sc6">&lt;=</span><span class="sc0"> </span><span class="sc2">9</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
         </span><span class="sc7">intLabelsPerDay</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0">
      </span><span class="sc3">ElseIf</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">intDays</span><span class="sc0"> </span><span class="sc6">&gt;=</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">AND</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">intDays</span><span class="sc0"> </span><span class="sc6">&lt;=</span><span class="sc0"> </span><span class="sc2">25</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
         </span><span class="sc7">intLabelsPerDay</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">
      </span><span class="sc3">Else</span><span class="sc0">
         </span><span class="sc1">' Shouldn't be able to get here...
</span><span class="sc0">      </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">      

      </span><span class="sc7">intXLabels</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">intDays</span><span class="sc0"> </span><span class="sc6">*</span><span class="sc0"> </span><span class="sc7">intLabelsPerDay</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">+</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">
      </span><span class="sc1">' Dim the dynamic array...
</span><span class="sc0">      </span><span class="sc3">ReDim</span><span class="sc0"> </span><span class="sc7">strTimeLabels</span><span class="sc6">(</span><span class="sc7">intXLabels</span><span class="sc6">)</span><span class="sc0">
      </span><span class="sc7">dblDaysIncrement</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0"> </span><span class="sc6">/</span><span class="sc0"> </span><span class="sc7">intLabelsPerDay</span><span class="sc0">
         
      </span><span class="sc3">For</span><span class="sc0"> </span><span class="sc7">intJ</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0"> </span><span class="sc3">To</span><span class="sc0"> </span><span class="sc7">intXLabels</span><span class="sc0"> </span><span class="sc6">-</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">
         </span><span class="sc7">dblDaysFraction</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">intJ</span><span class="sc0"> </span><span class="sc6">*</span><span class="sc0"> </span><span class="sc7">dblDaysIncrement</span><span class="sc0">
         
         </span><span class="sc1">' Put a Day label on the integer values (midnight)...
</span><span class="sc0">         </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">dblDaysFraction</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">Int</span><span class="sc6">(</span><span class="sc7">dblDaysFraction</span><span class="sc6">))</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
            </span><span class="sc7">dteLabelDate</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">DateAdd</span><span class="sc6">(</span><span class="sc4">"d"</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">Int</span><span class="sc6">(</span><span class="sc7">dblDaysFraction</span><span class="sc6">),</span><span class="sc0"> </span><span class="sc7">dteStartDate_forLabels</span><span class="sc6">)</span><span class="sc0">
            </span><span class="sc7">strTimeLabels</span><span class="sc6">(</span><span class="sc7">intJ</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">Left</span><span class="sc6">(</span><span class="sc7">WeekDayName</span><span class="sc6">(</span><span class="sc7">WeekDay</span><span class="sc6">(</span><span class="sc7">dteLabelDate</span><span class="sc6">),</span><span class="sc0"> </span><span class="sc3">True</span><span class="sc6">),</span><span class="sc2">2</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">"-"</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">Day</span><span class="sc6">(</span><span class="sc7">dteLabelDate</span><span class="sc6">)</span><span class="sc0">
         </span><span class="sc3">Else</span><span class="sc0">
            </span><span class="sc7">dblFractionalPart</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">dblDaysFraction</span><span class="sc0"> </span><span class="sc6">-</span><span class="sc0"> </span><span class="sc7">Int</span><span class="sc6">(</span><span class="sc7">dblDaysFraction</span><span class="sc6">)</span><span class="sc0">
            </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">dblFractionalPart</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">0.50</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
               </span><span class="sc1">' Suppress the 12n marks for 7 though 9.
</span><span class="sc0">               </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">intDays</span><span class="sc0"> </span><span class="sc6">&lt;=</span><span class="sc0"> </span><span class="sc2">6</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
                  </span><span class="sc7">strTimeLabels</span><span class="sc6">(</span><span class="sc7">intJ</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"12n"</span><span class="sc0">
               </span><span class="sc3">Else</span><span class="sc0">
                  </span><span class="sc7">strTimeLabels</span><span class="sc6">(</span><span class="sc7">intJ</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">""</span><span class="sc0">
               </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
            </span><span class="sc3">Else</span><span class="sc0">
               </span><span class="sc7">strTimeLabels</span><span class="sc6">(</span><span class="sc7">intJ</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">""</span><span class="sc0"> </span><span class="sc1">'CStr(dblDaysFraction)
</span><span class="sc0">            </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">      
         </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
      </span><span class="sc3">Next</span><span class="sc0">

      </span><span class="sc1">' Plot the pseudo trace....         
</span><span class="sc0">      </span><span class="sc3">For</span><span class="sc0"> </span><span class="sc7">intJ</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0"> </span><span class="sc3">To</span><span class="sc0"> </span><span class="sc7">intXLabels</span><span class="sc0"> </span><span class="sc6">-</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">
         </span><span class="sc1">' The key difference in this pseudo trace is that it has a parameter
</span><span class="sc0">         </span><span class="sc1">' for the label. All the data traces below have an empty string in
</span><span class="sc0">         </span><span class="sc1">' that position.
</span><span class="sc0">
         </span><span class="sc7">MyChartAddXY</span><span class="sc0"> </span><span class="sc7">intJ</span><span class="sc0"> </span><span class="sc6">*</span><span class="sc0"> </span><span class="sc7">dblDaysIncrement</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0"> </span><span class="sc6">-</span><span class="sc0"> </span><span class="sc2">200</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">strTimeLabels</span><span class="sc6">(</span><span class="sc7">intJ</span><span class="sc6">),</span><span class="sc0"> </span><span class="sc7">vbWhite</span><span class="sc0">   
      </span><span class="sc3">Next</span><span class="sc0">      

   </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">

   </span><span class="sc1">'===============================================================================
</span><span class="sc0">   </span><span class="sc1">' Add trace(s) depending on the sensor or plot type...
</span><span class="sc0">   </span><span class="sc1">'===============================================================================  
</span><span class="sc0">   
   </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">left</span><span class="sc6">(</span><span class="sc7">strSensorType</span><span class="sc6">,</span><span class="sc2">4</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"Wind"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
   
      </span><span class="sc7">intGray</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">175</span><span class="sc0">
      
      </span><span class="sc1">' Make horizontal lines for the compass points. Do this before adding the
</span><span class="sc0">      </span><span class="sc1">' trace lines so data points will lay on top of this reference lines.
</span><span class="sc0">       
      </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">strSensorType</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"Wind36"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
         </span><span class="sc7">AddHorizontalLine_gray</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">intGray</span><span class="sc6">,</span><span class="sc0">  </span><span class="sc2">45</span><span class="sc0"> </span><span class="sc6">*</span><span class="sc0"> </span><span class="sc7">dblWindNormFactor</span><span class="sc0">
         </span><span class="sc7">AddHorizontalLine_gray</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">intGray</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc2">135</span><span class="sc0"> </span><span class="sc6">*</span><span class="sc0"> </span><span class="sc7">dblWindNormFactor</span><span class="sc0">
         </span><span class="sc7">AddHorizontalLine_gray</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">intGray</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc2">225</span><span class="sc0"> </span><span class="sc6">*</span><span class="sc0"> </span><span class="sc7">dblWindNormFactor</span><span class="sc0">
         </span><span class="sc7">AddHorizontalLine_gray</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">intGray</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc2">315</span><span class="sc0"> </span><span class="sc6">*</span><span class="sc0"> </span><span class="sc7">dblWindNormFactor</span><span class="sc0">
      </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
     
      </span><span class="sc1">' These are common to both Wind40 and Wind36
</span><span class="sc0">      </span><span class="sc7">AddHorizontalLine_gray</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">intGray</span><span class="sc6">,</span><span class="sc0">   </span><span class="sc2">0</span><span class="sc0"> </span><span class="sc6">*</span><span class="sc0"> </span><span class="sc7">dblWindNormFactor</span><span class="sc0">
      </span><span class="sc7">AddHorizontalLine_gray</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">intGray</span><span class="sc6">,</span><span class="sc0">  </span><span class="sc2">90</span><span class="sc0"> </span><span class="sc6">*</span><span class="sc0"> </span><span class="sc7">dblWindNormFactor</span><span class="sc0">
      </span><span class="sc7">AddHorizontalLine_gray</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">intGray</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc2">180</span><span class="sc0"> </span><span class="sc6">*</span><span class="sc0"> </span><span class="sc7">dblWindNormFactor</span><span class="sc0">
      </span><span class="sc7">AddHorizontalLine_gray</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">intGray</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc2">270</span><span class="sc0"> </span><span class="sc6">*</span><span class="sc0"> </span><span class="sc7">dblWindNormFactor</span><span class="sc0">
      </span><span class="sc7">AddHorizontalLine_gray</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">intGray</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc2">360</span><span class="sc0"> </span><span class="sc6">*</span><span class="sc0"> </span><span class="sc7">dblWindNormFactor</span><span class="sc0">
      
      </span><span class="sc7">AddTrace</span><span class="sc0"> </span><span class="sc4">"WindDirection"</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc2">6</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc4">"Direction               "</span><span class="sc6">,</span><span class="sc0">     </span><span class="sc2">3</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">vbWhite</span><span class="sc6">,</span><span class="sc0">             </span><span class="sc7">dicTraceIO</span><span class="sc0">
      </span><span class="sc7">AddTrace</span><span class="sc0"> </span><span class="sc4">"WindGust"</span><span class="sc6">,</span><span class="sc0">      </span><span class="sc2">5</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc4">"Maximum Speed"</span><span class="sc6">,</span><span class="sc0">                </span><span class="sc2">2</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">RGB</span><span class="sc6">(</span><span class="sc2">&amp;h00</span><span class="sc6">,</span><span class="sc2">&amp;h80</span><span class="sc6">,</span><span class="sc2">&amp;h80</span><span class="sc6">),</span><span class="sc0"> </span><span class="sc7">dicTraceIO</span><span class="sc0">     
      </span><span class="sc7">intMaxGust</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">dicTraceIO.Item</span><span class="sc6">(</span><span class="sc4">"YMax"</span><span class="sc6">)</span><span class="sc0">
      </span><span class="sc7">AddTrace</span><span class="sc0"> </span><span class="sc4">"WindSpeed"</span><span class="sc6">,</span><span class="sc0">     </span><span class="sc2">5</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc4">"Average Speed"</span><span class="sc6">,</span><span class="sc0">                </span><span class="sc2">2</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">vbRed</span><span class="sc6">,</span><span class="sc0">               </span><span class="sc7">dicTraceIO</span><span class="sc0">
      
      </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc7">dicTraceIO.Item</span><span class="sc6">(</span><span class="sc4">"FoundData"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
      
         </span><span class="sc1">' To be consistent with the other sensor charts, putting these scale
</span><span class="sc0">         </span><span class="sc1">' limits here, after the trace filling calls above.
</span><span class="sc0">
         </span><span class="sc7">Chart.VertAxisMin</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">0.0</span><span class="sc0">  </span><span class="sc1">'-10
</span><span class="sc0">         </span><span class="sc3">If</span><span class="sc0">     </span><span class="sc6">(</span><span class="sc7">intMaxGust</span><span class="sc0"> </span><span class="sc6">&gt;</span><span class="sc0"> </span><span class="sc2">40</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">then</span><span class="sc0">
            </span><span class="sc7">Chart.VertAxisMax</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc3">CDbl</span><span class="sc6">(</span><span class="sc7">intMaxGust</span><span class="sc6">)</span><span class="sc0">
         </span><span class="sc3">Else</span><span class="sc0">
            </span><span class="sc7">Chart.VertAxisMax</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">40.0</span><span class="sc0">
         </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
               
         </span><span class="sc7">Chart.AddAxisLabel</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc4">"Wind Speed (mph)"</span><span class="sc0">

         </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">intDays</span><span class="sc0"> </span><span class="sc6">&gt;</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">then</span><span class="sc0">
            </span><span class="sc7">Chart.ChartTitleAdd</span><span class="sc0">  </span><span class="sc4">" Wind at "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">strNameForPlot</span><span class="sc0"> 
            </span><span class="sc7">Chart.HorizAxisMin</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">0.00</span><span class="sc0">      
         </span><span class="sc3">Else</span><span class="sc0">
            </span><span class="sc7">Chart.ChartTitleAdd</span><span class="sc0">  </span><span class="sc4">" Wind at "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">strNameForPlot</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">" on "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">WeekDayName</span><span class="sc6">(</span><span class="sc7">WeekDay</span><span class="sc6">(</span><span class="sc7">dtePostedDate</span><span class="sc6">))</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">" "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">dtePostedDate</span><span class="sc0">
            </span><span class="sc7">Chart.HorizAxisMin</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">0.04</span><span class="sc0">      
         </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">

         </span><span class="sc1">' Use tweak of -4 if there is a carriage return after each image element
</span><span class="sc0">         </span><span class="sc1">' in the div.
</span><span class="sc0">         </span><span class="sc7">intPixelRightShift_tweak</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc6">-</span><span class="sc2">4</span><span class="sc0">
         </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">intDays</span><span class="sc0"> </span><span class="sc6">&gt;=</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
            </span><span class="sc7">Chart.Width</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">1250</span><span class="sc0"> </span><span class="sc6">+</span><span class="sc0"> </span><span class="sc2">61</span><span class="sc0">  </span><span class="sc1">' The 61 helps to get the days to line up with the temperature chart.
</span><span class="sc0">            </span><span class="sc7">intPixelRightShift</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc6">-</span><span class="sc2">210</span><span class="sc0"> </span><span class="sc6">+</span><span class="sc0"> </span><span class="sc7">intPixelRightShift_tweak</span><span class="sc0"> </span><span class="sc6">-</span><span class="sc0"> </span><span class="sc2">3</span><span class="sc0">  </span><span class="sc1">' The -3 is a secondary tweak needed after I added the 61 in the line above.
</span><span class="sc0">         </span><span class="sc3">Else</span><span class="sc0">
            </span><span class="sc7">Chart.Width</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">855</span><span class="sc0">
            </span><span class="sc7">intPixelRightShift</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc6">-</span><span class="sc2">188</span><span class="sc0"> </span><span class="sc6">+</span><span class="sc0"> </span><span class="sc7">intPixelRightShift_tweak</span><span class="sc0">
         </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">

         </span><span class="sc1">' Set the chart height based on the y-axis maximum value.  Scale up the
</span><span class="sc0">         </span><span class="sc1">' plotting area by the ratio of intMaxGust/40.
</span><span class="sc0">
         </span><span class="sc7">intNonPlottingHeight</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0">  </span><span class="sc2">75</span><span class="sc0"> 
         </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">intMaxGust</span><span class="sc0"> </span><span class="sc6">&gt;</span><span class="sc0"> </span><span class="sc2">40</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">then</span><span class="sc0">    
            </span><span class="sc7">Chart.Height</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc6">((</span><span class="sc2">500</span><span class="sc0"> </span><span class="sc6">-</span><span class="sc0"> </span><span class="sc7">intNonPlottingHeight</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">*</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">intMaxGust</span><span class="sc6">/</span><span class="sc2">40</span><span class="sc6">))</span><span class="sc0"> </span><span class="sc6">+</span><span class="sc0"> </span><span class="sc7">intNonPlottingHeight</span><span class="sc0">
            </span><span class="sc1">' This gets used in the style-sheet the positions the directions-overlay image.
</span><span class="sc0">            </span><span class="sc7">intPixelBottomShift</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">Fix</span><span class="sc6">((</span><span class="sc7">intMaxGust</span><span class="sc0"> </span><span class="sc6">*</span><span class="sc0"> </span><span class="sc2">0.320</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">-</span><span class="sc0"> </span><span class="sc2">11</span><span class="sc6">)</span><span class="sc0">  </span><span class="sc1">'This is always positive.
</span><span class="sc0">            
         </span><span class="sc3">Else</span><span class="sc0">
            </span><span class="sc7">Chart.Height</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">500</span><span class="sc0">
            </span><span class="sc7">intPixelBottomShift</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
         </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
         
         </span><span class="sc7">Chart.LeftAxisIncrement</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">5</span><span class="sc0">
      
      </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">

   </span><span class="sc3">ElseIf</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">strSensorType</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"Temperature"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
         
      </span><span class="sc1">' Do this one first. This one should return data for any type
</span><span class="sc0">      </span><span class="sc1">' of temperature plot. If not, don't try the other parts.
</span><span class="sc0">      </span><span class="sc7">AddTrace</span><span class="sc0"> </span><span class="sc4">"TempAvg"</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc2">5</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc4">"Dry Bulb"</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">vbRed</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">dicTraceIO</span><span class="sc0">  

      </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc7">dicTraceIO.Item</span><span class="sc6">(</span><span class="sc4">"FoundData"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
         
         </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc7">IsArray</span><span class="sc6">(</span><span class="sc7">dataPoints_TempMin</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
            </span><span class="sc7">AddTrace</span><span class="sc0"> </span><span class="sc4">"TempMin"</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc2">5</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc4">"  Min"</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">vbBlack</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">dicTraceIO</span><span class="sc0">
            </span><span class="sc7">AddTrace</span><span class="sc0"> </span><span class="sc4">"TempMax"</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc2">5</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc4">"  Max"</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">vbBlack</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">dicTraceIO</span><span class="sc0">
         </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
         
         </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc7">IsArray</span><span class="sc6">(</span><span class="sc7">dataPoints_DewPoint</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
            </span><span class="sc7">AddTrace</span><span class="sc0"> </span><span class="sc4">"DewPoint"</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc2">5</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc4">"Dew Point"</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">RGB</span><span class="sc6">(</span><span class="sc2">&amp;h00</span><span class="sc6">,</span><span class="sc2">&amp;h80</span><span class="sc6">,</span><span class="sc2">&amp;h80</span><span class="sc6">),</span><span class="sc0"> </span><span class="sc7">dicTraceIO</span><span class="sc0">
         </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
      
         </span><span class="sc1">' Ongoing (overall) Min and Max values are collected in dicTraceIO as each trace
</span><span class="sc0">         </span><span class="sc1">' generated.
</span><span class="sc0">         </span><span class="sc7">sglTempMin</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">dicTraceIO</span><span class="sc6">(</span><span class="sc4">"YMin"</span><span class="sc6">)</span><span class="sc0">
         </span><span class="sc7">sglTempMax</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">dicTraceIO</span><span class="sc6">(</span><span class="sc4">"YMax"</span><span class="sc6">)</span><span class="sc0">
         </span><span class="sc7">sglTempRange</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">sglTempMax</span><span class="sc0"> </span><span class="sc6">-</span><span class="sc0"> </span><span class="sc7">sglTempMin</span><span class="sc0">
         
         </span><span class="sc1">' To be consistent with the other sensor charts, putting these scale
</span><span class="sc0">         </span><span class="sc1">' limits here, after the trace filling loop above. But seems to work
</span><span class="sc0">         </span><span class="sc1">' either way here...
</span><span class="sc0">
         </span><span class="sc7">intTempDiffScalingThreshold</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">40</span><span class="sc0">
         </span><span class="sc7">intNonPlottingHeight</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">108</span><span class="sc0">
         </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">sglTempRange</span><span class="sc0"> </span><span class="sc6">&lt;</span><span class="sc0"> </span><span class="sc7">intTempDiffScalingThreshold</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">then</span><span class="sc0">
            </span><span class="sc7">Chart.VertAxisMin</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">sglTempMin</span><span class="sc0"> </span><span class="sc6">-</span><span class="sc0"> </span><span class="sc6">((</span><span class="sc7">intTempDiffScalingThreshold</span><span class="sc0"> </span><span class="sc6">-</span><span class="sc0"> </span><span class="sc7">sglTempRange</span><span class="sc6">)/</span><span class="sc2">2</span><span class="sc6">)</span><span class="sc0">
            </span><span class="sc7">Chart.VertAxisMax</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">sglTempMax</span><span class="sc0"> </span><span class="sc6">+</span><span class="sc0"> </span><span class="sc6">((</span><span class="sc7">intTempDiffScalingThreshold</span><span class="sc0"> </span><span class="sc6">-</span><span class="sc0"> </span><span class="sc7">sglTempRange</span><span class="sc6">)/</span><span class="sc2">2</span><span class="sc6">)</span><span class="sc0">
            </span><span class="sc7">Chart.Height</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">500</span><span class="sc0">
         </span><span class="sc3">Else</span><span class="sc0">
            </span><span class="sc1">' The 0.2 keeps the max and min data from being obscured by the outer
</span><span class="sc0">            </span><span class="sc1">' boundaries of the charting area.
</span><span class="sc0">            </span><span class="sc7">Chart.VertAxisMin</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">sglTempMin</span><span class="sc0"> </span><span class="sc6">-</span><span class="sc0"> </span><span class="sc2">0.2</span><span class="sc0">     
            </span><span class="sc7">Chart.VertAxisMax</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">sglTempMax</span><span class="sc0"> </span><span class="sc6">+</span><span class="sc0"> </span><span class="sc2">0.2</span><span class="sc0">
            </span><span class="sc7">Chart.Height</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc6">((</span><span class="sc2">500</span><span class="sc0"> </span><span class="sc6">-</span><span class="sc0"> </span><span class="sc7">intNonPlottingHeight</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">*</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">sglTempRange</span><span class="sc6">/</span><span class="sc7">intTempDiffScalingThreshold</span><span class="sc6">))</span><span class="sc0"> </span><span class="sc6">+</span><span class="sc0"> </span><span class="sc7">intNonPlottingHeight</span><span class="sc0">    
         </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">

         </span><span class="sc7">Chart.LeftAxisIncrement</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">5</span><span class="sc0">
         
         
         </span><span class="sc1">' Y axis label
</span><span class="sc0">         </span><span class="sc7">Chart.AddAxisLabel</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc4">"Temperature (F)"</span><span class="sc0">
             
         </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">intDays</span><span class="sc0"> </span><span class="sc6">&gt;</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
            </span><span class="sc7">Chart.ChartTitleAdd</span><span class="sc0">  </span><span class="sc4">" Temperature at "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">strNameForPlot</span><span class="sc0">
         </span><span class="sc3">Else</span><span class="sc0">
            </span><span class="sc7">Chart.ChartTitleAdd</span><span class="sc0">  </span><span class="sc4">" Temperature at "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">strNameForPlot</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">" on "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">WeekDayName</span><span class="sc6">(</span><span class="sc7">WeekDay</span><span class="sc6">(</span><span class="sc7">dtePostedDate</span><span class="sc6">))</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">" "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">dtePostedDate</span><span class="sc0">
         </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">    

         </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">intDays</span><span class="sc0"> </span><span class="sc6">&gt;=</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
            </span><span class="sc7">Chart.Width</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">1250</span><span class="sc0">
         </span><span class="sc3">Else</span><span class="sc0">
            </span><span class="sc7">Chart.Width</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">791</span><span class="sc0">  </span><span class="sc1">'780            
</span><span class="sc0">         </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">

      </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
      
   </span><span class="sc3">ElseIf</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">strSensorType</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"Pressure"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">

      </span><span class="sc7">AddTrace</span><span class="sc0"> </span><span class="sc4">"Pressure"</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc2">5</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc4">"no trace label"</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">vbRed</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">dicTraceIO</span><span class="sc0">
      
      </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc7">dicTraceIO.Item</span><span class="sc6">(</span><span class="sc4">"FoundData"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
      
         </span><span class="sc7">Chart.SeriesInLegend</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc3">False</span><span class="sc0">
         </span><span class="sc7">sglPressureMin</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">dicTraceIO.Item</span><span class="sc6">(</span><span class="sc4">"YMin"</span><span class="sc6">)</span><span class="sc0">
         </span><span class="sc7">sglPressureMax</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">dicTraceIO.Item</span><span class="sc6">(</span><span class="sc4">"YMax"</span><span class="sc6">)</span><span class="sc0">
         
         </span><span class="sc7">Chart.AddAxisLabel</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc4">"Pressure (Inches Hg)"</span><span class="sc0">
                  
         </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">intDays</span><span class="sc0"> </span><span class="sc6">&gt;</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">then</span><span class="sc0">
            </span><span class="sc7">Chart.ChartTitleAdd</span><span class="sc0">  </span><span class="sc4">" Barometer at "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">strNameForPlot</span><span class="sc0">
         </span><span class="sc3">Else</span><span class="sc0">
            </span><span class="sc7">Chart.ChartTitleAdd</span><span class="sc0">  </span><span class="sc4">" Barometer at "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">strNameForPlot</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">" on "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">WeekDayName</span><span class="sc6">(</span><span class="sc7">WeekDay</span><span class="sc6">(</span><span class="sc7">dtePostedDate</span><span class="sc6">))</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">" "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">dtePostedDate</span><span class="sc0">
         </span><span class="sc3">end</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">    
      
         </span><span class="sc1">' Note: these axis limits only work if they come after
</span><span class="sc0">         </span><span class="sc1">' the chart filling loop above...
</span><span class="sc0">
         </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">sglPressureMin</span><span class="sc0"> </span><span class="sc6">&lt;</span><span class="sc0"> </span><span class="sc2">29.42</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">then</span><span class="sc0"> 
            </span><span class="sc7">Chart.VertAxisMin</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">sglPressureMin</span><span class="sc0"> </span><span class="sc6">-</span><span class="sc0"> </span><span class="sc2">0.005</span><span class="sc0">
         </span><span class="sc3">Else</span><span class="sc0">
            </span><span class="sc7">Chart.VertAxisMin</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">29.41</span><span class="sc0">
         </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">    
         
         </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">sglPressureMax</span><span class="sc0"> </span><span class="sc6">&gt;</span><span class="sc0"> </span><span class="sc2">30.42</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">then</span><span class="sc0"> 
            </span><span class="sc7">Chart.VertAxisMax</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">sglPressureMax</span><span class="sc0"> </span><span class="sc6">+</span><span class="sc0"> </span><span class="sc2">0.005</span><span class="sc0">
         </span><span class="sc3">Else</span><span class="sc0">
            </span><span class="sc7">Chart.VertAxisMax</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">30.43</span><span class="sc0">
         </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">        
            
         </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">sglPressureMin</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">then</span><span class="sc0">
            </span><span class="sc7">Chart.VertAxisMin</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc6">-</span><span class="sc2">0.5</span><span class="sc0">
            </span><span class="sc7">Chart.VertAxisMax</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0">  </span><span class="sc2">0.5</span><span class="sc0">   
         </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
         
         </span><span class="sc7">Chart.LeftAxisIncrement</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">0.1</span><span class="sc0">
         
         </span><span class="sc1">'Chart.AddAxisLabel 1, "Pressure (Inches Hg)"
</span><span class="sc0">         
         </span><span class="sc7">Chart.Height</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">500</span><span class="sc0">
         </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">intDays</span><span class="sc0"> </span><span class="sc6">&gt;=</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
            </span><span class="sc7">Chart.Width</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">1128</span><span class="sc0">
         </span><span class="sc3">Else</span><span class="sc0">
            </span><span class="sc7">Chart.Width</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">685</span><span class="sc0">
         </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">

      </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
  
   </span><span class="sc3">ElseIf</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">Left</span><span class="sc6">(</span><span class="sc7">strSensorType</span><span class="sc6">,</span><span class="sc2">6</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"DeltaP"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
      
      </span><span class="sc1">' Add some horizontal lines
</span><span class="sc0">      </span><span class="sc7">Chart.AddSeries</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc2">5</span><span class="sc6">)</span><span class="sc0">
      </span><span class="sc7">Chart.linewidth</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0">
      </span><span class="sc7">Chart.SeriesInLegend</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc3">False</span><span class="sc0">
      </span><span class="sc7">MyChartAddXY</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc4">""</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">vbBlack</span><span class="sc0">   
      </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">Request.QueryString</span><span class="sc6">(</span><span class="sc4">"specName"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">""</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
         </span><span class="sc7">MyChartAddXY</span><span class="sc0"> </span><span class="sc7">intDays</span><span class="sc6">+</span><span class="sc2">1</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc4">""</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">vbWhite</span><span class="sc0">
      </span><span class="sc3">Else</span><span class="sc0">
         </span><span class="sc1">' Gray line (if request is for the 50Webs example chart page).
</span><span class="sc0">         </span><span class="sc7">MyChartAddXY</span><span class="sc0"> </span><span class="sc7">intDays</span><span class="sc6">+</span><span class="sc2">1</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc4">""</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">RGB</span><span class="sc6">(</span><span class="sc2">&amp;hB5</span><span class="sc6">,</span><span class="sc2">&amp;hB5</span><span class="sc6">,</span><span class="sc2">&amp;hB5</span><span class="sc6">)</span><span class="sc0">     
      </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
      
      </span><span class="sc1">' Add the delta-P traces.
</span><span class="sc0">      
      </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">strSensorType</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"DeltaP1"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
               
         </span><span class="sc7">dicTraceIO</span><span class="sc6">(</span><span class="sc4">"WestSite"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"PORTLAND"</span><span class="sc0">
         </span><span class="sc7">dicTraceIO</span><span class="sc6">(</span><span class="sc4">"EastSite"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"THE DALLES"</span><span class="sc0">
         </span><span class="sc7">AddTrace</span><span class="sc0"> </span><span class="sc4">"DeltaP_trace_A"</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc2">5</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc4">"Portland - The Dalles "</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">RGB</span><span class="sc6">(</span><span class="sc2">&amp;h00</span><span class="sc6">,</span><span class="sc2">&amp;h80</span><span class="sc6">,</span><span class="sc2">&amp;h80</span><span class="sc6">),</span><span class="sc0"> </span><span class="sc7">dicTraceIO</span><span class="sc0">
         
         </span><span class="sc7">dicTraceIO</span><span class="sc6">(</span><span class="sc4">"WestSite"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"THE DALLES"</span><span class="sc0">
         </span><span class="sc7">dicTraceIO</span><span class="sc6">(</span><span class="sc4">"EastSite"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"PASCO"</span><span class="sc0">
         </span><span class="sc7">AddTrace</span><span class="sc0"> </span><span class="sc4">"DeltaP_trace_B"</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc2">5</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc4">"The Dalles - Pasco"</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">vbRed</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">dicTraceIO</span><span class="sc0">
         
         </span><span class="sc1">'"NORTH BEND", "PASCO"
</span><span class="sc0">               
      </span><span class="sc3">ElseIf</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">strSensorType</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"DeltaP2"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
         
         </span><span class="sc7">dicTraceIO</span><span class="sc6">(</span><span class="sc4">"WestSite"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"KTTD"</span><span class="sc0">
         </span><span class="sc7">dicTraceIO</span><span class="sc6">(</span><span class="sc4">"EastSite"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"KDLS"</span><span class="sc0">
         </span><span class="sc7">AddTrace</span><span class="sc0"> </span><span class="sc4">"DeltaP_trace_A"</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc2">5</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc4">"Troutdale - The Dalles"</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">RGB</span><span class="sc6">(</span><span class="sc2">&amp;h00</span><span class="sc6">,</span><span class="sc2">&amp;h80</span><span class="sc6">,</span><span class="sc2">&amp;h80</span><span class="sc6">),</span><span class="sc0"> </span><span class="sc7">dicTraceIO</span><span class="sc0">
         
         </span><span class="sc7">dicTraceIO</span><span class="sc6">(</span><span class="sc4">"WestSite"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"KDLS"</span><span class="sc0">
         </span><span class="sc7">dicTraceIO</span><span class="sc6">(</span><span class="sc4">"EastSite"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"KHRI"</span><span class="sc0">
         </span><span class="sc7">AddTrace</span><span class="sc0"> </span><span class="sc4">"DeltaP_trace_B"</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc2">5</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc4">"The Dalles - Hermiston"</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">vbRed</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">dicTraceIO</span><span class="sc0">
         
         </span><span class="sc1">' dicTraceIO("WestSite") = "KTTD"
</span><span class="sc0">         </span><span class="sc1">' dicTraceIO("EastSite") = "KHRI"
</span><span class="sc0">         </span><span class="sc1">' AddTrace "DeltaP_trace_B", 5, "Troutdale - Hermiston", 2, vbBlue, dicTraceIO
</span><span class="sc0">
      </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
      
      </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc7">dicTraceIO.Item</span><span class="sc6">(</span><span class="sc4">"FoundData"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
         </span><span class="sc1">' Force limits on the Y axis for the Delta-P chart.
</span><span class="sc0">         </span><span class="sc7">dblDPmin</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">dicTraceIO</span><span class="sc6">(</span><span class="sc4">"YMin"</span><span class="sc6">)</span><span class="sc0">
         </span><span class="sc7">dblDPmax</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">dicTraceIO</span><span class="sc6">(</span><span class="sc4">"YMax"</span><span class="sc6">)</span><span class="sc0">
         
         </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">dblDPmin</span><span class="sc0"> </span><span class="sc6">&lt;</span><span class="sc0"> </span><span class="sc6">-</span><span class="sc2">0.08</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
            </span><span class="sc7">Chart.VertAxisMin</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">dblDPmin</span><span class="sc0"> </span><span class="sc6">-</span><span class="sc0"> </span><span class="sc2">.001</span><span class="sc0">
         </span><span class="sc3">Else</span><span class="sc0">
            </span><span class="sc7">Chart.VertAxisMin</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc6">-</span><span class="sc2">0.08</span><span class="sc0">
         </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
         
         </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">dblDPmax</span><span class="sc0"> </span><span class="sc6">&gt;</span><span class="sc0"> </span><span class="sc2">0.18</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
            </span><span class="sc7">Chart.VertAxisMax</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">dblDPmax</span><span class="sc0"> </span><span class="sc6">+</span><span class="sc0"> </span><span class="sc2">0.001</span><span class="sc0">
         </span><span class="sc3">Else</span><span class="sc0">
            </span><span class="sc7">Chart.VertAxisMax</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">0.18</span><span class="sc0">
         </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
           
           
         </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">intDays</span><span class="sc0"> </span><span class="sc6">&gt;</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
            </span><span class="sc7">Chart.ChartTitleAdd</span><span class="sc0">  </span><span class="sc4">"Delta-P"</span><span class="sc0">
         </span><span class="sc3">Else</span><span class="sc0">
            </span><span class="sc7">Chart.ChartTitleAdd</span><span class="sc0">  </span><span class="sc4">"Delta-P on "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">WeekDayName</span><span class="sc6">(</span><span class="sc7">WeekDay</span><span class="sc6">(</span><span class="sc7">dtePostedDate</span><span class="sc6">))</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">" "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">dtePostedDate</span><span class="sc0">
         </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">    
         
         </span><span class="sc7">Chart.LeftAxisIncrement</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">0.05</span><span class="sc0">
         
         </span><span class="sc7">Chart.AddAxisLabel</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc4">"Pressure Differential (Inches Hg)"</span><span class="sc0">
         
         </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">intDays</span><span class="sc0"> </span><span class="sc6">&gt;=</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
            </span><span class="sc7">Chart.Width</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">1270</span><span class="sc0">
         </span><span class="sc3">Else</span><span class="sc0">
            </span><span class="sc7">Chart.Width</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">875</span><span class="sc0">
         </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
         
         </span><span class="sc1">' Scale the height of the image if the y range is larger than the default of 0.26.
</span><span class="sc0">         </span><span class="sc7">intNonPlottingHeight</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">90</span><span class="sc0">
         </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">((</span><span class="sc7">Chart.VertAxisMax</span><span class="sc0"> </span><span class="sc6">-</span><span class="sc0"> </span><span class="sc7">Chart.VertAxisMin</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">&gt;</span><span class="sc0"> </span><span class="sc2">0.26</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">    
            </span><span class="sc7">Chart.Height</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc6">((</span><span class="sc2">510</span><span class="sc0"> </span><span class="sc6">-</span><span class="sc0"> </span><span class="sc7">intNonPlottingHeight</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">*</span><span class="sc0"> </span><span class="sc6">((</span><span class="sc7">Chart.VertAxisMax</span><span class="sc0"> </span><span class="sc6">-</span><span class="sc0"> </span><span class="sc7">Chart.VertAxisMin</span><span class="sc6">)/</span><span class="sc2">0.26</span><span class="sc6">))</span><span class="sc0"> </span><span class="sc6">+</span><span class="sc0"> </span><span class="sc7">intNonPlottingHeight</span><span class="sc0">
         </span><span class="sc3">Else</span><span class="sc0">
            </span><span class="sc7">Chart.Height</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">510</span><span class="sc0">
         </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">         
         
      </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
   
   </span><span class="sc3">Else</span><span class="sc0">
      </span><span class="sc1">' Shouldn't ever get here...
</span><span class="sc0">      </span><span class="sc7">RBC</span><span class="sc0"> </span><span class="sc4">"No data or no match found for the specified sensor type."</span><span class="sc0"> 
   </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0"> 

   </span><span class="sc1">'=============================================================================
</span><span class="sc0">   </span><span class="sc1">' Control chart axes and labeling...
</span><span class="sc0">   </span><span class="sc1">' (This is done for every type of plot)
</span><span class="sc0">   </span><span class="sc1">'=============================================================================
</span><span class="sc0">
   </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc7">dicTraceIO.Item</span><span class="sc6">(</span><span class="sc4">"FoundData"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
      
      </span><span class="sc1">' Plot the LatestRecord and the NOW lines.
</span><span class="sc0">      </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">((</span><span class="sc7">intDays</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">and</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">str24Hrs_state</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"checked"</span><span class="sc6">))</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
         </span><span class="sc7">AddVerticalLine</span><span class="sc0"> </span><span class="sc7">DaysDec</span><span class="sc6">(</span><span class="sc0"> </span><span class="sc7">strMRTime</span><span class="sc6">),</span><span class="sc0">  </span><span class="sc2">1</span><span class="sc0">
         </span><span class="sc7">AddVerticalLine</span><span class="sc0"> </span><span class="sc7">DaysDec</span><span class="sc6">(</span><span class="sc0"> </span><span class="sc7">dteNowTime</span><span class="sc6">),</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">
      </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
        
      </span><span class="sc7">Chart.HorizAxisMax</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">intDays</span><span class="sc0">
      </span><span class="sc7">Chart.ShowMinorTicks</span><span class="sc0"> </span><span class="sc3">false</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc3">false</span><span class="sc0">  
        
      </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">intDays</span><span class="sc0"> </span><span class="sc6">&gt;</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">then</span><span class="sc0">
         </span><span class="sc1">' Set Horizontal Axis Label Style to: Axis Scales (2)
</span><span class="sc0">         </span><span class="sc7">Chart.HLabelStyle</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
                  
         </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">blnDayLightSavingsTime</span><span class="sc0"> </span><span class="sc3">And</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">strTimeZone</span><span class="sc0"> </span><span class="sc6">&lt;&gt;</span><span class="sc0"> </span><span class="sc4">"H"</span><span class="sc6">))</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
            </span><span class="sc7">Chart.AddAxisLabel</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc4">"Days Starting with "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">WeekDayName</span><span class="sc6">(</span><span class="sc7">WeekDay</span><span class="sc6">(</span><span class="sc7">dteStartDate_forLabels</span><span class="sc6">))</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">" "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">FormatDateTime</span><span class="sc6">(</span><span class="sc7">dteStartDate_forLabels</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">vbShortDate</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">" ("</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">strTimeZone</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">"DT)"</span><span class="sc0">
         </span><span class="sc3">Else</span><span class="sc0">
            </span><span class="sc7">Chart.AddAxisLabel</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc4">"Days Starting with "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">WeekDayName</span><span class="sc6">(</span><span class="sc7">WeekDay</span><span class="sc6">(</span><span class="sc7">dteStartDate_forLabels</span><span class="sc6">))</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">" "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">FormatDateTime</span><span class="sc6">(</span><span class="sc7">dteStartDate_forLabels</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">vbShortDate</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">" ("</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">strTimeZone</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">"ST)"</span><span class="sc0">
         </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
         </span><span class="sc7">Chart.HorizAxisMin</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">0.0</span><span class="sc0">     
      </span><span class="sc3">Else</span><span class="sc0">
         </span><span class="sc1">' Set Horizontal Axis Label Style to: Automatic (0)      
</span><span class="sc0">         </span><span class="sc7">Chart.HLabelStyle</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
             
         </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">blnDayLightSavingsTime</span><span class="sc0"> </span><span class="sc3">And</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">strTimeZone</span><span class="sc0"> </span><span class="sc6">&lt;&gt;</span><span class="sc0"> </span><span class="sc4">"H"</span><span class="sc6">))</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
            </span><span class="sc7">Chart.AddAxisLabel</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc4">"Hour of the Day ("</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">strTimeZone</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">"DT)"</span><span class="sc0">
         </span><span class="sc3">Else</span><span class="sc0">
            </span><span class="sc7">Chart.AddAxisLabel</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc4">"Hour of the Day ("</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">strTimeZone</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">"ST)"</span><span class="sc0">
         </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
         
         </span><span class="sc1">' Make a little more room on the y axis for the last point from yesterday. The
</span><span class="sc0">         </span><span class="sc1">' square boxes (markers) for the direction trace enforce a little more room on 
</span><span class="sc0">         </span><span class="sc1">' their own, so the non-wind plots require a little more wiggle room on each 
</span><span class="sc0">         </span><span class="sc1">' end of the x-axis.
</span><span class="sc0">         </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">left</span><span class="sc6">(</span><span class="sc7">strSensorType</span><span class="sc6">,</span><span class="sc2">4</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"Wind"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
            </span><span class="sc7">Chart.HorizAxisMin</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc6">-</span><span class="sc2">0.001</span><span class="sc0">
            </span><span class="sc7">Chart.HorizAxisMax</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">intDays</span><span class="sc0"> </span><span class="sc6">+</span><span class="sc0"> </span><span class="sc2">0.001</span><span class="sc0">
         </span><span class="sc3">Else</span><span class="sc0">
            </span><span class="sc1">'Chart.HorizAxisMin = 0.00
</span><span class="sc0">            </span><span class="sc7">Chart.HorizAxisMin</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc6">-</span><span class="sc2">0.003</span><span class="sc0">  
            </span><span class="sc7">Chart.HorizAxisMax</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">intDays</span><span class="sc0"> </span><span class="sc6">+</span><span class="sc0"> </span><span class="sc2">0.003</span><span class="sc0">            
         </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
      </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">

      </span><span class="sc7">Chart.ChartTitleFont.Size</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">16</span><span class="sc0">
      </span><span class="sc7">Chart.ChartTitleFont.Name</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"Arial"</span><span class="sc0">    
      </span><span class="sc1">'Chart.ChartTitleFontColor = vbBlue
</span><span class="sc0">      </span><span class="sc7">Chart.ChartTitleFontColor</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">RGB</span><span class="sc6">(</span><span class="sc2">&amp;h00</span><span class="sc6">,</span><span class="sc2">&amp;h80</span><span class="sc6">,</span><span class="sc2">&amp;h80</span><span class="sc6">)</span><span class="sc0">    
      </span><span class="sc7">Chart.LegendFont.Size</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc0">
      </span><span class="sc7">Chart.AxisLabelFontBottom.Size</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc0">
      </span><span class="sc7">Chart.AxisLabelFontLeft.Size</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc0">
        
      </span><span class="sc7">Chart.BevelOuter</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc3">false</span><span class="sc0">
      
      </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">Request.QueryString</span><span class="sc6">(</span><span class="sc4">"specName"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">&lt;&gt;</span><span class="sc0"> </span><span class="sc4">""</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
         </span><span class="sc7">Chart.GradientVisible</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc3">false</span><span class="sc0">
      </span><span class="sc3">Else</span><span class="sc0">
         </span><span class="sc7">Chart.GradientVisible</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc3">true</span><span class="sc0">
      </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
      </span><span class="sc7">Chart.GradientStartColor</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">RGB</span><span class="sc6">(</span><span class="sc2">&amp;hff</span><span class="sc6">,</span><span class="sc2">&amp;hcc</span><span class="sc6">,</span><span class="sc2">&amp;h99</span><span class="sc6">)</span><span class="sc0">
      </span><span class="sc7">Chart.GradientEndColor</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">vbWhite</span><span class="sc0">
      
      </span><span class="sc7">Chart.PanelColor</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">vbWhite</span><span class="sc0">
      </span><span class="sc7">Chart.View3D</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc3">false</span><span class="sc0">
      </span><span class="sc7">Chart.LegendVisible</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc3">true</span><span class="sc0">
      </span><span class="sc7">Chart.LegendStyle</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">

      </span><span class="sc1">' Set the filename, save the image and write the image tag.
</span><span class="sc0">        
      </span><span class="sc1">' Do this with sessionID and random name generated via the
</span><span class="sc0">      </span><span class="sc1">' FileSystemObject. First make a string with a random name in it. Use
</span><span class="sc0">      </span><span class="sc1">' split here to get rid of the txt extension that normally is returned.
</span><span class="sc0">
      </span><span class="sc7">strRandomNameString</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">Split</span><span class="sc6">(</span><span class="sc7">Server.CreateObject</span><span class="sc6">(</span><span class="sc4">"Scripting.FileSystemObject"</span><span class="sc6">).</span><span class="sc7">GetTempName</span><span class="sc6">,</span><span class="sc4">"."</span><span class="sc6">)(</span><span class="sc2">0</span><span class="sc6">)</span><span class="sc0">
      </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">Request.QueryString</span><span class="sc6">(</span><span class="sc4">"specName"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">&lt;&gt;</span><span class="sc0"> </span><span class="sc4">""</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
         </span><span class="sc7">strFileName2</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">Request.QueryString</span><span class="sc6">(</span><span class="sc4">"specName"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">".jpg"</span><span class="sc0">
      </span><span class="sc3">Else</span><span class="sc0">
         </span><span class="sc7">strFileName2</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"S"</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">"_"</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">Session.SessionID</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">"_"</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">strRandomNameString</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">".jpg"</span><span class="sc0"> 
      </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">

      </span><span class="sc1">'Response.Write "filename = " &amp; strPathToImageDir &amp; strFileName2
</span><span class="sc0">        
      </span><span class="sc7">Chart.FileName</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">strPathToImageDir</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">strFileName2</span><span class="sc0">
      </span><span class="sc7">Chart.SaveChart</span><span class="sc0">
      </span><span class="sc3">Set</span><span class="sc0"> </span><span class="sc7">Chart</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc3">nothing</span><span class="sc0">  
     
      </span><span class="sc1">' Put these two images into a DIV element that doesn't wrap! Then
</span><span class="sc0">      </span><span class="sc1">' position the directions overlay relative to the original chart image.
</span><span class="sc0">
      </span><span class="sc7">RC</span><span class="sc0"> </span><span class="sc4">"&lt;div style='white-space:nowrap;'&gt;"</span><span class="sc0">
      </span><span class="sc7">RC</span><span class="sc0"> </span><span class="sc4">"&lt;img id='chartimage' style='visibility:hidden' src='"</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">strURLPathToImageDir</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">strFileName2</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">"'&gt;"</span><span class="sc0">
      
      </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">Left</span><span class="sc6">(</span><span class="sc7">strSensorType</span><span class="sc6">,</span><span class="sc2">4</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"Wind"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
         </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">strSensorType</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"Wind40"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
            </span><span class="sc7">directAxisScale</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"'pictures/directions_40.gif'"</span><span class="sc0">
         </span><span class="sc3">ElseIf</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">strSensorType</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"Wind36"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
            </span><span class="sc7">directAxisScale</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"'pictures/directions_36.gif'"</span><span class="sc0">
         </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
         </span><span class="sc7">RC</span><span class="sc0"> </span><span class="sc4">"&lt;img id='directions' src="</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">directAxisScale</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">_</span><span class="sc0">
            </span><span class="sc4">"style='visibility:hidden; position:relative; left:"</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">intPixelRightShift</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">"px; bottom:"</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">intPixelBottomShift</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">"px'&gt;"</span><span class="sc0">
      </span><span class="sc3">Else</span><span class="sc0">
         </span><span class="sc1">' Could add secondary images for other sensors types here...
</span><span class="sc0">      </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
      
      </span><span class="sc7">RC</span><span class="sc0"> </span><span class="sc4">"&lt;/div&gt;"</span><span class="sc0">
        
   </span><span class="sc3">Else</span><span class="sc0">
      </span><span class="sc7">Response.Write</span><span class="sc0"> </span><span class="sc4">"The query has returned no data for the selected sensor, location, and time period."</span><span class="sc0">
   </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">Sub</span><span class="sc0">


</span><span class="sc3">Function</span><span class="sc0"> </span><span class="sc7">TimeZone</span><span class="sc6">(</span><span class="sc0"> </span><span class="sc7">strStationName</span><span class="sc6">)</span><span class="sc0">
   </span><span class="sc7">strSQL</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"SELECT StationNames.StationName, StationNames.NickName, StationNames.TimeZone FROM StationNames "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">_</span><span class="sc0">
            </span><span class="sc4">"WHERE (StationName = '"</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">strStationName</span><span class="sc0">  </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">"') "</span><span class="sc0">
   
   </span><span class="sc3">Set</span><span class="sc0"> </span><span class="sc7">rstTimeZone</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">Server.CreateObject</span><span class="sc6">(</span><span class="sc4">"ADODB.Recordset"</span><span class="sc6">)</span><span class="sc0">
    </span><span class="sc3">On</span><span class="sc0"> </span><span class="sc3">Error</span><span class="sc0"> </span><span class="sc3">Resume</span><span class="sc0"> </span><span class="sc3">Next</span><span class="sc0">
    </span><span class="sc7">rstTimeZone.Open</span><span class="sc0"> </span><span class="sc7">strSQL</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">DBConnection</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">adOpenStatic</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">adLockReadOnly</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">adCmdText</span><span class="sc0">
    </span><span class="sc7">LogError</span><span class="sc6">(</span><span class="sc4">"Recordset = rstTelem, SQL = "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">strSQL_trace</span><span class="sc6">)</span><span class="sc0">
    </span><span class="sc3">On</span><span class="sc0"> </span><span class="sc3">Error</span><span class="sc0"> </span><span class="sc3">Goto</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">

   </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">rstTimeZone.RecordCount</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
      </span><span class="sc7">TimeZone</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"?"</span><span class="sc0">
   </span><span class="sc3">Else</span><span class="sc0"> 
      </span><span class="sc7">rstTimeZone.MoveFirst</span><span class="sc0">
      </span><span class="sc7">TimeZone</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">rstTimeZone</span><span class="sc6">(</span><span class="sc4">"TimeZone"</span><span class="sc6">)</span><span class="sc0">
   </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">

   </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc7">rstTimeZone.State</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">adStateOpen</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0"> </span><span class="sc7">rstTimeZone.Close</span><span class="sc0">
   </span><span class="sc3">Set</span><span class="sc0"> </span><span class="sc7">rstTimeZone</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc3">Nothing</span><span class="sc0">
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0">


</span><span class="sc3">Function</span><span class="sc0"> </span><span class="sc7">RegionString</span><span class="sc6">(</span><span class="sc0"> </span><span class="sc7">strRegion</span><span class="sc6">)</span><span class="sc0">
   </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">strRegion</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"MN"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
      </span><span class="sc7">RegionString</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"Minnesota Weather"</span><span class="sc0">
   </span><span class="sc3">ElseIf</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">strRegion</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"CR"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
      </span><span class="sc7">RegionString</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"Columbia Basin Weather"</span><span class="sc0">
   </span><span class="sc3">ElseIf</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">strRegion</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"Misc"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
      </span><span class="sc7">RegionString</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"Misc. Weather Stations"</span><span class="sc0">
   </span><span class="sc3">Else</span><span class="sc0">
      </span><span class="sc7">RWBR</span><span class="sc0"> </span><span class="sc4">"No match when branching on Region."</span><span class="sc0">
   </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">Function</span><span class="sc0">


</span><span class="sc1">'=======================================================================================
' Main program body (start here and execute every time in)
'=======================================================================================
</span><span class="sc0">  
</span><span class="sc1">' Build the page
</span><span class="sc6">%&gt;</span><span class="sc0">

</span><span class="sc6">&lt;</span><span class="sc7">html</span><span class="sc6">&gt;</span><span class="sc0">
</span><span class="sc6">&lt;</span><span class="sc7">head</span><span class="sc6">&gt;</span><span class="sc0">
</span><span class="sc6">&lt;</span><span class="sc7">meta</span><span class="sc0"> </span><span class="sc7">name</span><span class="sc6">=</span><span class="sc1">'Author' content='Jim Miller'&gt;
</span><span class="sc6">&lt;</span><span class="sc7">meta</span><span class="sc0"> </span><span class="sc7">name</span><span class="sc6">=</span><span class="sc1">'keywords' 
</span><span class="sc0">      </span><span class="sc7">content</span><span class="sc6">=</span><span class="sc1">'WA,Washington,OR,Orgeon,MN,Minnesota,columbia,basin,weather,chart,plot,roosevelt,
</span><span class="sc0">               </span><span class="sc7">windsurfing</span><span class="sc6">,</span><span class="sc7">gorge</span><span class="sc6">,</span><span class="sc7">richland</span><span class="sc6">,</span><span class="sc7">wind</span><span class="sc6">,</span><span class="sc7">temperature</span><span class="sc6">,</span><span class="sc7">pressure</span><span class="sc6">,</span><span class="sc7">dewpoint</span><span class="sc1">'&gt;             
</span><span class="sc6">&lt;</span><span class="sc7">meta</span><span class="sc0"> </span><span class="sc7">charset</span><span class="sc6">=</span><span class="sc4">"UTF-8"</span><span class="sc6">&gt;</span><span class="sc0">

</span><span class="sc6">&lt;!--</span><span class="sc0"> </span><span class="sc7">Icon</span><span class="sc0"> </span><span class="sc3">for</span><span class="sc0"> </span><span class="sc7">browsers</span><span class="sc0"> </span><span class="sc3">using</span><span class="sc0"> </span><span class="sc7">Waconia.</span><span class="sc0">  </span><span class="sc6">--&gt;</span><span class="sc0"> 
</span><span class="sc6">&lt;</span><span class="sc7">link</span><span class="sc0"> </span><span class="sc7">rel</span><span class="sc6">=</span><span class="sc1">'SHORTCUT ICON' href='pictures/favicon.ico'&gt;
</span><span class="sc6">&lt;</span><span class="sc7">title</span><span class="sc6">&gt;</span><span class="sc7">Waconia</span><span class="sc0"> </span><span class="sc7">Weather</span><span class="sc0"> </span><span class="sc7">Database</span><span class="sc6">&lt;/</span><span class="sc7">title</span><span class="sc6">&gt;</span><span class="sc0">

</span><span class="sc6">&lt;</span><span class="sc7">style</span><span class="sc6">&gt;</span><span class="sc0">
   </span><span class="sc7">TD</span><span class="sc0"> </span><span class="sc6">{</span><span class="sc7">font</span><span class="sc6">-</span><span class="sc7">family</span><span class="sc6">:</span><span class="sc0"> </span><span class="sc7">Times</span><span class="sc6">;}</span><span class="sc0">
   </span><span class="sc7">TD.data</span><span class="sc0"> </span><span class="sc6">{</span><span class="sc7">font</span><span class="sc6">-</span><span class="sc7">family</span><span class="sc6">:</span><span class="sc0"> </span><span class="sc7">Arial</span><span class="sc6">;}</span><span class="sc0">

   </span><span class="sc7">A</span><span class="sc0">         </span><span class="sc6">{</span><span class="sc7">color</span><span class="sc6">:</span><span class="sc9">#008080; text-decoration:underline}
</span><span class="sc0">   </span><span class="sc7">A</span><span class="sc6">:</span><span class="sc7">hover</span><span class="sc0">   </span><span class="sc6">{</span><span class="sc7">color</span><span class="sc6">:</span><span class="sc8">#008080; text-decoration:none; background:#</span><span class="sc7">FFF1E3</span><span class="sc6">}</span><span class="sc0">

   </span><span class="sc7">A.noline</span><span class="sc0">       </span><span class="sc6">{</span><span class="sc7">color</span><span class="sc6">:</span><span class="sc9">#008080; text-decoration:none;      font-size:18pt; font-weight:bolder;                   }
</span><span class="sc0">   </span><span class="sc7">A.noline</span><span class="sc6">:</span><span class="sc7">hover</span><span class="sc0"> </span><span class="sc6">{</span><span class="sc7">color</span><span class="sc6">:</span><span class="sc8">#008080; text-decoration:underline; font-size:18pt; font-weight:bolder; background:#</span><span class="sc7">FFCC99</span><span class="sc6">}</span><span class="sc0">
   
   </span><span class="sc7">span.regionstring</span><span class="sc0"> </span><span class="sc6">{</span><span class="sc7">color</span><span class="sc6">:</span><span class="sc9">#008080; font-size:18pt; font-weight:bolder;}
</span><span class="sc0">   
   </span><span class="sc7">div.pageblock</span><span class="sc0"> </span><span class="sc6">{</span><span class="sc7">min</span><span class="sc6">-</span><span class="sc7">width</span><span class="sc6">:</span><span class="sc0"> </span><span class="sc2">650</span><span class="sc7">px</span><span class="sc6">;</span><span class="sc0"> </span><span class="sc7">max</span><span class="sc6">-</span><span class="sc7">width</span><span class="sc6">:</span><span class="sc0"> </span><span class="sc2">1000</span><span class="sc7">px</span><span class="sc6">;}</span><span class="sc0">
</span><span class="sc6">&lt;/</span><span class="sc7">style</span><span class="sc6">&gt;</span><span class="sc0">

</span><span class="sc6">&lt;!--</span><span class="sc7">[if</span><span class="sc0"> </span><span class="sc7">IE]</span><span class="sc6">&gt;</span><span class="sc0">
   </span><span class="sc6">&lt;</span><span class="sc7">style</span><span class="sc6">&gt;</span><span class="sc0">
      </span><span class="sc7">div.pageblock</span><span class="sc0"> </span><span class="sc6">{</span><span class="sc7">width</span><span class="sc6">:</span><span class="sc0"> </span><span class="sc7">expression</span><span class="sc6">(</span><span class="sc7">document.body.clientWidth</span><span class="sc0"> </span><span class="sc6">&gt;</span><span class="sc0"> </span><span class="sc2">1000</span><span class="sc6">?</span><span class="sc0"> </span><span class="sc4">"1000px"</span><span class="sc6">:</span><span class="sc0"> </span><span class="sc4">"auto"</span><span class="sc0"> </span><span class="sc6">)};</span><span class="sc0">
   </span><span class="sc6">&lt;/</span><span class="sc7">style</span><span class="sc6">&gt;</span><span class="sc0">
</span><span class="sc6">&lt;!</span><span class="sc7">[endif]</span><span class="sc6">--&gt;</span><span class="sc0">   

</span><span class="sc6">&lt;/</span><span class="sc7">head</span><span class="sc6">&gt;</span><span class="sc0">

</span><span class="sc6">&lt;%</span><span class="sc0">

</span><span class="sc7">strServerName</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">UCase</span><span class="sc6">(</span><span class="sc7">request.servervariables</span><span class="sc6">(</span><span class="sc4">"SERVER_NAME"</span><span class="sc6">))</span><span class="sc0">
</span><span class="sc7">strPathToImageDir</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">request.servervariables</span><span class="sc6">(</span><span class="sc4">"APPL_PHYSICAL_PATH"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">"\chart-images\"</span><span class="sc0">
</span><span class="sc7">strURLPathToImageDir</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"chart-images/"</span><span class="sc0">

</span><span class="sc1">' Connect to the database.
</span><span class="sc3">Set</span><span class="sc0"> </span><span class="sc7">DBConnection</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">CreateObject</span><span class="sc6">(</span><span class="sc4">"ADODB.Connection"</span><span class="sc6">)</span><span class="sc0">
</span><span class="sc1">' Open a connection to MySQL (telem schema) using 32-bit system DSN (MySQL ODBC 5.3 Unicode Driver)
</span><span class="sc7">DBConnection.Open</span><span class="sc0"> </span><span class="sc4">"DSN=MySQL_telem_for_ASP;"</span><span class="sc0">

</span><span class="sc3">Set</span><span class="sc0"> </span><span class="sc7">dicTZ</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">Server.CreateObject</span><span class="sc6">(</span><span class="sc4">"Scripting.Dictionary"</span><span class="sc6">)</span><span class="sc0">
</span><span class="sc7">dicTZ.Add</span><span class="sc0"> </span><span class="sc4">"H"</span><span class="sc6">,</span><span class="sc0">  </span><span class="sc6">-</span><span class="sc2">4</span><span class="sc0">
</span><span class="sc7">dicTZ.Add</span><span class="sc0"> </span><span class="sc4">"AK"</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc6">-</span><span class="sc2">3</span><span class="sc0">
</span><span class="sc7">dicTZ.Add</span><span class="sc0"> </span><span class="sc4">"P"</span><span class="sc6">,</span><span class="sc0">  </span><span class="sc6">-</span><span class="sc2">2</span><span class="sc0">
</span><span class="sc7">dicTZ.Add</span><span class="sc0"> </span><span class="sc4">"M"</span><span class="sc6">,</span><span class="sc0">  </span><span class="sc6">-</span><span class="sc2">1</span><span class="sc0">
</span><span class="sc7">dicTZ.Add</span><span class="sc0"> </span><span class="sc4">"C"</span><span class="sc6">,</span><span class="sc0">   </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc7">dicTZ.Add</span><span class="sc0"> </span><span class="sc4">"E"</span><span class="sc6">,</span><span class="sc0">   </span><span class="sc2">1</span><span class="sc0">
</span><span class="sc7">dicTZ.Add</span><span class="sc0"> </span><span class="sc4">"J"</span><span class="sc6">,</span><span class="sc0">  </span><span class="sc2">15</span><span class="sc0">
</span><span class="sc7">dicTZ.Add</span><span class="sc0"> </span><span class="sc4">"NZ"</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc2">18</span><span class="sc0">

</span><span class="sc7">serverTimeArray</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">split</span><span class="sc6">(</span><span class="sc7">Now</span><span class="sc6">(),</span><span class="sc4">" "</span><span class="sc6">)</span><span class="sc0">
</span><span class="sc7">serverTime</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">serverTimeArray</span><span class="sc6">(</span><span class="sc2">1</span><span class="sc6">)</span><span class="sc0">

</span><span class="sc1">' Establish defaults
</span><span class="sc0">
</span><span class="sc1">' Region_state (hidden) is used to facilitate changing the location to a default value
' when the region is changed.
</span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">Request.QueryString</span><span class="sc6">(</span><span class="sc4">"Region_state"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">""</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0"> 
   </span><span class="sc7">strRegionState</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"new"</span><span class="sc0">
</span><span class="sc3">Else</span><span class="sc0">
   </span><span class="sc7">strRegionState</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">Request.QueryString</span><span class="sc6">(</span><span class="sc4">"Region_state"</span><span class="sc6">)</span><span class="sc0">
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">

</span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">Request.QueryString</span><span class="sc6">(</span><span class="sc4">"Region"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">""</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0"> 
   </span><span class="sc7">strRegion</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"CR"</span><span class="sc0">
</span><span class="sc3">Else</span><span class="sc0">
   </span><span class="sc7">strRegion</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">Request.QueryString</span><span class="sc6">(</span><span class="sc4">"Region"</span><span class="sc6">)</span><span class="sc0">
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">

</span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">Request.QueryString</span><span class="sc6">(</span><span class="sc4">"chk24Hrs"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"on"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
   </span><span class="sc7">str24Hrs_state</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"checked"</span><span class="sc0">
</span><span class="sc3">Else</span><span class="sc0">
   </span><span class="sc7">str24Hrs_state</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">""</span><span class="sc0"> 
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">

</span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">Request.QueryString</span><span class="sc6">(</span><span class="sc4">"chkRA"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"on"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
   </span><span class="sc7">strRA_state</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"checked"</span><span class="sc0">
</span><span class="sc3">Else</span><span class="sc0">
   </span><span class="sc7">strRA_state</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">""</span><span class="sc0"> 
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">

</span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">Request.QueryString</span><span class="sc6">(</span><span class="sc4">"chkTimer"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"on"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
   </span><span class="sc7">strTimer_state</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"checked"</span><span class="sc0">
</span><span class="sc3">Else</span><span class="sc0">
   </span><span class="sc7">strTimer_state</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">""</span><span class="sc0">
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">

</span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">strTimer_state</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"checked"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
   </span><span class="sc1">'Check to see how far off the 5-minute mark. This should serve
</span><span class="sc0">   </span><span class="sc1">'to compensate for the drift in the client side timer.
</span><span class="sc0">   
   </span><span class="sc1">'Get the seconds and minutes from the server time.
</span><span class="sc0">   </span><span class="sc7">intSeconds_FromSeconds</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc3">CInt</span><span class="sc6">(</span><span class="sc7">right</span><span class="sc6">(</span><span class="sc7">serverTime</span><span class="sc6">,</span><span class="sc2">2</span><span class="sc6">))</span><span class="sc0">
   </span><span class="sc7">intMinutes</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc3">CInt</span><span class="sc6">(</span><span class="sc7">Split</span><span class="sc6">(</span><span class="sc7">serverTime</span><span class="sc6">,</span><span class="sc4">":"</span><span class="sc6">)(</span><span class="sc2">1</span><span class="sc6">))</span><span class="sc0">
   
   </span><span class="sc1">'How many five minute chunks.
</span><span class="sc0">   </span><span class="sc7">dblFiveMinutes</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc3">CDbl</span><span class="sc6">(</span><span class="sc7">intMinutes</span><span class="sc6">)/</span><span class="sc2">5.0</span><span class="sc0">
   
   </span><span class="sc1">'Take the fractional part of this and convert to seconds.
</span><span class="sc0">   </span><span class="sc7">intSeconds_FromMinutes</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc3">CInt</span><span class="sc6">(</span><span class="sc7">round</span><span class="sc6">(</span><span class="sc2">300</span><span class="sc6">*(</span><span class="sc7">dblFiveMinutes</span><span class="sc0"> </span><span class="sc6">-</span><span class="sc0"> </span><span class="sc7">Fix</span><span class="sc6">(</span><span class="sc7">dblFiveMinutes</span><span class="sc6">)),</span><span class="sc2">0</span><span class="sc6">))</span><span class="sc0">
   
   </span><span class="sc1">'Subtract both of these values from 300 to get the proper delay for the client.
</span><span class="sc0">   </span><span class="sc1">'Then add 9 to keep it tracking at 10 seconds after the 5-minute mark.
</span><span class="sc0">   </span><span class="sc7">intDelay_to_5min</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">300</span><span class="sc0"> </span><span class="sc6">-</span><span class="sc0"> </span><span class="sc7">intSeconds_FromMinutes</span><span class="sc0"> </span><span class="sc6">-</span><span class="sc0"> </span><span class="sc7">intSeconds_FromSeconds</span><span class="sc0"> </span><span class="sc6">+</span><span class="sc0"> </span><span class="sc2">9</span><span class="sc0">
   </span><span class="sc7">strInitializeTimer</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"initializeTimer("</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc3">CStr</span><span class="sc6">(</span><span class="sc7">intDelay_to_5min</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">");"</span><span class="sc0">
   
</span><span class="sc3">Else</span><span class="sc0">
   </span><span class="sc7">strInitializeTimer</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">""</span><span class="sc0">
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">

</span><span class="sc7">blnPostedDate_default</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc3">False</span><span class="sc0">
</span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">Request.QueryString</span><span class="sc6">(</span><span class="sc4">"EndDate"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">""</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0"> 
   </span><span class="sc1">' Use the current date for a default. 
</span><span class="sc0">   </span><span class="sc7">dtePostedDate</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc3">CStr</span><span class="sc6">(</span><span class="sc3">Date</span><span class="sc6">())</span><span class="sc0">
   </span><span class="sc7">blnPostedDate_default</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc3">True</span><span class="sc0">
</span><span class="sc3">Else</span><span class="sc0">
   </span><span class="sc1">' Split to just get the DATE part of this post.
</span><span class="sc0">   </span><span class="sc7">dtePostedDate</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">split</span><span class="sc6">(</span><span class="sc7">Request.QueryString</span><span class="sc6">(</span><span class="sc4">"EndDate"</span><span class="sc6">),</span><span class="sc4">" "</span><span class="sc6">)(</span><span class="sc2">0</span><span class="sc6">)</span><span class="sc0">
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">

</span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">Request.QueryString</span><span class="sc6">(</span><span class="sc4">"Days"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">""</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0"> 
   </span><span class="sc7">intDays</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">
</span><span class="sc3">Else</span><span class="sc0">
   </span><span class="sc7">intDays</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">Request.QueryString</span><span class="sc6">(</span><span class="sc4">"Days"</span><span class="sc6">)</span><span class="sc0">
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">

</span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">Request.QueryString</span><span class="sc6">(</span><span class="sc4">"Sensor"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">""</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0"> 
   </span><span class="sc7">strSensorType</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"Wind40"</span><span class="sc0">
</span><span class="sc3">Else</span><span class="sc0">
   </span><span class="sc7">strSensorType</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">Request.QueryString</span><span class="sc6">(</span><span class="sc4">"Sensor"</span><span class="sc6">)</span><span class="sc0">
   </span><span class="sc1">' Don't allow request for Delta-P from any region but CR.
</span><span class="sc0">   </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">strRegion</span><span class="sc0"> </span><span class="sc6">&lt;&gt;</span><span class="sc0"> </span><span class="sc4">"CR"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">And</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">strSensorType</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"DeltaP"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
         </span><span class="sc7">strSensorType</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"Wind40"</span><span class="sc0">
   </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">

</span><span class="sc1">' Set the normalization factor for the wind direction data
</span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">strSensorType</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"Wind40"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0"> 
   </span><span class="sc7">dblWindNormFactor</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">40.0</span><span class="sc0"> </span><span class="sc6">/</span><span class="sc0"> </span><span class="sc2">360.0</span><span class="sc0">
</span><span class="sc3">Else</span><span class="sc0">
   </span><span class="sc7">dblWindNormFactor</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">1.0</span><span class="sc0"> </span><span class="sc6">/</span><span class="sc0"> </span><span class="sc2">10.0</span><span class="sc0">
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">

</span><span class="sc1">' Set a default value for the location if the first time in or if the user changes
' the region.
</span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">((</span><span class="sc7">Request.QueryString</span><span class="sc6">(</span><span class="sc4">"Location"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">""</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">or</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">strRegionState</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"new"</span><span class="sc6">))</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0"> 
   </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">strRegion</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"CR"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
      </span><span class="sc7">strLocation</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"PASC"</span><span class="sc0">
   </span><span class="sc3">ElseIf</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">strRegion</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"MN"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
      </span><span class="sc7">strLocation</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"KMKT"</span><span class="sc0">   
   </span><span class="sc3">ElseIf</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">strRegion</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"Misc"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
      </span><span class="sc7">strLocation</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"KCQX"</span><span class="sc0">    
   </span><span class="sc3">Else</span><span class="sc0">
      </span><span class="sc7">strLocation</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">""</span><span class="sc0">
      </span><span class="sc7">RWBR</span><span class="sc0"> </span><span class="sc4">"No match in region branch..."</span><span class="sc0">
   </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
</span><span class="sc3">Else</span><span class="sc0">
   </span><span class="sc7">strLocation</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">Request.QueryString</span><span class="sc6">(</span><span class="sc4">"Location"</span><span class="sc6">)</span><span class="sc0">
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">

</span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">((</span><span class="sc7">strSensorType</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"Wind40"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">OR</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">strSensorType</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"Wind36"</span><span class="sc6">))</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
   </span><span class="sc7">strShowImages_command</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"showImage();showDirections();"</span><span class="sc0">
</span><span class="sc3">Else</span><span class="sc0">
   </span><span class="sc7">strShowImages_command</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"showImage();"</span><span class="sc0">
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">

</span><span class="sc7">strTimeZone</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">TimeZone</span><span class="sc6">(</span><span class="sc0"> </span><span class="sc7">strLocation</span><span class="sc6">)</span><span class="sc0">

</span><span class="sc7">RC</span><span class="sc0"> </span><span class="sc4">"&lt;body onLoad=testJS();"</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">strShowImages_command</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">strInitializeTimer</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">_</span><span class="sc0">
      </span><span class="sc4">" bgcolor=#FFCC99 link=#008080 vlink=#008080 topmargin=2 style=font-family:Arial;&gt;"</span><span class="sc0">

</span><span class="sc7">RC</span><span class="sc0"> </span><span class="sc4">"&lt;div class='pageblock'&gt;"</span><span class="sc0">

</span><span class="sc1">' If the region is specified, then make preparations for populating the table
' including getting the most recent values for all the sensor data.
</span><span class="sc0">
</span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">Request.QueryString</span><span class="sc6">(</span><span class="sc4">"Region"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">&lt;&gt;</span><span class="sc0"> </span><span class="sc4">""</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">

   </span><span class="sc1">' If the end date in the chart request is within daylight savings time, then
</span><span class="sc0">   </span><span class="sc1">' set the DLS flag. Add 3 hours to make sure you evaluate the day after the
</span><span class="sc0">   </span><span class="sc1">' 2am change over point.
</span><span class="sc0">
   </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">DaylightSavingsTime</span><span class="sc6">(</span><span class="sc7">dateadd</span><span class="sc6">(</span><span class="sc4">"h"</span><span class="sc6">,</span><span class="sc2">3</span><span class="sc6">,</span><span class="sc7">dtePostedDate</span><span class="sc6">)))</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0"> 
      </span><span class="sc7">blnDayLightSavingsTime</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc3">True</span><span class="sc0">
   </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">

   </span><span class="sc1">' Find the time of the most recent station record.
</span><span class="sc0">   </span><span class="sc7">strSQL</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"SELECT * FROM FifteenMinData "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">_</span><span class="sc0">
            </span><span class="sc4">"WHERE (StationName = '"</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">strLocation</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">"') "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">_</span><span class="sc0">
            </span><span class="sc4">"ORDER BY DateTimeStamp DESC "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">_</span><span class="sc0">
            </span><span class="sc4">"LIMIT 1"</span><span class="sc0">  

   </span><span class="sc3">Set</span><span class="sc0"> </span><span class="sc7">rstMostRecent</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">Server.CreateObject</span><span class="sc6">(</span><span class="sc4">"ADODB.Recordset"</span><span class="sc6">)</span><span class="sc0">
    </span><span class="sc3">On</span><span class="sc0"> </span><span class="sc3">Error</span><span class="sc0"> </span><span class="sc3">Resume</span><span class="sc0"> </span><span class="sc3">Next</span><span class="sc0">
    </span><span class="sc7">rstMostRecent.Open</span><span class="sc0"> </span><span class="sc7">strSQL</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">DBConnection</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">adOpenStatic</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">adLockReadOnly</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">adCmdText</span><span class="sc0">
    </span><span class="sc7">LogError</span><span class="sc6">(</span><span class="sc4">"Recordset = rstTelem, SQL = "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">strSQL_trace</span><span class="sc6">)</span><span class="sc0">
    </span><span class="sc3">On</span><span class="sc0"> </span><span class="sc3">Error</span><span class="sc0"> </span><span class="sc3">Goto</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">

   </span><span class="sc1">' Check to see if there are any records before applying the MoveFirst method
</span><span class="sc0">   </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc3">Not</span><span class="sc0"> </span><span class="sc7">rstMostRecent.EOF</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">

      </span><span class="sc1">' If a default value was used for the posted date, correct it if the posted date
</span><span class="sc0">      </span><span class="sc1">' is more recent than the most recent data.   
</span><span class="sc0">      </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc7">blnPostedDate_default</span><span class="sc0"> </span><span class="sc3">and</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">DateDiff</span><span class="sc6">(</span><span class="sc4">"d"</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">dtePostedDate</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">rstMostRecent</span><span class="sc6">(</span><span class="sc4">"TimeMDY"</span><span class="sc6">))</span><span class="sc0"> </span><span class="sc6">&lt;</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
         </span><span class="sc7">dtePostedDate</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">rstMostRecent</span><span class="sc6">(</span><span class="sc4">"TimeMDY"</span><span class="sc6">)</span><span class="sc0">
      </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
      
      </span><span class="sc1">'Warning: this variable changes type here.
</span><span class="sc0">      </span><span class="sc7">strMRTime</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">rstMostRecent</span><span class="sc6">(</span><span class="sc4">"TimeMDY"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">" "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">rstMostRecent</span><span class="sc6">(</span><span class="sc4">"TimeHr"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">":"</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">rstMostRecent</span><span class="sc6">(</span><span class="sc4">"TimeMin"</span><span class="sc6">)</span><span class="sc0">
      </span><span class="sc7">strMRTime</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">FormatDateTime</span><span class="sc6">(</span><span class="sc7">strMRTime</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">vbGeneralDate</span><span class="sc6">)</span><span class="sc0">
      
      </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">rstMostRecent</span><span class="sc6">(</span><span class="sc4">"WindDirection"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc6">-</span><span class="sc2">10</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
         </span><span class="sc7">strMRWindDir</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"Variable"</span><span class="sc0">
      </span><span class="sc3">Else</span><span class="sc0">
         </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc7">IsNull</span><span class="sc6">(</span><span class="sc7">rstMostRecent</span><span class="sc6">(</span><span class="sc4">"WindDirection"</span><span class="sc6">))</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
            </span><span class="sc7">strMRWindDir</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"-"</span><span class="sc0">
         </span><span class="sc3">Else</span><span class="sc0">
            </span><span class="sc7">strMRWindDir</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">rstMostRecent</span><span class="sc6">(</span><span class="sc4">"WindDirection"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">_</span><span class="sc0">
                           </span><span class="sc4">" deg. ["</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">DirectionLabel</span><span class="sc6">(</span><span class="sc7">rstMostRecent</span><span class="sc6">(</span><span class="sc4">"WindDirection"</span><span class="sc6">))</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">"]"</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">_</span><span class="sc0">
                           </span><span class="sc4">" ["</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">FormatNumber</span><span class="sc6">(</span><span class="sc7">rstMostRecent</span><span class="sc6">(</span><span class="sc4">"WindDirection"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">*</span><span class="sc0"> </span><span class="sc7">dblWindNormFactor</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">"]"</span><span class="sc0">
         </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
      </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">    
      </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc7">IsNull</span><span class="sc6">(</span><span class="sc7">rstMostRecent</span><span class="sc6">(</span><span class="sc4">"WindSpeed"</span><span class="sc6">))</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
         </span><span class="sc7">strMRWindAvg</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"-"</span><span class="sc0"> 
         </span><span class="sc7">strMRWindMax</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"-"</span><span class="sc0">
      </span><span class="sc3">Else</span><span class="sc0">
         </span><span class="sc7">strMRWindAvg</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">rstMostRecent</span><span class="sc6">(</span><span class="sc4">"WindSpeed"</span><span class="sc6">)</span><span class="sc0">
         </span><span class="sc7">strMRWindMax</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">rstMostRecent</span><span class="sc6">(</span><span class="sc4">"WindGust"</span><span class="sc6">)</span><span class="sc0">
      </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">

      </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc7">IsNull</span><span class="sc6">(</span><span class="sc7">rstMostRecent</span><span class="sc6">(</span><span class="sc4">"Pressure"</span><span class="sc6">))</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
         </span><span class="sc7">strMRPressure</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"-"</span><span class="sc0">
      </span><span class="sc3">Else</span><span class="sc0">
         </span><span class="sc7">strMRPressure</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">round</span><span class="sc6">(</span><span class="sc7">rstMostRecent</span><span class="sc6">(</span><span class="sc4">"Pressure"</span><span class="sc6">),</span><span class="sc2">2</span><span class="sc6">)</span><span class="sc0">
      </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0"> 

      </span><span class="sc7">strMRTemp</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">rstMostRecent</span><span class="sc6">(</span><span class="sc4">"TempAvg"</span><span class="sc6">)</span><span class="sc0">
      </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">IsNull</span><span class="sc6">(</span><span class="sc7">strMRTemp</span><span class="sc6">))</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
         </span><span class="sc7">strMRTemp</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"-"</span><span class="sc0">
      </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
      
      </span><span class="sc7">strMRDewPoint</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">rstMostRecent</span><span class="sc6">(</span><span class="sc4">"DewPoint"</span><span class="sc6">)</span><span class="sc0"> 
      </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">IsNull</span><span class="sc6">(</span><span class="sc7">strMRDewPoint</span><span class="sc6">))</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
         </span><span class="sc7">strMRDewPoint</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"-"</span><span class="sc0">
      </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
   
   </span><span class="sc3">Else</span><span class="sc0">
      </span><span class="sc7">strMRTime</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"-"</span><span class="sc0">
      </span><span class="sc7">strMRWindDir</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"-"</span><span class="sc0">
      </span><span class="sc7">strMRWindAvg</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"-"</span><span class="sc0">
      </span><span class="sc7">strMRWindMax</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"-"</span><span class="sc0">
      </span><span class="sc7">strMRTemp</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"-"</span><span class="sc0">
      </span><span class="sc7">strMRPressure</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"-"</span><span class="sc0">   
      </span><span class="sc7">strMRDewPoint</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"-"</span><span class="sc0"> 
   </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
   
   </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc7">rstMostRecent.State</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">adStateOpen</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0"> </span><span class="sc7">rstMostRecent.Close</span><span class="sc0">
   </span><span class="sc3">Set</span><span class="sc0"> </span><span class="sc7">rstMostRecent</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc3">Nothing</span><span class="sc0">
   
   </span><span class="sc7">strButtonLabel</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"Update"</span><span class="sc0">
   
</span><span class="sc3">Else</span><span class="sc0">
   </span><span class="sc7">dtePostedDate</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">""</span><span class="sc0">

   </span><span class="sc1">' Before first post (first time in) just show these dashes in the table...
</span><span class="sc0">   </span><span class="sc7">strMRTime</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"-"</span><span class="sc0">
   </span><span class="sc7">strMRWindDir</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"-"</span><span class="sc0">
   </span><span class="sc7">strMRWindAvg</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"-"</span><span class="sc0">
   </span><span class="sc7">strMRWindMax</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"-"</span><span class="sc0">
   </span><span class="sc7">strMRTemp</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"-"</span><span class="sc0">
   </span><span class="sc7">strMRPressure</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"-"</span><span class="sc0">
   </span><span class="sc7">strMRDewPoint</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"-"</span><span class="sc0"> 

   </span><span class="sc7">strButtonLabel</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"Chart"</span><span class="sc0">
   
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">

</span><span class="sc1">'===========================================================================
' The current data table and CONTROLS form...
'===========================================================================
</span><span class="sc7">RC</span><span class="sc0"> </span><span class="sc4">"&lt;table border='1'&gt;"</span><span class="sc0">

</span><span class="sc1">' First row
</span><span class="sc0">
</span><span class="sc7">RC</span><span class="sc0"> </span><span class="sc4">"&lt;tr&gt;"</span><span class="sc0">

</span><span class="sc7">RC</span><span class="sc0"> </span><span class="sc4">"&lt;td class='data' width='37%' rowspan='3'&gt;"</span><span class="sc0">
</span><span class="sc1">'RC "&lt;p align='center'&gt;&lt;a onmouseover=""changeRegionAnchorValue('" &amp; strRegion &amp; "')"" onmouseout=""changeRegionAnchorValue('" &amp; strTitle &amp; "')"" name='regionanchor' id='regionanchor' class='noline' href='" &amp; strRegionURL &amp; "'&gt;" &amp; strTitle  &amp; "&lt;/a&gt;&amp;nbsp;&lt;br&gt;"
</span><span class="sc7">RC</span><span class="sc0"> </span><span class="sc4">"&lt;p align='center'&gt;&lt;span class='regionstring'&gt;"</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">RegionString</span><span class="sc6">(</span><span class="sc0"> </span><span class="sc7">strRegion</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">"&lt;/span&gt;&lt;br&gt;"</span><span class="sc0">
</span><span class="sc1">'RC "&lt;a target='_blank' href='https://waconia.triquence.org/faq.html'&gt;&lt;font size='2' color='#FF0000'&gt;Help&lt;/font&gt;" &amp; _
'                     "&lt;font size='2' color='#008080'&gt;: FAQs&lt;/font&gt;&lt;/a&gt;&amp;nbsp;"
</span><span class="sc0">
</span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">strRegion</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"MN"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
   </span><span class="sc7">RC</span><span class="sc0"> </span><span class="sc4">"&lt;a href='pictures/mn_sites.jpg'&gt;&lt;font size='2' color='#008080'&gt;Sites&lt;/font&gt;&lt;/a&gt;&amp;nbsp;"</span><span class="sc0">
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
</span><span class="sc7">RC</span><span class="sc0"> </span><span class="sc4">"&lt;a href='default.htm'&gt;&lt;font size='2'&gt;(home)&lt;/font&gt;&lt;/a&gt;"</span><span class="sc0">

</span><span class="sc1">' Create a object for working with the image files...
</span><span class="sc3">Set</span><span class="sc0"> </span><span class="sc7">fsoObject</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">CreateObject</span><span class="sc6">(</span><span class="sc4">"Scripting.FileSystemObject"</span><span class="sc6">)</span><span class="sc0">
</span><span class="sc1">' Note: path to image directory is defined in include file.
</span><span class="sc3">Set</span><span class="sc0"> </span><span class="sc7">fdrObject</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">fsoObject.GetFolder</span><span class="sc6">(</span><span class="sc7">strPathToImageDir</span><span class="sc6">)</span><span class="sc0">
         
</span><span class="sc1">' Clean out any old temp image files. This is a new approach that doesn't depend on script in the global ASA
</span><span class="sc7">intFileCount</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">
</span><span class="sc3">For</span><span class="sc0"> </span><span class="sc3">Each</span><span class="sc0"> </span><span class="sc7">filObject</span><span class="sc0"> </span><span class="sc3">in</span><span class="sc0"> </span><span class="sc7">fdrObject.Files</span><span class="sc0">
   </span><span class="sc3">Dim</span><span class="sc0"> </span><span class="sc7">fileAge</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">fileDate</span><span class="sc0">
   </span><span class="sc7">fileDate</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">filObject.DateLastModified</span><span class="sc0">
   </span><span class="sc7">fileAge</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">DateDiff</span><span class="sc6">(</span><span class="sc4">"h"</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">fileDate</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">Now</span><span class="sc6">())</span><span class="sc0">
   
   </span><span class="sc1">' Count files that are less than 1 day old.
</span><span class="sc0">   </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">fileAge</span><span class="sc0"> </span><span class="sc6">&lt;=</span><span class="sc0"> </span><span class="sc2">24</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
      </span><span class="sc7">intFileCount</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">intFileCount</span><span class="sc0"> </span><span class="sc6">+</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc0">
   </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
   
   </span><span class="sc1">' Delete files that are more than three days old.
</span><span class="sc0">   </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">fileAge</span><span class="sc0"> </span><span class="sc6">&gt;</span><span class="sc0"> </span><span class="sc2">72</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
      </span><span class="sc7">filObject.delete</span><span class="sc0">
   </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">  
</span><span class="sc3">Next</span><span class="sc0">         

</span><span class="sc1">' Write out a count of image files in the directory (1 and 7 day counts).
' Put the serverTime in a span so can access it from the client (if needed, may not actually use this).          
</span><span class="sc7">RC</span><span class="sc0"> </span><span class="sc4">"&lt;font color='#008080'  size='1'&gt;"</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">_</span><span class="sc0">
   </span><span class="sc4">"&amp;nbsp;&amp;nbsp;"</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">intFileCount</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">"-(1d)&amp;nbsp;&amp;nbsp;"</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">fdrObject.Files.Count</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">"-(3d)&amp;nbsp;&amp;nbsp;"</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">_</span><span class="sc0">
   </span><span class="sc4">"&lt;span id='spServerTime' name='spServerTime'&gt;"</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">serverTime</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">"&lt;/span&gt;"</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">_</span><span class="sc0">
   </span><span class="sc4">" ("</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">AgeOfData</span><span class="sc6">(</span><span class="sc7">strMRTime</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">")"</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">_</span><span class="sc0">
   </span><span class="sc4">"&lt;/font&gt;"</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">_</span><span class="sc0">
   </span><span class="sc4">"&lt;/p&gt;"</span><span class="sc0">
</span><span class="sc7">RC</span><span class="sc0"> </span><span class="sc4">"&lt;/td&gt;"</span><span class="sc0">

</span><span class="sc1">' Rest of the table headers
</span><span class="sc7">RC</span><span class="sc0"> </span><span class="sc4">"&lt;td width='23%' align='center' rowspan='2'&gt;&lt;b&gt;&lt;font color='#FF0000'&gt;Latest&lt;/font&gt;"</span><span class="sc0">
</span><span class="sc7">RC</span><span class="sc0"> </span><span class="sc4">"&lt;font color='#008080'&gt; Reading"</span><span class="sc0">
</span><span class="sc7">RC</span><span class="sc0"> </span><span class="sc4">"&lt;/font&gt;&lt;/b&gt;"</span><span class="sc0">
</span><span class="sc7">RC</span><span class="sc0"> </span><span class="sc4">"&lt;/td&gt;"</span><span class="sc0">

</span><span class="sc7">RC</span><span class="sc0"> </span><span class="sc4">"&lt;td width='26%' align='center' colspan='3'&gt;&lt;font color='#008080'&gt;&lt;b&gt;Wind &lt;/b&gt;&lt;font size='2'&gt; (mph)&lt;/font&gt;&lt;/font&gt;&lt;/td&gt;"</span><span class="sc0">

</span><span class="sc7">RC</span><span class="sc0"> </span><span class="sc4">"&lt;td nowrap width='6%' align='center' colspan='2' rowspan='1'&gt;&lt;font color='#008080'&gt;&lt;b&gt;Temp&lt;/b&gt;&lt;font size='2'&gt; (&lt;sup&gt;o&lt;/sup&gt;F)&lt;/font&gt;&lt;/font&gt;&lt;/td&gt;"</span><span class="sc0">
</span><span class="sc7">RC</span><span class="sc0"> </span><span class="sc4">"&lt;td width='8%' align='center' rowspan='2'&gt;&lt;font color='#008080'&gt;&lt;b&gt;Pressure&lt;br&gt;&lt;/b&gt;&lt;font size='2'&gt; (in Hg"</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">strHGSL</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">")&lt;/font&gt;&lt;/font&gt;&lt;/td&gt;"</span><span class="sc0">
</span><span class="sc7">RC</span><span class="sc0"> </span><span class="sc4">"&lt;/tr&gt;"</span><span class="sc0">

</span><span class="sc1">' Second row
</span><span class="sc0">
</span><span class="sc7">RC</span><span class="sc0"> </span><span class="sc4">"&lt;tr&gt;"</span><span class="sc0">
</span><span class="sc7">RC</span><span class="sc0"> </span><span class="sc4">"&lt;td width='6%' align='center'&gt;&lt;font color='#008080' size='2'&gt;Avg&lt;/font&gt;&lt;/td&gt;"</span><span class="sc0">
</span><span class="sc7">RC</span><span class="sc0"> </span><span class="sc4">"&lt;td width='5%' align='center'&gt;&lt;font color='#008080' size='2'&gt;Max&lt;/font&gt;&lt;/td&gt;"</span><span class="sc0">
</span><span class="sc7">RC</span><span class="sc0"> </span><span class="sc4">"&lt;td width='18%' align='center'&gt;&lt;font color='#008080' size='2'&gt;Direction&lt;/font&gt;&lt;/td&gt;"</span><span class="sc0">
</span><span class="sc7">RC</span><span class="sc0"> </span><span class="sc4">"&lt;td align='center'&gt;&lt;font color='#008080' size='2'&gt;DryBulb&lt;/font&gt;&lt;/td&gt;"</span><span class="sc0">
</span><span class="sc7">RC</span><span class="sc0"> </span><span class="sc4">"&lt;td align='center'&gt;&lt;font color='#008080' size='2'&gt;DewPoint&lt;/font&gt;&lt;/td&gt;"</span><span class="sc0">
</span><span class="sc7">RC</span><span class="sc0"> </span><span class="sc4">"&lt;/tr&gt;"</span><span class="sc0">

</span><span class="sc1">' Third row
</span><span class="sc0">
</span><span class="sc7">RC</span><span class="sc0"> </span><span class="sc4">"&lt;tr&gt;"</span><span class="sc0">
</span><span class="sc7">RC</span><span class="sc0"> </span><span class="sc4">"&lt;td class='data' width='20%' align='center'&gt;&lt;font color='#000000' size='2'&gt;"</span><span class="sc0">
</span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">strMRTime</span><span class="sc0"> </span><span class="sc6">&lt;&gt;</span><span class="sc0"> </span><span class="sc4">"-"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
   </span><span class="sc1">'rwbr "strMRTime = " &amp; strMRTime &amp; ", strTimeZone = " &amp; strTimeZone &amp; ", DaylightSavingsTime(strMRTime) = " &amp; DaylightSavingsTime(strMRTime)
</span><span class="sc0">   </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">DaylightSavingsTime</span><span class="sc6">(</span><span class="sc7">strMRTime</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">And</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">strTimeZone</span><span class="sc0"> </span><span class="sc6">&lt;&gt;</span><span class="sc0"> </span><span class="sc4">"H"</span><span class="sc6">))</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
      </span><span class="sc7">Response.Write</span><span class="sc0"> </span><span class="sc7">DateAdd</span><span class="sc6">(</span><span class="sc4">"h"</span><span class="sc6">,</span><span class="sc2">1</span><span class="sc6">,</span><span class="sc7">strMRTime</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">" ("</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">strTimeZone</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">"DT)"</span><span class="sc0">
   </span><span class="sc3">Else</span><span class="sc0">
      </span><span class="sc7">Response.Write</span><span class="sc0">               </span><span class="sc7">strMRTime</span><span class="sc0">  </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">" ("</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">strTimeZone</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">"ST)"</span><span class="sc0">
   </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
</span><span class="sc3">Else</span><span class="sc0">
   </span><span class="sc7">Response.Write</span><span class="sc0"> </span><span class="sc7">strMRTime</span><span class="sc0">
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
</span><span class="sc7">RC</span><span class="sc0"> </span><span class="sc4">"&lt;/font&gt;&lt;/td&gt;"</span><span class="sc0">
</span><span class="sc7">RC</span><span class="sc0"> </span><span class="sc4">"&lt;td class='data' width='6%' align='center'&gt;&lt;font color='#000000' size='2'&gt;"</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">strMRWindAvg</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">"&lt;/font&gt;&lt;/td&gt;"</span><span class="sc0">
</span><span class="sc7">RC</span><span class="sc0"> </span><span class="sc4">"&lt;td class='data' width='5%' align='center'&gt;&lt;font color='#000000' size='2'&gt;"</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">strMRWindMax</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">"&lt;/font&gt;&lt;/td&gt;"</span><span class="sc0">
</span><span class="sc7">RC</span><span class="sc0"> </span><span class="sc4">"&lt;td class='data' width='18%' align='center'&gt;&lt;font color='#000000' size='2'&gt;"</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">strMRWindDir</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">"&lt;/font&gt;&lt;/td&gt;"</span><span class="sc0">
</span><span class="sc7">RC</span><span class="sc0"> </span><span class="sc4">"&lt;td class='data' width='6%' align='center'&gt;&lt;font color='#000000' size='2'&gt;"</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">strMRTemp</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">"&lt;/font&gt;&lt;/td&gt;"</span><span class="sc0">
</span><span class="sc7">RC</span><span class="sc0"> </span><span class="sc4">"&lt;td class='data' width='6%' align='center'&gt;&lt;font color='#000000' size='2'&gt;"</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">strMRDewPoint</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">"&lt;/font&gt;&lt;/td&gt;"</span><span class="sc0">
</span><span class="sc7">RC</span><span class="sc0"> </span><span class="sc4">"&lt;td class='data' width='8%' align='center'&gt;&lt;font color='#000000' size='2'&gt;"</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">strMRPressure</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">"&lt;/font&gt;&lt;/td&gt;"</span><span class="sc0">
</span><span class="sc7">RC</span><span class="sc0"> </span><span class="sc4">"&lt;/tr&gt;"</span><span class="sc0">

</span><span class="sc7">RC</span><span class="sc0"> </span><span class="sc4">"&lt;/table&gt;"</span><span class="sc0">

</span><span class="sc1">'=============================================================================
' Build a line of controls
'=============================================================================   
</span><span class="sc0">
</span><span class="sc7">RC</span><span class="sc0"> </span><span class="sc4">"&lt;br&gt;"</span><span class="sc0">
</span><span class="sc1">' Note that the GET method invokes the QueryString approach and submits form data in the URL.
</span><span class="sc7">RC</span><span class="sc0"> </span><span class="sc4">"&lt;form method='GET' accept-charset='utf-8' action='rosy.asp' name='ChartingParameters' id='ChartingParameters'&gt;"</span><span class="sc0">

</span><span class="sc1">' Removing the "name" parameter here avoids submitting this with the form.
' Another option is to use "button" instead of "input".
</span><span class="sc0">

</span><span class="sc1">' The submit button.
</span><span class="sc0">
</span><span class="sc1">'RC "&lt;...........................................name='submit_button'&gt;"
</span><span class="sc7">RC</span><span class="sc0"> </span><span class="sc4">"&lt;input type='button' title='Query the database and update the plot.' value='"</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">strButtonLabel</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">"' name='myButton' id='myButton' style='width: 90px' onclick='submitform()'&gt;"</span><span class="sc0">


</span><span class="sc1">' Region
</span><span class="sc0">
</span><span class="sc7">RC</span><span class="sc0"> </span><span class="sc4">"&lt;select title='Region' size='1' name='Region' id='Region' onChange='setRegionState()'&gt;"</span><span class="sc0">
</span><span class="sc7">arrRegions</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">Array</span><span class="sc6">(</span><span class="sc4">"MN"</span><span class="sc6">,</span><span class="sc4">"CR"</span><span class="sc6">,</span><span class="sc4">"Misc"</span><span class="sc6">)</span><span class="sc0">
</span><span class="sc3">For</span><span class="sc0"> </span><span class="sc3">each</span><span class="sc0"> </span><span class="sc7">strRegionValue</span><span class="sc0"> </span><span class="sc3">in</span><span class="sc0"> </span><span class="sc7">arrRegions</span><span class="sc0">
   </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">strRegionValue</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">strRegion</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
      </span><span class="sc7">RC</span><span class="sc0"> </span><span class="sc4">"   &lt;option selected&gt;"</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">strRegionValue</span><span class="sc0">
   </span><span class="sc3">Else</span><span class="sc0">
      </span><span class="sc7">RC</span><span class="sc0"> </span><span class="sc4">"   &lt;option&gt;"</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">strRegionValue</span><span class="sc0">
   </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
</span><span class="sc3">Next</span><span class="sc0">
</span><span class="sc7">RC</span><span class="sc0"> </span><span class="sc4">"&lt;/select&gt;"</span><span class="sc0">

</span><span class="sc1">' A hidden field that serves to indicate whether a new region has been selected. This is needed
' for determining the default location if the region selection changes.
</span><span class="sc7">RC</span><span class="sc0"> </span><span class="sc4">"&lt;input type='hidden' name='Region_state' id= 'Region_state' value='old'&gt;"</span><span class="sc0">


</span><span class="sc1">' Location
</span><span class="sc0">
</span><span class="sc7">strSQL</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"SELECT StationNames.Priority, StationNames.StationName, StationNames.NickName FROM StationNames "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">_</span><span class="sc0">
         </span><span class="sc4">"WHERE (Region='"</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">strRegion</span><span class="sc0">  </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">"') "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">_</span><span class="sc0">
         </span><span class="sc4">"ORDER BY Priority, NickName"</span><span class="sc0">

</span><span class="sc3">Set</span><span class="sc0"> </span><span class="sc7">rstStations</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">Server.CreateObject</span><span class="sc6">(</span><span class="sc4">"ADODB.Recordset"</span><span class="sc6">)</span><span class="sc0">
</span><span class="sc3">On</span><span class="sc0"> </span><span class="sc3">Error</span><span class="sc0"> </span><span class="sc3">Resume</span><span class="sc0"> </span><span class="sc3">Next</span><span class="sc0">
</span><span class="sc7">rstStations.Open</span><span class="sc0"> </span><span class="sc7">strSQL</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">DBConnection</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">adOpenStatic</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">adLockReadOnly</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">adCmdText</span><span class="sc0">
</span><span class="sc7">LogError</span><span class="sc6">(</span><span class="sc4">"Recordset = rstTelem, SQL = "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">strSQL_trace</span><span class="sc6">)</span><span class="sc0">
</span><span class="sc3">On</span><span class="sc0"> </span><span class="sc3">Error</span><span class="sc0"> </span><span class="sc3">Goto</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc7">RC</span><span class="sc0"> </span><span class="sc4">"&lt;select title='Location of weather station' size='1' name='Location' id='Location' onChange='submitform()'&gt;"</span><span class="sc0">
</span><span class="sc7">rstStations.movefirst</span><span class="sc0">
</span><span class="sc3">Do</span><span class="sc0"> </span><span class="sc3">until</span><span class="sc0"> </span><span class="sc7">rstStations.EOF</span><span class="sc0"> 
   </span><span class="sc1">' Exclude inactive stations from the selection list (marked as "skip" in the database).
</span><span class="sc0">   </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">InStr</span><span class="sc6">(</span><span class="sc7">rstStations</span><span class="sc6">(</span><span class="sc4">"Priority"</span><span class="sc6">),</span><span class="sc4">"skip"</span><span class="sc6">)=</span><span class="sc2">0</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
   
      </span><span class="sc1">'Populate the list and set the selected station for the two regions.
</span><span class="sc0">      </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">rstStations</span><span class="sc6">(</span><span class="sc4">"StationName"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0">  </span><span class="sc7">strLocation</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0"> 
         </span><span class="sc7">strNameForPlot</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">rstStations</span><span class="sc6">(</span><span class="sc4">"NickName"</span><span class="sc6">)</span><span class="sc0">
         </span><span class="sc7">RC</span><span class="sc0"> </span><span class="sc4">"   &lt;option value='"</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">rstStations</span><span class="sc6">(</span><span class="sc4">"StationName"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">"' selected&gt;"</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">rstStations</span><span class="sc6">(</span><span class="sc4">"NickName"</span><span class="sc6">)</span><span class="sc0"> 
      </span><span class="sc3">Else</span><span class="sc0">
         </span><span class="sc7">RC</span><span class="sc0"> </span><span class="sc4">"   &lt;option value='"</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">rstStations</span><span class="sc6">(</span><span class="sc4">"StationName"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">"'&gt;"</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">rstStations</span><span class="sc6">(</span><span class="sc4">"NickName"</span><span class="sc6">)</span><span class="sc0">
      </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
   
   </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
   </span><span class="sc7">rstStations.movenext</span><span class="sc0">
</span><span class="sc3">loop</span><span class="sc0">
</span><span class="sc7">RC</span><span class="sc0"> </span><span class="sc4">"&lt;/select&gt;"</span><span class="sc0">

</span><span class="sc3">If</span><span class="sc0"> </span><span class="sc7">rstStations.State</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">adStateOpen</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0"> </span><span class="sc7">rstStations.Close</span><span class="sc0">
</span><span class="sc3">Set</span><span class="sc0"> </span><span class="sc7">rstStations</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc3">Nothing</span><span class="sc0">

</span><span class="sc1">' Click for next location.
</span><span class="sc7">RC</span><span class="sc0"> </span><span class="sc4">"&lt;INPUT  title='Click to step through the list of locations.' type='button' style='WIDTH:18px; HEIGHT:23px; COLOR:black; padding-left:3px;' value='&gt;' id='btnStepLocationForward' name='btnStepLocationForward' onClick='stepLocationForward()'&gt;"</span><span class="sc0">


</span><span class="sc1">' Sensor type
</span><span class="sc0">
</span><span class="sc7">WeatherTypes</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0">     </span><span class="sc7">Array</span><span class="sc6">(</span><span class="sc4">"Wind (0-36)"</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc4">"Wind (0-40)"</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc4">"Temperature"</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc4">"Pressure"</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc4">"Delta-P1"</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc4">"Delta-P2"</span><span class="sc6">)</span><span class="sc0">
</span><span class="sc7">WeatherTypes_URL</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">Array</span><span class="sc6">(</span><span class="sc4">"Wind36"</span><span class="sc6">,</span><span class="sc0">      </span><span class="sc4">"Wind40"</span><span class="sc6">,</span><span class="sc0">      </span><span class="sc4">"Temperature"</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc4">"Pressure"</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc4">"DeltaP1"</span><span class="sc0"> </span><span class="sc6">,</span><span class="sc0"> </span><span class="sc4">"DeltaP2"</span><span class="sc6">)</span><span class="sc0"> 
</span><span class="sc7">WeatherTypes_count</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">UBound</span><span class="sc6">(</span><span class="sc7">WeatherTypes</span><span class="sc6">)</span><span class="sc0">

</span><span class="sc1">' Don't offer the Delta-P plot anywhere but in the Columbia Basin.
</span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">strRegion</span><span class="sc0"> </span><span class="sc6">&lt;&gt;</span><span class="sc0"> </span><span class="sc4">"CR"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">then</span><span class="sc0">
   </span><span class="sc7">WeatherTypes_count</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">WeatherTypes_count</span><span class="sc0"> </span><span class="sc6">-</span><span class="sc0"> </span><span class="sc2">2</span><span class="sc0"> 
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">

</span><span class="sc7">RC</span><span class="sc0"> </span><span class="sc4">"&lt;select title='Sensor type' size='1' name='Sensor' id='Sensor' onChange='submitform()'&gt;"</span><span class="sc0">
</span><span class="sc3">For</span><span class="sc0"> </span><span class="sc7">intJ</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0"> </span><span class="sc3">to</span><span class="sc0"> </span><span class="sc7">WeatherTypes_count</span><span class="sc0"> 
   </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">((</span><span class="sc7">WeatherTypes_URL</span><span class="sc6">(</span><span class="sc7">intJ</span><span class="sc6">)=</span><span class="sc0"> </span><span class="sc7">strSensorType</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">OR</span><span class="sc0"> </span><span class="sc6">((</span><span class="sc7">strSensorType</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">""</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">AND</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">WeatherTypes_URL</span><span class="sc6">(</span><span class="sc7">intJ</span><span class="sc6">)=</span><span class="sc0"> </span><span class="sc4">"Wind40"</span><span class="sc6">)))</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
      </span><span class="sc7">RC</span><span class="sc0"> </span><span class="sc4">"   &lt;option selected value="</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">WeatherTypes_URL</span><span class="sc6">(</span><span class="sc7">intJ</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">" &gt;"</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">WeatherTypes</span><span class="sc6">(</span><span class="sc7">intJ</span><span class="sc6">)</span><span class="sc0">
   </span><span class="sc3">Else</span><span class="sc0">
      </span><span class="sc7">RC</span><span class="sc0"> </span><span class="sc4">"   &lt;option value="</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">WeatherTypes_URL</span><span class="sc6">(</span><span class="sc7">intJ</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">" &gt;"</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">WeatherTypes</span><span class="sc6">(</span><span class="sc7">intJ</span><span class="sc6">)</span><span class="sc0">
   </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
</span><span class="sc3">Next</span><span class="sc0">
</span><span class="sc7">RC</span><span class="sc0"> </span><span class="sc4">"&lt;/select&gt;"</span><span class="sc0">


</span><span class="sc1">' Select the last day.
</span><span class="sc0">
</span><span class="sc7">strSQL</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"SELECT DISTINCT DaysGleaned.TimeMDY FROM DaysGleaned ORDER BY DaysGleaned.TimeMDY DESC"</span><span class="sc0">
  
</span><span class="sc1">' See IIShelp for description of parameters: Open Method (Recordset - ADO).
' The AdCmdText just tells it that it is a SQL string in the first parameter.
' Alternatively you could tell it that the first parameter is a table name...
</span><span class="sc0">
</span><span class="sc3">Set</span><span class="sc0"> </span><span class="sc7">rstDate</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">Server.CreateObject</span><span class="sc6">(</span><span class="sc4">"ADODB.Recordset"</span><span class="sc6">)</span><span class="sc0">
</span><span class="sc3">On</span><span class="sc0"> </span><span class="sc3">Error</span><span class="sc0"> </span><span class="sc3">Resume</span><span class="sc0"> </span><span class="sc3">Next</span><span class="sc0">
</span><span class="sc7">rstDate.Open</span><span class="sc0"> </span><span class="sc7">strSQL</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">DBConnection</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">adOpenStatic</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">adLockReadOnly</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">adCmdText</span><span class="sc0">
</span><span class="sc7">LogError</span><span class="sc6">(</span><span class="sc4">"Recordset = rstTelem, SQL = "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">strSQL_trace</span><span class="sc6">)</span><span class="sc0">
</span><span class="sc3">On</span><span class="sc0"> </span><span class="sc3">Error</span><span class="sc0"> </span><span class="sc3">Goto</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc0">

</span><span class="sc7">RC</span><span class="sc0"> </span><span class="sc4">"&lt;select title='Last day' size='1' name='EndDate' id='EndDate' onChange='submitform()'&gt;"</span><span class="sc0">
</span><span class="sc7">rstDate.movefirst</span><span class="sc0">
</span><span class="sc3">do</span><span class="sc0"> </span><span class="sc3">until</span><span class="sc0"> </span><span class="sc7">rstDate.EOF</span><span class="sc0">
   </span><span class="sc1">' Coerce the date object to a string by using the (&amp; "")
</span><span class="sc0">   </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">((</span><span class="sc7">dtePostedDate</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">rstDate</span><span class="sc6">(</span><span class="sc4">"TimeMDY"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">""</span><span class="sc6">))</span><span class="sc0"> </span><span class="sc3">OR</span><span class="sc0"> </span><span class="sc6">((</span><span class="sc7">dtePostedDate</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">""</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">AND</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">rstDate</span><span class="sc6">(</span><span class="sc4">"TimeMDY"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc3">Date</span><span class="sc6">())))</span><span class="sc0"> </span><span class="sc3">then</span><span class="sc0">
      </span><span class="sc7">RC</span><span class="sc0"> </span><span class="sc4">"   &lt;option selected&gt;"</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">rstDate</span><span class="sc6">(</span><span class="sc4">"TimeMDY"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">" "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">weekdayname</span><span class="sc6">(</span><span class="sc7">weekday</span><span class="sc6">(</span><span class="sc7">rstDate</span><span class="sc6">(</span><span class="sc4">"TimeMDY"</span><span class="sc6">)),</span><span class="sc3">True</span><span class="sc6">)</span><span class="sc0">
   </span><span class="sc3">Else</span><span class="sc0">
      </span><span class="sc7">RC</span><span class="sc0"> </span><span class="sc4">"   &lt;option&gt;"</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">rstDate</span><span class="sc6">(</span><span class="sc4">"TimeMDY"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">" "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">weekdayname</span><span class="sc6">(</span><span class="sc7">weekday</span><span class="sc6">(</span><span class="sc7">rstDate</span><span class="sc6">(</span><span class="sc4">"TimeMDY"</span><span class="sc6">)),</span><span class="sc3">True</span><span class="sc6">)</span><span class="sc0">
   </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">  
   </span><span class="sc7">rstDate.movenext</span><span class="sc0">
</span><span class="sc3">loop</span><span class="sc0">
</span><span class="sc7">RC</span><span class="sc0"> </span><span class="sc4">"&lt;/select&gt;"</span><span class="sc0">

</span><span class="sc3">If</span><span class="sc0"> </span><span class="sc7">rstDate.State</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">adStateOpen</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0"> </span><span class="sc7">rstDate.Close</span><span class="sc0">
</span><span class="sc3">Set</span><span class="sc0"> </span><span class="sc7">rstDate</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc3">Nothing</span><span class="sc0">


</span><span class="sc1">' Select the time range.
</span><span class="sc0">  
</span><span class="sc7">RC</span><span class="sc0"> </span><span class="sc4">"&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;font color='#008080'&gt;Days:&lt;/font&gt;"</span><span class="sc0">

</span><span class="sc7">RC</span><span class="sc0"> </span><span class="sc4">"&lt;select title='Time range' size='1' name='Days' id='Days' onChange='submitform()'&gt;"</span><span class="sc0">
</span><span class="sc7">DaysChoices</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">Array</span><span class="sc6">(</span><span class="sc4">"1"</span><span class="sc6">,</span><span class="sc4">"2"</span><span class="sc6">,</span><span class="sc4">"3"</span><span class="sc6">,</span><span class="sc4">"4"</span><span class="sc6">,</span><span class="sc4">"5"</span><span class="sc6">,</span><span class="sc4">"6"</span><span class="sc6">,</span><span class="sc4">"7"</span><span class="sc6">,</span><span class="sc4">"8"</span><span class="sc6">,</span><span class="sc4">"9"</span><span class="sc6">,</span><span class="sc4">"10"</span><span class="sc6">,</span><span class="sc4">"14"</span><span class="sc6">,</span><span class="sc4">"25"</span><span class="sc6">)</span><span class="sc0">
</span><span class="sc3">For</span><span class="sc0"> </span><span class="sc3">each</span><span class="sc0"> </span><span class="sc7">DayValue</span><span class="sc0"> </span><span class="sc3">in</span><span class="sc0"> </span><span class="sc7">DaysChoices</span><span class="sc0">
   </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">DayValue</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">intDays</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
      </span><span class="sc7">RC</span><span class="sc0"> </span><span class="sc4">"   &lt;option selected&gt;"</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">DayValue</span><span class="sc0">
   </span><span class="sc3">Else</span><span class="sc0">
      </span><span class="sc7">RC</span><span class="sc0"> </span><span class="sc4">"   &lt;option&gt;"</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">DayValue</span><span class="sc0">
   </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
</span><span class="sc3">Next</span><span class="sc0">
</span><span class="sc7">RC</span><span class="sc0"> </span><span class="sc4">"&lt;/select&gt;"</span><span class="sc0">


</span><span class="sc1">' Time steppers
</span><span class="sc0">
</span><span class="sc7">RC</span><span class="sc0"> </span><span class="sc4">"&lt;INPUT title='Click to step back in time.' type='button' style='WIDTH: 18px; HEIGHT: 23px; COLOR: black; padding-left:3px;' value='&lt;' id='btnStepBack' name='btnStepBack' onClick='stepBack()'&gt;"</span><span class="sc0">
</span><span class="sc7">RC</span><span class="sc0"> </span><span class="sc4">"&lt;INPUT title='Click to step forward in time.' type='button' style='WIDTH: 18px; HEIGHT: 23px; COLOR: black; padding-left:3px;' value='&gt;' id='btnStepForward' name='btnStepForward' onClick='stepForward()'&gt;"</span><span class="sc0">


</span><span class="sc1">' The 24-Hour charting option.
</span><span class="sc7">RC</span><span class="sc0"> </span><span class="sc4">"&amp;nbsp;&amp;nbsp;"</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">_</span><span class="sc0">
   </span><span class="sc4">"&lt;input "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">str24Hrs_state</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">" type='checkbox' name='chk24Hrs' "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">_</span><span class="sc0">
   </span><span class="sc4">"title='Select to display 24 hours of the most recent data (including data from yesterday) on the 1-day chart. "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">_</span><span class="sc0">
   </span><span class="sc4">"Please refer to the FAQ on the ""24h"" checkbox.' "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">_</span><span class="sc0">
   </span><span class="sc4">"onClick='submitform()'/&gt;"</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">_</span><span class="sc0">
   </span><span class="sc4">"&lt;font size='2' color='#008080'&gt;24h&lt;/font&gt;"</span><span class="sc0">
   
</span><span class="sc1">' The Running-average option
</span><span class="sc7">RW</span><span class="sc0"> </span><span class="sc4">""</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">_</span><span class="sc0">
   </span><span class="sc4">"&lt;input "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">strRA_state</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">" type='checkbox' name='chkRA' "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">_</span><span class="sc0">
   </span><span class="sc4">"title='Select to apply a running average to all the data.' "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">_</span><span class="sc0">
   </span><span class="sc4">"onClick='submitform()'/&gt;"</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">_</span><span class="sc0">
   </span><span class="sc4">"&lt;font size='2' color='#008080'&gt;RA&lt;/font&gt;"</span><span class="sc0">
   
</span><span class="sc1">' The timer for auto-plots
</span><span class="sc7">RW</span><span class="sc0"> </span><span class="sc4">"&amp;nbsp;"</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">_</span><span class="sc0">
   </span><span class="sc4">"&lt;input "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">strTimer_state</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">" type='checkbox' name='chkTimer' "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">_</span><span class="sc0">
   </span><span class="sc4">"title='Select to enable a repeating 5-minute countdown timer. This is synchronized with the server to trigger a chart update immediately after "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">_</span><span class="sc0">
   </span><span class="sc4">"the database has been updated.' "</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">_</span><span class="sc0">
   </span><span class="sc4">"onClick='submitform()'/&gt;"</span><span class="sc0">

</span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">strTimer_state</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"checked"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
   </span><span class="sc1">' The space in the span is needed for an initial value. The client-sided JavaScript changes this value
</span><span class="sc0">   </span><span class="sc1">' every second.
</span><span class="sc0">   </span><span class="sc7">strTimer_value</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">" "</span><span class="sc0">
</span><span class="sc3">Else</span><span class="sc0">
   </span><span class="sc7">strTimer_value</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"Timer"</span><span class="sc0">
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
</span><span class="sc7">RW</span><span class="sc0"> </span><span class="sc4">"&lt;span id='spTimerSec' name='spTimerSec' style='color:#008080; font-size:10pt;'&gt;"</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc7">strTimer_value</span><span class="sc0"> </span><span class="sc6">&amp;</span><span class="sc0"> </span><span class="sc4">"&lt;/span&gt;"</span><span class="sc0">


</span><span class="sc1">' A hidden field that serves to test if the client has JavaScript enabled. Some script will
' try to change this value from F to T.
</span><span class="sc7">RC</span><span class="sc0"> </span><span class="sc4">"&lt;input type='hidden' name='jS' id='jS' value='F'&gt;"</span><span class="sc0">

</span><span class="sc7">RC</span><span class="sc0"> </span><span class="sc4">"&lt;/form&gt;"</span><span class="sc0">

</span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">Request.QueryString</span><span class="sc6">(</span><span class="sc4">"jS"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc4">"F"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
   </span><span class="sc7">RBC</span><span class="sc0"> </span><span class="sc4">"JavaScript is needed to use the charting controls and view a chart image."</span><span class="sc0">
   </span><span class="sc7">RBC</span><span class="sc0"> </span><span class="sc4">""</span><span class="sc0">
   </span><span class="sc7">RBC</span><span class="sc0"> </span><span class="sc4">"Please enable JavaScript in your web browser. If you enable JavaScript, this warning"</span><span class="sc0">
   </span><span class="sc7">RBC</span><span class="sc0"> </span><span class="sc4">"will clear after your second click of the press-to-chart button."</span><span class="sc0">
   </span><span class="sc7">RBC</span><span class="sc0"> </span><span class="sc4">""</span><span class="sc0">
   </span><span class="sc7">RBC</span><span class="sc0"> </span><span class="sc4">"Note that requesting a chart update before the previous chart has completed is another"</span><span class="sc0">
   </span><span class="sc7">RBC</span><span class="sc0"> </span><span class="sc4">"possible cause for this error message. Please wait until the image returns from the"</span><span class="sc0">
   </span><span class="sc7">RBC</span><span class="sc0"> </span><span class="sc4">"server."</span><span class="sc0">
</span><span class="sc3">Else</span><span class="sc0">
   </span><span class="sc1">'=================================================================================
</span><span class="sc0">   </span><span class="sc1">' PLOT THE CHART...
</span><span class="sc0">   </span><span class="sc1">'
</span><span class="sc0">   </span><span class="sc1">' If the region has been specified in the query, then plot the chart.
</span><span class="sc0">   </span><span class="sc1">'
</span><span class="sc0">   </span><span class="sc1">'=================================================================================
</span><span class="sc0">   </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">Request.QueryString</span><span class="sc6">(</span><span class="sc4">"Region"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc6">&lt;&gt;</span><span class="sc0"> </span><span class="sc4">""</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
      
      </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">strMRTime</span><span class="sc0"> </span><span class="sc6">&lt;&gt;</span><span class="sc0"> </span><span class="sc4">"-"</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
         </span><span class="sc7">FetchTheData</span><span class="sc0">

         </span><span class="sc1">' Close the database connection
</span><span class="sc0">         </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc7">IsObject</span><span class="sc6">(</span><span class="sc7">DBConnection</span><span class="sc6">)</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
            </span><span class="sc3">If</span><span class="sc0"> </span><span class="sc7">DBConnection.State</span><span class="sc0"> </span><span class="sc6">&lt;&gt;</span><span class="sc0"> </span><span class="sc7">adStateClosed</span><span class="sc0"> </span><span class="sc3">Then</span><span class="sc0">
               </span><span class="sc7">DBConnection.Close</span><span class="sc0">
            </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
            </span><span class="sc3">Set</span><span class="sc0"> </span><span class="sc7">DBConnection</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc3">Nothing</span><span class="sc0">
         </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">

         </span><span class="sc7">PlotTheChart</span><span class="sc0">

      </span><span class="sc3">Else</span><span class="sc0">
         </span><span class="sc7">RWBR</span><span class="sc0"> </span><span class="sc4">"No data available for the selected station."</span><span class="sc0">
      </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">

   </span><span class="sc3">Else</span><span class="sc0">
      </span><span class="sc7">RWBR</span><span class="sc0"> </span><span class="sc4">""</span><span class="sc0">
      </span><span class="sc7">RWBR</span><span class="sc0"> </span><span class="sc4">"Specifiy a region and then click the chart button."</span><span class="sc0">
   </span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">
</span><span class="sc3">End</span><span class="sc0"> </span><span class="sc3">If</span><span class="sc0">

</span><span class="sc6">%&gt;</span><span class="sc0">

</span><span class="sc6">&lt;!--</span><span class="sc0">  </span><span class="sc7">Client</span><span class="sc0"> </span><span class="sc7">side</span><span class="sc0"> </span><span class="sc7">script</span><span class="sc0"> </span><span class="sc6">--&gt;</span><span class="sc0">

</span><span class="sc6">&lt;</span><span class="sc7">SCRIPT</span><span class="sc0"> </span><span class="sc7">LANGUAGE</span><span class="sc6">=</span><span class="sc4">"javascript"</span><span class="sc6">&gt;</span><span class="sc0">
</span><span class="sc6">&lt;!--</span><span class="sc0">

</span><span class="sc6">//</span><span class="sc0"> </span><span class="sc7">Globals</span><span class="sc0">

</span><span class="sc7">var</span><span class="sc0"> </span><span class="sc7">cP</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">document.getElementById</span><span class="sc6">(</span><span class="sc1">'ChartingParameters');
</span><span class="sc0">
</span><span class="sc7">var</span><span class="sc0"> </span><span class="sc7">cmbEndDate</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">document.getElementById</span><span class="sc6">(</span><span class="sc1">'EndDate');
</span><span class="sc7">var</span><span class="sc0"> </span><span class="sc7">cmbDays</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">document.getElementById</span><span class="sc6">(</span><span class="sc1">'Days');
</span><span class="sc7">var</span><span class="sc0"> </span><span class="sc7">cmbLocation</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">document.getElementById</span><span class="sc6">(</span><span class="sc1">'Location');
</span><span class="sc0">
</span><span class="sc7">var</span><span class="sc0"> </span><span class="sc7">stepIncrement</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">cmbDays.options[cmbDays.selectedIndex]</span><span class="sc6">.</span><span class="sc3">text</span><span class="sc6">;</span><span class="sc0">

</span><span class="sc3">function</span><span class="sc0"> </span><span class="sc7">testJS</span><span class="sc6">(){</span><span class="sc0">
   </span><span class="sc7">document.getElementById</span><span class="sc6">(</span><span class="sc1">'jS').value = 'T';
</span><span class="sc6">}</span><span class="sc0">

</span><span class="sc3">function</span><span class="sc0"> </span><span class="sc7">showDirections</span><span class="sc6">(){</span><span class="sc0">
   </span><span class="sc3">try</span><span class="sc0"> </span><span class="sc6">{</span><span class="sc0">
      </span><span class="sc7">var</span><span class="sc0"> </span><span class="sc7">imgDirections</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">document.getElementById</span><span class="sc6">(</span><span class="sc1">'directions');
</span><span class="sc0">      </span><span class="sc7">imgDirections.style.visibility</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc1">'visible';
</span><span class="sc0">   </span><span class="sc6">}</span><span class="sc0">
   </span><span class="sc3">catch</span><span class="sc6">(</span><span class="sc7">e</span><span class="sc6">){}</span><span class="sc0">
</span><span class="sc6">}</span><span class="sc0">

</span><span class="sc3">function</span><span class="sc0"> </span><span class="sc7">showImage</span><span class="sc6">(){</span><span class="sc0">
   </span><span class="sc3">try</span><span class="sc0"> </span><span class="sc6">{</span><span class="sc0">
      </span><span class="sc7">var</span><span class="sc0"> </span><span class="sc7">imgChartImage</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">document.getElementById</span><span class="sc6">(</span><span class="sc1">'chartimage');
</span><span class="sc0">      </span><span class="sc7">imgChartImage.style.visibility</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc1">'visible';
</span><span class="sc0">   </span><span class="sc6">}</span><span class="sc0">
   </span><span class="sc3">catch</span><span class="sc6">(</span><span class="sc7">e</span><span class="sc6">){}</span><span class="sc0">
</span><span class="sc6">}</span><span class="sc0">

</span><span class="sc3">function</span><span class="sc0"> </span><span class="sc7">changeColorSubmitButton</span><span class="sc6">(){</span><span class="sc0">
   </span><span class="sc7">document.getElementById</span><span class="sc6">(</span><span class="sc1">'myButton').style.color='red';
</span><span class="sc6">}</span><span class="sc0">

</span><span class="sc3">function</span><span class="sc0"> </span><span class="sc7">submitform</span><span class="sc6">(){</span><span class="sc0">
   </span><span class="sc6">//</span><span class="sc7">document.getElementById</span><span class="sc6">(</span><span class="sc1">'Sensor').style.backgroundColor='#FFE4C4';
</span><span class="sc0">   </span><span class="sc7">document.getElementById</span><span class="sc6">(</span><span class="sc1">'myButton').value = 'Please Wait';
</span><span class="sc0">   </span><span class="sc7">cP.submit</span><span class="sc6">();</span><span class="sc0">
</span><span class="sc6">}</span><span class="sc0">

</span><span class="sc3">function</span><span class="sc0"> </span><span class="sc7">stepLocationForward</span><span class="sc6">(){</span><span class="sc0">
   </span><span class="sc7">var</span><span class="sc0"> </span><span class="sc7">targetIndex</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">cmbLocation.selectedIndex</span><span class="sc6">;</span><span class="sc0">
   </span><span class="sc3">if</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">targetIndex</span><span class="sc0"> </span><span class="sc6">&lt;</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">cmbLocation.length</span><span class="sc0"> </span><span class="sc6">-</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc6">)){</span><span class="sc0">
      </span><span class="sc7">cmbLocation.selectedIndex</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">targetIndex</span><span class="sc0"> </span><span class="sc6">+</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc6">;</span><span class="sc0">
   </span><span class="sc6">}</span><span class="sc0"> </span><span class="sc3">else</span><span class="sc0"> </span><span class="sc6">{</span><span class="sc0">
      </span><span class="sc7">cmbLocation.selectedIndex</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc6">;</span><span class="sc0">
   </span><span class="sc6">}</span><span class="sc0">
   </span><span class="sc7">submitform</span><span class="sc6">();</span><span class="sc0">
</span><span class="sc6">}</span><span class="sc0">

</span><span class="sc3">function</span><span class="sc0"> </span><span class="sc7">stepBack</span><span class="sc6">(){</span><span class="sc0">
   </span><span class="sc7">var</span><span class="sc0"> </span><span class="sc7">targetIndex</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">cmbEndDate.selectedIndex</span><span class="sc0"> </span><span class="sc6">+</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">stepIncrement</span><span class="sc0"> </span><span class="sc6">*</span><span class="sc0"> </span><span class="sc2">1.0</span><span class="sc6">);</span><span class="sc0">
   </span><span class="sc3">if</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">targetIndex</span><span class="sc0"> </span><span class="sc6">&gt;</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">cmbEndDate.length</span><span class="sc0"> </span><span class="sc6">-</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc6">)){</span><span class="sc0">
      </span><span class="sc7">cmbEndDate.selectedIndex</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">cmbEndDate.selectedIndex</span><span class="sc6">;</span><span class="sc0">
   </span><span class="sc6">}</span><span class="sc0"> </span><span class="sc3">else</span><span class="sc0"> </span><span class="sc6">{</span><span class="sc0">
      </span><span class="sc7">cmbEndDate.selectedIndex</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">targetIndex</span><span class="sc6">;</span><span class="sc0">
   </span><span class="sc6">}</span><span class="sc0">
   </span><span class="sc7">submitform</span><span class="sc6">();</span><span class="sc0">   
</span><span class="sc6">}</span><span class="sc0">

</span><span class="sc3">function</span><span class="sc0"> </span><span class="sc7">stepForward</span><span class="sc6">(){</span><span class="sc0">
   </span><span class="sc7">var</span><span class="sc0"> </span><span class="sc7">targetIndex</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">cmbEndDate.selectedIndex</span><span class="sc0"> </span><span class="sc6">-</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">stepIncrement</span><span class="sc0"> </span><span class="sc6">*</span><span class="sc0"> </span><span class="sc2">1.0</span><span class="sc6">);</span><span class="sc0">
   </span><span class="sc3">if</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">targetIndex</span><span class="sc0"> </span><span class="sc6">&lt;</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc6">){</span><span class="sc0">
      </span><span class="sc7">cmbEndDate.selectedIndex</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc6">;</span><span class="sc0">
   </span><span class="sc6">}</span><span class="sc0"> </span><span class="sc3">else</span><span class="sc0"> </span><span class="sc6">{</span><span class="sc0">
      </span><span class="sc7">cmbEndDate.selectedIndex</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">targetIndex</span><span class="sc6">;</span><span class="sc0">
   </span><span class="sc6">}</span><span class="sc0">
   </span><span class="sc7">submitform</span><span class="sc6">();</span><span class="sc0">   
</span><span class="sc6">}</span><span class="sc0">

</span><span class="sc6">//</span><span class="sc0"> </span><span class="sc7">Timer</span><span class="sc0"> </span><span class="sc7">functions</span><span class="sc0">

</span><span class="sc7">var</span><span class="sc0"> </span><span class="sc7">secs</span><span class="sc6">;</span><span class="sc0">
</span><span class="sc7">var</span><span class="sc0"> </span><span class="sc7">timerID</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">null</span><span class="sc6">;</span><span class="sc0">
</span><span class="sc7">var</span><span class="sc0"> </span><span class="sc7">timerRunning</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc3">false</span><span class="sc6">;</span><span class="sc0">
</span><span class="sc7">var</span><span class="sc0"> </span><span class="sc7">delay</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">1000</span><span class="sc6">;</span><span class="sc0">

</span><span class="sc3">function</span><span class="sc0"> </span><span class="sc7">initializeTimer</span><span class="sc6">(</span><span class="sc7">secsFromChart</span><span class="sc6">){</span><span class="sc0">

   </span><span class="sc6">//</span><span class="sc0"> </span><span class="sc3">Set</span><span class="sc0"> </span><span class="sc7">the</span><span class="sc0"> </span><span class="sc7">length</span><span class="sc0"> </span><span class="sc3">of</span><span class="sc0"> </span><span class="sc7">the</span><span class="sc0"> </span><span class="sc7">timer</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc3">in</span><span class="sc0"> </span><span class="sc7">seconds</span><span class="sc0">
   </span><span class="sc3">if</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">secsFromChart</span><span class="sc0"> </span><span class="sc6">==</span><span class="sc0"> </span><span class="sc7">null</span><span class="sc6">){</span><span class="sc0">
      </span><span class="sc3">if</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">timerRunning</span><span class="sc6">){</span><span class="sc0">
         </span><span class="sc7">secs</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">secs</span><span class="sc0"> </span><span class="sc6">-</span><span class="sc0"> </span><span class="sc2">5</span><span class="sc6">;</span><span class="sc0">
         </span><span class="sc3">if</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">secs</span><span class="sc0"> </span><span class="sc6">&lt;</span><span class="sc0"> </span><span class="sc2">0</span><span class="sc6">){</span><span class="sc0"> 
            </span><span class="sc7">secs</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">3</span><span class="sc6">;</span><span class="sc0">
         </span><span class="sc6">}</span><span class="sc0">
      </span><span class="sc6">}</span><span class="sc3">else</span><span class="sc6">{</span><span class="sc0">
         </span><span class="sc3">if</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">secs</span><span class="sc0"> </span><span class="sc6">==</span><span class="sc0"> </span><span class="sc7">null</span><span class="sc6">){</span><span class="sc0">
            </span><span class="sc7">secs</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc2">298</span><span class="sc6">;</span><span class="sc0">
         </span><span class="sc6">}</span><span class="sc0">
      </span><span class="sc6">}</span><span class="sc0">
   </span><span class="sc6">}</span><span class="sc3">else</span><span class="sc6">{</span><span class="sc0">
      </span><span class="sc7">secs</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">secsFromChart</span><span class="sc6">;</span><span class="sc0">   
   </span><span class="sc6">}</span><span class="sc0">
    
   </span><span class="sc7">stopTheTimer</span><span class="sc6">();</span><span class="sc0">
   </span><span class="sc7">startTheTimer</span><span class="sc6">();</span><span class="sc0">
</span><span class="sc6">}</span><span class="sc0">

</span><span class="sc3">function</span><span class="sc0"> </span><span class="sc7">stopTheTimer</span><span class="sc6">(){</span><span class="sc0">

   </span><span class="sc3">if</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">timerRunning</span><span class="sc6">){</span><span class="sc0">
      </span><span class="sc7">clearTimeout</span><span class="sc6">(</span><span class="sc7">timerID</span><span class="sc6">);</span><span class="sc0">
      </span><span class="sc7">timerRunning</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc3">false</span><span class="sc6">;</span><span class="sc0"> 
      </span><span class="sc6">//</span><span class="sc0"> </span><span class="sc7">This</span><span class="sc0"> </span><span class="sc7">color</span><span class="sc0"> </span><span class="sc7">change</span><span class="sc0"> </span><span class="sc7">was</span><span class="sc0"> </span><span class="sc7">used</span><span class="sc0"> </span><span class="sc3">when</span><span class="sc0"> </span><span class="sc7">there</span><span class="sc0"> </span><span class="sc7">was</span><span class="sc0"> </span><span class="sc7">a</span><span class="sc0"> </span><span class="sc7">pause</span><span class="sc0"> </span><span class="sc7">mode.</span><span class="sc0">
      </span><span class="sc6">//</span><span class="sc7">document.getElementById</span><span class="sc6">(</span><span class="sc1">'spTimerSec').style.color = 'red';
</span><span class="sc0">   </span><span class="sc6">}</span><span class="sc0">
</span><span class="sc6">}</span><span class="sc0">

</span><span class="sc3">function</span><span class="sc0"> </span><span class="sc7">startTheTimer</span><span class="sc6">(){</span><span class="sc0">
   </span><span class="sc6">//</span><span class="sc0"> </span><span class="sc7">Reset</span><span class="sc0"> </span><span class="sc7">the</span><span class="sc0"> </span><span class="sc7">color</span><span class="sc0"> </span><span class="sc7">back</span><span class="sc0"> </span><span class="sc3">to</span><span class="sc0"> </span><span class="sc7">normal.</span><span class="sc0">
   </span><span class="sc6">//</span><span class="sc7">document.getElementById</span><span class="sc6">(</span><span class="sc1">'spTimerSec').style.color = '#008080';
</span><span class="sc0">
   </span><span class="sc3">if</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">secs</span><span class="sc6">==</span><span class="sc2">0</span><span class="sc6">){</span><span class="sc0">
      </span><span class="sc6">//</span><span class="sc0"> </span><span class="sc7">Here</span><span class="sc1">'s where you put something useful that's
</span><span class="sc0">      </span><span class="sc6">//</span><span class="sc0"> </span><span class="sc7">executes</span><span class="sc0"> </span><span class="sc7">after</span><span class="sc0"> </span><span class="sc7">the</span><span class="sc0"> </span><span class="sc7">allotted</span><span class="sc0"> </span><span class="sc7">time.</span><span class="sc0">
      </span><span class="sc7">submitform</span><span class="sc6">();</span><span class="sc0">
    
   </span><span class="sc6">}</span><span class="sc3">else</span><span class="sc6">{</span><span class="sc0">
      </span><span class="sc7">self.status</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">secs</span><span class="sc6">;</span><span class="sc0">
      </span><span class="sc3">if</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">secs</span><span class="sc0"> </span><span class="sc6">&lt;</span><span class="sc0"> </span><span class="sc2">10</span><span class="sc6">){</span><span class="sc0">
         </span><span class="sc7">secs</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc1">' ' + secs;
</span><span class="sc0">      </span><span class="sc6">}</span><span class="sc0">
      </span><span class="sc7">document.getElementById</span><span class="sc6">(</span><span class="sc1">'spTimerSec').firstChild.nodeValue = '' + secs + 's.';
</span><span class="sc0">      </span><span class="sc7">secs</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">secs</span><span class="sc0"> </span><span class="sc6">-</span><span class="sc0"> </span><span class="sc2">1</span><span class="sc6">;</span><span class="sc0">

      </span><span class="sc7">timerRunning</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc3">true</span><span class="sc6">;</span><span class="sc0">
      </span><span class="sc7">timerID</span><span class="sc0"> </span><span class="sc6">=</span><span class="sc0"> </span><span class="sc7">self.setTimeout</span><span class="sc6">(</span><span class="sc4">"startTheTimer()"</span><span class="sc6">,</span><span class="sc0"> </span><span class="sc7">delay</span><span class="sc6">);</span><span class="sc0">
   </span><span class="sc6">}</span><span class="sc0">
</span><span class="sc6">}</span><span class="sc0">

</span><span class="sc3">function</span><span class="sc0"> </span><span class="sc7">changeRegionAnchorValue</span><span class="sc6">(</span><span class="sc0"> </span><span class="sc7">theInputString</span><span class="sc6">){</span><span class="sc0">
   </span><span class="sc3">if</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">theInputString</span><span class="sc6">==</span><span class="sc1">'MN') {
</span><span class="sc0">      </span><span class="sc7">document.getElementById</span><span class="sc6">(</span><span class="sc1">'regionanchor').firstChild.nodeValue = 'Columbia Basin Weather';
</span><span class="sc0">   </span><span class="sc6">}</span><span class="sc0"> </span><span class="sc3">else</span><span class="sc0"> </span><span class="sc3">if</span><span class="sc0"> </span><span class="sc6">(</span><span class="sc7">theInputString</span><span class="sc6">==</span><span class="sc1">'CR') {
</span><span class="sc0">      </span><span class="sc7">document.getElementById</span><span class="sc6">(</span><span class="sc1">'regionanchor').firstChild.nodeValue = 'Minnesota Weather';
</span><span class="sc0">   </span><span class="sc6">}</span><span class="sc0"> </span><span class="sc3">else</span><span class="sc0"> </span><span class="sc6">{</span><span class="sc0">
      </span><span class="sc7">document.getElementById</span><span class="sc6">(</span><span class="sc1">'regionanchor').firstChild.nodeValue = theInputString;
</span><span class="sc0">   </span><span class="sc6">}</span><span class="sc0">
</span><span class="sc6">}</span><span class="sc0">

</span><span class="sc3">function</span><span class="sc0"> </span><span class="sc7">setRegionState</span><span class="sc6">(){</span><span class="sc0">
   </span><span class="sc7">document.getElementById</span><span class="sc6">(</span><span class="sc1">'Region_state').value = 'new';
</span><span class="sc0">   </span><span class="sc7">submitform</span><span class="sc6">();</span><span class="sc0"> 
</span><span class="sc6">}</span><span class="sc0">

</span><span class="sc6">//--&gt;</span><span class="sc0">
</span><span class="sc6">&lt;/</span><span class="sc7">SCRIPT</span><span class="sc6">&gt;</span><span class="sc0">
</span><span class="sc6">&lt;/</span><span class="sc7">div</span><span class="sc6">&gt;</span><span class="sc0">
</span><span class="sc6">&lt;/</span><span class="sc7">body</span><span class="sc6">&gt;</span><span class="sc0">
</span><span class="sc6">&lt;/</span><span class="sc7">html</span><span class="sc6">&gt;</span></div></body>
</html>
