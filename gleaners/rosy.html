<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">
<!--
generated by Pygments <https://pygments.org/>
Copyright 2006-2024 by the Pygments team.
Licensed under the BSD license, see LICENSE for details.
-->
<html>
<head>
  <link rel='canonical' href='https://waconia.triquence.org/gleaners/rosy.html' />
  <title>rosy</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <style type="text/css">
/*
generated by Pygments <https://pygments.org/>
Copyright 2006-2024 by the Pygments team.
Licensed under the BSD license, see LICENSE for details.
*/
pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
body .hll { background-color: #49483e }
body { background: #272822; color: #f8f8f2 }
body .c { color: #959077 } /* Comment */
body .err { color: #ed007e; background-color: #1e0010 } /* Error */
body .esc { color: #f8f8f2 } /* Escape */
body .g { color: #f8f8f2 } /* Generic */
body .k { color: #66d9ef } /* Keyword */
body .l { color: #ae81ff } /* Literal */
body .n { color: #f8f8f2 } /* Name */
body .o { color: #ff4689 } /* Operator */
body .x { color: #f8f8f2 } /* Other */
body .p { color: #f8f8f2 } /* Punctuation */
body .ch { color: #959077 } /* Comment.Hashbang */
body .cm { color: #959077 } /* Comment.Multiline */
body .cp { color: #959077 } /* Comment.Preproc */
body .cpf { color: #959077 } /* Comment.PreprocFile */
body .c1 { color: #959077 } /* Comment.Single */
body .cs { color: #959077 } /* Comment.Special */
body .gd { color: #ff4689 } /* Generic.Deleted */
body .ge { color: #f8f8f2; font-style: italic } /* Generic.Emph */
body .ges { color: #f8f8f2; font-weight: bold; font-style: italic } /* Generic.EmphStrong */
body .gr { color: #f8f8f2 } /* Generic.Error */
body .gh { color: #f8f8f2 } /* Generic.Heading */
body .gi { color: #a6e22e } /* Generic.Inserted */
body .go { color: #66d9ef } /* Generic.Output */
body .gp { color: #ff4689; font-weight: bold } /* Generic.Prompt */
body .gs { color: #f8f8f2; font-weight: bold } /* Generic.Strong */
body .gu { color: #959077 } /* Generic.Subheading */
body .gt { color: #f8f8f2 } /* Generic.Traceback */
body .kc { color: #66d9ef } /* Keyword.Constant */
body .kd { color: #66d9ef } /* Keyword.Declaration */
body .kn { color: #ff4689 } /* Keyword.Namespace */
body .kp { color: #66d9ef } /* Keyword.Pseudo */
body .kr { color: #66d9ef } /* Keyword.Reserved */
body .kt { color: #66d9ef } /* Keyword.Type */
body .ld { color: #e6db74 } /* Literal.Date */
body .m { color: #ae81ff } /* Literal.Number */
body .s { color: #e6db74 } /* Literal.String */
body .na { color: #a6e22e } /* Name.Attribute */
body .nb { color: #f8f8f2 } /* Name.Builtin */
body .nc { color: #a6e22e } /* Name.Class */
body .no { color: #66d9ef } /* Name.Constant */
body .nd { color: #a6e22e } /* Name.Decorator */
body .ni { color: #f8f8f2 } /* Name.Entity */
body .ne { color: #a6e22e } /* Name.Exception */
body .nf { color: #a6e22e } /* Name.Function */
body .nl { color: #f8f8f2 } /* Name.Label */
body .nn { color: #f8f8f2 } /* Name.Namespace */
body .nx { color: #a6e22e } /* Name.Other */
body .py { color: #f8f8f2 } /* Name.Property */
body .nt { color: #ff4689 } /* Name.Tag */
body .nv { color: #f8f8f2 } /* Name.Variable */
body .ow { color: #ff4689 } /* Operator.Word */
body .pm { color: #f8f8f2 } /* Punctuation.Marker */
body .w { color: #f8f8f2 } /* Text.Whitespace */
body .mb { color: #ae81ff } /* Literal.Number.Bin */
body .mf { color: #ae81ff } /* Literal.Number.Float */
body .mh { color: #ae81ff } /* Literal.Number.Hex */
body .mi { color: #ae81ff } /* Literal.Number.Integer */
body .mo { color: #ae81ff } /* Literal.Number.Oct */
body .sa { color: #e6db74 } /* Literal.String.Affix */
body .sb { color: #e6db74 } /* Literal.String.Backtick */
body .sc { color: #e6db74 } /* Literal.String.Char */
body .dl { color: #e6db74 } /* Literal.String.Delimiter */
body .sd { color: #e6db74 } /* Literal.String.Doc */
body .s2 { color: #e6db74 } /* Literal.String.Double */
body .se { color: #ae81ff } /* Literal.String.Escape */
body .sh { color: #e6db74 } /* Literal.String.Heredoc */
body .si { color: #e6db74 } /* Literal.String.Interpol */
body .sx { color: #e6db74 } /* Literal.String.Other */
body .sr { color: #e6db74 } /* Literal.String.Regex */
body .s1 { color: #e6db74 } /* Literal.String.Single */
body .ss { color: #e6db74 } /* Literal.String.Symbol */
body .bp { color: #f8f8f2 } /* Name.Builtin.Pseudo */
body .fm { color: #a6e22e } /* Name.Function.Magic */
body .vc { color: #f8f8f2 } /* Name.Variable.Class */
body .vg { color: #f8f8f2 } /* Name.Variable.Global */
body .vi { color: #f8f8f2 } /* Name.Variable.Instance */
body .vm { color: #f8f8f2 } /* Name.Variable.Magic */
body .il { color: #ae81ff } /* Literal.Number.Integer.Long */

  </style>
</head>
<body>
<h2></h2>

<div class="highlight"><pre><span></span><span class="o">&lt;%</span><span class="err">@</span><span class="w"> </span><span class="nx">Language</span><span class="o">=</span><span class="nx">VBScript</span><span class="w"> </span><span class="o">%&gt;</span>

<span class="o">&lt;%</span><span class="w"> </span>
<span class="nx">Option</span><span class="w"> </span><span class="nx">Explicit</span>

<span class="s1">&#39; Author: James D. (Jim) Miller</span>
<span class="s1">&#39;</span><span class="w"> </span><span class="nx">Version</span><span class="o">:</span><span class="w"> </span><span class="mf">5.0</span>
<span class="s1">&#39; 10:47 PM Thu April 6, 2023</span>

<span class="s1">&#39;</span><span class="w"> </span><span class="nx">Buffer</span><span class="w"> </span><span class="nx">and</span><span class="w"> </span><span class="nx">release</span><span class="w"> </span><span class="nx">all</span><span class="w"> </span><span class="nx">at</span><span class="w"> </span><span class="nx">once</span><span class="p">...</span>
<span class="nx">Response</span><span class="p">.</span><span class="nx">Buffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">True</span><span class="w"> </span>
<span class="o">%&gt;</span>

<span class="c">&lt;!--</span><span class="w"> </span><span class="err">#</span><span class="nx">include</span><span class="w"> </span><span class="nx">file</span><span class="o">=</span><span class="s2">&quot;common/adovbs.inc&quot;</span><span class="w"> </span><span class="o">--&gt;</span>
<span class="c">&lt;!--</span><span class="w"> </span><span class="err">#</span><span class="nx">include</span><span class="w"> </span><span class="nx">file</span><span class="o">=</span><span class="s2">&quot;common/headers.asp&quot;</span><span class="w"> </span><span class="o">--&gt;</span>
<span class="c">&lt;!--</span><span class="w"> </span><span class="err">#</span><span class="nx">include</span><span class="w"> </span><span class="nx">file</span><span class="o">=</span><span class="s2">&quot;common/connection_code.asp&quot;</span><span class="w"> </span><span class="o">--&gt;</span>

<span class="o">&lt;%</span>
<span class="s1">&#39;==========================================</span>
<span class="s1">&#39;</span><span class="w"> </span><span class="nx">Common</span><span class="w"> </span><span class="nx">Variables</span><span class="w"> </span><span class="p">(</span><span class="nx">globals</span><span class="p">)</span>
<span class="s1">&#39;==========================================</span>

<span class="s1">Dim DBConnection, rstDate, rstTelem, rstStations, rstLatestDate, rstMostRecent, rstMinMaxFifteenMinData, rstTimeZone</span>
<span class="s1">Dim dteMaxTimeStamp</span>
<span class="s1">Dim strSQL, strNameForPlot, intMaxGust, intNonPlottingHeight, intTempDiffScalingThreshold</span>
<span class="s1">Dim strTitle, strHGSL</span>
<span class="s1">Dim sglTempMax, sglTempMin, sglPressureMin, sglPressureMax, sglTempRange, sglDewPointMin, blnDewPointData</span>
<span class="s1">Dim strMRTime, strMRWindAvg, strMRWindMax, strMRWindDir, strMRTemp, strMRPressure, strMRDewPoint</span>
<span class="s1">Dim Chart</span>
<span class="s1">Dim Filename</span>
<span class="s1">Dim WeatherTypes, WeatherTypes_URL, WeatherTypes_count, DaysChoices</span>
<span class="s1">Dim dteStartDateTime, dteEndDateTime, dteStartDate_forLabels</span>
<span class="s1">Dim TimeLabels, TheHour, DayValue, DaysDecSinceRef, intHour</span>
<span class="s1">Dim blnMinMax, blnFoundSomeData</span>
<span class="s1">Dim intTheColor</span>
<span class="s1">Dim strRandomNameString, strFileName2, strOrderBy, intColorScaleFactor</span>
<span class="s1">Dim fsoObject, fdrObject, filObject</span>
<span class="s1">Dim intFileCount</span>
<span class="s1">Dim blnDayLightSavingsTime</span>
<span class="s1">Dim dtePostedDate, blnPostedDate_default</span>
<span class="s1">Dim intJ, intDays, intXLabels, dblDaysIncrement, dblDaysFraction, dblFractionalPart, dteLabelDate, intLabelsPerDay</span>
<span class="s1">Dim dblDPmin, dblDPmax</span>
<span class="s1">Dim dblWindNormFactor, intRed, intGreen, intBlue, intGray</span>
<span class="s1">Dim strRegionURL, strSensor, strInitializeTimer, strLocation</span>
<span class="s1">Dim serverTimeArray, serverTime, intPixelBottomShift, intPixelRightShift, intPixelRightShift_tweak</span>
<span class="s1">Dim strShowImages_command</span>
<span class="s1">Dim vrtReturnFromMINMAX</span>
<span class="s1">Dim intMinutes, dblFiveMinutes, intSeconds_FromMinutes, intSeconds_FromSeconds, intDelay_to_5min</span>
<span class="s1">Dim strButtonLabel</span>
<span class="s1">Dim strTimeZone, dicTZ</span>
<span class="s1">Dim arrRegions, strRegionValue, strRegion, strRegionState</span>
<span class="s1">Dim strDebugMessage</span>
<span class="s1">Dim dteNowTime, dteStartDateTime_forQuery</span>
<span class="s1">Dim str24Hrs_state, strTimer_state, strTimer_value, strRA_state</span>

<span class="s1">&#39;</span><span class="o">=============================================================================================</span>
<span class="s1">&#39; Functions and Subroutines</span>
<span class="s1">&#39;</span><span class="o">=============================================================================================</span>

<span class="nx">Sub</span><span class="w"> </span><span class="nx">RBC</span><span class="p">(</span><span class="nx">strTheString</span><span class="p">)</span>
<span class="w">   </span><span class="nx">Response</span><span class="p">.</span><span class="nx">Write</span><span class="w"> </span><span class="nx">strTheString</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;&lt;BR&gt;&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">Chr</span><span class="p">(</span><span class="mf">10</span><span class="p">)</span>
<span class="nx">End</span><span class="w"> </span><span class="nx">Sub</span>

<span class="s1">&#39;Alias for RBC</span>
<span class="s1">Sub RWBR(strTheString)</span>
<span class="s1">   RBC strTheString</span>
<span class="s1">End Sub</span>

<span class="s1">Sub RC(strTheString)</span>
<span class="s1">   Response.Write strTheString &amp; Chr(10)</span>
<span class="s1">End Sub</span>

<span class="s1">&#39;</span><span class="nx">This</span><span class="w"> </span><span class="nx">will</span><span class="w"> </span><span class="nx">not</span><span class="w"> </span><span class="nx">make</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">line</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">HTML</span><span class="w"> </span><span class="nx">file</span><span class="p">.</span>
<span class="nx">Sub</span><span class="w"> </span><span class="nx">RW</span><span class="p">(</span><span class="nx">strTheString</span><span class="p">)</span>
<span class="w">   </span><span class="nx">Response</span><span class="p">.</span><span class="nx">Write</span><span class="w"> </span><span class="nx">strTheString</span>
<span class="nx">End</span><span class="w"> </span><span class="nx">Sub</span>

<span class="nx">Sub</span><span class="w"> </span><span class="nx">MinMax</span><span class="p">(</span><span class="nx">ByVal</span><span class="w"> </span><span class="nx">dblNewValue</span><span class="p">,</span><span class="w"> </span><span class="nx">ByRef</span><span class="w"> </span><span class="nx">dblMax</span><span class="p">,</span><span class="w"> </span><span class="nx">ByRef</span><span class="w"> </span><span class="nx">dblMin</span><span class="p">)</span>
<span class="w">     </span>
<span class="w">   </span><span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">dblNewValue</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">dblMax</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">      </span><span class="nx">dblMax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dblNewValue</span>
<span class="w">   </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>
<span class="w">   </span>
<span class="w">   </span><span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">dblNewValue</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">dblMin</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">      </span><span class="nx">dblMin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dblNewValue</span>
<span class="w">   </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>
<span class="w">   </span>
<span class="nx">End</span><span class="w"> </span><span class="nx">Sub</span>

<span class="nb">Function</span><span class="w"> </span><span class="nx">DaylightTime</span><span class="p">(</span><span class="nx">strMRTime</span><span class="p">)</span>
<span class="w">   </span><span class="nx">Dim</span><span class="w"> </span><span class="nx">strMRTime_DLS</span>
<span class="w">   </span><span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">strMRTime</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="s2">&quot;-&quot;</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">      </span><span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">dayLightSavingsTime</span><span class="p">(</span><span class="nx">strMRTime</span><span class="p">))</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">         </span><span class="nx">strMRTime_DLS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">DateAdd</span><span class="p">(</span><span class="s2">&quot;h&quot;</span><span class="p">,</span><span class="mf">1</span><span class="p">,</span><span class="nx">strMRTime</span><span class="p">)</span>
<span class="w">      </span><span class="nx">Else</span>
<span class="w">         </span><span class="nx">strMRTime_DLS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">strMRTime</span>
<span class="w">      </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>
<span class="w">   </span><span class="nx">Else</span>
<span class="w">      </span><span class="nx">strMRTime_DLS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;-&quot;</span>
<span class="w">   </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>
<span class="w">   </span><span class="nx">DaylightTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">strMRTime_DLS</span>
<span class="nx">End</span><span class="w"> </span><span class="nb">Function</span>

<span class="nb">Function</span><span class="w"> </span><span class="nx">AgeOfData</span><span class="p">(</span><span class="nx">strMRTime</span><span class="p">)</span>
<span class="w">   </span><span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">strMRTime</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="s2">&quot;-&quot;</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">      </span><span class="s1">&#39; The following line works mainly because strMRTime is in standard time. So no problem with HI.</span>
<span class="s1">      AgeOfData = DateDiff(&quot;n&quot;, DaylightTime(strMRTime), Now()) + 60 * dicTZ.item(strTimeZone)</span>
<span class="s1">   Else</span>
<span class="s1">      AgeOfData = &quot;-&quot;</span>
<span class="s1">   End If</span>
<span class="s1">End Function</span>

<span class="s1">Function MinMaxFifteenMinData(strMode, strVariableName)</span>
<span class="s1">   &#39;</span><span class="w"> </span><span class="nx">Check</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">see</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">there</span><span class="w"> </span><span class="nx">is</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">specified</span><span class="w"> </span><span class="nx">field</span><span class="p">.</span><span class="w">  </span><span class="nx">And</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">there</span><span class="w"> </span><span class="nx">is</span><span class="p">,</span>
<span class="w">   </span><span class="s1">&#39; find either the max or min of the specified variable</span>

<span class="s1">   strSQL = &quot;Select &quot; &amp; strMode &amp; &quot;(&quot; &amp; strVariableName &amp; &quot;) AS TheExtreme From FifteenMinData WHERE ([StationName] = &#39;</span><span class="s2">&quot; &amp; strLocation &amp; &quot;</span><span class="s1">&#39;) AND &quot; &amp; _</span>
<span class="s1">                              &quot;([DateTimeStamp] &lt;=     #&quot; &amp; dteEndDateTime &amp; &quot;#) AND &quot; &amp; _</span>
<span class="s1">                              &quot;([DateTimeStamp] &gt;=     #&quot; &amp; dteStartDateTime_forQuery &amp; &quot;#)&quot;                                            </span>
<span class="s1">   </span>
<span class="s1">   PopulateStaticRecordset DBConnection, strSQL, rstMinMaxFifteenMinData</span>

<span class="s1">   &#39;</span><span class="w"> </span><span class="nx">Check</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="p">(</span><span class="nx">because</span><span class="w"> </span><span class="nx">sites</span><span class="w"> </span><span class="nx">don</span><span class="s1">&#39;t have min max data on the temperature)</span>
<span class="s1">   If (rstMinMaxFifteenMinData.RecordCount = 0) Then</span>
<span class="s1">      MinMaxFifteenMinData = -999</span>
<span class="s1">   Else </span>
<span class="s1">      rstMinMaxFifteenMinData.MoveFirst</span>
<span class="s1">      MinMaxFifteenMinData = rstMinMaxFifteenMinData(&quot;TheExtreme&quot;)</span>
<span class="s1">   End If</span>

<span class="s1">   CloseRecordSet rstMinMaxFifteenMinData</span>
<span class="s1">End Function</span>

<span class="s1">Function DaysDecSinceRefF()</span>
<span class="s1"> </span>
<span class="s1">   Dim dteRecordTime</span>
<span class="s1">   Dim TheMin</span>
<span class="s1"> </span>
<span class="s1">   If (intDays = 1) Then</span>
<span class="s1">      TheMin = rstTelem(&quot;TimeMin&quot;)</span>
<span class="s1">   Else</span>
<span class="s1">      TheMin = 0</span>
<span class="s1">   End If</span>
<span class="s1"> </span>
<span class="s1">   dteRecordTime = rstTelem(&quot;TimeMDY&quot;) + TimeSerial(rstTelem(&quot;TimeHr&quot;), TheMin, 0)   </span>
<span class="s1">   </span>
<span class="s1">   DaysDecSinceRefF = CDbl(  DateDiff(&quot;n&quot;, dteStartDateTime, dteRecordTime)  ) / 1440 </span>
<span class="s1">   </span>
<span class="s1">End Function</span>

<span class="s1">Function DaysDec( dteTime)</span>
<span class="s1">   &#39;</span><span class="w"> </span><span class="mf">86400</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">24.0</span><span class="o">*</span><span class="mf">60.0</span><span class="o">*</span><span class="mf">60.0</span><span class="w">  </span><span class="p">(</span><span class="nx">Seconds</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nx">day</span><span class="p">).</span>

<span class="w">   </span><span class="s1">&#39; Decimal day as measured from the midnight start time.</span>
<span class="s1">   &#39;</span><span class="nx">RWBR</span><span class="w"> </span><span class="s2">&quot;dteTime = &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">dteTime</span>
<span class="w">   </span><span class="nx">DaysDec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">CDbl</span><span class="p">(</span><span class="w"> </span><span class="nx">DateDiff</span><span class="p">(</span><span class="s2">&quot;s&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">dteStartDateTime</span><span class="p">,</span><span class="w"> </span><span class="nx">dteTime</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">86400.0</span>

<span class="nx">End</span><span class="w"> </span><span class="nb">Function</span>

<span class="nx">Sub</span><span class="w"> </span><span class="nx">IPMessage</span><span class="p">()</span>
<span class="w">   </span><span class="nx">Dim</span><span class="w"> </span><span class="nx">UserIPAddress</span>
<span class="w">   </span><span class="nx">UserIPAddress</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Request</span><span class="p">.</span><span class="nx">ServerVariables</span><span class="p">(</span><span class="s2">&quot;HTTP_X_FORWARDED_FOR&quot;</span><span class="p">)</span>
<span class="w">   </span><span class="nx">If</span><span class="w"> </span><span class="nx">UserIPAddress</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">     </span><span class="nx">UserIPAddress</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Request</span><span class="p">.</span><span class="nx">ServerVariables</span><span class="p">(</span><span class="s2">&quot;REMOTE_ADDR&quot;</span><span class="p">)</span>
<span class="w">   </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>
<span class="w">   </span>
<span class="w">   </span><span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">UserIPAddress</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;50.35.244.236&quot;</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">   </span><span class="s1">&#39;If (UserIPAddress = &quot;138.236.65.69&quot;) Then</span>
<span class="s1">      RWBR &quot;Message to &quot; &amp; UserIPAddress &amp; &quot;:&quot;</span>
<span class="s1">      RWBR &quot;Eric, I&#39;</span><span class="nx">m</span><span class="w"> </span><span class="nx">guessing</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="nx">IP</span><span class="w"> </span><span class="nx">address</span><span class="w"> </span><span class="nx">is</span><span class="w"> </span><span class="nx">you</span><span class="p">.</span><span class="w"> </span><span class="nx">I</span><span class="w"> </span><span class="nx">tried</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">email</span><span class="w"> </span><span class="nx">you</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nx">few</span><span class="w"> </span><span class="nx">days</span><span class="w"> </span><span class="nx">ago</span><span class="p">.</span><span class="w"> </span><span class="nx">It</span><span class="w"> </span><span class="nx">bounced</span><span class="w"> </span><span class="nx">back</span><span class="p">.</span><span class="w"> </span><span class="nx">Looks</span><span class="w"> </span><span class="nx">like</span><span class="w"> </span><span class="nx">you</span><span class="s1">&#39;re no longer using this email address: engreenwell@verizon.net. You&#39;</span><span class="nx">re</span><span class="w"> </span><span class="nx">one</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">Waconia</span><span class="s1">&#39;s most frequent users and it would be good to be able to email you if I&#39;</span><span class="nx">m</span><span class="w"> </span><span class="nx">working</span><span class="w"> </span><span class="nx">on</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nx">problem</span><span class="p">.</span><span class="w"> </span><span class="nx">Let</span><span class="w"> </span><span class="nx">me</span><span class="w"> </span><span class="nx">know</span><span class="p">.</span><span class="w"> </span><span class="nx">I</span><span class="s1">&#39;ll take this message off in a few days. Thanks, Jim (jmiller6@gac.edu)&quot;</span>
<span class="s1">   End If</span>
<span class="s1">   </span>
<span class="s1">End Sub</span>

<span class="s1">Function DirectionLabel (WindDeg)</span>
<span class="s1">   If     (WindDeg &gt; 345 And WindDeg &lt;= 360) Then </span>
<span class="s1">      DirectionLabel = &quot;North&quot;</span>
<span class="s1">   ElseIf (WindDeg &gt;   0 And WindDeg &lt;=  15) Then </span>
<span class="s1">      DirectionLabel = &quot;North&quot;</span>
<span class="s1">   </span>
<span class="s1">   ElseIf (WindDeg &gt;  15 And WindDeg &lt;=  45) Then </span>
<span class="s1">      DirectionLabel = &quot;NNE&quot;</span>
<span class="s1">   ElseIf (WindDeg &gt;  45 And WindDeg &lt;=  75) Then </span>
<span class="s1">      DirectionLabel = &quot;ENE&quot;</span>
<span class="s1">   ElseIf (WindDeg &gt;  75 And WindDeg &lt;= 105) Then </span>
<span class="s1">      DirectionLabel = &quot;East&quot;</span>
<span class="s1">   ElseIf (WindDeg &gt; 105 And WindDeg &lt;= 135) Then </span>
<span class="s1">      DirectionLabel = &quot;ESE&quot;</span>
<span class="s1">   ElseIf (WindDeg &gt; 135 And WindDeg &lt;= 165) Then </span>
<span class="s1">      DirectionLabel = &quot;SSE&quot;</span>
<span class="s1">   ElseIf (WindDeg &gt; 165 And WindDeg &lt;= 195) Then </span>
<span class="s1">      DirectionLabel = &quot;South&quot;</span>
<span class="s1">   ElseIf (WindDeg &gt; 195 And WindDeg &lt;= 225) Then </span>
<span class="s1">      DirectionLabel = &quot;SSW&quot;</span>
<span class="s1">   ElseIf (WindDeg &gt; 225 And WindDeg &lt;= 255) Then </span>
<span class="s1">      DirectionLabel = &quot;WSW&quot;</span>
<span class="s1">   ElseIf (WindDeg &gt; 255 And WindDeg &lt;= 285) Then </span>
<span class="s1">      DirectionLabel = &quot;West&quot;</span>
<span class="s1">   ElseIf (WindDeg &gt; 285 And WindDeg &lt;= 315) Then </span>
<span class="s1">      DirectionLabel = &quot;WNW&quot;</span>
<span class="s1">   ElseIf (WindDeg &gt; 315 And WindDeg &lt;= 345) Then </span>
<span class="s1">      DirectionLabel = &quot;NNW&quot;</span>
<span class="s1">   Else </span>
<span class="s1">      DirectionLabel = &quot;Var&quot;</span>
<span class="s1">   End If</span>
<span class="s1">   </span>
<span class="s1">   If     (WindDeg =  45) Then </span>
<span class="s1">      DirectionLabel = &quot;NE&quot;</span>
<span class="s1">   ElseIf (WindDeg = 135) Then</span>
<span class="s1">      DirectionLabel = &quot;SE&quot;</span>
<span class="s1">   ElseIf (WindDeg = 225) Then</span>
<span class="s1">      DirectionLabel = &quot;SW&quot;</span>
<span class="s1">   ElseIf (WindDeg = 315) Then</span>
<span class="s1">      DirectionLabel = &quot;NW&quot;</span>
<span class="s1">   End If</span>
<span class="s1">End Function</span>

<span class="s1">Sub AddHorizontalLine_gray(intLineWidth, intColor, dblYvalue)</span>

<span class="s1">   Chart.AddSeries (5)</span>
<span class="s1">   Chart.linewidth = intLineWidth</span>
<span class="s1">   Chart.SeriesInLegend = false</span>

<span class="s1">   &#39;</span><span class="nx">MyChartAddXY</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">dblYvalue</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">strColor</span><span class="w">   </span>
<span class="w">   </span><span class="s1">&#39;MyChartAddXY intDays+1, dblYvalue, &quot;&quot;, RGB(&amp;hFF,&amp;hFF,&amp;hFF)</span>

<span class="s1">   &#39;</span><span class="w"> </span><span class="nx">The</span><span class="w"> </span><span class="o">-</span><span class="mf">0.009</span><span class="w"> </span><span class="k">extends</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">line</span><span class="w"> </span><span class="nx">all</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">way</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">left</span><span class="w"> </span><span class="nx">edge</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="mf">1</span><span class="o">-</span><span class="nx">day</span><span class="w"> </span><span class="nx">chart</span><span class="p">.</span>
<span class="w">   </span><span class="nx">MyChartAddXY</span><span class="w">      </span><span class="o">-</span><span class="mf">0.009</span><span class="p">,</span><span class="w"> </span><span class="nx">dblYvalue</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">RGB</span><span class="p">(</span><span class="nx">intColor</span><span class="p">,</span><span class="w"> </span><span class="nx">intColor</span><span class="p">,</span><span class="w"> </span><span class="nx">intColor</span><span class="p">)</span><span class="w">  </span>
<span class="w">   </span><span class="nx">MyChartAddXY</span><span class="w"> </span><span class="nx">intDays</span><span class="o">+</span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="nx">dblYvalue</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">RGB</span><span class="p">(</span><span class="nx">intColor</span><span class="p">,</span><span class="w"> </span><span class="nx">intColor</span><span class="p">,</span><span class="w"> </span><span class="nx">intColor</span><span class="p">)</span>

<span class="nx">End</span><span class="w"> </span><span class="nx">Sub</span>

<span class="nx">Sub</span><span class="w"> </span><span class="nx">AddHorizontalLine_color</span><span class="p">(</span><span class="nx">intLineWidth</span><span class="p">,</span><span class="w"> </span><span class="nx">intRed</span><span class="p">,</span><span class="w"> </span><span class="nx">intGreen</span><span class="p">,</span><span class="w"> </span><span class="nx">intBlue</span><span class="p">,</span><span class="w"> </span><span class="nx">dblYvalue</span><span class="p">)</span>

<span class="w">   </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">AddSeries</span><span class="w"> </span><span class="p">(</span><span class="mf">5</span><span class="p">)</span>
<span class="w">   </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">linewidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">intLineWidth</span>
<span class="w">   </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">SeriesInLegend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span>

<span class="w">   </span><span class="nx">MyChartAddXY</span><span class="w">      </span><span class="o">-</span><span class="mf">0.009</span><span class="p">,</span><span class="w"> </span><span class="nx">dblYvalue</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">RGB</span><span class="p">(</span><span class="nx">intRed</span><span class="p">,</span><span class="w"> </span><span class="nx">intGreen</span><span class="p">,</span><span class="w"> </span><span class="nx">intBlue</span><span class="p">)</span><span class="w">  </span>
<span class="w">   </span><span class="nx">MyChartAddXY</span><span class="w"> </span><span class="nx">intDays</span><span class="o">+</span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="nx">dblYvalue</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">RGB</span><span class="p">(</span><span class="nx">intRed</span><span class="p">,</span><span class="w"> </span><span class="nx">intGreen</span><span class="p">,</span><span class="w"> </span><span class="nx">intBlue</span><span class="p">)</span>

<span class="nx">End</span><span class="w"> </span><span class="nx">Sub</span>

<span class="nx">Sub</span><span class="w"> </span><span class="nx">MyChartAddXY</span><span class="p">(</span><span class="nx">dblXValue</span><span class="p">,</span><span class="w"> </span><span class="nx">dblYValue</span><span class="p">,</span><span class="w"> </span><span class="nx">strXLabel</span><span class="p">,</span><span class="w"> </span><span class="nx">intColor</span><span class="p">)</span>

<span class="w">   </span><span class="s1">&#39; Feed only NON-Null values to the AddXY method.</span>
<span class="s1">   If (Not IsNull(dblYValue)) Then</span>
<span class="s1">      Chart.AddXY dblXValue, dblYValue, strXLabel, intColor</span>
<span class="s1">   End If</span>

<span class="s1">End Sub</span>

<span class="s1">Sub AddVerticalLine( dblXValue, intLineWidth)</span>

<span class="s1">   Dim intColor, intGray, intColor_Red, intColor_Green, intColor_Blue</span>
<span class="s1">   </span>
<span class="s1">   Chart.AddSeries (5)</span>
<span class="s1">   Chart.linewidth = intLineWidth</span>
<span class="s1">   Chart.SeriesInLegend = false</span>

<span class="s1">   intGray = 75  &#39;</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="p">(</span><span class="nx">black</span><span class="p">)</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="mf">255</span><span class="w"> </span><span class="p">(</span><span class="nx">white</span><span class="p">)</span>
<span class="w">   </span>
<span class="w">   </span><span class="nx">intColor_Red</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">intGray</span>
<span class="w">   </span><span class="nx">intColor_Green</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">intGray</span>
<span class="w">   </span><span class="nx">intColor_Blue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">intGray</span>
<span class="w">   </span>
<span class="w">   </span><span class="nx">intColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">RGB</span><span class="p">(</span><span class="nx">intColor_Red</span><span class="p">,</span><span class="w"> </span><span class="nx">intColor_Green</span><span class="p">,</span><span class="w"> </span><span class="nx">intColor_Blue</span><span class="p">)</span>
<span class="w">   </span><span class="s1">&#39;intColor = vbBlack</span>
<span class="s1">   </span>
<span class="s1">   MyChartAddXY           dblXValue, Chart.VertAxisMin, &quot;&quot;, intColor  </span>
<span class="s1">   MyChartAddXY           dblXValue, Chart.VertAxisMax, &quot;&quot;, intColor</span>
<span class="s1">   </span>
<span class="s1">End Sub</span>

<span class="s1">Sub UpdateTraceRecordSet_DeltaP(ByRef rstTelem, ByRef dicTraceIO)</span>
<span class="s1">   Dim strWestSite, strEastSite</span>
<span class="s1">   </span>
<span class="s1">   strWestSite = dicTraceIO.Item(&quot;WestSite&quot;)</span>
<span class="s1">   strEastSite = dicTraceIO.Item(&quot;EastSite&quot;)</span>

<span class="s1">   dicTraceIO.Item(&quot;FoundData_ForThisTrace&quot;) = False</span>

<span class="s1">   If (intDays = 1) then</span>
<span class="s1">      &#39;</span><span class="w"> </span><span class="nx">This</span><span class="w"> </span><span class="nx">query</span><span class="w"> </span><span class="nx">uses</span><span class="w"> </span><span class="nx">an</span><span class="w"> </span><span class="nx">interesting</span><span class="w"> </span><span class="nx">trick</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">accomplish</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">delta</span><span class="o">-</span><span class="nx">P</span>
<span class="w">      </span><span class="s1">&#39; calculation.  It selects all the needed data from two sites and then</span>
<span class="s1">      &#39;</span><span class="w"> </span><span class="nx">groups</span><span class="w"> </span><span class="nx">it</span><span class="w"> </span><span class="nx">by</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="w">  </span><span class="nx">It</span><span class="w"> </span><span class="nx">feeds</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">SUM</span><span class="w"> </span><span class="nx">operator</span><span class="w"> </span><span class="kd">with</span><span class="w"> </span><span class="nx">logic</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">IIF</span>
<span class="w">      </span><span class="s1">&#39; operator.  That is how the delta is calculated.  The HAVING clause</span>
<span class="s1">      &#39;</span><span class="w"> </span><span class="nx">insures</span><span class="w"> </span><span class="nx">that</span><span class="w"> </span><span class="nx">only</span><span class="w"> </span><span class="nx">groups</span><span class="w"> </span><span class="kd">with</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nx">count</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="mf">2</span><span class="w"> </span><span class="nx">are</span><span class="w"> </span><span class="nx">used</span><span class="p">.</span>

<span class="w">      </span><span class="s1">&#39; Get the most recent 24 hours of data. This modification of dteStartDateTime_forQuery is in support</span>
<span class="s1">      &#39;</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="mf">24</span><span class="nx">h</span><span class="w"> </span><span class="nx">plot</span><span class="p">.</span>
<span class="w">      </span><span class="nx">If</span><span class="w"> </span><span class="p">((</span><span class="nx">strMRTime</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="s2">&quot;-&quot;</span><span class="p">)</span><span class="w"> </span><span class="nx">And</span><span class="w"> </span><span class="p">(</span><span class="nx">DaysDec</span><span class="p">(</span><span class="nx">strMRTime</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="nx">And</span><span class="w"> </span><span class="p">(</span><span class="nx">DaysDec</span><span class="p">(</span><span class="nx">strMRTime</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">1.0</span><span class="p">)</span><span class="w"> </span><span class="nx">And</span><span class="w"> </span><span class="p">(</span><span class="nx">str24Hrs_state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;checked&quot;</span><span class="p">))</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">         </span><span class="nx">dteStartDateTime_forQuery</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">DateAdd</span><span class="p">(</span><span class="s2">&quot;d&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="nx">DateAdd</span><span class="p">(</span><span class="s2">&quot;n&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">strMRTime</span><span class="p">))</span>
<span class="w">      </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>
<span class="w">      </span>
<span class="w">      </span><span class="nx">strSQL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;SELECT DateTimeStamp, TimeMDY, TimeHr, TimeMin, SUM(IIf([StationName]=&#39;&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">strWestSite</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;&#39;,+[Pressure],-[Pressure])) AS DeltaP &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">               </span><span class="s2">&quot;FROM FifteenMinData &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">               </span><span class="s2">&quot;WHERE ((StationName) In (&#39;&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">strWestSite</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;&#39;,&#39;&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">strEastSite</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;&#39;)) AND &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">               </span><span class="s2">&quot;      ([DateTimeStamp] &lt;=     #&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">dteEndDateTime</span><span class="w">    </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;#) AND &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">               </span><span class="s2">&quot;      ([DateTimeStamp] &gt;=     #&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">dteStartDateTime_forQuery</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;#) &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">               </span><span class="s2">&quot;GROUP BY DateTimeStamp, TimeMDY, TimeHr, TimeMin &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">               </span><span class="s2">&quot;HAVING (((Count(DateTimeStamp))=2)) &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">               </span><span class="s2">&quot;ORDER BY TimeMDY ASC, TimeHr ASC, TimeMin ASC&quot;</span><span class="w">   </span>
<span class="w">   </span>
<span class="w">   </span><span class="nx">Else</span>

<span class="w">      </span><span class="nx">strSQL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;SELECT DateTimeStamp, TimeMDY, TimeHr, TimeMin, SUM(IIf([StationName]=&#39;&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">strWestSite</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;&#39;,+[Pressure],-[Pressure])) AS DeltaP1 &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">               </span><span class="s2">&quot;FROM FifteenMinData &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">               </span><span class="s2">&quot;WHERE ((StationName) In (&#39;&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">strWestSite</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;&#39;,&#39;&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">strEastSite</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;&#39;)) AND &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">               </span><span class="s2">&quot;      ([DateTimeStamp] &lt;=     #&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">dteEndDateTime</span><span class="w">    </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;#) AND &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">               </span><span class="s2">&quot;      ([DateTimeStamp] &gt;=     #&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">dteStartDateTime_forQuery</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;#) &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">               </span><span class="s2">&quot;GROUP BY DateTimeStamp, TimeMDY, TimeHr, TimeMin &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">               </span><span class="s2">&quot;HAVING (((Count(DateTimeStamp))=2)) &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">               </span><span class="s2">&quot;ORDER BY TimeMDY ASC, TimeHr ASC, TimeMin ASC&quot;</span><span class="w">   </span>

<span class="w">      </span><span class="s1">&#39; And now we feed the query above into the aggregation query below</span>
<span class="s1">      &#39;</span><span class="w"> </span><span class="p">(</span><span class="nx">another</span><span class="w"> </span><span class="nx">interesting</span><span class="w"> </span><span class="nx">SQL</span><span class="w"> </span><span class="nx">trick</span><span class="p">).</span>

<span class="w">      </span><span class="nx">strSQL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;SELECT TimeMDY, TimeHr, AVG(DeltaP1) AS DeltaP &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">               </span><span class="s2">&quot;FROM (&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">strSQL</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;) &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">               </span><span class="s2">&quot;GROUP BY TimeMDY, TimeHr &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">               </span><span class="s2">&quot;ORDER BY TimeMDY ASC , TimeHr ASC &quot;</span>

<span class="w">   </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>

<span class="w">   </span><span class="s1">&#39;RWBR dteStartDateTime_forQuery &amp; &quot;--------&quot; &amp; dteEndDateTime</span>
<span class="s1">   PopulateStaticRecordset DBConnection, strSQL, rstTelem</span>

<span class="s1">   If (Not rstTelem.BOF) Then </span>
<span class="s1">      dicTraceIO.Item(&quot;FoundData&quot;) = True</span>
<span class="s1">      dicTraceIO.Item(&quot;FoundData_ForThisTrace&quot;) = True</span>
<span class="s1">   End If</span>
<span class="s1">   </span>
<span class="s1">End Sub</span>

<span class="s1">Sub UpdateTraceRecordSet(ByVal strSensor_DBName, ByRef rstTelem, ByRef dicTraceIO)</span>

<span class="s1">   Dim strSensorSelectClause</span>

<span class="s1">   dicTraceIO.Item(&quot;FoundData_ForThisTrace&quot;) = False</span>
<span class="s1">   </span>
<span class="s1">   If (intDays = 1) Then</span>
<span class="s1">      &#39;</span><span class="nx">RWBR</span><span class="w"> </span><span class="s2">&quot;Diff: Post-Now = &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">DateDiff</span><span class="p">(</span><span class="s2">&quot;h&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">dtePostedDate</span><span class="p">,</span><span class="w"> </span><span class="nx">Now</span><span class="p">())</span>
<span class="w">      </span><span class="nx">If</span><span class="w"> </span><span class="p">((</span><span class="nx">strMRTime</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="s2">&quot;-&quot;</span><span class="p">)</span><span class="w"> </span><span class="nx">And</span><span class="w"> </span><span class="p">(</span><span class="nx">DaysDec</span><span class="p">(</span><span class="nx">strMRTime</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="nx">And</span><span class="w"> </span><span class="p">(</span><span class="nx">DaysDec</span><span class="p">(</span><span class="w"> </span><span class="nx">strMRTime</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">1.0</span><span class="p">)</span><span class="w"> </span><span class="nx">And</span><span class="w"> </span><span class="p">(</span><span class="nx">str24Hrs_state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;checked&quot;</span><span class="p">))</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">         </span><span class="s1">&#39; Go back a full day. This modification of dteStartDateTime_forQuery is in support </span>
<span class="s1">         &#39;</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="mf">24</span><span class="nx">h</span><span class="w"> </span><span class="nx">plot</span><span class="p">.</span>
<span class="w">         </span><span class="nx">dteStartDateTime_forQuery</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">DateAdd</span><span class="p">(</span><span class="s2">&quot;d&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="nx">DateAdd</span><span class="p">(</span><span class="s2">&quot;n&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">strMRTime</span><span class="p">))</span>
<span class="w">      </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>
<span class="w">      </span>
<span class="w">      </span><span class="nx">strSQL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;SELECT StationName, DateTimeStamp, TimeMDY, TimeMin, TimeHr, &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">strSensor_DBName</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot; &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">               </span><span class="s2">&quot;FROM FifteenMinData &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span>
<span class="w">               </span><span class="s2">&quot;WHERE ([StationName] = &#39;&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">strLocation</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;&#39;) AND &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">                     </span><span class="s2">&quot;([DateTimeStamp] &lt;=     #&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">dteEndDateTime</span><span class="w">    </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;#) AND &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">                     </span><span class="s2">&quot;([DateTimeStamp] &gt;=     #&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">dteStartDateTime_forQuery</span><span class="w">     </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;#) AND &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">                     </span><span class="s2">&quot;(&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">strSensor_DBName</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot; Is Not Null) &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">               </span><span class="s2">&quot;ORDER BY TimeMDY ASC, TimeHr ASC, TimeMin ASC&quot;</span><span class="w">                  </span>
<span class="w">   </span><span class="nx">Else</span><span class="w">   </span>
<span class="w">      </span>
<span class="w">      </span><span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">strSensor_DBName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;TempMax&quot;</span><span class="p">)</span><span class="w"> </span><span class="nx">or</span><span class="w"> </span><span class="p">(</span><span class="nx">strSensor_DBName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;WindGust&quot;</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">         </span><span class="nx">strSensorSelectClause</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;MAX(A.&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">strSensor_DBName</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;) AS &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">strSensor_DBName</span>
<span class="w">         </span>
<span class="w">      </span><span class="nx">ElseIf</span><span class="w"> </span><span class="p">(</span><span class="nx">strSensor_DBName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;TempMin&quot;</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">         </span><span class="nx">strSensorSelectClause</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;MIN(A.&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">strSensor_DBName</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;) AS &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">strSensor_DBName</span>
<span class="w">            </span>
<span class="w">      </span><span class="nx">Else</span>
<span class="w">         </span><span class="nx">strSensorSelectClause</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;AVG(A.&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">strSensor_DBName</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;) AS &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">strSensor_DBName</span>
<span class="w">      </span>
<span class="w">      </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>
<span class="w">      </span>
<span class="w">      </span><span class="nx">strSQL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;SELECT TimeMDY, TimeHr, FIRST(A.StationName) AS StationName, AVG(A.DateTimeStamp) AS DateTimeStamp, &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">strSensorSelectClause</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot; &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">               </span><span class="s2">&quot;FROM FifteenMinData AS A &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span>
<span class="w">               </span><span class="s2">&quot;WHERE ([StationName] = &#39;&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">strLocation</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;&#39;) AND &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">                     </span><span class="s2">&quot;([DateTimeStamp] &lt;=     #&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">dteEndDateTime</span><span class="w">    </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;#) AND &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">                     </span><span class="s2">&quot;([DateTimeStamp] &gt;=     #&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">dteStartDateTime_forQuery</span><span class="w">     </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;#) AND &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">                     </span><span class="s2">&quot;(&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">strSensor_DBName</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot; Is Not Null) &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">               </span><span class="s2">&quot;GROUP BY TimeMDY, TimeHr &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">               </span><span class="s2">&quot;ORDER BY TimeMDY ASC, TimeHr ASC&quot;</span><span class="w">       </span>
<span class="w">   </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>

<span class="w">   </span><span class="s1">&#39;RWBR strSQL</span>
<span class="s1">   PopulateStaticRecordset DBConnection, strSQL, rstTelem</span>
<span class="s1">   </span>
<span class="s1">   If (Not rstTelem.BOF) Then </span>
<span class="s1">      dicTraceIO.Item(&quot;FoundData&quot;) = True</span>
<span class="s1">      dicTraceIO.Item(&quot;FoundData_ForThisTrace&quot;) = True</span>
<span class="s1">   End If</span>

<span class="s1">End Sub</span>

<span class="s1">Sub AddTrace(strSensorName, dblYScaleFactor, intSeriesType, strSeriesTitle, intLineWidth, intColor, ByRef dicTraceIO)</span>
<span class="s1">   Dim intTraceArray_index</span>
<span class="s1">   Dim intYesterdayColor, intGray </span>
<span class="s1">   Dim dblYMin, dblYMax, dblYValue, dblYValue_raw</span>
<span class="s1">   Dim dblXValue, dblXValue_raw</span>
<span class="s1">   </span>
<span class="s1">   Dim dblX_Previous, dblY_Previous</span>
<span class="s1">   dblX_Previous = -999 : dblY_Previous = -999</span>
<span class="s1">   </span>
<span class="s1">   </span>
<span class="s1">   If (strSensorName = &quot;DeltaP&quot;) Then</span>
<span class="s1">      UpdateTraceRecordSet_DeltaP         rstTelem, dicTraceIO</span>
<span class="s1">   Else</span>
<span class="s1">      UpdateTraceRecordSet strSensorName, rstTelem, dicTraceIO</span>
<span class="s1">   End If</span>
<span class="s1">   </span>
<span class="s1">   If (dicTraceIO.Item(&quot;FoundData_ForThisTrace&quot;) = False) Then</span>
<span class="s1">      CloseRecordSet rstTelem</span>
<span class="s1">      Exit Sub</span>
<span class="s1">   End If</span>
<span class="s1">   </span>
<span class="s1">   </span>
<span class="s1">   dblYMax = dicTraceIO.Item(&quot;YMax&quot;) </span>
<span class="s1">   dblYMin = dicTraceIO.Item(&quot;YMin&quot;) </span>
<span class="s1">   </span>
<span class="s1">   If intSeriesType = 6 Then</span>
<span class="s1">      intGray = 200</span>
<span class="s1">      intYesterdayColor = RGB(intGray,intGray,intGray)</span>
<span class="s1">   Else</span>
<span class="s1">      intYesterdayColor = intColor</span>
<span class="s1">   End If</span>
<span class="s1">   </span>
<span class="s1">   &#39;</span><span class="nx">Instantiate</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">running</span><span class="w"> </span><span class="nx">averages</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">JavaScript</span><span class="p">.</span>
<span class="w">   </span><span class="nx">instantiateRunningAverages</span><span class="p">(</span><span class="w"> </span><span class="nx">strSensorName</span><span class="p">)</span>
<span class="w">   </span>
<span class="w">   </span><span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">intDays</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">      </span><span class="nx">rstTelem</span><span class="p">.</span><span class="nx">MoveFirst</span>
<span class="w">      </span>
<span class="w">      </span><span class="s1">&#39;First plot yesterday&#39;</span><span class="nx">s</span><span class="w"> </span><span class="nx">data</span><span class="p">.</span>
<span class="w">      </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">AddSeries</span><span class="p">(</span><span class="w"> </span><span class="nx">intSeriesType</span><span class="p">)</span>
<span class="w">      </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">SeriesInLegend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">False</span><span class="w">      </span>
<span class="w">      </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">linewidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span>
<span class="w">      </span>
<span class="w">      </span><span class="nx">RA_y</span><span class="p">.</span><span class="nx">reset</span><span class="p">(</span><span class="w"> </span><span class="nx">rstTelem</span><span class="p">.</span><span class="nx">RecordCount</span><span class="p">)</span>
<span class="w">      </span><span class="nx">RA_x</span><span class="p">.</span><span class="nx">reset</span><span class="p">(</span><span class="w"> </span><span class="nx">rstTelem</span><span class="p">.</span><span class="nx">RecordCount</span><span class="p">)</span>
<span class="w">            </span>
<span class="w">      </span><span class="nx">Do</span><span class="w"> </span><span class="nx">Until</span><span class="w"> </span><span class="nx">rstTelem</span><span class="p">.</span><span class="nx">EOF</span>
<span class="w">         </span><span class="nx">If</span><span class="w"> </span><span class="nx">Not</span><span class="w"> </span><span class="nx">IsNull</span><span class="p">(</span><span class="w"> </span><span class="nx">rstTelem</span><span class="p">(</span><span class="w"> </span><span class="nx">strSensorName</span><span class="p">))</span><span class="w"> </span><span class="nx">Then</span><span class="w">         </span>
<span class="w">            </span><span class="nx">dblYValue_raw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">CDbl</span><span class="p">(</span><span class="nx">rstTelem</span><span class="p">(</span><span class="w"> </span><span class="nx">strSensorName</span><span class="p">))</span>
<span class="w">            </span><span class="nx">dblXValue_raw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">DaysDecSinceRefF</span><span class="p">()</span>
<span class="w">            </span>
<span class="w">            </span><span class="s1">&#39; Do a running average if requested.</span>
<span class="s1">            If (strRA_state = &quot;checked&quot;) AND (rstTelem.RecordCount &gt; 5) Then</span>
<span class="s1">               dblYValue = RA_y.update( dblYValue_raw) * dblYScaleFactor</span>
<span class="s1">               dblXValue = RA_x.update( dblXValue_raw)</span>
<span class="s1">            Else</span>
<span class="s1">               dblYValue = dblYValue_raw * dblYScaleFactor</span>
<span class="s1">               dblXValue = dblXValue_raw               </span>
<span class="s1">            End If</span>
<span class="s1">            </span>
<span class="s1">            If (dblXValue &lt; 0.0) Then</span>
<span class="s1">               &#39;</span><span class="nx">Display</span><span class="w"> </span><span class="nx">yesterday</span><span class="s1">&#39;s data on the current single-day plot.</span>
<span class="s1">               </span>
<span class="s1">               &#39;</span><span class="nx">Add</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">move</span><span class="w"> </span><span class="nx">these</span><span class="w"> </span><span class="nx">yesterday</span><span class="w"> </span><span class="nx">points</span><span class="w"> </span><span class="nx">onto</span><span class="w"> </span><span class="nx">today</span><span class="s1">&#39;s plot.</span>
<span class="s1">               MyChartAddXY dblXValue + 1.0, dblYValue, &quot;&quot;, intYesterdayColor</span>
<span class="s1">               MinMax dblYValue, dblYMax, dblYMin</span>
<span class="s1">               &#39;</span><span class="nx">dicTraceIO</span><span class="p">.</span><span class="nx">Item</span><span class="p">(</span><span class="s2">&quot;FoundData&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">True</span>
<span class="w">               </span>
<span class="w">               </span><span class="s1">&#39; Save a starter point for today&#39;</span><span class="nx">s</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="nx">trace</span><span class="p">.</span>
<span class="w">               </span><span class="nx">dblX_Previous</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dblXValue</span>
<span class="w">               </span><span class="nx">dblY_Previous</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dblYValue</span>

<span class="w">            </span><span class="nx">Else</span>
<span class="w">               </span><span class="s1">&#39;At the start of today&#39;</span><span class="nx">s</span><span class="w"> </span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">exit</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="nx">first</span><span class="w"> </span><span class="nx">loop</span><span class="p">.</span>
<span class="w">               </span><span class="nx">Exit</span><span class="w"> </span><span class="nx">Do</span>
<span class="w">            </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>
<span class="w">         </span>
<span class="w">         </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>
<span class="w">         </span><span class="nx">rstTelem</span><span class="p">.</span><span class="nx">MoveNext</span><span class="w">         </span>
<span class="w">      </span><span class="nx">Loop</span>
<span class="w">      </span>
<span class="w">      </span><span class="s1">&#39;Then start a new trace for today&#39;</span><span class="nx">s</span><span class="w"> </span><span class="nx">data</span><span class="p">.</span>
<span class="w">      </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">AddSeries</span><span class="p">(</span><span class="w"> </span><span class="nx">intSeriesType</span><span class="p">)</span><span class="w">      </span>
<span class="w">      </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">linewidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">intLineWidth</span>
<span class="w">      </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">SeriesTitle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">strSeriesTitle</span><span class="w"> </span>
<span class="w">      </span>
<span class="w">      </span><span class="s1">&#39;First, plot the last point from yesterday&#39;</span><span class="nx">s</span><span class="w"> </span><span class="nx">data</span><span class="p">.</span><span class="w"> </span><span class="nx">This</span><span class="w"> </span><span class="nx">makes</span>
<span class="w">      </span><span class="s1">&#39;the trace lines visible for the first point of the day (2 points needed).</span>
<span class="s1">      If dblX_Previous &lt;&gt; -999 Then</span>
<span class="s1">         MyChartAddXY dblX_Previous, dblY_Previous, &quot;&quot;, intColor</span>
<span class="s1">      End If</span>
<span class="s1">      </span>
<span class="s1">      Do Until rstTelem.EOF</span>
<span class="s1">         If Not IsNull( rstTelem( strSensorName)) Then</span>
<span class="s1">            dblYValue_raw = CDbl(rstTelem( strSensorName))</span>
<span class="s1">            dblXValue_raw = DaysDecSinceRefF()</span>
<span class="s1">            </span>
<span class="s1">            &#39;</span><span class="w"> </span><span class="nx">Do</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nx">running</span><span class="w"> </span><span class="nx">average</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">requested</span><span class="p">.</span>
<span class="w">            </span><span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">strRA_state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;checked&quot;</span><span class="p">)</span><span class="w"> </span><span class="nx">AND</span><span class="w"> </span><span class="p">(</span><span class="nx">rstTelem</span><span class="p">.</span><span class="nx">RecordCount</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">5</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">               </span><span class="nx">dblYValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">RA_y</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="w"> </span><span class="nx">dblYValue_raw</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dblYScaleFactor</span>
<span class="w">               </span><span class="nx">dblXValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">RA_x</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="w"> </span><span class="nx">dblXValue_raw</span><span class="p">)</span>
<span class="w">            </span><span class="nx">Else</span>
<span class="w">               </span><span class="nx">dblYValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dblYValue_raw</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dblYScaleFactor</span>
<span class="w">               </span><span class="nx">dblXValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dblXValue_raw</span><span class="w">               </span>
<span class="w">            </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>
<span class="w">            </span>
<span class="w">            </span><span class="nx">MyChartAddXY</span><span class="w"> </span><span class="nx">dblXValue</span><span class="p">,</span><span class="w"> </span><span class="nx">dblYValue</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">intColor</span>
<span class="w">            </span><span class="nx">MinMax</span><span class="w"> </span><span class="nx">dblYValue</span><span class="p">,</span><span class="w"> </span><span class="nx">dblYMax</span><span class="p">,</span><span class="w"> </span><span class="nx">dblYMin</span>
<span class="w">            </span><span class="s1">&#39;dicTraceIO.Item(&quot;FoundData&quot;) = True</span>
<span class="s1">         End If</span>
<span class="s1">         rstTelem.MoveNext</span>
<span class="s1">      Loop</span>
<span class="s1">   </span>
<span class="s1">   Else</span>
<span class="s1">      &#39;</span><span class="w"> </span><span class="nx">Multi</span><span class="o">-</span><span class="nx">day</span><span class="w"> </span><span class="nx">charts</span><span class="p">.</span>
<span class="w">      </span>
<span class="w">      </span><span class="nx">ReDim</span><span class="w"> </span><span class="nx">dblTraceArray</span><span class="p">(</span><span class="w"> </span><span class="nx">rstTelem</span><span class="p">.</span><span class="nx">recordcount</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span>
<span class="w">   </span>
<span class="w">      </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">AddSeries</span><span class="p">(</span><span class="w"> </span><span class="nx">intSeriesType</span><span class="p">)</span>
<span class="w">      </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">linewidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">intLineWidth</span>
<span class="w">      </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">SeriesTitle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">strSeriesTitle</span>
<span class="w">      </span>
<span class="w">      </span><span class="nx">intTraceArray_index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span>
<span class="w">      </span><span class="nx">rstTelem</span><span class="p">.</span><span class="nx">MoveFirst</span>
<span class="w">      </span>
<span class="w">      </span><span class="s1">&#39; Reset the running average objects with each new trace.</span>
<span class="s1">      RA_y.reset( rstTelem.RecordCount)</span>
<span class="s1">      RA_x.reset( rstTelem.RecordCount)</span>
<span class="s1">      </span>
<span class="s1">      Do Until rstTelem.EOF</span>
<span class="s1">         If Not IsNull( rstTelem( strSensorName)) Then</span>
<span class="s1">            dblYValue_raw = CDbl(rstTelem( strSensorName))</span>
<span class="s1">            dblXValue_raw = DaysDecSinceRefF()</span>
<span class="s1">            </span>
<span class="s1">            &#39;</span><span class="w"> </span><span class="nx">Do</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nx">running</span><span class="w"> </span><span class="nx">average</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">requested</span><span class="p">.</span>
<span class="w">            </span><span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">strRA_state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;checked&quot;</span><span class="p">)</span><span class="w"> </span><span class="nx">AND</span><span class="w"> </span><span class="p">(</span><span class="nx">rstTelem</span><span class="p">.</span><span class="nx">RecordCount</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">5</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">               </span><span class="nx">dblYValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">RA_y</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="w"> </span><span class="nx">dblYValue_raw</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dblYScaleFactor</span>
<span class="w">               </span><span class="nx">dblXValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">RA_x</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="w"> </span><span class="nx">dblXValue_raw</span><span class="p">)</span>
<span class="w">            </span><span class="nx">Else</span>
<span class="w">               </span><span class="nx">dblYValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dblYValue_raw</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dblYScaleFactor</span>
<span class="w">               </span><span class="nx">dblXValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dblXValue_raw</span><span class="w">               </span>
<span class="w">            </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>
<span class="w">            </span>
<span class="w">            </span><span class="s1">&#39; For these multi-day plots, use the Array approach to save some time.</span>
<span class="s1">            dblTraceArray( intTraceArray_index) = Array( dblXValue, dblYValue, &quot;&quot;, intColor)</span>
<span class="s1">            intTraceArray_index = intTraceArray_index + 1</span>
<span class="s1">            MinMax dblYValue, dblYMax, dblYMin</span>
<span class="s1">            &#39;</span><span class="nx">dicTraceIO</span><span class="p">.</span><span class="nx">Item</span><span class="p">(</span><span class="s2">&quot;FoundData&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">True</span>
<span class="w">         </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>
<span class="w">         </span><span class="nx">rstTelem</span><span class="p">.</span><span class="nx">MoveNext</span>
<span class="w">      </span><span class="nx">Loop</span>
<span class="w">      </span>
<span class="w">      </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">AddXYArray</span><span class="w"> </span><span class="nx">dblTraceArray</span>
<span class="w">   </span>
<span class="w">   </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>
<span class="w">   </span>
<span class="w">   </span><span class="s1">&#39; Note that this assignment can not be made in the call to MinMax. It can&#39;</span><span class="nx">t</span><span class="w"> </span><span class="nx">modify</span><span class="w"> </span><span class="nx">the</span>
<span class="w">   </span><span class="s1">&#39; dictionary values directly (unless you passed it the whole dictionary).</span>
<span class="s1">   dicTraceIO.Item(&quot;YMax&quot;) = dblYMax</span>
<span class="s1">   dicTraceIO.Item(&quot;YMin&quot;) = dblYMin</span>
<span class="s1">      </span>
<span class="s1">   CloseRecordSet rstTelem   </span>
<span class="s1">      </span>
<span class="s1">End Sub</span>

<span class="s1">Sub PlotTheChart()</span>

<span class="s1">   &#39;</span><span class="w"> </span><span class="nb">Set</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">ContentType</span>
<span class="w">   </span><span class="s1">&#39;Response.ContentType = &quot;image/JPEG&quot;</span>

<span class="s1">   &#39;</span><span class="w"> </span><span class="nx">Instantiate</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">Chart</span><span class="w"> </span><span class="nx">component</span>
<span class="w">   </span><span class="nb">Set</span><span class="w"> </span><span class="nx">Chart</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Server</span><span class="p">.</span><span class="nx">CreateObject</span><span class="w"> </span><span class="p">(</span><span class="s2">&quot;ASPChart.Chart&quot;</span><span class="p">)</span>
<span class="w">   </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">JPEGQuality</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">80</span>

<span class="w">   </span><span class="nx">Dim</span><span class="w"> </span><span class="nx">dblTraceArray</span><span class="p">,</span><span class="w"> </span><span class="nx">intTraceArray_index</span><span class="p">,</span><span class="w"> </span><span class="nx">dicTraceIO</span>
<span class="w">   </span>
<span class="w">   </span><span class="s1">&#39; Use this to facilitate a general ByReference argument to the AddTrace subroutine.</span>
<span class="s1">   Set dicTraceIO = Server.CreateObject(&quot;Scripting.Dictionary&quot;)</span>
<span class="s1">   dicTraceIO.Add &quot;YMax&quot;, -999</span>
<span class="s1">   dicTraceIO.Add &quot;YMin&quot;, 999</span>
<span class="s1">   dicTraceIO.Add &quot;FoundData&quot;, False</span>
<span class="s1">   dicTraceIO.Add &quot;FoundData_ForThisTrace&quot;, False</span>
<span class="s1">   &#39;</span><span class="nx">Used</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">Delta</span><span class="o">-</span><span class="nx">P</span><span class="w"> </span><span class="nx">calculations</span><span class="p">.</span>
<span class="w">   </span><span class="nx">dicTraceIO</span><span class="p">.</span><span class="nx">Add</span><span class="w"> </span><span class="s2">&quot;WestSite&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<span class="w">   </span><span class="nx">dicTraceIO</span><span class="p">.</span><span class="nx">Add</span><span class="w"> </span><span class="s2">&quot;EastSite&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<span class="w">   </span>
<span class="w">   </span><span class="s1">&#39; Set dteStartDate_forLabels and dteStartDateTime for use in queries and chart labels...</span>
<span class="s1">   dteStartDate_forLabels = DateAdd(&quot;d&quot;, (1 - intDays), dtePostedDate)</span>
<span class="s1">   </span>
<span class="s1">   &#39;</span><span class="w"> </span><span class="nx">The</span><span class="w"> </span><span class="nx">following</span><span class="w"> </span><span class="nx">is</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nx">somewhat</span><span class="w"> </span><span class="nx">clumsy</span><span class="w"> </span><span class="nx">way</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">deal</span><span class="w"> </span><span class="kd">with</span><span class="w"> </span><span class="nx">daylight</span><span class="w"> </span><span class="nx">savings</span><span class="w"> </span><span class="nx">time</span><span class="w"> </span><span class="nx">and</span><span class="w"> </span>
<span class="w">   </span><span class="s1">&#39; timezone. Noteworthy here is the way that start and end times are shifted </span>
<span class="s1">   &#39;</span><span class="w"> </span><span class="nx">back</span><span class="w"> </span><span class="nx">during</span><span class="w"> </span><span class="nx">periods</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">daylight</span><span class="w"> </span><span class="nx">savings</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="w"> </span><span class="nx">This</span><span class="p">,</span><span class="w"> </span><span class="nx">coupled</span><span class="w"> </span><span class="kd">with</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">way</span><span class="w"> </span><span class="nx">that</span><span class="w"> </span>
<span class="w">   </span><span class="s1">&#39; points are plotted using a decimal day value that is calculated relative to </span>
<span class="s1">   &#39;</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">starting</span><span class="w"> </span><span class="nx">point</span><span class="w"> </span><span class="nx">AND</span><span class="w"> </span><span class="nx">using</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">standard</span><span class="w"> </span><span class="nx">time</span><span class="w"> </span><span class="nx">values</span><span class="w"> </span><span class="nx">that</span><span class="w"> </span><span class="nx">are</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span>
<span class="w">   </span><span class="s1">&#39; database, has the net effect of shifting the standard to DLS values. It&#39;</span><span class="nx">s</span><span class="w"> </span><span class="nx">all</span><span class="w"> </span>
<span class="w">   </span><span class="s1">&#39; a bit confusing. Not completely sure why I originally did it this way. </span>
<span class="s1">   &#39;</span><span class="w"> </span><span class="nx">But</span><span class="w"> </span><span class="nx">one</span><span class="w"> </span><span class="nx">advantage</span><span class="w"> </span><span class="nx">is</span><span class="w"> </span><span class="nx">that</span><span class="w"> </span><span class="nx">when</span><span class="w"> </span><span class="nx">aggregating</span><span class="w"> </span><span class="nx">large</span><span class="w"> </span><span class="nx">amounts</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span>
<span class="w">   </span><span class="s1">&#39; (like in the 25 day plot) each data point does not need to be converted. This </span>
<span class="s1">   &#39;</span><span class="w"> </span><span class="nx">is</span><span class="w"> </span><span class="nx">an</span><span class="w"> </span><span class="nx">efficiency</span><span class="w"> </span><span class="nx">that</span><span class="w"> </span><span class="nx">is</span><span class="w"> </span><span class="nx">probably</span><span class="w"> </span><span class="nx">not</span><span class="w"> </span><span class="nx">noticeable</span><span class="w"> </span><span class="nx">on</span><span class="w"> </span><span class="nx">recent</span><span class="w"> </span><span class="nx">computers</span><span class="w"> </span><span class="p">(</span><span class="mf">2015</span><span class="p">),</span><span class="w"> </span>
<span class="w">   </span><span class="s1">&#39; but probably was worth considering when I first did this 20-some years ago.</span>
<span class="s1">   </span>
<span class="s1">   dteStartDateTime = DateAdd(&quot;d&quot;, (1 - intDays), dtePostedDate)</span>
<span class="s1">   dteEndDateTime = DateAdd(&quot;d&quot;, 1, dtePostedDate)</span>
<span class="s1">   dteNowTime = DateAdd( &quot;h&quot;, dicTZ.item(strTimeZone), Now())</span>
<span class="s1">   If (blnDayLightSavingsTime) Then</span>
<span class="s1">      dteNowTime = DateAdd(&quot;h&quot;, -1, dteNowTime) </span>
<span class="s1">      If (strTimeZone &lt;&gt; &quot;H&quot;) Then</span>
<span class="s1">         dteStartDateTime = DateAdd(&quot;h&quot;, -1, dteStartDateTime)   </span>
<span class="s1">         dteEndDateTime = DateAdd(&quot;h&quot;, -1, dteEndDateTime) </span>
<span class="s1">      End If</span>
<span class="s1">   End If</span>
<span class="s1">   </span>
<span class="s1">   &#39;</span><span class="w"> </span><span class="nx">Initialize</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">start</span><span class="w"> </span><span class="nx">time</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">queries</span><span class="p">.</span><span class="w"> </span><span class="nx">This</span><span class="w"> </span><span class="nx">will</span><span class="w"> </span><span class="nx">later</span><span class="w"> </span><span class="nx">get</span><span class="w"> </span><span class="nx">modified</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="mf">24</span><span class="nx">h</span>
<span class="w">   </span><span class="s1">&#39; versions of the 1-day charts.</span>
<span class="s1">   dteStartDateTime_forQuery = dteStartDateTime</span>
<span class="s1">     </span>
<span class="s1">   &#39;</span><span class="w"> </span><span class="nx">Add</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nx">separate</span><span class="w"> </span><span class="p">(</span><span class="nx">pseudo</span><span class="p">)</span><span class="w"> </span><span class="nx">trace</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">x</span><span class="o">-</span><span class="nx">axis</span><span class="w"> </span><span class="nx">labeling</span><span class="p">.</span><span class="w">  </span><span class="nx">Shift</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">y</span>
<span class="w">   </span><span class="s1">&#39; value by negative 200 so the points don&#39;</span><span class="nx">t</span><span class="w"> </span><span class="nx">show</span><span class="w"> </span><span class="nx">on</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">plot</span><span class="p">.</span><span class="w"> </span><span class="nx">Also</span><span class="w"> </span><span class="nx">prevent</span>
<span class="w">   </span><span class="s1">&#39; it from showing in the legend.</span>
<span class="s1">   &#39;</span>
<span class="w">   </span><span class="s1">&#39; Have tried more direct methods of charting the labels as part of the data</span>
<span class="s1">   &#39;</span><span class="w"> </span><span class="nx">traces</span><span class="w"> </span><span class="nx">but</span><span class="w"> </span><span class="nx">always</span><span class="w"> </span><span class="nx">ran</span><span class="w"> </span><span class="nx">into</span><span class="w"> </span><span class="nx">problems</span><span class="p">.</span><span class="w">  </span><span class="nx">This</span><span class="w"> </span><span class="nx">somewhat</span><span class="w"> </span><span class="nx">indirect</span><span class="w"> </span><span class="p">(</span><span class="nx">but</span>
<span class="w">   </span><span class="s1">&#39; successful) method offers more control and is general for any numeric</span>
<span class="s1">   &#39;</span><span class="w"> </span><span class="nx">based</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="nx">axis</span><span class="p">.</span>

<span class="w">   </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">AddSeries</span><span class="w"> </span><span class="p">(</span><span class="mf">5</span><span class="p">)</span>
<span class="w">   </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">linewidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span>
<span class="w">   </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">SeriesTitle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot; &quot;</span>
<span class="w">   </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">SeriesInLegend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">False</span><span class="w">   </span>
<span class="w">   </span>
<span class="w">   </span><span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">intDays</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">      </span><span class="nx">TimeLabels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Array</span><span class="p">(</span><span class="s2">&quot;12m&quot;</span><span class="p">,</span><span class="s2">&quot;1&quot;</span><span class="p">,</span><span class="s2">&quot;2&quot;</span><span class="p">,</span><span class="s2">&quot;3&quot;</span><span class="p">,</span><span class="s2">&quot;4&quot;</span><span class="p">,</span><span class="s2">&quot;5&quot;</span><span class="p">,</span><span class="s2">&quot;6am&quot;</span><span class="p">,</span><span class="s2">&quot;7&quot;</span><span class="p">,</span><span class="s2">&quot;8&quot;</span><span class="p">,</span><span class="s2">&quot;9&quot;</span><span class="p">,</span><span class="s2">&quot;10&quot;</span><span class="p">,</span><span class="s2">&quot;11&quot;</span><span class="p">,</span><span class="s2">&quot;12n&quot;</span><span class="p">,</span><span class="s2">&quot;1&quot;</span><span class="p">,</span><span class="s2">&quot;2&quot;</span><span class="p">,</span><span class="s2">&quot;3&quot;</span><span class="p">,</span><span class="s2">&quot;4&quot;</span><span class="p">,</span><span class="s2">&quot;5&quot;</span><span class="p">,</span><span class="s2">&quot;6pm&quot;</span><span class="p">,</span><span class="s2">&quot;7&quot;</span><span class="p">,</span><span class="s2">&quot;8&quot;</span><span class="p">,</span><span class="s2">&quot;9&quot;</span><span class="p">,</span><span class="s2">&quot;10&quot;</span><span class="p">,</span><span class="s2">&quot;11&quot;</span><span class="p">,</span><span class="s2">&quot;12m&quot;</span><span class="p">)</span>

<span class="w">      </span><span class="nx">For</span><span class="w"> </span><span class="nx">intHour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="mf">24</span>
<span class="w">         </span><span class="s1">&#39; The key difference in this dummy trace is that it has a parameter</span>
<span class="s1">         &#39;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">label</span><span class="p">.</span><span class="w">  </span><span class="nx">All</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="nx">traces</span><span class="w"> </span><span class="nx">below</span><span class="w"> </span><span class="nx">have</span><span class="w"> </span><span class="nx">an</span><span class="w"> </span><span class="nx">empty</span><span class="w"> </span><span class="nx">string</span><span class="w"> </span><span class="ow">in</span>
<span class="w">         </span><span class="s1">&#39; that position.</span>

<span class="s1">         MyChartAddXY (CDbl(intHour)/24.0), 0 - 200, TimeLabels(intHour), vbWhite   </span>
<span class="s1">      Next</span>
<span class="s1">      </span>
<span class="s1">   Else      </span>
<span class="s1">      &#39;</span><span class="w"> </span><span class="nx">Make</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nx">special</span><span class="w"> </span><span class="nx">label</span><span class="w"> </span><span class="nx">trace</span><span class="w"> </span><span class="p">(</span><span class="nx">dummy</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">multiple</span><span class="o">-</span><span class="nx">day</span><span class="w"> </span><span class="nx">charts</span><span class="p">...</span>
<span class="w">      </span>
<span class="w">      </span><span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">intDays</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">2</span><span class="p">)</span><span class="w"> </span><span class="nx">AND</span><span class="w"> </span><span class="p">(</span><span class="nx">intDays</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">4</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">         </span><span class="nx">intLabelsPerDay</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">4</span>
<span class="w">      </span><span class="nx">ElseIf</span><span class="w"> </span><span class="p">(</span><span class="nx">intDays</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">5</span><span class="p">)</span><span class="w"> </span><span class="nx">AND</span><span class="w"> </span><span class="p">(</span><span class="nx">intDays</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">9</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">         </span><span class="nx">intLabelsPerDay</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2</span>
<span class="w">      </span><span class="nx">ElseIf</span><span class="w"> </span><span class="p">(</span><span class="nx">intDays</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">10</span><span class="p">)</span><span class="w"> </span><span class="nx">AND</span><span class="w"> </span><span class="p">(</span><span class="nx">intDays</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">25</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">         </span><span class="nx">intLabelsPerDay</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span>
<span class="w">      </span><span class="nx">Else</span>
<span class="w">         </span><span class="s1">&#39; Shouldn&#39;</span><span class="nx">t</span><span class="w"> </span><span class="nx">be</span><span class="w"> </span><span class="nx">able</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">get</span><span class="w"> </span><span class="nx">here</span><span class="p">...</span>
<span class="w">      </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span><span class="w">      </span>

<span class="w">      </span><span class="nx">intXLabels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">intDays</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">intLabelsPerDay</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span>
<span class="w">      </span><span class="s1">&#39; Dim the dynamic array...</span>
<span class="s1">      ReDim strTimeLabels(intXLabels)</span>
<span class="s1">      dblDaysIncrement = 1 / intLabelsPerDay</span>
<span class="s1">         </span>
<span class="s1">      For intJ = 0 To intXLabels - 1</span>
<span class="s1">         dblDaysFraction = intJ * dblDaysIncrement</span>
<span class="s1">         </span>
<span class="s1">         &#39;</span><span class="w"> </span><span class="nx">Put</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nx">Day</span><span class="w"> </span><span class="nx">label</span><span class="w"> </span><span class="nx">on</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">integer</span><span class="w"> </span><span class="nx">values</span><span class="w"> </span><span class="p">(</span><span class="nx">midnight</span><span class="p">)...</span>
<span class="w">         </span><span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">dblDaysFraction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Int</span><span class="p">(</span><span class="nx">dblDaysFraction</span><span class="p">))</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">            </span><span class="nx">dteLabelDate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">DateAdd</span><span class="p">(</span><span class="s2">&quot;d&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">Int</span><span class="p">(</span><span class="nx">dblDaysFraction</span><span class="p">),</span><span class="w"> </span><span class="nx">dteStartDate_forLabels</span><span class="p">)</span>
<span class="w">            </span><span class="nx">strTimeLabels</span><span class="p">(</span><span class="nx">intJ</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Left</span><span class="p">(</span><span class="nx">WeekDayName</span><span class="p">(</span><span class="nx">WeekDay</span><span class="p">(</span><span class="nx">dteLabelDate</span><span class="p">),</span><span class="w"> </span><span class="nx">True</span><span class="p">),</span><span class="mf">2</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;-&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">Day</span><span class="p">(</span><span class="nx">dteLabelDate</span><span class="p">)</span>
<span class="w">         </span><span class="nx">Else</span>
<span class="w">            </span><span class="nx">dblFractionalPart</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dblDaysFraction</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">Int</span><span class="p">(</span><span class="nx">dblDaysFraction</span><span class="p">)</span>
<span class="w">            </span><span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">dblFractionalPart</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.50</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">               </span><span class="s1">&#39; Suppress the 12n marks for 7 though 9.</span>
<span class="s1">               If (intDays &lt;= 6) Then</span>
<span class="s1">                  strTimeLabels(intJ) = &quot;12n&quot;</span>
<span class="s1">               Else</span>
<span class="s1">                  strTimeLabels(intJ) = &quot;&quot;</span>
<span class="s1">               End If</span>
<span class="s1">            Else</span>
<span class="s1">               strTimeLabels(intJ) = &quot;&quot; &#39;</span><span class="nx">CStr</span><span class="p">(</span><span class="nx">dblDaysFraction</span><span class="p">)</span>
<span class="w">            </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span><span class="w">      </span>
<span class="w">         </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>
<span class="w">      </span><span class="nx">Next</span>

<span class="w">      </span><span class="s1">&#39; Plot the pseudo trace....         </span>
<span class="s1">      For intJ = 0 To intXLabels - 1</span>
<span class="s1">         &#39;</span><span class="w"> </span><span class="nx">The</span><span class="w"> </span><span class="nx">key</span><span class="w"> </span><span class="nx">difference</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="nx">pseudo</span><span class="w"> </span><span class="nx">trace</span><span class="w"> </span><span class="nx">is</span><span class="w"> </span><span class="nx">that</span><span class="w"> </span><span class="nx">it</span><span class="w"> </span><span class="nx">has</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nx">parameter</span>
<span class="w">         </span><span class="s1">&#39; for the label. All the data traces below have an empty string in</span>
<span class="s1">         &#39;</span><span class="w"> </span><span class="nx">that</span><span class="w"> </span><span class="nx">position</span><span class="p">.</span>

<span class="w">         </span><span class="nx">MyChartAddXY</span><span class="w"> </span><span class="nx">intJ</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dblDaysIncrement</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">200</span><span class="p">,</span><span class="w"> </span><span class="nx">strTimeLabels</span><span class="p">(</span><span class="nx">intJ</span><span class="p">),</span><span class="w"> </span><span class="nx">vbWhite</span><span class="w">   </span>
<span class="w">      </span><span class="nx">Next</span><span class="w">      </span>

<span class="w">   </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>

<span class="w">   </span><span class="s1">&#39;===============================================================================</span>
<span class="s1">   &#39;</span><span class="w"> </span><span class="nx">Populate</span><span class="w"> </span><span class="nx">trace</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span><span class="w"> </span><span class="nx">depending</span><span class="w"> </span><span class="nx">on</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">sensor</span><span class="w"> </span><span class="nx">or</span><span class="w"> </span><span class="nx">plot</span><span class="w"> </span><span class="nx">type</span><span class="p">...</span>
<span class="w">   </span><span class="s1">&#39;===============================================================================  </span>
<span class="s1">   </span>
<span class="s1">   If (left(strSensor,4) = &quot;Wind&quot;) Then</span>
<span class="s1">   </span>
<span class="s1">      intGray = 175</span>
<span class="s1">      </span>
<span class="s1">      &#39;</span><span class="w"> </span><span class="nx">Make</span><span class="w"> </span><span class="nx">horizontal</span><span class="w"> </span><span class="nx">lines</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">compass</span><span class="w"> </span><span class="nx">points</span><span class="p">.</span><span class="w"> </span><span class="nx">Do</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="nx">before</span><span class="w"> </span><span class="nx">adding</span><span class="w"> </span><span class="nx">the</span>
<span class="w">      </span><span class="s1">&#39; trace lines so data points will lay on top of this reference lines.</span>
<span class="s1">       </span>
<span class="s1">      If (strSensor = &quot;Wind36&quot;) Then</span>
<span class="s1">         AddHorizontalLine_gray 1, intGray,  45 * dblWindNormFactor</span>
<span class="s1">         AddHorizontalLine_gray 1, intGray, 135 * dblWindNormFactor</span>
<span class="s1">         AddHorizontalLine_gray 1, intGray, 225 * dblWindNormFactor</span>
<span class="s1">         AddHorizontalLine_gray 1, intGray, 315 * dblWindNormFactor</span>
<span class="s1">      End If</span>
<span class="s1">     </span>
<span class="s1">      &#39;</span><span class="w"> </span><span class="nx">These</span><span class="w"> </span><span class="nx">are</span><span class="w"> </span><span class="nx">common</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">both</span><span class="w"> </span><span class="nx">Wind40</span><span class="w"> </span><span class="nx">and</span><span class="w"> </span><span class="nx">Wind36</span>
<span class="w">      </span><span class="nx">AddHorizontalLine_gray</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="nx">intGray</span><span class="p">,</span><span class="w">   </span><span class="mf">0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dblWindNormFactor</span>
<span class="w">      </span><span class="nx">AddHorizontalLine_gray</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="nx">intGray</span><span class="p">,</span><span class="w">  </span><span class="mf">90</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dblWindNormFactor</span>
<span class="w">      </span><span class="nx">AddHorizontalLine_gray</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="nx">intGray</span><span class="p">,</span><span class="w"> </span><span class="mf">180</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dblWindNormFactor</span>
<span class="w">      </span><span class="nx">AddHorizontalLine_gray</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="nx">intGray</span><span class="p">,</span><span class="w"> </span><span class="mf">270</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dblWindNormFactor</span>
<span class="w">      </span><span class="nx">AddHorizontalLine_gray</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="nx">intGray</span><span class="p">,</span><span class="w"> </span><span class="mf">360</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dblWindNormFactor</span>
<span class="w">      </span>
<span class="w">      </span><span class="nx">AddTrace</span><span class="w"> </span><span class="s2">&quot;WindDirection&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">dblWindNormFactor</span><span class="p">,</span><span class="w"> </span><span class="mf">6</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Direction               &quot;</span><span class="p">,</span><span class="w">     </span><span class="mf">3</span><span class="p">,</span><span class="w"> </span><span class="nx">vbWhite</span><span class="p">,</span><span class="w">             </span><span class="nx">dicTraceIO</span>
<span class="w">      </span><span class="nx">AddTrace</span><span class="w"> </span><span class="s2">&quot;WindGust&quot;</span><span class="p">,</span><span class="w">      </span><span class="mf">1.0</span><span class="p">,</span><span class="w">               </span><span class="mf">5</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Maximum Speed&quot;</span><span class="p">,</span><span class="w">                </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="nx">RGB</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">h00</span><span class="p">,</span><span class="o">&amp;</span><span class="nx">h80</span><span class="p">,</span><span class="o">&amp;</span><span class="nx">h80</span><span class="p">),</span><span class="w"> </span><span class="nx">dicTraceIO</span><span class="w">     </span>
<span class="w">      </span><span class="nx">intMaxGust</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dicTraceIO</span><span class="p">.</span><span class="nx">Item</span><span class="p">(</span><span class="s2">&quot;YMax&quot;</span><span class="p">)</span>
<span class="w">      </span><span class="nx">AddTrace</span><span class="w"> </span><span class="s2">&quot;WindSpeed&quot;</span><span class="p">,</span><span class="w">     </span><span class="mf">1.0</span><span class="p">,</span><span class="w">               </span><span class="mf">5</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Average Speed&quot;</span><span class="p">,</span><span class="w">                </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="nx">vbRed</span><span class="p">,</span><span class="w">               </span><span class="nx">dicTraceIO</span>
<span class="w">      </span>
<span class="w">      </span><span class="nx">If</span><span class="w"> </span><span class="nx">dicTraceIO</span><span class="p">.</span><span class="nx">Item</span><span class="p">(</span><span class="s2">&quot;FoundData&quot;</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">      </span>
<span class="w">         </span><span class="s1">&#39; To be consistent with the other sensor charts, putting these scale</span>
<span class="s1">         &#39;</span><span class="w"> </span><span class="nx">limits</span><span class="w"> </span><span class="nx">here</span><span class="p">,</span><span class="w"> </span><span class="nx">after</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">trace</span><span class="w"> </span><span class="nx">filling</span><span class="w"> </span><span class="nx">calls</span><span class="w"> </span><span class="nx">above</span><span class="p">.</span>

<span class="w">         </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">VertAxisMin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="w">  </span><span class="s1">&#39;-10</span>
<span class="s1">         If     (intMaxGust &gt; 40) then</span>
<span class="s1">            Chart.VertAxisMax = CDbl(intMaxGust)</span>
<span class="s1">         Else</span>
<span class="s1">            Chart.VertAxisMax = 40.0</span>
<span class="s1">         End If</span>
<span class="s1">               </span>
<span class="s1">         Chart.AddAxisLabel 1, &quot;Wind Speed (mph)&quot;</span>

<span class="s1">         If (intDays &gt; 1) then</span>
<span class="s1">            Chart.ChartTitleAdd  &quot; Wind at &quot; &amp; strNameForPlot </span>
<span class="s1">            Chart.HorizAxisMin = 0.00      </span>
<span class="s1">         Else</span>
<span class="s1">            Chart.ChartTitleAdd  &quot; Wind at &quot; &amp; strNameForPlot &amp; &quot; on &quot; &amp; WeekDayName(WeekDay(dtePostedDate)) &amp; &quot; &quot; &amp; dtePostedDate</span>
<span class="s1">            Chart.HorizAxisMin = 0.04      </span>
<span class="s1">         End If</span>

<span class="s1">         &#39;</span><span class="w"> </span><span class="nx">Use</span><span class="w"> </span><span class="nx">tweak</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="o">-</span><span class="mf">4</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">there</span><span class="w"> </span><span class="nx">is</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nx">carriage</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">after</span><span class="w"> </span><span class="nx">each</span><span class="w"> </span><span class="nx">image</span><span class="w"> </span><span class="nx">element</span>
<span class="w">         </span><span class="s1">&#39; in the div.</span>
<span class="s1">         intPixelRightShift_tweak = -4</span>
<span class="s1">         If (intDays &gt;= 10) Then</span>
<span class="s1">            Chart.Width = 1250 + 61  &#39;</span><span class="w"> </span><span class="nx">The</span><span class="w"> </span><span class="mf">61</span><span class="w"> </span><span class="nx">helps</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">get</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">days</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">line</span><span class="w"> </span><span class="nx">up</span><span class="w"> </span><span class="kd">with</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">temperature</span><span class="w"> </span><span class="nx">chart</span><span class="p">.</span>
<span class="w">            </span><span class="nx">intPixelRightShift</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mf">210</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">intPixelRightShift_tweak</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">3</span><span class="w">  </span><span class="s1">&#39; The -3 is a secondary tweak needed after I added the 61 in the line above.</span>
<span class="s1">         Else</span>
<span class="s1">            Chart.Width = 855</span>
<span class="s1">            intPixelRightShift = -188 + intPixelRightShift_tweak</span>
<span class="s1">         End If</span>

<span class="s1">         &#39;</span><span class="w"> </span><span class="nb">Set</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">chart</span><span class="w"> </span><span class="nx">height</span><span class="w"> </span><span class="nx">based</span><span class="w"> </span><span class="nx">on</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">y</span><span class="o">-</span><span class="nx">axis</span><span class="w"> </span><span class="nx">maximum</span><span class="w"> </span><span class="nx">value</span><span class="p">.</span><span class="w">  </span><span class="nx">Scale</span><span class="w"> </span><span class="nx">up</span><span class="w"> </span><span class="nx">the</span>
<span class="w">         </span><span class="s1">&#39; plotting area by the ratio of intMaxGust/40.</span>

<span class="s1">         intNonPlottingHeight =  75 </span>
<span class="s1">         If (intMaxGust &gt; 40) then    </span>
<span class="s1">            Chart.Height = ((500 - intNonPlottingHeight) * (intMaxGust/40)) + intNonPlottingHeight</span>
<span class="s1">            &#39;</span><span class="w"> </span><span class="nx">This</span><span class="w"> </span><span class="nx">gets</span><span class="w"> </span><span class="nx">used</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">style</span><span class="o">-</span><span class="nx">sheet</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">positions</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">directions</span><span class="o">-</span><span class="nx">overlay</span><span class="w"> </span><span class="nx">image</span><span class="p">.</span>
<span class="w">            </span><span class="nx">intPixelBottomShift</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Fix</span><span class="p">((</span><span class="nx">intMaxGust</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.320</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">11</span><span class="p">)</span><span class="w">  </span><span class="s1">&#39;This is always positive.</span>
<span class="s1">            </span>
<span class="s1">         Else</span>
<span class="s1">            Chart.Height = 500</span>
<span class="s1">            intPixelBottomShift = 0</span>
<span class="s1">         End If</span>
<span class="s1">         </span>
<span class="s1">         Chart.LeftAxisIncrement = 5</span>
<span class="s1">      </span>
<span class="s1">      End If</span>

<span class="s1">   ElseIf (strSensor = &quot;Temperature&quot;) Then</span>
<span class="s1">         </span>
<span class="s1">      &#39;</span><span class="w"> </span><span class="nx">Do</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="nx">one</span><span class="w"> </span><span class="nx">first</span><span class="p">.</span><span class="w"> </span><span class="nx">This</span><span class="w"> </span><span class="nx">one</span><span class="w"> </span><span class="nx">should</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">any</span><span class="w"> </span><span class="nx">type</span>
<span class="w">      </span><span class="s1">&#39; of temperature plot. If not, don&#39;</span><span class="nx">t</span><span class="w"> </span><span class="k">try</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">other</span><span class="w"> </span><span class="nx">parts</span><span class="p">.</span>
<span class="w">      </span><span class="nx">AddTrace</span><span class="w"> </span><span class="s2">&quot;TempAvg&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="mf">5</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Dry Bulb&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="nx">vbRed</span><span class="p">,</span><span class="w"> </span><span class="nx">dicTraceIO</span><span class="w">  </span>
<span class="w">            </span>
<span class="w">      </span><span class="nx">If</span><span class="w"> </span><span class="nx">dicTraceIO</span><span class="p">.</span><span class="nx">Item</span><span class="p">(</span><span class="s2">&quot;FoundData&quot;</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">         </span>
<span class="w">         </span><span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">MinMaxFifteenMinData</span><span class="p">(</span><span class="s2">&quot;Min&quot;</span><span class="p">,</span><span class="s2">&quot;TempMin&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="o">-</span><span class="mf">999</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">            </span><span class="nx">AddTrace</span><span class="w"> </span><span class="s2">&quot;TempMin&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="mf">5</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;  Min&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="nx">vbBlack</span><span class="p">,</span><span class="w"> </span><span class="nx">dicTraceIO</span>
<span class="w">            </span><span class="nx">AddTrace</span><span class="w"> </span><span class="s2">&quot;TempMax&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="mf">5</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;  Max&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="nx">vbBlack</span><span class="p">,</span><span class="w"> </span><span class="nx">dicTraceIO</span>
<span class="w">         </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>
<span class="w">         </span>
<span class="w">         </span><span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">MinMaxFifteenMinData</span><span class="p">(</span><span class="s2">&quot;Min&quot;</span><span class="p">,</span><span class="s2">&quot;DewPoint&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="o">-</span><span class="mf">999</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">            </span><span class="nx">AddTrace</span><span class="w"> </span><span class="s2">&quot;DewPoint&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="mf">5</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Dew Point&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="nx">RGB</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">h00</span><span class="p">,</span><span class="o">&amp;</span><span class="nx">h80</span><span class="p">,</span><span class="o">&amp;</span><span class="nx">h80</span><span class="p">),</span><span class="w"> </span><span class="nx">dicTraceIO</span>
<span class="w">         </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>
<span class="w">      </span>
<span class="w">         </span><span class="s1">&#39; Ongoing (overall) Min and Max values are collected in dicTraceIO as each trace</span>
<span class="s1">         &#39;</span><span class="w"> </span><span class="nx">generated</span><span class="p">.</span>
<span class="w">         </span><span class="nx">sglTempMin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dicTraceIO</span><span class="p">(</span><span class="s2">&quot;YMin&quot;</span><span class="p">)</span>
<span class="w">         </span><span class="nx">sglTempMax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dicTraceIO</span><span class="p">(</span><span class="s2">&quot;YMax&quot;</span><span class="p">)</span>
<span class="w">         </span><span class="nx">sglTempRange</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">sglTempMax</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">sglTempMin</span>
<span class="w">         </span>
<span class="w">         </span><span class="s1">&#39; To be consistent with the other sensor charts, putting these scale</span>
<span class="s1">         &#39;</span><span class="w"> </span><span class="nx">limits</span><span class="w"> </span><span class="nx">here</span><span class="p">,</span><span class="w"> </span><span class="nx">after</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">trace</span><span class="w"> </span><span class="nx">filling</span><span class="w"> </span><span class="nx">loop</span><span class="w"> </span><span class="nx">above</span><span class="p">.</span><span class="w"> </span><span class="nx">But</span><span class="w"> </span><span class="nx">seems</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">work</span>
<span class="w">         </span><span class="s1">&#39; either way here...</span>

<span class="s1">         intTempDiffScalingThreshold = 40</span>
<span class="s1">         intNonPlottingHeight = 108</span>
<span class="s1">         If (sglTempRange &lt; intTempDiffScalingThreshold) then</span>
<span class="s1">            Chart.VertAxisMin = sglTempMin - ((intTempDiffScalingThreshold - sglTempRange)/2)</span>
<span class="s1">            Chart.VertAxisMax = sglTempMax + ((intTempDiffScalingThreshold - sglTempRange)/2)</span>
<span class="s1">            Chart.Height = 500</span>
<span class="s1">         Else</span>
<span class="s1">            &#39;</span><span class="w"> </span><span class="nx">The</span><span class="w"> </span><span class="mf">0.2</span><span class="w"> </span><span class="nx">keeps</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">max</span><span class="w"> </span><span class="nx">and</span><span class="w"> </span><span class="nx">min</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="nx">being</span><span class="w"> </span><span class="nx">obscured</span><span class="w"> </span><span class="nx">by</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">outer</span>
<span class="w">            </span><span class="s1">&#39; boundaries of the charting area.</span>
<span class="s1">            Chart.VertAxisMin = sglTempMin - 0.2     </span>
<span class="s1">            Chart.VertAxisMax = sglTempMax + 0.2</span>
<span class="s1">            Chart.Height = ((500 - intNonPlottingHeight) * (sglTempRange/intTempDiffScalingThreshold)) + intNonPlottingHeight    </span>
<span class="s1">         End If</span>

<span class="s1">         Chart.LeftAxisIncrement = 5</span>
<span class="s1">         </span>
<span class="s1">         </span>
<span class="s1">         &#39;</span><span class="w"> </span><span class="nx">Y</span><span class="w"> </span><span class="nx">axis</span><span class="w"> </span><span class="nx">label</span>
<span class="w">         </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">AddAxisLabel</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Temperature (F)&quot;</span>
<span class="w">             </span>
<span class="w">         </span><span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">intDays</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">            </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">ChartTitleAdd</span><span class="w">  </span><span class="s2">&quot; Temperature at &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">strNameForPlot</span>
<span class="w">         </span><span class="nx">Else</span>
<span class="w">            </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">ChartTitleAdd</span><span class="w">  </span><span class="s2">&quot; Temperature at &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">strNameForPlot</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot; on &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">WeekDayName</span><span class="p">(</span><span class="nx">WeekDay</span><span class="p">(</span><span class="nx">dtePostedDate</span><span class="p">))</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot; &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">dtePostedDate</span>
<span class="w">         </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span><span class="w">    </span>

<span class="w">         </span><span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">intDays</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">10</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">            </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">Width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1250</span>
<span class="w">         </span><span class="nx">Else</span>
<span class="w">            </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">Width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">791</span><span class="w">  </span><span class="s1">&#39;780            </span>
<span class="s1">         End If</span>

<span class="s1">      End If</span>
<span class="s1">      </span>
<span class="s1">   ElseIf (strSensor = &quot;Pressure&quot;) Then</span>

<span class="s1">      &#39;</span><span class="w"> </span><span class="nx">The</span><span class="w"> </span><span class="nx">Pressure</span><span class="w"> </span><span class="nx">Plot</span><span class="p">.</span>
<span class="w">      </span>
<span class="w">      </span><span class="nx">AddTrace</span><span class="w"> </span><span class="s2">&quot;Pressure&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="mf">5</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;no trace label&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="nx">vbRed</span><span class="p">,</span><span class="w"> </span><span class="nx">dicTraceIO</span>
<span class="w">      </span>
<span class="w">      </span><span class="nx">If</span><span class="w"> </span><span class="nx">dicTraceIO</span><span class="p">.</span><span class="nx">Item</span><span class="p">(</span><span class="s2">&quot;FoundData&quot;</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">      </span>
<span class="w">         </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">SeriesInLegend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">False</span>
<span class="w">         </span><span class="nx">sglPressureMin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dicTraceIO</span><span class="p">.</span><span class="nx">Item</span><span class="p">(</span><span class="s2">&quot;YMin&quot;</span><span class="p">)</span>
<span class="w">         </span><span class="nx">sglPressureMax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">dicTraceIO</span><span class="p">.</span><span class="nx">Item</span><span class="p">(</span><span class="s2">&quot;YMax&quot;</span><span class="p">)</span>
<span class="w">         </span>
<span class="w">         </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">AddAxisLabel</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Pressure (Inches Hg)&quot;</span>
<span class="w">                  </span>
<span class="w">         </span><span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">intDays</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span><span class="w"> </span><span class="nx">then</span>
<span class="w">            </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">ChartTitleAdd</span><span class="w">  </span><span class="s2">&quot; Barometer at &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">strNameForPlot</span>
<span class="w">         </span><span class="nx">Else</span>
<span class="w">            </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">ChartTitleAdd</span><span class="w">  </span><span class="s2">&quot; Barometer at &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">strNameForPlot</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot; on &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">WeekDayName</span><span class="p">(</span><span class="nx">WeekDay</span><span class="p">(</span><span class="nx">dtePostedDate</span><span class="p">))</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot; &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">dtePostedDate</span>
<span class="w">         </span><span class="nx">end</span><span class="w"> </span><span class="nx">If</span><span class="w">    </span>
<span class="w">      </span>
<span class="w">         </span><span class="s1">&#39; Note: these axis limits only work if they come after</span>
<span class="s1">         &#39;</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">chart</span><span class="w"> </span><span class="nx">filling</span><span class="w"> </span><span class="nx">loop</span><span class="w"> </span><span class="nx">above</span><span class="p">...</span>

<span class="w">         </span><span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">sglPressureMin</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">29.42</span><span class="p">)</span><span class="w"> </span><span class="nx">then</span><span class="w"> </span>
<span class="w">            </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">VertAxisMin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">sglPressureMin</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">0.005</span>
<span class="w">         </span><span class="nx">Else</span>
<span class="w">            </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">VertAxisMin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">29.41</span>
<span class="w">         </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span><span class="w">    </span>
<span class="w">         </span>
<span class="w">         </span><span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">sglPressureMax</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">30.42</span><span class="p">)</span><span class="w"> </span><span class="nx">then</span><span class="w"> </span>
<span class="w">            </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">VertAxisMax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">sglPressureMax</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.005</span>
<span class="w">         </span><span class="nx">Else</span>
<span class="w">            </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">VertAxisMax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">30.43</span>
<span class="w">         </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span><span class="w">        </span>
<span class="w">            </span>
<span class="w">         </span><span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">sglPressureMin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="nx">then</span>
<span class="w">            </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">VertAxisMin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mf">0.5</span>
<span class="w">            </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">VertAxisMax</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="mf">0.5</span><span class="w">   </span>
<span class="w">         </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>
<span class="w">         </span>
<span class="w">         </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">LeftAxisIncrement</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.1</span>
<span class="w">         </span>
<span class="w">         </span><span class="s1">&#39;Chart.AddAxisLabel 1, &quot;Pressure (Inches Hg)&quot;</span>
<span class="s1">         </span>
<span class="s1">         Chart.Height = 500</span>
<span class="s1">         If (intDays &gt;= 10) Then</span>
<span class="s1">            Chart.Width = 1128</span>
<span class="s1">         Else</span>
<span class="s1">            Chart.Width = 685</span>
<span class="s1">         End If</span>

<span class="s1">      End If</span>
<span class="s1">  </span>
<span class="s1">   ElseIf (Left(strSensor,6) = &quot;DeltaP&quot;) Then</span>

<span class="s1">      &#39;</span><span class="w"> </span><span class="nx">The</span><span class="w"> </span><span class="nx">Delta</span><span class="o">-</span><span class="nx">P</span><span class="w"> </span><span class="nx">plot</span><span class="p">.</span>
<span class="w">      </span>
<span class="w">      </span><span class="s1">&#39; Add some horizontal lines</span>
<span class="s1">      Chart.AddSeries (5)</span>
<span class="s1">      Chart.linewidth = 2</span>
<span class="s1">      Chart.SeriesInLegend = False</span>
<span class="s1">      MyChartAddXY 0, 0, &quot;&quot;, vbBlack   </span>
<span class="s1">      If (Request.QueryString(&quot;specName&quot;) = &quot;&quot;) Then</span>
<span class="s1">         MyChartAddXY intDays+1, 0, &quot;&quot;, vbWhite</span>
<span class="s1">      Else</span>
<span class="s1">         &#39;</span><span class="w"> </span><span class="nx">Gray</span><span class="w"> </span><span class="nx">line</span><span class="w"> </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="nx">request</span><span class="w"> </span><span class="nx">is</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="mf">50</span><span class="nx">Webs</span><span class="w"> </span><span class="nx">example</span><span class="w"> </span><span class="nx">chart</span><span class="w"> </span><span class="nx">page</span><span class="p">).</span>
<span class="w">         </span><span class="nx">MyChartAddXY</span><span class="w"> </span><span class="nx">intDays</span><span class="o">+</span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">RGB</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">hB5</span><span class="p">,</span><span class="o">&amp;</span><span class="nx">hB5</span><span class="p">,</span><span class="o">&amp;</span><span class="nx">hB5</span><span class="p">)</span><span class="w">     </span>
<span class="w">      </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>
<span class="w">      </span>
<span class="w">      </span><span class="s1">&#39; Add the delta-P traces.</span>
<span class="s1">      </span>
<span class="s1">      If (strSensor = &quot;DeltaP1&quot;) Then</span>
<span class="s1">               </span>
<span class="s1">         dicTraceIO(&quot;WestSite&quot;) = &quot;PORTLAND&quot;</span>
<span class="s1">         dicTraceIO(&quot;EastSite&quot;) = &quot;THE DALLES&quot;</span>
<span class="s1">         AddTrace &quot;DeltaP&quot;, 1.0, 5, &quot;Portland - The Dalles &quot;, 2, RGB(&amp;h00,&amp;h80,&amp;h80), dicTraceIO</span>
<span class="s1">         </span>
<span class="s1">         dicTraceIO(&quot;WestSite&quot;) = &quot;THE DALLES&quot;</span>
<span class="s1">         dicTraceIO(&quot;EastSite&quot;) = &quot;PASCO&quot;</span>
<span class="s1">         AddTrace &quot;DeltaP&quot;, 1.0, 5, &quot;The Dalles - Pasco&quot;, 2, vbRed, dicTraceIO</span>
<span class="s1">         </span>
<span class="s1">         &#39;</span><span class="s2">&quot;NORTH BEND&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;PASCO&quot;</span>
<span class="w">               </span>
<span class="w">      </span><span class="nx">ElseIf</span><span class="w"> </span><span class="p">(</span><span class="nx">strSensor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;DeltaP2&quot;</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">         </span>
<span class="w">         </span><span class="nx">dicTraceIO</span><span class="p">(</span><span class="s2">&quot;WestSite&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;KTTD&quot;</span>
<span class="w">         </span><span class="nx">dicTraceIO</span><span class="p">(</span><span class="s2">&quot;EastSite&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;KDLS&quot;</span>
<span class="w">         </span><span class="nx">AddTrace</span><span class="w"> </span><span class="s2">&quot;DeltaP&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="mf">5</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Troutdale - The Dalles&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="nx">RGB</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">h00</span><span class="p">,</span><span class="o">&amp;</span><span class="nx">h80</span><span class="p">,</span><span class="o">&amp;</span><span class="nx">h80</span><span class="p">),</span><span class="w"> </span><span class="nx">dicTraceIO</span>
<span class="w">         </span>
<span class="w">         </span><span class="nx">dicTraceIO</span><span class="p">(</span><span class="s2">&quot;WestSite&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;KDLS&quot;</span>
<span class="w">         </span><span class="nx">dicTraceIO</span><span class="p">(</span><span class="s2">&quot;EastSite&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;KHRI&quot;</span>
<span class="w">         </span><span class="nx">AddTrace</span><span class="w"> </span><span class="s2">&quot;DeltaP&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="mf">5</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;The Dalles - Hermiston&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="nx">vbRed</span><span class="p">,</span><span class="w"> </span><span class="nx">dicTraceIO</span>
<span class="w">         </span>
<span class="w">         </span><span class="s1">&#39; dicTraceIO(&quot;WestSite&quot;) = &quot;KTTD&quot;</span>
<span class="s1">         &#39;</span><span class="w"> </span><span class="nx">dicTraceIO</span><span class="p">(</span><span class="s2">&quot;EastSite&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;KHRI&quot;</span>
<span class="w">         </span><span class="s1">&#39; AddTrace &quot;DeltaP&quot;, 1.0, 5, &quot;Troutdale - Hermiston&quot;, 2, vbBlue, dicTraceIO</span>

<span class="s1">      End If</span>
<span class="s1">      </span>
<span class="s1">      If dicTraceIO.Item(&quot;FoundData&quot;) Then</span>
<span class="s1">         </span>
<span class="s1">         &#39;</span><span class="w"> </span><span class="nx">Force</span><span class="w"> </span><span class="nx">limits</span><span class="w"> </span><span class="nx">on</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">Y</span><span class="w"> </span><span class="nx">axis</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">Delta</span><span class="o">-</span><span class="nx">P</span><span class="w"> </span><span class="nx">chart</span><span class="p">.</span><span class="w"> </span><span class="nx">Note</span><span class="o">:</span><span class="w"> </span><span class="nx">these</span><span class="w"> </span><span class="nx">must</span><span class="w"> </span><span class="nx">come</span>
<span class="w">         </span><span class="s1">&#39; after the trace filling calls above...</span>
<span class="s1">         </span>
<span class="s1">         dblDPmin = dicTraceIO(&quot;YMin&quot;)</span>
<span class="s1">         dblDPmax = dicTraceIO(&quot;YMax&quot;)</span>
<span class="s1">         </span>
<span class="s1">         If (dblDPmin &lt; -0.08) Then</span>
<span class="s1">            Chart.VertAxisMin = dblDPmin - .001</span>
<span class="s1">         Else</span>
<span class="s1">            Chart.VertAxisMin = -0.08</span>
<span class="s1">         End If</span>
<span class="s1">         </span>
<span class="s1">         If (dblDPmax &gt; 0.18) Then</span>
<span class="s1">            Chart.VertAxisMax = dblDPmax + 0.001</span>
<span class="s1">         Else</span>
<span class="s1">            Chart.VertAxisMax = 0.18</span>
<span class="s1">         End If</span>
<span class="s1">           </span>
<span class="s1">           </span>
<span class="s1">         If (intDays &gt; 1) Then</span>
<span class="s1">            Chart.ChartTitleAdd  &quot;Delta-P&quot;</span>
<span class="s1">         Else</span>
<span class="s1">            Chart.ChartTitleAdd  &quot;Delta-P on &quot; &amp; WeekDayName(WeekDay(dtePostedDate)) &amp; &quot; &quot; &amp; dtePostedDate</span>
<span class="s1">         End If    </span>
<span class="s1">         </span>
<span class="s1">         Chart.LeftAxisIncrement = 0.05</span>
<span class="s1">         </span>
<span class="s1">         Chart.AddAxisLabel 1, &quot;Pressure Differential (Inches Hg)&quot;</span>
<span class="s1">         </span>
<span class="s1">         If (intDays &gt;= 10) Then</span>
<span class="s1">            Chart.Width = 1270</span>
<span class="s1">         Else</span>
<span class="s1">            Chart.Width = 875</span>
<span class="s1">         End If</span>
<span class="s1">         </span>
<span class="s1">         &#39;</span><span class="w"> </span><span class="nx">Scale</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">height</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">image</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">y</span><span class="w"> </span><span class="nx">range</span><span class="w"> </span><span class="nx">is</span><span class="w"> </span><span class="nx">larger</span><span class="w"> </span><span class="nx">than</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="mf">0.26</span><span class="p">.</span>
<span class="w">         </span><span class="nx">intNonPlottingHeight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">90</span>
<span class="w">         </span><span class="nx">If</span><span class="w"> </span><span class="p">((</span><span class="nx">Chart</span><span class="p">.</span><span class="nx">VertAxisMax</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">VertAxisMin</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.26</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span><span class="w">    </span>
<span class="w">            </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">Height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">((</span><span class="mf">510</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">intNonPlottingHeight</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">((</span><span class="nx">Chart</span><span class="p">.</span><span class="nx">VertAxisMax</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">VertAxisMin</span><span class="p">)</span><span class="o">/</span><span class="mf">0.26</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">intNonPlottingHeight</span>
<span class="w">         </span><span class="nx">Else</span>
<span class="w">            </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">Height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">510</span>
<span class="w">         </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span><span class="w">         </span>
<span class="w">         </span>
<span class="w">      </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>
<span class="w">   </span>
<span class="w">   </span><span class="nx">Else</span>
<span class="w">      </span><span class="s1">&#39; Shouldn&#39;</span><span class="nx">t</span><span class="w"> </span><span class="nx">ever</span><span class="w"> </span><span class="nx">get</span><span class="w"> </span><span class="nx">here</span><span class="p">...</span>
<span class="w">      </span><span class="s1">&#39;RBC &quot;No data or no match found for the specified sensor type.&quot; </span>
<span class="s1">   End If </span>

<span class="s1">   &#39;</span><span class="o">=============================================================================</span>
<span class="w">   </span><span class="s1">&#39; Control chart axes and labeling...</span>
<span class="s1">   &#39;</span><span class="w"> </span><span class="p">(</span><span class="nx">This</span><span class="w"> </span><span class="nx">is</span><span class="w"> </span><span class="nx">done</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">every</span><span class="w"> </span><span class="nx">type</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">plot</span><span class="p">)</span>
<span class="w">   </span><span class="s1">&#39;=============================================================================</span>

<span class="s1">   If dicTraceIO.Item(&quot;FoundData&quot;) Then</span>
<span class="s1">      </span>
<span class="s1">      &#39;</span><span class="w"> </span><span class="nx">Plot</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">LatestRecord</span><span class="w"> </span><span class="nx">and</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">NOW</span><span class="w"> </span><span class="nx">lines</span><span class="p">.</span>
<span class="w">      </span><span class="nx">If</span><span class="w"> </span><span class="p">((</span><span class="nx">intDays</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span><span class="w"> </span><span class="nx">and</span><span class="w"> </span><span class="p">(</span><span class="nx">str24Hrs_state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;checked&quot;</span><span class="p">))</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">         </span><span class="nx">AddVerticalLine</span><span class="w"> </span><span class="nx">DaysDec</span><span class="p">(</span><span class="w"> </span><span class="nx">strMRTime</span><span class="p">),</span><span class="w">  </span><span class="mf">1</span>
<span class="w">         </span><span class="nx">AddVerticalLine</span><span class="w"> </span><span class="nx">DaysDec</span><span class="p">(</span><span class="w"> </span><span class="nx">dteNowTime</span><span class="p">),</span><span class="w"> </span><span class="mf">1</span>
<span class="w">      </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>
<span class="w">        </span>
<span class="w">      </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">HorizAxisMax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">intDays</span>
<span class="w">      </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">ShowMinorTicks</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="w">  </span>
<span class="w">        </span>
<span class="w">      </span><span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">intDays</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span><span class="w"> </span><span class="nx">then</span>
<span class="w">         </span><span class="s1">&#39; Set Horizontal Axis Label Style to: Axis Scales (2)</span>
<span class="s1">         Chart.HLabelStyle = 0</span>
<span class="s1">                  </span>
<span class="s1">         If (blnDayLightSavingsTime And (strTimeZone &lt;&gt; &quot;H&quot;)) Then</span>
<span class="s1">            Chart.AddAxisLabel 2, &quot;Days Starting with &quot; &amp; WeekDayName(WeekDay(dteStartDate_forLabels)) &amp; &quot; &quot; &amp; FormatDateTime(dteStartDate_forLabels, vbShortDate) &amp; &quot; (&quot; &amp; strTimeZone &amp; &quot;DT)&quot;</span>
<span class="s1">         Else</span>
<span class="s1">            Chart.AddAxisLabel 2, &quot;Days Starting with &quot; &amp; WeekDayName(WeekDay(dteStartDate_forLabels)) &amp; &quot; &quot; &amp; FormatDateTime(dteStartDate_forLabels, vbShortDate) &amp; &quot; (&quot; &amp; strTimeZone &amp; &quot;ST)&quot;</span>
<span class="s1">         End If</span>
<span class="s1">         Chart.HorizAxisMin = 0.0     </span>
<span class="s1">      Else</span>
<span class="s1">         &#39;</span><span class="w"> </span><span class="nb">Set</span><span class="w"> </span><span class="nx">Horizontal</span><span class="w"> </span><span class="nx">Axis</span><span class="w"> </span><span class="nx">Label</span><span class="w"> </span><span class="nx">Style</span><span class="w"> </span><span class="nx">to</span><span class="o">:</span><span class="w"> </span><span class="nx">Automatic</span><span class="w"> </span><span class="p">(</span><span class="mf">0</span><span class="p">)</span><span class="w">      </span>
<span class="w">         </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">HLabelStyle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span>
<span class="w">             </span>
<span class="w">         </span><span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">blnDayLightSavingsTime</span><span class="w"> </span><span class="nx">And</span><span class="w"> </span><span class="p">(</span><span class="nx">strTimeZone</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="s2">&quot;H&quot;</span><span class="p">))</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">            </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">AddAxisLabel</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Hour of the Day (&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">strTimeZone</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;DT)&quot;</span>
<span class="w">         </span><span class="nx">Else</span>
<span class="w">            </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">AddAxisLabel</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Hour of the Day (&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">strTimeZone</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;ST)&quot;</span>
<span class="w">         </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>
<span class="w">         </span>
<span class="w">         </span><span class="s1">&#39; Make a little more room on the y axis for the last point from yesterday. The</span>
<span class="s1">         &#39;</span><span class="w"> </span><span class="nx">square</span><span class="w"> </span><span class="nx">boxes</span><span class="w"> </span><span class="p">(</span><span class="nx">markers</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">direction</span><span class="w"> </span><span class="nx">trace</span><span class="w"> </span><span class="nx">enforce</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nx">little</span><span class="w"> </span><span class="nx">more</span><span class="w"> </span><span class="nx">room</span><span class="w"> </span><span class="nx">on</span><span class="w"> </span>
<span class="w">         </span><span class="s1">&#39; their own, so the non-wind plots require a little more wiggle room on each </span>
<span class="s1">         &#39;</span><span class="w"> </span><span class="nx">end</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">x</span><span class="o">-</span><span class="nx">axis</span><span class="p">.</span>
<span class="w">         </span><span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">left</span><span class="p">(</span><span class="nx">strSensor</span><span class="p">,</span><span class="mf">4</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Wind&quot;</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">            </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">HorizAxisMin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mf">0.001</span>
<span class="w">            </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">HorizAxisMax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">intDays</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.001</span>
<span class="w">         </span><span class="nx">Else</span>
<span class="w">            </span><span class="s1">&#39;Chart.HorizAxisMin = 0.00</span>
<span class="s1">            Chart.HorizAxisMin = -0.003  </span>
<span class="s1">            Chart.HorizAxisMax = intDays + 0.003            </span>
<span class="s1">         End If</span>
<span class="s1">      End If</span>

<span class="s1">      Chart.ChartTitleFont.Size = 16</span>
<span class="s1">      Chart.ChartTitleFont.Name = &quot;Arial&quot;    </span>
<span class="s1">      &#39;</span><span class="nx">Chart</span><span class="p">.</span><span class="nx">ChartTitleFontColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">vbBlue</span>
<span class="w">      </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">ChartTitleFontColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">RGB</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">h00</span><span class="p">,</span><span class="o">&amp;</span><span class="nx">h80</span><span class="p">,</span><span class="o">&amp;</span><span class="nx">h80</span><span class="p">)</span><span class="w">    </span>
<span class="w">      </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">LegendFont</span><span class="p">.</span><span class="nx">Size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">10</span>
<span class="w">      </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">AxisLabelFontBottom</span><span class="p">.</span><span class="nx">Size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">10</span>
<span class="w">      </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">AxisLabelFontLeft</span><span class="p">.</span><span class="nx">Size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">10</span>
<span class="w">        </span>
<span class="w">      </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">BevelOuter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span>
<span class="w">      </span>
<span class="w">      </span><span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">Request</span><span class="p">.</span><span class="nx">QueryString</span><span class="p">(</span><span class="s2">&quot;specName&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">         </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">GradientVisible</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span>
<span class="w">      </span><span class="nx">Else</span>
<span class="w">         </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">GradientVisible</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">      </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>
<span class="w">      </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">GradientStartColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">RGB</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">hff</span><span class="p">,</span><span class="o">&amp;</span><span class="nx">hcc</span><span class="p">,</span><span class="o">&amp;</span><span class="nx">h99</span><span class="p">)</span>
<span class="w">      </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">GradientEndColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">vbWhite</span>
<span class="w">      </span>
<span class="w">      </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">PanelColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">vbWhite</span>
<span class="w">      </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">View3D</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span>
<span class="w">      </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">LegendVisible</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">      </span><span class="nx">Chart</span><span class="p">.</span><span class="nx">LegendStyle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span>

<span class="w">      </span><span class="s1">&#39; Set the filename, save the image and write the image tag.</span>
<span class="s1">        </span>
<span class="s1">      &#39;</span><span class="w"> </span><span class="nx">Do</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="kd">with</span><span class="w"> </span><span class="nx">sessionID</span><span class="w"> </span><span class="nx">and</span><span class="w"> </span><span class="nx">random</span><span class="w"> </span><span class="nx">name</span><span class="w"> </span><span class="nx">generated</span><span class="w"> </span><span class="nx">via</span><span class="w"> </span><span class="nx">the</span>
<span class="w">      </span><span class="s1">&#39; FileSystemObject. First make a string with a random name in it. Use</span>
<span class="s1">      &#39;</span><span class="w"> </span><span class="nx">split</span><span class="w"> </span><span class="nx">here</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">get</span><span class="w"> </span><span class="nx">rid</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">txt</span><span class="w"> </span><span class="nx">extension</span><span class="w"> </span><span class="nx">that</span><span class="w"> </span><span class="nx">normally</span><span class="w"> </span><span class="nx">is</span><span class="w"> </span><span class="nx">returned</span><span class="p">.</span>

<span class="w">      </span><span class="nx">strRandomNameString</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Split</span><span class="p">(</span><span class="nx">Server</span><span class="p">.</span><span class="nx">CreateObject</span><span class="p">(</span><span class="s2">&quot;Scripting.FileSystemObject&quot;</span><span class="p">).</span><span class="nx">GetTempName</span><span class="p">,</span><span class="s2">&quot;.&quot;</span><span class="p">)(</span><span class="mf">0</span><span class="p">)</span>
<span class="w">      </span><span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">Request</span><span class="p">.</span><span class="nx">QueryString</span><span class="p">(</span><span class="s2">&quot;specName&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">         </span><span class="nx">strFileName2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Request</span><span class="p">.</span><span class="nx">QueryString</span><span class="p">(</span><span class="s2">&quot;specName&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;.jpg&quot;</span>
<span class="w">      </span><span class="nx">Else</span>
<span class="w">         </span><span class="nx">strFileName2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;S&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;_&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">Session</span><span class="p">.</span><span class="nx">SessionID</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;_&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">strRandomNameString</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;.jpg&quot;</span><span class="w"> </span>
<span class="w">      </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>

<span class="w">      </span><span class="s1">&#39;Response.Write &quot;filename = &quot; &amp; strPathToImageDir &amp; strFileName2</span>
<span class="s1">        </span>
<span class="s1">      Chart.FileName = strPathToImageDir &amp; strFileName2</span>
<span class="s1">      Chart.SaveChart</span>
<span class="s1">      &#39;</span><span class="nx">Response</span><span class="p">.</span><span class="nx">Write</span><span class="w"> </span><span class="s2">&quot;path = &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">strPathToImageDir</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">strFileName2</span>
<span class="w">     </span>
<span class="w">      </span><span class="s1">&#39; Put these two images into a DIV element that doesn&#39;</span><span class="nx">t</span><span class="w"> </span><span class="nx">wrap</span><span class="o">!</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">      </span><span class="s1">&#39; position the directions overlay relative to the original chart image.</span>

<span class="s1">      RC &quot;&lt;div style=&quot;&quot;white-space:nowrap;&quot;&quot;&gt;&quot;</span>
<span class="s1">      RC &quot;&lt;img id=&#39;</span><span class="nx">chartimage</span><span class="s1">&#39; style=&quot;&quot;visibility:hidden&quot;&quot; src=&quot; &amp; strURLPathToImageDir &amp; strFileName2 &amp; &quot;&#39;</span><span class="o">&gt;</span><span class="s2">&quot;</span>
<span class="s2">      If (strSensor = &quot;</span><span class="nx">Wind40</span><span class="s2">&quot;) Then</span>
<span class="s2">         RC &quot;</span><span class="o">&lt;</span><span class="nx">img</span><span class="w"> </span><span class="nx">id</span><span class="o">=</span><span class="s1">&#39;directions&#39;</span><span class="w"> </span><span class="nx">src</span><span class="o">=</span><span class="s1">&#39;pictures/directions_40.gif&#39;</span><span class="w"> </span><span class="nx">style</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="nx">visibility</span><span class="o">:</span><span class="nx">hidden</span><span class="p">;</span><span class="w"> </span><span class="nx">position</span><span class="o">:</span><span class="nx">relative</span><span class="p">;</span><span class="w"> </span><span class="nx">left</span><span class="o">:</span><span class="s2">&quot; &amp; intPixelRightShift &amp; &quot;</span><span class="nx">px</span><span class="p">;</span><span class="w"> </span><span class="nx">bottom</span><span class="o">:</span><span class="s2">&quot; &amp; _</span>
<span class="s2">            intPixelBottomShift &amp; &quot;</span><span class="nx">px</span><span class="s2">&quot;&quot;</span><span class="o">&gt;</span><span class="s2">&quot;</span>
<span class="s2">      ElseIf (strSensor = &quot;</span><span class="nx">Wind36</span><span class="s2">&quot;) Then</span>
<span class="s2">         RC &quot;</span><span class="o">&lt;</span><span class="nx">img</span><span class="w"> </span><span class="nx">id</span><span class="o">=</span><span class="s1">&#39;directions&#39;</span><span class="w"> </span><span class="nx">src</span><span class="o">=</span><span class="s1">&#39;pictures/directions_36.gif&#39;</span><span class="w"> </span><span class="nx">style</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="nx">visibility</span><span class="o">:</span><span class="nx">hidden</span><span class="p">;</span><span class="w"> </span><span class="nx">position</span><span class="o">:</span><span class="nx">relative</span><span class="p">;</span><span class="w"> </span><span class="nx">left</span><span class="o">:</span><span class="s2">&quot; &amp; intPixelRightShift &amp; &quot;</span><span class="nx">px</span><span class="p">;</span><span class="w"> </span><span class="nx">bottom</span><span class="o">:</span><span class="s2">&quot; &amp; _</span>
<span class="s2">            intPixelBottomShift &amp; &quot;</span><span class="nx">px</span><span class="s2">&quot;&quot;</span><span class="o">&gt;</span><span class="s2">&quot;</span>
<span class="s2">      Else</span>
<span class="s2">         &#39; Could add secondary images for other sensors types here...</span>
<span class="s2">      End If</span>
<span class="s2">      RC &quot;</span><span class="o">&lt;</span><span class="err">/div&gt;&quot;</span>

<span class="w">      </span><span class="s1">&#39; Destroy the object</span>
<span class="s1">      Set Chart = nothing</span>
<span class="s1">        </span>
<span class="s1">   Else</span>
<span class="s1">      Response.Write &quot;The query has returned no data for the selected sensor and location.&quot;</span>
<span class="s1">   End If</span>
<span class="s1">     </span>
<span class="s1">End Sub</span>

<span class="s1">Function TimeZone( strStationName)</span>
<span class="s1">   strSQL = &quot;SELECT StationNames.StationName, StationNames.NickName, StationNames.TimeZone FROM StationNames &quot; &amp; _</span>
<span class="s1">            &quot;WHERE ([StationName]=&#39;</span><span class="s2">&quot; &amp; strStationName  &amp; &quot;</span><span class="s1">&#39;) &quot;</span>
<span class="s1">   </span>
<span class="s1">   PopulateStaticRecordset DBConnection, strSQL, rstTimeZone</span>

<span class="s1">   If (rstTimeZone.RecordCount = 0) Then</span>
<span class="s1">      TimeZone = &quot;?&quot;</span>
<span class="s1">   Else </span>
<span class="s1">      rstTimeZone.MoveFirst</span>
<span class="s1">      TimeZone = rstTimeZone(&quot;TimeZone&quot;)</span>
<span class="s1">   End If</span>

<span class="s1">   CloseRecordSet rstTimeZone</span>
<span class="s1">End Function</span>

<span class="s1">Function RegionString( strRegion)</span>
<span class="s1">   If (strRegion = &quot;MN&quot;) Then</span>
<span class="s1">      RegionString = &quot;Minnesota Weather&quot;</span>
<span class="s1">   ElseIf (strRegion = &quot;CR&quot;) Then</span>
<span class="s1">      RegionString = &quot;Columbia Basin Weather&quot;</span>
<span class="s1">   ElseIf (strRegion = &quot;Misc&quot;) Then</span>
<span class="s1">      RegionString = &quot;Misc. Weather Stations&quot;</span>
<span class="s1">   Else</span>
<span class="s1">      RWBR &quot;No match when branching on Region.&quot;</span>
<span class="s1">   End If</span>
<span class="s1">End Function</span>



<span class="s1">&#39;</span><span class="o">=======================================================================================</span>
<span class="s1">&#39; Main program body (start here and execute every time in)</span>
<span class="s1">&#39;</span><span class="o">=======================================================================================</span>
<span class="w">  </span>
<span class="s1">&#39; Build the page</span>
<span class="s1">%&gt;</span>

<span class="s1">&lt;html&gt;</span>
<span class="s1">&lt;head&gt;</span>
<span class="s1">&lt;meta name=&#39;</span><span class="nx">Author</span><span class="s1">&#39; content=&#39;</span><span class="nx">James</span><span class="w"> </span><span class="nx">D</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="nx">Jim</span><span class="p">)</span><span class="w"> </span><span class="nx">Miller</span><span class="s1">&#39;&gt;</span>
<span class="s1">&lt;meta name=&#39;</span><span class="nx">keywords</span><span class="s1">&#39; </span>
<span class="s1">      content=&#39;</span><span class="nx">WA</span><span class="p">,</span><span class="nx">Washington</span><span class="p">,</span><span class="nx">OR</span><span class="p">,</span><span class="nx">Orgeon</span><span class="p">,</span><span class="nx">MN</span><span class="p">,</span><span class="nx">Minnesota</span><span class="p">,</span><span class="nx">columbia</span><span class="p">,</span><span class="nx">basin</span><span class="p">,</span><span class="nx">weather</span><span class="p">,</span><span class="nx">chart</span><span class="p">,</span><span class="nx">plot</span><span class="p">,</span><span class="nx">roosevelt</span><span class="p">,</span>
<span class="w">               </span><span class="nx">windsurfing</span><span class="p">,</span><span class="nx">gorge</span><span class="p">,</span><span class="nx">richland</span><span class="p">,</span><span class="nx">wind</span><span class="p">,</span><span class="nx">temperature</span><span class="p">,</span><span class="nx">pressure</span><span class="p">,</span><span class="nx">dewpoint</span><span class="s1">&#39;&gt;             </span>
<span class="s1">&lt;meta charset=&quot;UTF-8&quot;&gt;</span>

<span class="s1">&lt;!-- Icon for browsers using Waconia.  --&gt; </span>
<span class="s1">&lt;link rel=&#39;</span><span class="nx">SHORTCUT</span><span class="w"> </span><span class="nx">ICON</span><span class="s1">&#39; href=&#39;</span><span class="nx">pictures</span><span class="o">/</span><span class="nx">favicon</span><span class="p">.</span><span class="nx">ico</span><span class="s1">&#39;&gt;</span>
<span class="s1">&lt;title&gt;Waconia Weather Database&lt;/title&gt;</span>

<span class="s1">&lt;style&gt;</span>
<span class="s1">   TD {font-family: Times;}</span>
<span class="s1">   TD.data {font-family: Arial;}</span>

<span class="s1">   A         {color:#008080; text-decoration:underline}</span>
<span class="s1">   A:hover   {color:#008080; text-decoration:none; background:#FFF1E3}</span>

<span class="s1">   A.noline       {color:#008080; text-decoration:none;      font-size:18pt; font-weight:bolder;                   }</span>
<span class="s1">   A.noline:hover {color:#008080; text-decoration:underline; font-size:18pt; font-weight:bolder; background:#FFCC99}</span>
<span class="s1">   </span>
<span class="s1">   span.regionstring {color:#008080; font-size:18pt; font-weight:bolder;}</span>
<span class="s1">   </span>
<span class="s1">   div.pageblock {min-width: 650px; max-width: 1000px;}</span>
<span class="s1">&lt;/style&gt;</span>

<span class="s1">&lt;!--[if IE]&gt;</span>
<span class="s1">   &lt;style&gt;</span>
<span class="s1">      div.pageblock {width: expression(document.body.clientWidth &gt; 1000? &quot;1000px&quot;: &quot;auto&quot; )};</span>
<span class="s1">   &lt;/style&gt;</span>
<span class="s1">&lt;![endif]--&gt;   </span>

<span class="s1">&lt;/head&gt;</span>

<span class="s1">&lt;%  </span>

<span class="s1">&#39;</span><span class="w"> </span><span class="nx">Connect</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">database</span><span class="p">.</span>
<span class="s1">&#39;OpenDataConnection DBConnection, strConnectionString</span>

<span class="s1">&#39;</span><span class="w"> </span><span class="nx">Or</span><span class="p">,</span><span class="w"> </span><span class="nx">connect</span><span class="w"> </span><span class="nx">using</span><span class="w"> </span><span class="nx">another</span><span class="w"> </span><span class="nx">method</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">documented</span><span class="w"> </span><span class="nx">here</span><span class="o">:</span>
<span class="s1">&#39; https://saplsmw.com/Use_Classic_ASP_with_Access_Databases_in_Windows_10</span>
<span class="s1">&#39;</span><span class="w"> </span><span class="p">(</span><span class="nx">note</span><span class="o">:</span><span class="w"> </span><span class="nx">had</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">install</span><span class="w"> </span><span class="nx">AccessDatabaseEngine</span><span class="p">.</span><span class="nx">exe</span><span class="p">)</span>
<span class="nb">Set</span><span class="w"> </span><span class="nx">DBConnection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">CreateObject</span><span class="p">(</span><span class="s2">&quot;ADODB.Connection&quot;</span><span class="p">)</span>
<span class="nx">DBConnection</span><span class="p">.</span><span class="nx">Provider</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Microsoft.ACE.OLEDB.12.0&quot;</span>
<span class="nx">DBConnection</span><span class="p">.</span><span class="nx">Open</span><span class="w"> </span><span class="s2">&quot;C:\Users\Jim\Documents\webcontent\waconia\data\telem.mdb&quot;</span>

<span class="nb">Set</span><span class="w"> </span><span class="nx">dicTZ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Server</span><span class="p">.</span><span class="nx">CreateObject</span><span class="p">(</span><span class="s2">&quot;Scripting.Dictionary&quot;</span><span class="p">)</span>
<span class="nx">dicTZ</span><span class="p">.</span><span class="nx">Add</span><span class="w"> </span><span class="s2">&quot;H&quot;</span><span class="p">,</span><span class="w">  </span><span class="o">-</span><span class="mf">4</span>
<span class="nx">dicTZ</span><span class="p">.</span><span class="nx">Add</span><span class="w"> </span><span class="s2">&quot;AK&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">3</span>
<span class="nx">dicTZ</span><span class="p">.</span><span class="nx">Add</span><span class="w"> </span><span class="s2">&quot;P&quot;</span><span class="p">,</span><span class="w">  </span><span class="o">-</span><span class="mf">2</span>
<span class="nx">dicTZ</span><span class="p">.</span><span class="nx">Add</span><span class="w"> </span><span class="s2">&quot;M&quot;</span><span class="p">,</span><span class="w">  </span><span class="o">-</span><span class="mf">1</span>
<span class="nx">dicTZ</span><span class="p">.</span><span class="nx">Add</span><span class="w"> </span><span class="s2">&quot;C&quot;</span><span class="p">,</span><span class="w">   </span><span class="mf">0</span>
<span class="nx">dicTZ</span><span class="p">.</span><span class="nx">Add</span><span class="w"> </span><span class="s2">&quot;E&quot;</span><span class="p">,</span><span class="w">   </span><span class="mf">1</span>
<span class="nx">dicTZ</span><span class="p">.</span><span class="nx">Add</span><span class="w"> </span><span class="s2">&quot;J&quot;</span><span class="p">,</span><span class="w">  </span><span class="mf">15</span>
<span class="nx">dicTZ</span><span class="p">.</span><span class="nx">Add</span><span class="w"> </span><span class="s2">&quot;NZ&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">18</span>

<span class="nx">serverTimeArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">split</span><span class="p">(</span><span class="nx">Now</span><span class="p">(),</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
<span class="nx">serverTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">serverTimeArray</span><span class="p">(</span><span class="mf">1</span><span class="p">)</span>

<span class="s1">&#39; Establish defaults</span>

<span class="s1">&#39;</span><span class="w"> </span><span class="nx">Region_state</span><span class="w"> </span><span class="p">(</span><span class="nx">hidden</span><span class="p">)</span><span class="w"> </span><span class="nx">is</span><span class="w"> </span><span class="nx">used</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">facilitate</span><span class="w"> </span><span class="nx">changing</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">location</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="nx">value</span>
<span class="s1">&#39; when the region is changed.</span>
<span class="s1">If (Request.QueryString(&quot;Region_state&quot;) = &quot;&quot;) Then </span>
<span class="s1">   strRegionState = &quot;new&quot;</span>
<span class="s1">Else</span>
<span class="s1">   strRegionState = Request.QueryString(&quot;Region_state&quot;)</span>
<span class="s1">End If</span>

<span class="s1">If (Request.QueryString(&quot;Region&quot;) = &quot;&quot;) Then </span>
<span class="s1">   strRegion = &quot;CR&quot;</span>
<span class="s1">Else</span>
<span class="s1">   strRegion = Request.QueryString(&quot;Region&quot;)</span>
<span class="s1">End If</span>

<span class="s1">If (Request.QueryString(&quot;chk24Hrs&quot;) = &quot;on&quot;) Then</span>
<span class="s1">   str24Hrs_state = &quot;checked&quot;</span>
<span class="s1">Else</span>
<span class="s1">   str24Hrs_state = &quot;&quot; </span>
<span class="s1">End If</span>

<span class="s1">If (Request.QueryString(&quot;chkRA&quot;) = &quot;on&quot;) Then</span>
<span class="s1">   strRA_state = &quot;checked&quot;</span>
<span class="s1">Else</span>
<span class="s1">   strRA_state = &quot;&quot; </span>
<span class="s1">End If</span>

<span class="s1">If (Request.QueryString(&quot;chkTimer&quot;) = &quot;on&quot;) Then</span>
<span class="s1">   strTimer_state = &quot;checked&quot;</span>
<span class="s1">Else</span>
<span class="s1">   strTimer_state = &quot;&quot;</span>
<span class="s1">End If</span>

<span class="s1">If (strTimer_state = &quot;checked&quot;) Then</span>
<span class="s1">   &#39;</span><span class="nx">Check</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">see</span><span class="w"> </span><span class="nx">how</span><span class="w"> </span><span class="nx">far</span><span class="w"> </span><span class="nx">off</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="mf">5</span><span class="o">-</span><span class="nx">minute</span><span class="w"> </span><span class="nx">mark</span><span class="p">.</span><span class="w"> </span><span class="nx">This</span><span class="w"> </span><span class="nx">should</span><span class="w"> </span><span class="nx">serve</span>
<span class="w">   </span><span class="s1">&#39;to compensate for the drift in the client side timer.</span>
<span class="s1">   </span>
<span class="s1">   &#39;</span><span class="nx">Get</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">seconds</span><span class="w"> </span><span class="nx">and</span><span class="w"> </span><span class="nx">minutes</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">server</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span>
<span class="w">   </span><span class="nx">intSeconds_FromSeconds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">CInt</span><span class="p">(</span><span class="nx">right</span><span class="p">(</span><span class="nx">serverTime</span><span class="p">,</span><span class="mf">2</span><span class="p">))</span>
<span class="w">   </span><span class="nx">intMinutes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">CInt</span><span class="p">(</span><span class="nx">Split</span><span class="p">(</span><span class="nx">serverTime</span><span class="p">,</span><span class="s2">&quot;:&quot;</span><span class="p">)(</span><span class="mf">1</span><span class="p">))</span>
<span class="w">   </span>
<span class="w">   </span><span class="s1">&#39;How many five minute chunks.</span>
<span class="s1">   dblFiveMinutes = CDbl(intMinutes)/5.0</span>
<span class="s1">   </span>
<span class="s1">   &#39;</span><span class="nx">Take</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">fractional</span><span class="w"> </span><span class="nx">part</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="nx">and</span><span class="w"> </span><span class="nx">convert</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">seconds</span><span class="p">.</span>
<span class="w">   </span><span class="nx">intSeconds_FromMinutes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">CInt</span><span class="p">(</span><span class="nx">round</span><span class="p">(</span><span class="mf">300</span><span class="o">*</span><span class="p">(</span><span class="nx">dblFiveMinutes</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">Fix</span><span class="p">(</span><span class="nx">dblFiveMinutes</span><span class="p">)),</span><span class="mf">0</span><span class="p">))</span>
<span class="w">   </span>
<span class="w">   </span><span class="s1">&#39;Subtract both of these values from 300 to get the proper delay for the client.</span>
<span class="s1">   &#39;</span><span class="nx">Then</span><span class="w"> </span><span class="nx">add</span><span class="w"> </span><span class="mf">9</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">keep</span><span class="w"> </span><span class="nx">it</span><span class="w"> </span><span class="nx">tracking</span><span class="w"> </span><span class="nx">at</span><span class="w"> </span><span class="mf">10</span><span class="w"> </span><span class="nx">seconds</span><span class="w"> </span><span class="nx">after</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="mf">5</span><span class="o">-</span><span class="nx">minute</span><span class="w"> </span><span class="nx">mark</span><span class="p">.</span>
<span class="w">   </span><span class="nx">intDelay_to_5min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">300</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">intSeconds_FromMinutes</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">intSeconds_FromSeconds</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">9</span>
<span class="w">   </span><span class="nx">strInitializeTimer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;initializeTimer(&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">CStr</span><span class="p">(</span><span class="nx">intDelay_to_5min</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;);&quot;</span>
<span class="w">   </span>
<span class="nx">Else</span>
<span class="w">   </span><span class="nx">strInitializeTimer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<span class="nx">End</span><span class="w"> </span><span class="nx">If</span>

<span class="nx">blnPostedDate_default</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">False</span>
<span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">Request</span><span class="p">.</span><span class="nx">QueryString</span><span class="p">(</span><span class="s2">&quot;EndDate&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span><span class="w"> </span>
<span class="w">   </span><span class="s1">&#39; Use the current date for a default. </span>
<span class="s1">   dtePostedDate = CStr(Date())</span>
<span class="s1">   blnPostedDate_default = True</span>
<span class="s1">Else</span>
<span class="s1">   &#39;</span><span class="w"> </span><span class="nx">Split</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">just</span><span class="w"> </span><span class="nx">get</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">DATE</span><span class="w"> </span><span class="nx">part</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="nx">post</span><span class="p">.</span>
<span class="w">   </span><span class="nx">dtePostedDate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">split</span><span class="p">(</span><span class="nx">Request</span><span class="p">.</span><span class="nx">QueryString</span><span class="p">(</span><span class="s2">&quot;EndDate&quot;</span><span class="p">),</span><span class="s2">&quot; &quot;</span><span class="p">)(</span><span class="mf">0</span><span class="p">)</span>
<span class="nx">End</span><span class="w"> </span><span class="nx">If</span>

<span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">Request</span><span class="p">.</span><span class="nx">QueryString</span><span class="p">(</span><span class="s2">&quot;Days&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span><span class="w"> </span>
<span class="w">   </span><span class="nx">intDays</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span>
<span class="nx">Else</span>
<span class="w">   </span><span class="nx">intDays</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Request</span><span class="p">.</span><span class="nx">QueryString</span><span class="p">(</span><span class="s2">&quot;Days&quot;</span><span class="p">)</span>
<span class="nx">End</span><span class="w"> </span><span class="nx">If</span>

<span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">Request</span><span class="p">.</span><span class="nx">QueryString</span><span class="p">(</span><span class="s2">&quot;Sensor&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span><span class="w"> </span>
<span class="w">   </span><span class="nx">strSensor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Wind40&quot;</span>
<span class="nx">Else</span>
<span class="w">   </span><span class="nx">strSensor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Request</span><span class="p">.</span><span class="nx">QueryString</span><span class="p">(</span><span class="s2">&quot;Sensor&quot;</span><span class="p">)</span>
<span class="w">   </span><span class="s1">&#39; Don&#39;</span><span class="nx">t</span><span class="w"> </span><span class="nx">allow</span><span class="w"> </span><span class="nx">request</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">Delta</span><span class="o">-</span><span class="nx">P</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="nx">any</span><span class="w"> </span><span class="nx">region</span><span class="w"> </span><span class="nx">but</span><span class="w"> </span><span class="nx">CR</span><span class="p">.</span>
<span class="w">   </span><span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">strRegion</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="s2">&quot;CR&quot;</span><span class="p">)</span><span class="w"> </span><span class="nx">And</span><span class="w"> </span><span class="p">(</span><span class="nx">strSensor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;DeltaP&quot;</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">         </span><span class="nx">strSensor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Wind40&quot;</span>
<span class="w">   </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>
<span class="nx">End</span><span class="w"> </span><span class="nx">If</span>

<span class="s1">&#39; Set the normalization factor for the wind direction data</span>
<span class="s1">If (strSensor = &quot;Wind40&quot;) Then </span>
<span class="s1">   dblWindNormFactor = 40.0 / 360.0</span>
<span class="s1">Else</span>
<span class="s1">   dblWindNormFactor = 1.0 / 10.0</span>
<span class="s1">End If</span>

<span class="s1">&#39;</span><span class="w"> </span><span class="nb">Set</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">location</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">first</span><span class="w"> </span><span class="nx">time</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">or</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="nx">changes</span>
<span class="s1">&#39; the region.</span>
<span class="s1">If ((Request.QueryString(&quot;Location&quot;) = &quot;&quot;) or (strRegionState = &quot;new&quot;)) Then </span>
<span class="s1">   If (strRegion = &quot;CR&quot;) Then</span>
<span class="s1">      strLocation = &quot;PASC&quot;</span>
<span class="s1">   ElseIf (strRegion = &quot;MN&quot;) Then</span>
<span class="s1">      strLocation = &quot;KMKT&quot;   </span>
<span class="s1">   ElseIf (strRegion = &quot;Misc&quot;) Then</span>
<span class="s1">      strLocation = &quot;KCQX&quot;    </span>
<span class="s1">   Else</span>
<span class="s1">      strLocation = &quot;&quot;</span>
<span class="s1">      RWBR &quot;No match in region branch...&quot;</span>
<span class="s1">   End If</span>
<span class="s1">Else</span>
<span class="s1">   strLocation = Request.QueryString(&quot;Location&quot;)</span>
<span class="s1">End If</span>


<span class="s1">If ((strSensor = &quot;Wind40&quot;) OR (strSensor = &quot;Wind36&quot;)) Then</span>
<span class="s1">   strShowImages_command = &quot;showImage();showDirections();&quot;</span>
<span class="s1">Else</span>
<span class="s1">   strShowImages_command = &quot;showImage();&quot;</span>
<span class="s1">End If</span>


<span class="s1">strTimeZone = TimeZone( strLocation)</span>


<span class="s1">RC &quot;&lt;body onLoad=&#39;</span><span class="nx">testJS</span><span class="p">();</span><span class="s2">&quot; &amp; strShowImages_command &amp; strInitializeTimer &amp; _</span>
<span class="s2">      &quot;</span><span class="s1">&#39; bgcolor=#FFCC99 link=&#39;</span><span class="err">#</span><span class="mo">00</span><span class="mf">8080</span><span class="s1">&#39; vlink=&#39;</span><span class="err">#</span><span class="mo">00</span><span class="mf">8080</span><span class="s1">&#39; topmargin=&#39;</span><span class="mf">2</span><span class="s1">&#39; style=&#39;</span><span class="nx">font</span><span class="o">-</span><span class="nx">family</span><span class="o">:</span><span class="w"> </span><span class="nx">Arial</span><span class="p">;</span><span class="s1">&#39;&gt;&quot;</span>

<span class="s1">RC &quot;&lt;div class=&#39;</span><span class="nx">pageblock</span><span class="s1">&#39;&gt;&quot;</span>
<span class="s1">    </span>

<span class="s1">&#39;</span><span class="w"> </span><span class="nx">If</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">region</span><span class="w"> </span><span class="nx">is</span><span class="w"> </span><span class="nx">specified</span><span class="p">,</span><span class="w"> </span><span class="nx">then</span><span class="w"> </span><span class="nx">make</span><span class="w"> </span><span class="nx">preparations</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">populating</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">table</span>
<span class="s1">&#39; including getting the most recent values for all the sensor data.</span>

<span class="s1">If (Request.QueryString(&quot;Region&quot;) &lt;&gt; &quot;&quot;) Then</span>

<span class="s1">   &#39;</span><span class="w"> </span><span class="nx">If</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">end</span><span class="w"> </span><span class="nx">date</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">chart</span><span class="w"> </span><span class="nx">request</span><span class="w"> </span><span class="nx">is</span><span class="w"> </span><span class="nx">within</span><span class="w"> </span><span class="nx">daylight</span><span class="w"> </span><span class="nx">savings</span><span class="w"> </span><span class="nx">time</span><span class="p">,</span><span class="w"> </span><span class="nx">then</span>
<span class="w">   </span><span class="s1">&#39; set the DLS flag. Add 3 hours to make sure you evaluate the day after the</span>
<span class="s1">   &#39;</span><span class="w"> </span><span class="mf">2</span><span class="nx">am</span><span class="w"> </span><span class="nx">change</span><span class="w"> </span><span class="nx">over</span><span class="w"> </span><span class="nx">point</span><span class="p">.</span>

<span class="w">   </span><span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">dayLightSavingsTime</span><span class="p">(</span><span class="nx">dateadd</span><span class="p">(</span><span class="s2">&quot;h&quot;</span><span class="p">,</span><span class="mf">3</span><span class="p">,</span><span class="nx">dtePostedDate</span><span class="p">)))</span><span class="w"> </span><span class="nx">Then</span><span class="w"> </span><span class="nx">blnDayLightSavingsTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">True</span>

<span class="w">   </span><span class="s1">&#39; Get a recordset for the most recent data (to put into the table on</span>
<span class="s1">   &#39;</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">charting</span><span class="w"> </span><span class="nx">page</span><span class="p">).</span><span class="w"> </span><span class="nx">For</span><span class="w"> </span><span class="nx">speed</span><span class="p">,</span><span class="w"> </span><span class="nx">start</span><span class="w"> </span><span class="nx">by</span><span class="w"> </span><span class="nx">querying</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">most</span><span class="w"> </span><span class="nx">recent</span><span class="w"> </span><span class="mf">24</span><span class="w"> </span><span class="nx">hours</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">data</span><span class="p">.</span>
<span class="w">   </span>
<span class="w">   </span><span class="nx">strSQL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;SELECT * FROM FifteenMinData &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">            </span><span class="s2">&quot;WHERE ([StationName] = &#39;&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">strLocation</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;&#39;) AND &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">                  </span><span class="s2">&quot;([DateTimeStamp] &gt;=     #&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">dateAdd</span><span class="p">(</span><span class="s2">&quot;h&quot;</span><span class="p">,</span><span class="o">-</span><span class="mf">24</span><span class="p">,</span><span class="nx">now</span><span class="p">())</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;#) &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">            </span><span class="s2">&quot;ORDER BY TimeMDY DESC, TimeHr DESC, TimeMin DESC&quot;</span>
<span class="w">      </span>
<span class="w">   </span><span class="nx">PopulateStaticRecordset</span><span class="w"> </span><span class="nx">DBConnection</span><span class="p">,</span><span class="w"> </span><span class="nx">strSQL</span><span class="p">,</span><span class="w"> </span><span class="nx">rstMostRecent</span>
<span class="w">   </span>
<span class="w">   </span><span class="s1">&#39; If there&#39;</span><span class="nx">s</span><span class="w"> </span><span class="nx">no</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="nx">within</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">last</span><span class="w"> </span><span class="mf">24</span><span class="w"> </span><span class="nx">hours</span><span class="p">,</span><span class="w"> </span><span class="nx">search</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">whole</span><span class="w"> </span><span class="nx">database</span><span class="w"> </span><span class="nx">and</span><span class="w"> </span><span class="nx">find</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">latest</span><span class="w"> </span><span class="nx">timestamp</span><span class="p">.</span>
<span class="w">   </span><span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">rstMostRecent</span><span class="p">.</span><span class="nx">BOF</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">   </span>
<span class="w">      </span><span class="s1">&#39; Find the time of the most recent station record.</span>
<span class="s1">      strSQL = &quot;SELECT MAX(DateTimeStamp) as maxDateTime FROM FifteenMinData &quot; &amp; _</span>
<span class="s1">               &quot;WHERE ([StationName] = &#39;</span><span class="s2">&quot; &amp; strLocation &amp; &quot;</span><span class="s1">&#39;)&quot;</span>
<span class="s1">                     </span>
<span class="s1">      PopulateStaticRecordset DBConnection, strSQL, rstLatestDate</span>
<span class="s1">      dteMaxTimeStamp = rstLatestDate(&quot;maxDateTime&quot;)</span>
<span class="s1">      CloseRecordSet rstLatestDate</span>
<span class="s1">            </span>
<span class="s1">      &#39;</span><span class="w"> </span><span class="nx">Build</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nx">recordset</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">getting</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">most</span><span class="w"> </span><span class="nx">recent</span><span class="w"> </span><span class="nx">record</span><span class="w"> </span><span class="nx">to</span>
<span class="w">      </span><span class="s1">&#39; put into the table on the charting page.</span>
<span class="s1">      strSQL = &quot;SELECT * FROM FifteenMinData &quot; &amp; _</span>
<span class="s1">               &quot;WHERE ([StationName] = &#39;</span><span class="s2">&quot; &amp; strLocation &amp; &quot;</span><span class="s1">&#39;) AND &quot; &amp; _</span>
<span class="s1">               &quot;      ([DateTimeStamp] = #&quot; &amp; FormatDateTime(dteMaxTimeStamp, vbGeneralDate) &amp; &quot;#) &quot;</span>
<span class="s1">               </span>
<span class="s1">      PopulateStaticRecordset DBConnection, strSQL, rstMostRecent</span>
<span class="s1">   </span>
<span class="s1">   End If</span>
<span class="s1">   </span>
<span class="s1">   &#39;</span><span class="w"> </span><span class="nx">If</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="nx">was</span><span class="w"> </span><span class="nx">used</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">posted</span><span class="w"> </span><span class="nx">date</span><span class="p">,</span><span class="w"> </span><span class="nx">correct</span><span class="w"> </span><span class="nx">it</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">posted</span><span class="w"> </span><span class="nx">date</span>
<span class="w">   </span><span class="s1">&#39; is more recent than the most recent data.</span>
<span class="s1">   &#39;</span><span class="nx">RWBR</span><span class="w"> </span><span class="s2">&quot;Default=&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">dtePostedDate</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;, MostRecent=&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">rstMostRecent</span><span class="p">(</span><span class="s2">&quot;TimeMDY&quot;</span><span class="p">)</span>
<span class="w">   </span><span class="nx">If</span><span class="w"> </span><span class="nx">blnPostedDate_default</span><span class="w"> </span><span class="nx">and</span><span class="w"> </span><span class="p">(</span><span class="nx">DateDiff</span><span class="p">(</span><span class="s2">&quot;d&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">dtePostedDate</span><span class="p">,</span><span class="w"> </span><span class="nx">rstMostRecent</span><span class="p">(</span><span class="s2">&quot;TimeMDY&quot;</span><span class="p">))</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">      </span><span class="nx">dtePostedDate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">rstMostRecent</span><span class="p">(</span><span class="s2">&quot;TimeMDY&quot;</span><span class="p">)</span>
<span class="w">   </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>
<span class="w">   </span>
<span class="w">   </span><span class="s1">&#39; Check to see if there are any records before applying the MoveFirst method</span>
<span class="s1">   If (Not rstMostRecent.BOF) Then</span>
<span class="s1">      </span>
<span class="s1">      rstMostRecent.MoveFirst</span>
<span class="s1">      </span>
<span class="s1">      &#39;</span><span class="nx">Warning</span><span class="o">:</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="nx">variable</span><span class="w"> </span><span class="nx">changes</span><span class="w"> </span><span class="nx">type</span><span class="w"> </span><span class="nx">here</span><span class="p">.</span>
<span class="w">      </span><span class="nx">strMRTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">rstMostRecent</span><span class="p">(</span><span class="s2">&quot;TimeMDY&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot; &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">rstMostRecent</span><span class="p">(</span><span class="s2">&quot;TimeHr&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;:&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">rstMostRecent</span><span class="p">(</span><span class="s2">&quot;TimeMin&quot;</span><span class="p">)</span>
<span class="w">      </span><span class="nx">strMRTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">FormatDateTime</span><span class="p">(</span><span class="nx">strMRTime</span><span class="p">,</span><span class="w"> </span><span class="nx">vbGeneralDate</span><span class="p">)</span>
<span class="w">      </span>
<span class="w">      </span><span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">rstMostRecent</span><span class="p">(</span><span class="s2">&quot;WindDirection&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mf">10</span><span class="p">)</span><span class="w"> </span><span class="nx">then</span>
<span class="w">         </span><span class="nx">strMRWindDir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Variable&quot;</span>
<span class="w">      </span><span class="nx">Else</span>
<span class="w">         </span><span class="nx">If</span><span class="w"> </span><span class="nx">IsNull</span><span class="p">(</span><span class="nx">rstMostRecent</span><span class="p">(</span><span class="s2">&quot;WindDirection&quot;</span><span class="p">))</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">            </span><span class="nx">strMRWindDir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;-&quot;</span>
<span class="w">         </span><span class="nx">Else</span>
<span class="w">            </span><span class="nx">strMRWindDir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">rstMostRecent</span><span class="p">(</span><span class="s2">&quot;WindDirection&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">                           </span><span class="s2">&quot; deg. [&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">DirectionLabel</span><span class="p">(</span><span class="nx">rstMostRecent</span><span class="p">(</span><span class="s2">&quot;WindDirection&quot;</span><span class="p">))</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;]&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">                           </span><span class="s2">&quot; [&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">FormatNumber</span><span class="p">(</span><span class="nx">rstMostRecent</span><span class="p">(</span><span class="s2">&quot;WindDirection&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dblWindNormFactor</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;]&quot;</span>
<span class="w">         </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>
<span class="w">      </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span><span class="w">    </span>
<span class="w">      </span><span class="nx">If</span><span class="w"> </span><span class="nx">IsNull</span><span class="p">(</span><span class="nx">rstMostRecent</span><span class="p">(</span><span class="s2">&quot;WindSpeed&quot;</span><span class="p">))</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">         </span><span class="nx">strMRWindAvg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;-&quot;</span><span class="w"> </span>
<span class="w">         </span><span class="nx">strMRWindMax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;-&quot;</span>
<span class="w">      </span><span class="nx">Else</span>
<span class="w">         </span><span class="nx">strMRWindAvg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">rstMostRecent</span><span class="p">(</span><span class="s2">&quot;WindSpeed&quot;</span><span class="p">)</span>
<span class="w">         </span><span class="nx">strMRWindMax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">rstMostRecent</span><span class="p">(</span><span class="s2">&quot;WindGust&quot;</span><span class="p">)</span>
<span class="w">      </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>

<span class="w">      </span><span class="nx">If</span><span class="w"> </span><span class="nx">IsNull</span><span class="p">(</span><span class="nx">rstMostRecent</span><span class="p">(</span><span class="s2">&quot;Pressure&quot;</span><span class="p">))</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">         </span><span class="nx">strMRPressure</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;-&quot;</span>
<span class="w">      </span><span class="nx">Else</span>
<span class="w">         </span><span class="nx">strMRPressure</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">round</span><span class="p">(</span><span class="nx">rstMostRecent</span><span class="p">(</span><span class="s2">&quot;Pressure&quot;</span><span class="p">),</span><span class="mf">2</span><span class="p">)</span>
<span class="w">      </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span><span class="w"> </span>

<span class="w">      </span><span class="nx">strMRTemp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">rstMostRecent</span><span class="p">(</span><span class="s2">&quot;TempAvg&quot;</span><span class="p">)</span>
<span class="w">      </span><span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">IsNull</span><span class="p">(</span><span class="nx">strMRTemp</span><span class="p">))</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">         </span><span class="nx">strMRTemp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;-&quot;</span>
<span class="w">      </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>
<span class="w">      </span>
<span class="w">      </span><span class="nx">strMRDewPoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">rstMostRecent</span><span class="p">(</span><span class="s2">&quot;DewPoint&quot;</span><span class="p">)</span><span class="w"> </span>
<span class="w">      </span><span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">IsNull</span><span class="p">(</span><span class="nx">strMRDewPoint</span><span class="p">))</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">         </span><span class="nx">strMRDewPoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;-&quot;</span>
<span class="w">      </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>
<span class="w">   </span>
<span class="w">   </span><span class="nx">Else</span>
<span class="w">      </span><span class="nx">strMRTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;-&quot;</span>
<span class="w">      </span><span class="nx">strMRWindDir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;-&quot;</span>
<span class="w">      </span><span class="nx">strMRWindAvg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;-&quot;</span>
<span class="w">      </span><span class="nx">strMRWindMax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;-&quot;</span>
<span class="w">      </span><span class="nx">strMRTemp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;-&quot;</span>
<span class="w">      </span><span class="nx">strMRPressure</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;-&quot;</span><span class="w">   </span>
<span class="w">      </span><span class="nx">strMRDewPoint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;-&quot;</span><span class="w"> </span>
<span class="w">   </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>
<span class="w">   </span>
<span class="w">   </span><span class="nx">CloseRecordSet</span><span class="w"> </span><span class="nx">rstMostRecent</span>

<span class="w">   </span><span class="nx">strButtonLabel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Update&quot;</span>
<span class="w">   </span>
<span class="nx">Else</span>
<span class="w">   </span><span class="nx">dtePostedDate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&quot;</span>

<span class="w">   </span><span class="s1">&#39; Before first post (first time in) just show these dashes in the table...</span>
<span class="s1">   strMRTime = &quot;-&quot;</span>
<span class="s1">   strMRWindDir = &quot;-&quot;</span>
<span class="s1">   strMRWindAvg = &quot;-&quot;</span>
<span class="s1">   strMRWindMax = &quot;-&quot;</span>
<span class="s1">   strMRTemp = &quot;-&quot;</span>
<span class="s1">   strMRPressure = &quot;-&quot;</span>
<span class="s1">   strMRDewPoint = &quot;-&quot; </span>

<span class="s1">   strButtonLabel = &quot;Chart&quot;</span>
<span class="s1">   </span>
<span class="s1">End if</span>

<span class="s1">&#39;</span><span class="nx">IP</span><span class="w"> </span><span class="nx">message</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nx">particular</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span>
<span class="s1">&#39;IPMessage</span>
<span class="s1">&#39;</span><span class="nx">RWBR</span><span class="w"> </span><span class="s2">&quot;Debug Message = &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">strDebugMessage</span>

<span class="s1">&#39;===========================================================================</span>
<span class="s1">&#39;</span><span class="w"> </span><span class="nx">The</span><span class="w"> </span><span class="nx">current</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="nx">table</span><span class="w"> </span><span class="nx">and</span><span class="w"> </span><span class="nx">CONTROLS</span><span class="w"> </span><span class="nx">form</span><span class="p">...</span>
<span class="s1">&#39;===========================================================================</span>
<span class="s1">RC &quot;&lt;table border=&#39;</span><span class="mf">1</span><span class="s1">&#39;&gt;&quot;</span>

<span class="s1">&#39;</span><span class="w"> </span><span class="nx">First</span><span class="w"> </span><span class="nx">row</span>

<span class="nx">RC</span><span class="w"> </span><span class="s2">&quot;&lt;tr&gt;&quot;</span>

<span class="nx">RC</span><span class="w"> </span><span class="s2">&quot;&lt;td class=&#39;data&#39; width=&#39;37%&#39; rowspan=&#39;3&#39;&gt;&quot;</span>
<span class="s1">&#39;RC &quot;&lt;p align=&#39;</span><span class="nx">center</span><span class="s1">&#39;&gt;&lt;a onmouseover=&quot;&quot;changeRegionAnchorValue(&#39;</span><span class="s2">&quot; &amp; strRegion &amp; &quot;</span><span class="s1">&#39;)&quot;&quot; onmouseout=&quot;&quot;changeRegionAnchorValue(&#39;</span><span class="s2">&quot; &amp; strTitle &amp; &quot;</span><span class="s1">&#39;)&quot;&quot; name=&#39;</span><span class="nx">regionanchor</span><span class="s1">&#39; id=&#39;</span><span class="nx">regionanchor</span><span class="s1">&#39; class=&#39;</span><span class="nx">noline</span><span class="s1">&#39; href=&#39;</span><span class="s2">&quot; &amp; strRegionURL &amp; &quot;</span><span class="s1">&#39;&gt;&quot; &amp; strTitle  &amp; &quot;&lt;/a&gt;&amp;nbsp;&lt;br&gt;&quot;</span>
<span class="s1">RC &quot;&lt;p align=&#39;</span><span class="nx">center</span><span class="s1">&#39;&gt;&lt;span class=&#39;</span><span class="nx">regionstring</span><span class="s1">&#39;&gt;&quot; &amp; RegionString( strRegion) &amp; &quot;&lt;/span&gt;&lt;br&gt;&quot;</span>
<span class="s1">RC &quot;&lt;a target=&#39;</span><span class="nx">_blank</span><span class="s1">&#39; href=&#39;</span><span class="nx">http</span><span class="o">:</span><span class="c1">//waconia.timetocode.org/FAQ.htm&#39;&gt;&lt;font size=&#39;2&#39; color=&#39;#FF0000&#39;&gt;Help&lt;/font&gt;&quot; &amp; _</span>
<span class="w">                     </span><span class="s2">&quot;&lt;font size=&#39;2&#39; color=&#39;#008080&#39;&gt;: FAQs&lt;/font&gt;&lt;/a&gt;&amp;nbsp;&quot;</span>

<span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">strRegion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;MN&quot;</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">   </span><span class="nx">RC</span><span class="w"> </span><span class="s2">&quot;&lt;a href=&#39;pictures/mn_sites.jpg&#39;&gt;&lt;font size=&#39;2&#39; color=&#39;#008080&#39;&gt;Sites&lt;/font&gt;&lt;/a&gt;&amp;nbsp;&quot;</span>
<span class="nx">End</span><span class="w"> </span><span class="nx">If</span>
<span class="nx">RC</span><span class="w"> </span><span class="s2">&quot;&lt;a href=&#39;default.htm&#39;&gt;&lt;font size=&#39;2&#39;&gt;(home)&lt;/font&gt;&lt;/a&gt;&quot;</span>

<span class="s1">&#39; Create a object for working with the image files...</span>
<span class="s1">Set fsoObject = CreateObject(&quot;Scripting.FileSystemObject&quot;)</span>
<span class="s1">&#39;</span><span class="w"> </span><span class="nx">Note</span><span class="o">:</span><span class="w"> </span><span class="nx">path</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">image</span><span class="w"> </span><span class="nx">directory</span><span class="w"> </span><span class="nx">is</span><span class="w"> </span><span class="nx">defined</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">include</span><span class="w"> </span><span class="nx">file</span><span class="p">.</span>
<span class="nb">Set</span><span class="w"> </span><span class="nx">fdrObject</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fsoObject</span><span class="p">.</span><span class="nx">GetFolder</span><span class="p">(</span><span class="nx">strPathToImageDir</span><span class="p">)</span>
<span class="w">         </span>
<span class="s1">&#39; Clean out any old temp image files. This is a new approach that doesn&#39;</span><span class="nx">t</span><span class="w"> </span><span class="nx">depend</span><span class="w"> </span><span class="nx">on</span><span class="w"> </span><span class="nx">script</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nb">global</span><span class="w"> </span><span class="nx">ASA</span>
<span class="nx">intFileCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span>
<span class="nx">For</span><span class="w"> </span><span class="nx">Each</span><span class="w"> </span><span class="nx">filObject</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">fdrObject</span><span class="p">.</span><span class="nx">Files</span>
<span class="w">   </span><span class="s1">&#39; Count files that are less than 1 day old.</span>
<span class="s1">   If (DateDiff(&quot;h&quot;, filObject.DateLastModified, Now()) &lt;= 24) Then</span>
<span class="s1">      intFileCount = intFileCount + 1</span>
<span class="s1">   End If</span>
<span class="s1">   &#39;</span><span class="w"> </span><span class="nx">Delete</span><span class="w"> </span><span class="nx">files</span><span class="w"> </span><span class="nx">that</span><span class="w"> </span><span class="nx">are</span><span class="w"> </span><span class="nx">more</span><span class="w"> </span><span class="nx">than</span><span class="w"> </span><span class="nx">three</span><span class="w"> </span><span class="nx">days</span><span class="w"> </span><span class="nx">old</span><span class="p">.</span>
<span class="w">   </span><span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">DateDiff</span><span class="p">(</span><span class="s2">&quot;h&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">filObject</span><span class="p">.</span><span class="nx">DateLastModified</span><span class="p">,</span><span class="w"> </span><span class="nx">Now</span><span class="p">())</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">72</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span><span class="w">   </span>
<span class="w">      </span><span class="nx">filObject</span><span class="p">.</span><span class="ow">delete</span>
<span class="w">   </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span><span class="w">  </span>
<span class="nx">Next</span><span class="w">         </span>

<span class="s1">&#39; Write out a count of image files in the directory (1 and 7 day counts).</span>
<span class="s1">&#39;</span><span class="w"> </span><span class="nx">Put</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">serverTime</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nx">span</span><span class="w"> </span><span class="nx">so</span><span class="w"> </span><span class="nx">can</span><span class="w"> </span><span class="nx">access</span><span class="w"> </span><span class="nx">it</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">client</span><span class="w"> </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="nx">needed</span><span class="p">,</span><span class="w"> </span><span class="nx">may</span><span class="w"> </span><span class="nx">not</span><span class="w"> </span><span class="nx">actually</span><span class="w"> </span><span class="nx">use</span><span class="w"> </span><span class="k">this</span><span class="p">).</span><span class="w">          </span>
<span class="nx">RC</span><span class="w"> </span><span class="s2">&quot;&lt;font color=&#39;#008080&#39;  size=&#39;1&#39;&gt;&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">   </span><span class="s2">&quot;&amp;nbsp;&amp;nbsp;&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">intFileCount</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;-(1d)&amp;nbsp;&amp;nbsp;&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">fdrObject</span><span class="p">.</span><span class="nx">Files</span><span class="p">.</span><span class="nx">Count</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;-(3d)&amp;nbsp;&amp;nbsp;&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">   </span><span class="s2">&quot;&lt;span id=&#39;spServerTime&#39; name=&#39;spServerTime&#39;&gt;&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">serverTime</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;&lt;/span&gt;&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">   </span><span class="s2">&quot; (&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">AgeOfData</span><span class="p">(</span><span class="nx">strMRTime</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;)&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">   </span><span class="s2">&quot;&lt;/font&gt;&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">   </span><span class="s2">&quot;&lt;/p&gt;&quot;</span>
<span class="nx">RC</span><span class="w"> </span><span class="s2">&quot;&lt;/td&gt;&quot;</span>


<span class="s1">&#39; Rest of the table headers</span>
<span class="s1">RC &quot;&lt;td width=&#39;</span><span class="mf">23</span><span class="o">%</span><span class="s1">&#39; align=&#39;</span><span class="nx">center</span><span class="s1">&#39; rowspan=&#39;</span><span class="mf">2</span><span class="s1">&#39;&gt;&lt;b&gt;&lt;font color=&#39;</span><span class="err">#</span><span class="nx">FF0000</span><span class="s1">&#39;&gt;Latest&lt;/font&gt;&quot;</span>
<span class="s1">RC &quot;&lt;font color=&#39;</span><span class="err">#</span><span class="mo">00</span><span class="mf">8080</span><span class="s1">&#39;&gt; Reading&quot;</span>
<span class="s1">RC &quot;&lt;/font&gt;&lt;/b&gt;&quot;</span>
<span class="s1">RC &quot;&lt;/td&gt;&quot;</span>

<span class="s1">RC &quot;&lt;td width=&#39;</span><span class="mf">26</span><span class="o">%</span><span class="s1">&#39; align=&#39;</span><span class="nx">center</span><span class="s1">&#39; colspan=&#39;</span><span class="mf">3</span><span class="s1">&#39;&gt;&lt;font color=&#39;</span><span class="err">#</span><span class="mo">00</span><span class="mf">8080</span><span class="s1">&#39;&gt;&lt;b&gt;Wind &lt;/b&gt;&lt;font size=&#39;</span><span class="mf">2</span><span class="s1">&#39;&gt; (mph)&lt;/font&gt;&lt;/font&gt;&lt;/td&gt;&quot;</span>

<span class="s1">RC &quot;&lt;td nowrap width=&#39;</span><span class="mf">6</span><span class="o">%</span><span class="s1">&#39; align=&#39;</span><span class="nx">center</span><span class="s1">&#39; colspan=&#39;</span><span class="mf">2</span><span class="s1">&#39; rowspan=&#39;</span><span class="mf">1</span><span class="s1">&#39;&gt;&lt;font color=&#39;</span><span class="err">#</span><span class="mo">00</span><span class="mf">8080</span><span class="s1">&#39;&gt;&lt;b&gt;Temp&lt;/b&gt;&lt;font size=&#39;</span><span class="mf">2</span><span class="s1">&#39;&gt; (&lt;sup&gt;o&lt;/sup&gt;F)&lt;/font&gt;&lt;/font&gt;&lt;/td&gt;&quot;</span>
<span class="s1">RC &quot;&lt;td width=&#39;</span><span class="mf">8</span><span class="o">%</span><span class="s1">&#39; align=&#39;</span><span class="nx">center</span><span class="s1">&#39; rowspan=&#39;</span><span class="mf">2</span><span class="s1">&#39;&gt;&lt;font color=&#39;</span><span class="err">#</span><span class="mo">00</span><span class="mf">8080</span><span class="s1">&#39;&gt;&lt;b&gt;Pressure&lt;br&gt;&lt;/b&gt;&lt;font size=&#39;</span><span class="mf">2</span><span class="s1">&#39;&gt; (in Hg&quot; &amp; strHGSL &amp; &quot;)&lt;/font&gt;&lt;/font&gt;&lt;/td&gt;&quot;</span>
<span class="s1">RC &quot;&lt;/tr&gt;&quot;</span>

<span class="s1">&#39;</span><span class="w"> </span><span class="nx">Second</span><span class="w"> </span><span class="nx">row</span>

<span class="nx">RC</span><span class="w"> </span><span class="s2">&quot;&lt;tr&gt;&quot;</span>
<span class="nx">RC</span><span class="w"> </span><span class="s2">&quot;&lt;td width=&#39;6%&#39; align=&#39;center&#39;&gt;&lt;font color=&#39;#008080&#39; size=&#39;2&#39;&gt;Avg&lt;/font&gt;&lt;/td&gt;&quot;</span>
<span class="nx">RC</span><span class="w"> </span><span class="s2">&quot;&lt;td width=&#39;5%&#39; align=&#39;center&#39;&gt;&lt;font color=&#39;#008080&#39; size=&#39;2&#39;&gt;Max&lt;/font&gt;&lt;/td&gt;&quot;</span>
<span class="nx">RC</span><span class="w"> </span><span class="s2">&quot;&lt;td width=&#39;18%&#39; align=&#39;center&#39;&gt;&lt;font color=&#39;#008080&#39; size=&#39;2&#39;&gt;Direction&lt;/font&gt;&lt;/td&gt;&quot;</span>
<span class="nx">RC</span><span class="w"> </span><span class="s2">&quot;&lt;td align=&#39;center&#39;&gt;&lt;font color=&#39;#008080&#39; size=&#39;2&#39;&gt;DryBulb&lt;/font&gt;&lt;/td&gt;&quot;</span>
<span class="nx">RC</span><span class="w"> </span><span class="s2">&quot;&lt;td align=&#39;center&#39;&gt;&lt;font color=&#39;#008080&#39; size=&#39;2&#39;&gt;DewPoint&lt;/font&gt;&lt;/td&gt;&quot;</span>
<span class="nx">RC</span><span class="w"> </span><span class="s2">&quot;&lt;/tr&gt;&quot;</span>

<span class="s1">&#39; Third row</span>

<span class="s1">RC &quot;&lt;tr&gt;&quot;</span>
<span class="s1">RC &quot;&lt;td class=&#39;</span><span class="nx">data</span><span class="s1">&#39; width=&#39;</span><span class="mf">20</span><span class="o">%</span><span class="s1">&#39; align=&#39;</span><span class="nx">center</span><span class="s1">&#39;&gt;&lt;font color=&#39;</span><span class="err">#</span><span class="mo">000000</span><span class="s1">&#39; size=&#39;</span><span class="mf">2</span><span class="s1">&#39;&gt;&quot;</span>
<span class="s1">If (strMRTime &lt;&gt; &quot;-&quot;) Then</span>
<span class="s1">   If (dayLightSavingsTime(strMRTime) And (strTimeZone &lt;&gt; &quot;H&quot;)) Then</span>
<span class="s1">      Response.Write DateAdd(&quot;h&quot;,1,strMRTime) &amp; &quot; (&quot; &amp; strTimeZone &amp; &quot;DT)&quot;</span>
<span class="s1">   Else</span>
<span class="s1">      Response.Write               strMRTime  &amp; &quot; (&quot; &amp; strTimeZone &amp; &quot;ST)&quot;</span>
<span class="s1">   End If</span>
<span class="s1">Else</span>
<span class="s1">   Response.Write strMRTime</span>
<span class="s1">End If</span>
<span class="s1">RC &quot;&lt;/font&gt;&lt;/td&gt;&quot;</span>
<span class="s1">RC &quot;&lt;td class=&#39;</span><span class="nx">data</span><span class="s1">&#39; width=&#39;</span><span class="mf">6</span><span class="o">%</span><span class="s1">&#39; align=&#39;</span><span class="nx">center</span><span class="s1">&#39;&gt;&lt;font color=&#39;</span><span class="err">#</span><span class="mo">000000</span><span class="s1">&#39; size=&#39;</span><span class="mf">2</span><span class="s1">&#39;&gt;&quot; &amp; strMRWindAvg &amp; &quot;&lt;/font&gt;&lt;/td&gt;&quot;</span>
<span class="s1">RC &quot;&lt;td class=&#39;</span><span class="nx">data</span><span class="s1">&#39; width=&#39;</span><span class="mf">5</span><span class="o">%</span><span class="s1">&#39; align=&#39;</span><span class="nx">center</span><span class="s1">&#39;&gt;&lt;font color=&#39;</span><span class="err">#</span><span class="mo">000000</span><span class="s1">&#39; size=&#39;</span><span class="mf">2</span><span class="s1">&#39;&gt;&quot; &amp; strMRWindMax &amp; &quot;&lt;/font&gt;&lt;/td&gt;&quot;</span>
<span class="s1">RC &quot;&lt;td class=&#39;</span><span class="nx">data</span><span class="s1">&#39; width=&#39;</span><span class="mf">18</span><span class="o">%</span><span class="s1">&#39; align=&#39;</span><span class="nx">center</span><span class="s1">&#39;&gt;&lt;font color=&#39;</span><span class="err">#</span><span class="mo">000000</span><span class="s1">&#39; size=&#39;</span><span class="mf">2</span><span class="s1">&#39;&gt;&quot; &amp; strMRWindDir &amp; &quot;&lt;/font&gt;&lt;/td&gt;&quot;</span>
<span class="s1">RC &quot;&lt;td class=&#39;</span><span class="nx">data</span><span class="s1">&#39; width=&#39;</span><span class="mf">6</span><span class="o">%</span><span class="s1">&#39; align=&#39;</span><span class="nx">center</span><span class="s1">&#39;&gt;&lt;font color=&#39;</span><span class="err">#</span><span class="mo">000000</span><span class="s1">&#39; size=&#39;</span><span class="mf">2</span><span class="s1">&#39;&gt;&quot; &amp; strMRTemp &amp; &quot;&lt;/font&gt;&lt;/td&gt;&quot;</span>
<span class="s1">RC &quot;&lt;td class=&#39;</span><span class="nx">data</span><span class="s1">&#39; width=&#39;</span><span class="mf">6</span><span class="o">%</span><span class="s1">&#39; align=&#39;</span><span class="nx">center</span><span class="s1">&#39;&gt;&lt;font color=&#39;</span><span class="err">#</span><span class="mo">000000</span><span class="s1">&#39; size=&#39;</span><span class="mf">2</span><span class="s1">&#39;&gt;&quot; &amp; strMRDewPoint &amp; &quot;&lt;/font&gt;&lt;/td&gt;&quot;</span>
<span class="s1">RC &quot;&lt;td class=&#39;</span><span class="nx">data</span><span class="s1">&#39; width=&#39;</span><span class="mf">8</span><span class="o">%</span><span class="s1">&#39; align=&#39;</span><span class="nx">center</span><span class="s1">&#39;&gt;&lt;font color=&#39;</span><span class="err">#</span><span class="mo">000000</span><span class="s1">&#39; size=&#39;</span><span class="mf">2</span><span class="s1">&#39;&gt;&quot; &amp; strMRPressure &amp; &quot;&lt;/font&gt;&lt;/td&gt;&quot;</span>
<span class="s1">RC &quot;&lt;/tr&gt;&quot;</span>

<span class="s1">RC &quot;&lt;/table&gt;&quot;</span>

<span class="s1">&#39;</span><span class="o">=============================================================================</span>
<span class="s1">&#39; Build a line of controls</span>
<span class="s1">&#39;</span><span class="o">=============================================================================</span><span class="w">   </span>

<span class="nx">RC</span><span class="w"> </span><span class="s2">&quot;&lt;br&gt;&quot;</span>
<span class="s1">&#39; Note that the GET method invokes the QueryString approach and submits form data in the URL.</span>
<span class="s1">RC &quot;&lt;form method=&#39;</span><span class="nx">GET</span><span class="s1">&#39; accept-charset=&#39;</span><span class="nx">utf</span><span class="o">-</span><span class="mf">8</span><span class="s1">&#39; action=&#39;</span><span class="nx">rosy</span><span class="p">.</span><span class="nx">asp</span><span class="s1">&#39; name=&#39;</span><span class="nx">ChartingParameters</span><span class="s1">&#39; id=&#39;</span><span class="nx">ChartingParameters</span><span class="s1">&#39;&gt;&quot;</span>

<span class="s1">&#39;</span><span class="w"> </span><span class="nx">Removing</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="s2">&quot;name&quot;</span><span class="w"> </span><span class="nx">parameter</span><span class="w"> </span><span class="nx">here</span><span class="w"> </span><span class="nx">avoids</span><span class="w"> </span><span class="nx">submitting</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="kd">with</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">form</span><span class="p">.</span>
<span class="s1">&#39; Another option is to use &quot;button&quot; instead of &quot;input&quot;.</span>


<span class="s1">&#39;</span><span class="w"> </span><span class="nx">The</span><span class="w"> </span><span class="nx">submit</span><span class="w"> </span><span class="nx">button</span><span class="p">.</span>

<span class="s1">&#39;RC &quot;&lt;...........................................name=&#39;</span><span class="nx">submit_button</span><span class="s1">&#39;&gt;&quot;</span>
<span class="s1">RC &quot;&lt;input type=&#39;</span><span class="nx">button</span><span class="s1">&#39; title=&#39;</span><span class="nx">Query</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">database</span><span class="w"> </span><span class="nx">and</span><span class="w"> </span><span class="nx">update</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">plot</span><span class="p">.</span><span class="s1">&#39; value=&#39;</span><span class="s2">&quot; &amp; strButtonLabel &amp; &quot;</span><span class="s1">&#39; name=&#39;</span><span class="nx">myButton</span><span class="s1">&#39; id=&#39;</span><span class="nx">myButton</span><span class="s1">&#39; style=&#39;</span><span class="nx">width</span><span class="o">:</span><span class="w"> </span><span class="mf">90</span><span class="nx">px</span><span class="s1">&#39; onclick=&#39;</span><span class="nx">submitform</span><span class="p">()</span><span class="s1">&#39;&gt;&quot;</span>


<span class="s1">&#39;</span><span class="w"> </span><span class="nx">Region</span>

<span class="nx">RC</span><span class="w"> </span><span class="s2">&quot;&lt;select title=&#39;Region&#39; size=&#39;1&#39; name=&#39;Region&#39; id=&#39;Region&#39; onChange=&#39;setRegionState()&#39;&gt;&quot;</span>
<span class="nx">arrRegions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Array</span><span class="p">(</span><span class="s2">&quot;MN&quot;</span><span class="p">,</span><span class="s2">&quot;CR&quot;</span><span class="p">,</span><span class="s2">&quot;Misc&quot;</span><span class="p">)</span>
<span class="nx">For</span><span class="w"> </span><span class="nx">each</span><span class="w"> </span><span class="nx">strRegionValue</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">arrRegions</span>
<span class="w">   </span><span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">strRegionValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">strRegion</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">      </span><span class="nx">RC</span><span class="w"> </span><span class="s2">&quot;   &lt;option selected&gt;&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">strRegionValue</span>
<span class="w">   </span><span class="nx">Else</span>
<span class="w">      </span><span class="nx">RC</span><span class="w"> </span><span class="s2">&quot;   &lt;option&gt;&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">strRegionValue</span>
<span class="w">   </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>
<span class="nx">Next</span>
<span class="nx">RC</span><span class="w"> </span><span class="s2">&quot;&lt;/select&gt;&quot;</span>

<span class="s1">&#39; A hidden field that serves to indicate whether a new region has been selected. This is needed</span>
<span class="s1">&#39;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">determining</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="k">default</span><span class="w"> </span><span class="nx">location</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">region</span><span class="w"> </span><span class="nx">selection</span><span class="w"> </span><span class="nx">changes</span><span class="p">.</span>
<span class="nx">RC</span><span class="w"> </span><span class="s2">&quot;&lt;input type=&#39;hidden&#39; name=&#39;Region_state&#39; id= &#39;Region_state&#39; value=&#39;old&#39;&gt;&quot;</span>


<span class="s1">&#39; Location</span>
<span class="s1">&#39;</span><span class="nx">RWBR</span><span class="w"> </span><span class="s2">&quot;strRegion = &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">strRegion</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;, RS= &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">Request</span><span class="p">.</span><span class="nx">QueryString</span><span class="p">(</span><span class="s2">&quot;Region_state&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;, &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;Request.QueryString(&#39;Location&#39;) = &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">Request</span><span class="p">.</span><span class="nx">QueryString</span><span class="p">(</span><span class="s2">&quot;Location&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;, strLocation = &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">strLocation</span><span class="w"> </span>

<span class="nx">RC</span><span class="w"> </span><span class="s2">&quot;&lt;select title=&#39;Location of weather station&#39; size=&#39;1&#39; name=&#39;Location&#39; id=&#39;Location&#39; onChange=&#39;submitform()&#39;&gt;&quot;</span>

<span class="nx">strSQL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;SELECT StationNames.Priority, StationNames.StationName, StationNames.NickName FROM StationNames &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">         </span><span class="s2">&quot;WHERE ([Region]=&#39;&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">strRegion</span><span class="w">  </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;&#39;) &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">         </span><span class="s2">&quot;ORDER BY Priority, NickName&quot;</span>

<span class="nx">PopulateStaticRecordset</span><span class="w"> </span><span class="nx">DBConnection</span><span class="p">,</span><span class="w"> </span><span class="nx">strSQL</span><span class="p">,</span><span class="w"> </span><span class="nx">rstStations</span>
<span class="nx">rstStations</span><span class="p">.</span><span class="nx">movefirst</span>

<span class="nx">Do</span><span class="w"> </span><span class="nx">until</span><span class="w"> </span><span class="nx">rstStations</span><span class="p">.</span><span class="nx">eof</span><span class="w"> </span>
<span class="w">   </span><span class="s1">&#39; Exclude inactive stations from the selection list (marked as &quot;skip&quot; in the database).</span>
<span class="s1">   If (InStr(rstStations(&quot;Priority&quot;),&quot;skip&quot;)=0) Then</span>
<span class="s1">   </span>
<span class="s1">      &#39;</span><span class="nx">Populate</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">list</span><span class="w"> </span><span class="nx">and</span><span class="w"> </span><span class="nx">set</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">selected</span><span class="w"> </span><span class="nx">station</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">two</span><span class="w"> </span><span class="nx">regions</span><span class="p">.</span>
<span class="w">      </span><span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">rstStations</span><span class="p">(</span><span class="s2">&quot;StationName&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="nx">strLocation</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span><span class="w"> </span>
<span class="w">         </span><span class="nx">strNameForPlot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">rstStations</span><span class="p">(</span><span class="s2">&quot;NickName&quot;</span><span class="p">)</span>
<span class="w">         </span><span class="nx">RC</span><span class="w"> </span><span class="s2">&quot;   &lt;option value=&#39;&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">rstStations</span><span class="p">(</span><span class="s2">&quot;StationName&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;&#39; selected&gt;&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">rstStations</span><span class="p">(</span><span class="s2">&quot;NickName&quot;</span><span class="p">)</span><span class="w"> </span>
<span class="w">      </span><span class="nx">Else</span>
<span class="w">         </span><span class="nx">RC</span><span class="w"> </span><span class="s2">&quot;   &lt;option value=&#39;&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">rstStations</span><span class="p">(</span><span class="s2">&quot;StationName&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;&#39;&gt;&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">rstStations</span><span class="p">(</span><span class="s2">&quot;NickName&quot;</span><span class="p">)</span>
<span class="w">      </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>
<span class="w">   </span>
<span class="w">   </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>
<span class="w">   </span>
<span class="w">   </span><span class="nx">rstStations</span><span class="p">.</span><span class="nx">movenext</span>
<span class="w">   </span>
<span class="nx">loop</span>

<span class="nx">CloseRecordSet</span><span class="w"> </span><span class="nx">rstStations</span>
<span class="nx">RC</span><span class="w"> </span><span class="s2">&quot;&lt;/select&gt;&quot;</span>


<span class="s1">&#39; Click for next location.</span>

<span class="s1">RC &quot;&lt;INPUT  title=&#39;</span><span class="nx">Click</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">step</span><span class="w"> </span><span class="nx">through</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">list</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">locations</span><span class="p">.</span><span class="s1">&#39; type=&#39;</span><span class="nx">button</span><span class="s1">&#39; style=&#39;</span><span class="nx">WIDTH</span><span class="o">:</span><span class="mf">18</span><span class="nx">px</span><span class="p">;</span><span class="w"> </span><span class="nx">HEIGHT</span><span class="o">:</span><span class="mf">23</span><span class="nx">px</span><span class="p">;</span><span class="w"> </span><span class="nx">COLOR</span><span class="o">:</span><span class="nx">black</span><span class="p">;</span><span class="w"> </span><span class="nx">padding</span><span class="o">-</span><span class="nx">left</span><span class="o">:</span><span class="mf">3</span><span class="nx">px</span><span class="p">;</span><span class="s1">&#39; value=&#39;</span><span class="o">&gt;</span><span class="s1">&#39; id=&#39;</span><span class="nx">btnStepLocationForward</span><span class="s1">&#39; name=&#39;</span><span class="nx">btnStepLocationForward</span><span class="s1">&#39; onClick=&#39;</span><span class="nx">stepLocationForward</span><span class="p">()</span><span class="s1">&#39;&gt;&quot;</span>


<span class="s1">&#39;</span><span class="w"> </span><span class="nx">Sensor</span><span class="w"> </span><span class="nx">type</span>

<span class="nx">RC</span><span class="w"> </span><span class="s2">&quot;&lt;select title=&#39;Sensor type&#39; size=&#39;1&#39; name=&#39;Sensor&#39; id=&#39;Sensor&#39; onChange=&#39;submitform()&#39;&gt;&quot;</span>

<span class="nx">WeatherTypes</span><span class="w"> </span><span class="o">=</span><span class="w">     </span><span class="nb">Array</span><span class="p">(</span><span class="s2">&quot;Wind (0-36)&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Wind (0-40)&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Temperature&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Pressure&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Delta-P1&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Delta-P2&quot;</span><span class="p">)</span>
<span class="nx">WeatherTypes_URL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Array</span><span class="p">(</span><span class="s2">&quot;Wind36&quot;</span><span class="p">,</span><span class="w">      </span><span class="s2">&quot;Wind40&quot;</span><span class="p">,</span><span class="w">      </span><span class="s2">&quot;Temperature&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Pressure&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;DeltaP1&quot;</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;DeltaP2&quot;</span><span class="p">)</span><span class="w"> </span>
<span class="nx">WeatherTypes_count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">UBound</span><span class="p">(</span><span class="nx">WeatherTypes</span><span class="p">)</span>

<span class="s1">&#39; Don&#39;</span><span class="nx">t</span><span class="w"> </span><span class="nx">offer</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">Delta</span><span class="o">-</span><span class="nx">P</span><span class="w"> </span><span class="nx">plot</span><span class="w"> </span><span class="nx">anywhere</span><span class="w"> </span><span class="nx">but</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">Columbia</span><span class="w"> </span><span class="nx">Basin</span><span class="p">.</span>
<span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">strRegion</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="s2">&quot;CR&quot;</span><span class="p">)</span><span class="w"> </span><span class="nx">then</span>
<span class="w">   </span><span class="nx">WeatherTypes_count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">WeatherTypes_count</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">2</span><span class="w"> </span>
<span class="nx">End</span><span class="w"> </span><span class="nx">If</span>

<span class="nx">For</span><span class="w"> </span><span class="nx">intJ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">WeatherTypes_count</span><span class="w"> </span>
<span class="w">   </span><span class="nx">If</span><span class="w"> </span><span class="p">((</span><span class="nx">WeatherTypes_URL</span><span class="p">(</span><span class="nx">intJ</span><span class="p">)</span><span class="o">=</span><span class="w"> </span><span class="nx">strSensor</span><span class="p">)</span><span class="w"> </span><span class="nx">OR</span><span class="w"> </span><span class="p">((</span><span class="nx">strSensor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="w"> </span><span class="nx">AND</span><span class="w"> </span><span class="p">(</span><span class="nx">WeatherTypes_URL</span><span class="p">(</span><span class="nx">intJ</span><span class="p">)</span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Wind40&quot;</span><span class="p">)))</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">      </span><span class="nx">RC</span><span class="w"> </span><span class="s2">&quot;   &lt;option selected value=&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">WeatherTypes_URL</span><span class="p">(</span><span class="nx">intJ</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot; &gt;&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">WeatherTypes</span><span class="p">(</span><span class="nx">intJ</span><span class="p">)</span>
<span class="w">   </span><span class="nx">Else</span>
<span class="w">      </span><span class="nx">RC</span><span class="w"> </span><span class="s2">&quot;   &lt;option value=&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">WeatherTypes_URL</span><span class="p">(</span><span class="nx">intJ</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot; &gt;&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">WeatherTypes</span><span class="p">(</span><span class="nx">intJ</span><span class="p">)</span>
<span class="w">   </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>
<span class="nx">Next</span>
<span class="nx">RC</span><span class="w"> </span><span class="s2">&quot;&lt;/select&gt;&quot;</span>


<span class="s1">&#39; Select the last day.</span>

<span class="s1">RC &quot;&lt;select title=&#39;</span><span class="nx">Last</span><span class="w"> </span><span class="nx">day</span><span class="s1">&#39; size=&#39;</span><span class="mf">1</span><span class="s1">&#39; name=&#39;</span><span class="nx">EndDate</span><span class="s1">&#39; id=&#39;</span><span class="nx">EndDate</span><span class="s1">&#39; onChange=&#39;</span><span class="nx">submitform</span><span class="p">()</span><span class="s1">&#39;&gt;&quot;</span>
<span class="s1">strSQL = &quot;SELECT DISTINCT DaysGleaned.TimeMDY FROM DaysGleaned ORDER BY DaysGleaned.TimeMDY DESC&quot;</span>
<span class="s1">  </span>
<span class="s1">&#39;</span><span class="w"> </span><span class="nx">See</span><span class="w"> </span><span class="nx">IIShelp</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">description</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">parameters</span><span class="o">:</span><span class="w"> </span><span class="nx">Open</span><span class="w"> </span><span class="nx">Method</span><span class="w"> </span><span class="p">(</span><span class="nx">Recordset</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">ADO</span><span class="p">).</span>
<span class="s1">&#39; The AdCmdText just tells it that it is a SQL string in the first parameter.</span>
<span class="s1">&#39;</span><span class="w"> </span><span class="nx">Alternatively</span><span class="w"> </span><span class="nx">you</span><span class="w"> </span><span class="nx">could</span><span class="w"> </span><span class="nx">tell</span><span class="w"> </span><span class="nx">it</span><span class="w"> </span><span class="nx">that</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">first</span><span class="w"> </span><span class="nx">parameter</span><span class="w"> </span><span class="nx">is</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nx">table</span><span class="w"> </span><span class="nx">name</span><span class="p">...</span>

<span class="nx">PopulateStaticRecordset</span><span class="w"> </span><span class="nx">DBConnection</span><span class="p">,</span><span class="w"> </span><span class="nx">strSQL</span><span class="p">,</span><span class="w"> </span><span class="nx">rstDate</span>
<span class="w">         </span>
<span class="nx">rstDate</span><span class="p">.</span><span class="nx">movefirst</span>
<span class="k">do</span><span class="w"> </span><span class="nx">until</span><span class="w"> </span><span class="nx">rstDate</span><span class="p">.</span><span class="nx">eof</span><span class="w"> </span>
<span class="w">   </span><span class="s1">&#39; Coerce the date object to a string by using the (&amp; &quot;&quot;)</span>
<span class="s1">   If ((dtePostedDate = (rstDate(&quot;TimeMDY&quot;) &amp; &quot;&quot;)) OR ((dtePostedDate = &quot;&quot;) AND (rstDate(&quot;TimeMDY&quot;) = Date()))) then</span>
<span class="s1">      RC &quot;   &lt;option selected&gt;&quot; &amp; rstDate(&quot;TimeMDY&quot;) &amp; &quot; &quot; &amp; weekdayname(weekday(rstDate(&quot;TimeMDY&quot;)),True)</span>
<span class="s1">   Else</span>
<span class="s1">      RC &quot;   &lt;option&gt;&quot; &amp; rstDate(&quot;TimeMDY&quot;) &amp; &quot; &quot; &amp; weekdayname(weekday(rstDate(&quot;TimeMDY&quot;)),True)</span>
<span class="s1">   End If  </span>
<span class="s1">   rstDate.movenext</span>
<span class="s1">loop</span>
<span class="s1">CloseRecordSet rstDate</span>
<span class="s1">RC &quot;&lt;/select&gt;&quot;</span>


<span class="s1">&#39;</span><span class="w"> </span><span class="nx">Select</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">time</span><span class="w"> </span><span class="nx">range</span><span class="p">.</span>
<span class="w">  </span>
<span class="nx">RC</span><span class="w"> </span><span class="s2">&quot;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;font color=&#39;#008080&#39;&gt;Days:&lt;/font&gt;&quot;</span>

<span class="nx">RC</span><span class="w"> </span><span class="s2">&quot;&lt;select title=&#39;Time range&#39; size=&#39;1&#39; name=&#39;Days&#39; id=&#39;Days&#39; onChange=&#39;submitform()&#39;&gt;&quot;</span>
<span class="nx">DaysChoices</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Array</span><span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">,</span><span class="s2">&quot;2&quot;</span><span class="p">,</span><span class="s2">&quot;3&quot;</span><span class="p">,</span><span class="s2">&quot;4&quot;</span><span class="p">,</span><span class="s2">&quot;5&quot;</span><span class="p">,</span><span class="s2">&quot;6&quot;</span><span class="p">,</span><span class="s2">&quot;7&quot;</span><span class="p">,</span><span class="s2">&quot;8&quot;</span><span class="p">,</span><span class="s2">&quot;9&quot;</span><span class="p">,</span><span class="s2">&quot;10&quot;</span><span class="p">,</span><span class="s2">&quot;14&quot;</span><span class="p">,</span><span class="s2">&quot;25&quot;</span><span class="p">)</span>
<span class="nx">For</span><span class="w"> </span><span class="nx">each</span><span class="w"> </span><span class="nx">DayValue</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">DaysChoices</span>
<span class="w">   </span><span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">DayValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">intDays</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">      </span><span class="nx">RC</span><span class="w"> </span><span class="s2">&quot;   &lt;option selected&gt;&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">DayValue</span>
<span class="w">   </span><span class="nx">Else</span>
<span class="w">      </span><span class="nx">RC</span><span class="w"> </span><span class="s2">&quot;   &lt;option&gt;&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">DayValue</span>
<span class="w">   </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>
<span class="nx">Next</span>
<span class="nx">RC</span><span class="w"> </span><span class="s2">&quot;&lt;/select&gt;&quot;</span>


<span class="s1">&#39; Time steppers</span>

<span class="s1">RC &quot;&lt;INPUT title=&#39;</span><span class="nx">Click</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">step</span><span class="w"> </span><span class="nx">back</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="s1">&#39; type=&#39;</span><span class="nx">button</span><span class="s1">&#39; style=&#39;</span><span class="nx">WIDTH</span><span class="o">:</span><span class="w"> </span><span class="mf">18</span><span class="nx">px</span><span class="p">;</span><span class="w"> </span><span class="nx">HEIGHT</span><span class="o">:</span><span class="w"> </span><span class="mf">23</span><span class="nx">px</span><span class="p">;</span><span class="w"> </span><span class="nx">COLOR</span><span class="o">:</span><span class="w"> </span><span class="nx">black</span><span class="p">;</span><span class="w"> </span><span class="nx">padding</span><span class="o">-</span><span class="nx">left</span><span class="o">:</span><span class="mf">3</span><span class="nx">px</span><span class="p">;</span><span class="s1">&#39; value=&#39;</span><span class="o">&lt;</span><span class="s1">&#39; id=&#39;</span><span class="nx">btnStepBack</span><span class="s1">&#39; name=&#39;</span><span class="nx">btnStepBack</span><span class="s1">&#39; onClick=&#39;</span><span class="nx">stepBack</span><span class="p">()</span><span class="s1">&#39;&gt;&quot;</span>
<span class="s1">RC &quot;&lt;INPUT title=&#39;</span><span class="nx">Click</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">step</span><span class="w"> </span><span class="nx">forward</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="s1">&#39; type=&#39;</span><span class="nx">button</span><span class="s1">&#39; style=&#39;</span><span class="nx">WIDTH</span><span class="o">:</span><span class="w"> </span><span class="mf">18</span><span class="nx">px</span><span class="p">;</span><span class="w"> </span><span class="nx">HEIGHT</span><span class="o">:</span><span class="w"> </span><span class="mf">23</span><span class="nx">px</span><span class="p">;</span><span class="w"> </span><span class="nx">COLOR</span><span class="o">:</span><span class="w"> </span><span class="nx">black</span><span class="p">;</span><span class="w"> </span><span class="nx">padding</span><span class="o">-</span><span class="nx">left</span><span class="o">:</span><span class="mf">3</span><span class="nx">px</span><span class="p">;</span><span class="s1">&#39; value=&#39;</span><span class="o">&gt;</span><span class="s1">&#39; id=&#39;</span><span class="nx">btnStepForward</span><span class="s1">&#39; name=&#39;</span><span class="nx">btnStepForward</span><span class="s1">&#39; onClick=&#39;</span><span class="nx">stepForward</span><span class="p">()</span><span class="s1">&#39;&gt;&quot;</span>


<span class="s1">&#39;</span><span class="w"> </span><span class="nx">The</span><span class="w"> </span><span class="mf">24</span><span class="o">-</span><span class="nx">Hour</span><span class="w"> </span><span class="nx">charting</span><span class="w"> </span><span class="nx">option</span><span class="p">.</span>
<span class="nx">RC</span><span class="w"> </span><span class="s2">&quot;&amp;nbsp;&amp;nbsp;&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">   </span><span class="s2">&quot;&lt;input &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">str24Hrs_state</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot; type=&#39;checkbox&#39; name=&#39;chk24Hrs&#39; &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">   </span><span class="s2">&quot;title=&#39;Select to display 24 hours of the most recent data (including data from yesterday) on the 1-day chart. &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">   </span><span class="s2">&quot;Please refer to the FAQ on the &quot;&quot;24h&quot;&quot; checkbox.&#39; &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">   </span><span class="s2">&quot;onClick=&#39;submitform()&#39;/&gt;&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">   </span><span class="s2">&quot;&lt;font size=&#39;2&#39; color=&#39;#008080&#39;&gt;24h&lt;/font&gt;&quot;</span>
<span class="w">   </span>
<span class="s1">&#39; The Running-average option</span>
<span class="s1">RW &quot;&quot; &amp; _</span>
<span class="s1">   &quot;&lt;input &quot; &amp; strRA_state &amp; &quot; type=&#39;</span><span class="nx">checkbox</span><span class="s1">&#39; name=&#39;</span><span class="nx">chkRA</span><span class="s1">&#39; &quot; &amp; _</span>
<span class="s1">   &quot;title=&#39;</span><span class="nx">Select</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">apply</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nx">running</span><span class="w"> </span><span class="nx">average</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">all</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">data</span><span class="p">.</span><span class="s1">&#39; &quot; &amp; _</span>
<span class="s1">   &quot;onClick=&#39;</span><span class="nx">submitform</span><span class="p">()</span><span class="s1">&#39;/&gt;&quot; &amp; _</span>
<span class="s1">   &quot;&lt;font size=&#39;</span><span class="mf">2</span><span class="s1">&#39; color=&#39;</span><span class="err">#</span><span class="mo">00</span><span class="mf">8080</span><span class="s1">&#39;&gt;RA&lt;/font&gt;&quot;</span>
<span class="s1">   </span>
<span class="s1">&#39;</span><span class="w"> </span><span class="nx">The</span><span class="w"> </span><span class="nx">timer</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">auto</span><span class="o">-</span><span class="nx">plots</span>
<span class="nx">RW</span><span class="w"> </span><span class="s2">&quot;&amp;nbsp;&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">   </span><span class="s2">&quot;&lt;input &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">strTimer_state</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot; type=&#39;checkbox&#39; name=&#39;chkTimer&#39; &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">   </span><span class="s2">&quot;title=&#39;Select to enable a repeating 5-minute countdown timer. This is synchronized with the server to trigger a chart update immediately after &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">   </span><span class="s2">&quot;the database has been updated.&#39; &quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">_</span>
<span class="w">   </span><span class="s2">&quot;onClick=&#39;submitform()&#39;/&gt;&quot;</span>

<span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">strTimer_state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;checked&quot;</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">   </span><span class="s1">&#39; The space in the span is needed for an initial value. The client-sided JavaScript changes this value</span>
<span class="s1">   &#39;</span><span class="w"> </span><span class="nx">every</span><span class="w"> </span><span class="nx">second</span><span class="p">.</span>
<span class="w">   </span><span class="nx">strTimer_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot; &quot;</span>
<span class="nx">Else</span>
<span class="w">   </span><span class="nx">strTimer_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Timer&quot;</span>
<span class="nx">End</span><span class="w"> </span><span class="nx">If</span>
<span class="nx">RW</span><span class="w"> </span><span class="s2">&quot;&lt;span id=&#39;spTimerSec&#39; name=&#39;spTimerSec&#39; style=&#39;color:#008080; font-size:10pt;&#39;&gt;&quot;</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="nx">strTimer_value</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="s2">&quot;&lt;/span&gt;&quot;</span>


<span class="s1">&#39; A hidden field that serves to test if the client has JavaScript enabled. Some script will</span>
<span class="s1">&#39;</span><span class="w"> </span><span class="k">try</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">change</span><span class="w"> </span><span class="k">this</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="nx">F</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">T</span><span class="p">.</span>
<span class="nx">RC</span><span class="w"> </span><span class="s2">&quot;&lt;input type=&#39;hidden&#39; name=&#39;jS&#39; id=&#39;jS&#39; value=&#39;F&#39;&gt;&quot;</span>

<span class="nx">RC</span><span class="w"> </span><span class="s2">&quot;&lt;/form&gt;&quot;</span>

<span class="nx">If</span><span class="w"> </span><span class="p">(</span><span class="nx">Request</span><span class="p">.</span><span class="nx">QueryString</span><span class="p">(</span><span class="s2">&quot;jS&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;F&quot;</span><span class="p">)</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">   </span><span class="nx">RBC</span><span class="w"> </span><span class="s2">&quot;JavaScript is needed to use the charting controls and view a chart image.&quot;</span>
<span class="w">   </span><span class="nx">RBC</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<span class="w">   </span><span class="nx">RBC</span><span class="w"> </span><span class="s2">&quot;Please enable JavaScript in your web browser. If you enable JavaScript, this warning&quot;</span>
<span class="w">   </span><span class="nx">RBC</span><span class="w"> </span><span class="s2">&quot;will clear after your second click of the press-to-chart button.&quot;</span>
<span class="w">   </span><span class="nx">RBC</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<span class="w">   </span><span class="nx">RBC</span><span class="w"> </span><span class="s2">&quot;Note that requesting a chart update before the previous chart has completed is another&quot;</span>
<span class="w">   </span><span class="nx">RBC</span><span class="w"> </span><span class="s2">&quot;possible cause for this error message. Please wait until the image returns from the&quot;</span>
<span class="w">   </span><span class="nx">RBC</span><span class="w"> </span><span class="s2">&quot;server.&quot;</span>
<span class="nx">Else</span>
<span class="w">   </span><span class="s1">&#39;=================================================================================</span>
<span class="s1">   &#39;</span><span class="w"> </span><span class="nx">PLOT</span><span class="w"> </span><span class="nx">THE</span><span class="w"> </span><span class="nx">CHART</span><span class="p">...</span>
<span class="w">   </span><span class="s1">&#39;</span>
<span class="s1">   &#39;</span><span class="w"> </span><span class="nx">If</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">region</span><span class="w"> </span><span class="nx">has</span><span class="w"> </span><span class="nx">been</span><span class="w"> </span><span class="nx">specified</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">query</span><span class="p">,</span><span class="w"> </span><span class="nx">then</span><span class="w"> </span><span class="nx">plot</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">chart</span><span class="p">.</span>
<span class="w">   </span><span class="s1">&#39;</span>
<span class="s1">   &#39;</span><span class="o">=================================================================================</span>
<span class="w">   </span><span class="nx">If</span><span class="w"> </span><span class="p">((</span><span class="nx">Request</span><span class="p">.</span><span class="nx">QueryString</span><span class="p">(</span><span class="s2">&quot;Region&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="w"> </span><span class="nx">and</span><span class="w"> </span><span class="p">(</span><span class="nx">strMRTime</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="s2">&quot;-&quot;</span><span class="p">))</span><span class="w"> </span><span class="nx">Then</span>
<span class="w">      </span><span class="nx">PlotTheChart</span>
<span class="w">   </span><span class="nx">Else</span>
<span class="w">      </span><span class="nx">RWBR</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<span class="w">      </span><span class="nx">RWBR</span><span class="w"> </span><span class="s2">&quot;The query has returned no data for the selected sensor and location.&quot;</span>
<span class="w">   </span><span class="nx">End</span><span class="w"> </span><span class="nx">If</span>
<span class="nx">End</span><span class="w"> </span><span class="nx">If</span>

<span class="s1">&#39; Close connection to the database</span>
<span class="s1">CloseDataConnection DBConnection</span>

<span class="s1">&#39;</span><span class="nx">RBC</span><span class="w"> </span><span class="s2">&quot;Testing&quot;</span>
<span class="s1">&#39;RBC &quot;Date = &quot; &amp; Request.QueryString(&quot;EndDate&quot;) </span>

<span class="s1">%&gt;</span>


<span class="s1">&lt;SCRIPT LANGUAGE=javascript RUNAT=Server&gt;</span>

<span class="s1">// Server Side Scripting in JavaScript</span>

<span class="s1">// Running average prototype (a class)</span>
<span class="s1">function RunningAverage( n_StackSize){</span>
<span class="s1">   this.queue = [];</span>
<span class="s1">   this.n_StackSize = n_StackSize;</span>
<span class="s1">   this.recordCount = 0;</span>
<span class="s1">   this.recordIndex = 0;</span>
<span class="s1">   </span>
<span class="s1">   this.reset = function( recordCount){</span>
<span class="s1">      this.queue = [];</span>
<span class="s1">      this.recordIndex = 0;</span>
<span class="s1">      this.recordCount = recordCount;</span>
<span class="s1">      //Response.write(&quot;////////////////////////////&lt;br&gt;&lt;br&gt;&quot;);</span>
<span class="s1">   }</span>
<span class="s1">   </span>
<span class="s1">   this.update = function( newValue){</span>
<span class="s1">      var total = 0;</span>
<span class="s1">      var n_FromEnd = 0;</span>
<span class="s1">      var average = 0;</span>
<span class="s1">      this.recordIndex = this.recordIndex + 1;</span>
<span class="s1">      </span>
<span class="s1">      //Add one to the top.</span>
<span class="s1">      this.queue.push( newValue);</span>
<span class="s1">      </span>
<span class="s1">      //Scrape one off the bottom.</span>
<span class="s1">      if (this.queue.length &gt; this.n_StackSize) {</span>
<span class="s1">         this.queue.shift();</span>
<span class="s1">         //Response.write(&quot;Normal: one from bottom.&lt;br&gt;&quot;);   </span>
<span class="s1">      } </span>
<span class="s1">           </span>
<span class="s1">      // As the record index approaches the end of the recordset, gradually turn</span>
<span class="s1">      // off the running average (empty out the bottom of the queue). This causes</span>
<span class="s1">      // the last value in the running average to equal the latest reading.</span>
<span class="s1">      </span>
<span class="s1">      //Hmmmm, the need for this &quot;+ 1&quot; here is a nagging mystery.</span>
<span class="s1">      n_FromEnd = (this.recordCount + 1) - this.recordIndex;  </span>
<span class="s1">      if (n_FromEnd == this.n_StackSize-2) {</span>
<span class="s1">         // Take only one (additional) off.</span>
<span class="s1">         this.queue.shift();   </span>
<span class="s1">         //Response.write(&quot;Special: one from bottom.&lt;br&gt;&quot;);   </span>
<span class="s1">         </span>
<span class="s1">      //} else if ((n_FromEnd &gt;= 0) &amp;&amp; (n_FromEnd &lt; this.n_StackSize-2)){</span>
<span class="s1">      } else if (n_FromEnd &lt; this.n_StackSize-2){</span>
<span class="s1">      </span>
<span class="s1">         // Take two off the bottom (because the normal bottom scraping won&#39;</span><span class="nx">t</span>
<span class="w">         </span><span class="c1">// be triggered as the queue size diminishes).</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">queue</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>
<span class="w">         </span><span class="k">this</span><span class="p">.</span><span class="nx">queue</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>
<span class="w">         </span><span class="c1">//Response.write(&quot;Special: two from bottom.&lt;br&gt;&quot;);   </span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span>
<span class="w">      </span><span class="c1">//Sum the values.</span>
<span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">queue</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="nx">total</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">queue</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span><span class="w"> </span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span>
<span class="w">      </span><span class="nx">average</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">total</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">queue</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
<span class="w">      </span>
<span class="w">      </span><span class="c1">// Debug statements.</span>
<span class="w">      </span><span class="c1">//Response.write(&quot;--New=&quot; + newValue + &quot;--T=&quot; + total + &quot;--L=&quot; + this.queue.length + &quot;--A=&quot; + average + </span>
<span class="w">      </span><span class="c1">//               &quot;--n_FEnd=&quot; + n_FromEnd + &quot;--Index=&quot; + this.recordIndex + &quot;---RC=&quot; + this.recordCount + &quot;&lt;br&gt;\n&quot;);</span>
<span class="w">    </span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nx">average</span><span class="p">;</span>
<span class="w">   </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Running average prototype for direction data (using components);</span>
<span class="kd">function</span><span class="w"> </span><span class="nx">RunningAverage_Dir</span><span class="p">(</span><span class="w"> </span><span class="nx">n_StackSize</span><span class="p">){</span>
<span class="w">   </span><span class="k">this</span><span class="p">.</span><span class="nx">n_StackSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">n_StackSize</span><span class="p">;</span>
<span class="w">   </span><span class="c1">// Instantiate a running average for each of the components.</span>
<span class="w">   </span><span class="k">this</span><span class="p">.</span><span class="nx">RA_x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">RunningAverage</span><span class="p">(</span><span class="w"> </span><span class="nx">n_StackSize</span><span class="p">);</span>
<span class="w">   </span><span class="k">this</span><span class="p">.</span><span class="nx">RA_y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">RunningAverage</span><span class="p">(</span><span class="w"> </span><span class="nx">n_StackSize</span><span class="p">);</span>
<span class="w">   </span>
<span class="w">   </span><span class="k">this</span><span class="p">.</span><span class="nx">reset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="w"> </span><span class="nx">recordCount</span><span class="p">){</span>
<span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">RA_x</span><span class="p">.</span><span class="nx">reset</span><span class="p">(</span><span class="w"> </span><span class="nx">recordCount</span><span class="p">);</span>
<span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">RA_y</span><span class="p">.</span><span class="nx">reset</span><span class="p">(</span><span class="w"> </span><span class="nx">recordCount</span><span class="p">);</span>
<span class="w">   </span><span class="p">}</span><span class="w">   </span>
<span class="w">   </span>
<span class="w">   </span><span class="k">this</span><span class="p">.</span><span class="nx">update</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="w"> </span><span class="nx">newDir_deg</span><span class="p">){</span>
<span class="w">      </span><span class="c1">// Determine the components of a unit vector at the specified direction</span>
<span class="w">      </span><span class="c1">// in radians.</span>
<span class="w">      </span><span class="kd">var</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="w"> </span><span class="nx">newDir_deg</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="o">/</span><span class="mf">180.0</span><span class="p">)</span><span class="w"> </span><span class="p">);</span>
<span class="w">      </span><span class="kd">var</span><span class="w"> </span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">sin</span><span class="p">(</span><span class="w"> </span><span class="nx">newDir_deg</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="o">/</span><span class="mf">180.0</span><span class="p">)</span><span class="w"> </span><span class="p">);</span>
<span class="w">   </span>
<span class="w">      </span><span class="c1">// Add each component to a the running average.</span>
<span class="w">      </span><span class="kd">var</span><span class="w"> </span><span class="nx">x_avg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">RA_x</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="w"> </span><span class="nx">x</span><span class="p">);</span>
<span class="w">      </span><span class="kd">var</span><span class="w"> </span><span class="nx">y_avg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">RA_y</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="w"> </span><span class="nx">y</span><span class="p">);</span>
<span class="w">      </span>
<span class="w">      </span><span class="c1">// Determine the average angle from the running averages of the components. </span>
<span class="w">      </span><span class="kd">var</span><span class="w"> </span><span class="nx">averageDir_deg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">atan2</span><span class="p">(</span><span class="w"> </span><span class="nx">y_avg</span><span class="p">,</span><span class="w"> </span><span class="nx">x_avg</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="mf">180.0</span><span class="o">/</span><span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="p">);</span>
<span class="w">      </span>
<span class="w">      </span><span class="c1">// Transform the output so that all directions are positive.</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">averageDir_deg</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">averageDir_deg_corrected</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">averageDir_deg</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">360.0</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="kd">var</span><span class="w"> </span><span class="nx">averageDir_deg_corrected</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">averageDir_deg</span><span class="w"> </span><span class="o">+</span><span class="w">   </span><span class="mf">0.0</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">            </span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nx">averageDir_deg_corrected</span><span class="p">;</span>
<span class="w">   </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">instantiateRunningAverages</span><span class="p">(</span><span class="w"> </span><span class="nx">traceName</span><span class="p">){</span>
<span class="w">   </span><span class="c1">// Make two running average objects for the chart, each a 3-point average.   </span>
<span class="w">   </span>
<span class="w">   </span><span class="c1">// Set the number of points in the running average.</span>
<span class="w">   </span><span class="kd">var</span><span class="w"> </span><span class="nx">nPoints</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">3</span><span class="p">;</span>
<span class="w">   </span>
<span class="w">   </span><span class="c1">// These instantiated objects have global scope if the &quot;var&quot; word is not used </span>
<span class="w">   </span><span class="c1">// in the assignment.</span>
<span class="w">   </span><span class="nx">RA_x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">RunningAverage</span><span class="p">(</span><span class="w"> </span><span class="nx">nPoints</span><span class="p">);</span><span class="w">  </span>
<span class="w">   </span>
<span class="w">   </span><span class="c1">// Use a special running average for the wind-direction data.</span>
<span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">traceName</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">&#39;WindDirection&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">RA_y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">RunningAverage_Dir</span><span class="p">(</span><span class="w"> </span><span class="nx">nPoints</span><span class="p">);</span>
<span class="w">   </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">RA_y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">RunningAverage</span><span class="p">(</span><span class="w"> </span><span class="nx">nPoints</span><span class="p">);</span>
<span class="w">   </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1">// This function determines if the supplied date is within daylight savings time.</span>
<span class="c1">// It does this by comparing the difference between local time and GMT. This difference</span>
<span class="c1">// is 5 hours (in the central time zone) during daylight savings time.</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">dayLightSavingsTime</span><span class="p">(</span><span class="w"> </span><span class="nx">dateToCheck</span><span class="w"> </span><span class="p">){</span>
<span class="w">   </span><span class="kd">var</span><span class="w"> </span><span class="nx">dateObjectToCheck</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="w"> </span><span class="nx">dateToCheck</span><span class="p">);</span>
<span class="w">   </span><span class="c1">// Return true/false</span>
<span class="w">   </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="nx">dateObjectToCheck</span><span class="p">.</span><span class="nx">getTimezoneOffset</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">5</span><span class="o">*</span><span class="mf">60</span><span class="p">);</span>
<span class="p">}</span>

<span class="o">&lt;</span><span class="err">/SCRIPT&gt;</span>



<span class="c">&lt;!--</span><span class="w">  </span><span class="nx">Client</span><span class="w"> </span><span class="nx">side</span><span class="w"> </span><span class="nx">script</span><span class="w"> </span><span class="o">--&gt;</span>
<span class="o">&lt;</span><span class="nx">SCRIPT</span><span class="w"> </span><span class="nx">LANGUAGE</span><span class="o">=</span><span class="s2">&quot;javascript&quot;</span><span class="o">&gt;</span>
<span class="c">&lt;!--</span>

<span class="c1">//Globals</span>

<span class="kd">var</span><span class="w"> </span><span class="nx">cP</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;ChartingParameters&#39;</span><span class="p">);</span>

<span class="kd">var</span><span class="w"> </span><span class="nx">cmbEndDate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;EndDate&#39;</span><span class="p">);</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">cmbDays</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;Days&#39;</span><span class="p">);</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">cmbLocation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;Location&#39;</span><span class="p">);</span>

<span class="kd">var</span><span class="w"> </span><span class="nx">stepIncrement</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cmbDays</span><span class="p">.</span><span class="nx">options</span><span class="p">[</span><span class="nx">cmbDays</span><span class="p">.</span><span class="nx">selectedIndex</span><span class="p">].</span><span class="nx">text</span><span class="p">;</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">testJS</span><span class="p">(){</span>
<span class="w">   </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;jS&#39;</span><span class="p">).</span><span class="nx">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;T&#39;</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">showDirections</span><span class="p">(){</span>
<span class="w">   </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kd">var</span><span class="w"> </span><span class="nx">imgDirections</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;directions&#39;</span><span class="p">);</span>
<span class="w">      </span><span class="nx">imgDirections</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">visibility</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;visible&#39;</span><span class="p">;</span>
<span class="w">   </span><span class="p">}</span>
<span class="w">   </span><span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">){}</span>
<span class="p">}</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">showImage</span><span class="p">(){</span>
<span class="w">   </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kd">var</span><span class="w"> </span><span class="nx">imgChartImage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;chartimage&#39;</span><span class="p">);</span>
<span class="w">      </span><span class="nx">imgChartImage</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">visibility</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;visible&#39;</span><span class="p">;</span>
<span class="w">   </span><span class="p">}</span>
<span class="w">   </span><span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">){}</span>
<span class="p">}</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">changeColorSubmitButton</span><span class="p">(){</span>
<span class="w">   </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;myButton&#39;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">submitform</span><span class="p">(){</span>
<span class="w">   </span><span class="c1">//document.getElementById(&#39;Sensor&#39;).style.backgroundColor=&#39;#FFE4C4&#39;;</span>
<span class="w">   </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;myButton&#39;</span><span class="p">).</span><span class="nx">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Please Wait&#39;</span><span class="p">;</span>
<span class="w">   </span><span class="nx">cP</span><span class="p">.</span><span class="nx">submit</span><span class="p">();</span>
<span class="p">}</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">stepLocationForward</span><span class="p">(){</span>
<span class="w">   </span><span class="kd">var</span><span class="w"> </span><span class="nx">targetIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cmbLocation</span><span class="p">.</span><span class="nx">selectedIndex</span><span class="p">;</span>
<span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">targetIndex</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="p">(</span><span class="nx">cmbLocation</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1</span><span class="p">)){</span>
<span class="w">      </span><span class="nx">cmbLocation</span><span class="p">.</span><span class="nx">selectedIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">targetIndex</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>
<span class="w">   </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">cmbLocation</span><span class="p">.</span><span class="nx">selectedIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">   </span><span class="p">}</span>
<span class="w">   </span><span class="nx">submitform</span><span class="p">();</span>
<span class="p">}</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">stepBack</span><span class="p">(){</span>
<span class="w">   </span><span class="kd">var</span><span class="w"> </span><span class="nx">targetIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cmbEndDate</span><span class="p">.</span><span class="nx">selectedIndex</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">stepIncrement</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1.0</span><span class="p">);</span>
<span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">targetIndex</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="nx">cmbEndDate</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1</span><span class="p">)){</span>
<span class="w">      </span><span class="nx">cmbEndDate</span><span class="p">.</span><span class="nx">selectedIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cmbEndDate</span><span class="p">.</span><span class="nx">selectedIndex</span><span class="p">;</span>
<span class="w">   </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">cmbEndDate</span><span class="p">.</span><span class="nx">selectedIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">targetIndex</span><span class="p">;</span>
<span class="w">   </span><span class="p">}</span>
<span class="w">   </span><span class="nx">submitform</span><span class="p">();</span><span class="w">   </span>
<span class="p">}</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">stepForward</span><span class="p">(){</span>
<span class="w">   </span><span class="kd">var</span><span class="w"> </span><span class="nx">targetIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cmbEndDate</span><span class="p">.</span><span class="nx">selectedIndex</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="nx">stepIncrement</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1.0</span><span class="p">);</span>
<span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">targetIndex</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0</span><span class="p">){</span>
<span class="w">      </span><span class="nx">cmbEndDate</span><span class="p">.</span><span class="nx">selectedIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">   </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nx">cmbEndDate</span><span class="p">.</span><span class="nx">selectedIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">targetIndex</span><span class="p">;</span>
<span class="w">   </span><span class="p">}</span>
<span class="w">   </span><span class="nx">submitform</span><span class="p">();</span><span class="w">   </span>
<span class="p">}</span>

<span class="c1">//Timer functions</span>

<span class="kd">var</span><span class="w"> </span><span class="nx">secs</span><span class="p">;</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">timerID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">timerRunning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">delay</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1000</span><span class="p">;</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">initializeTimer</span><span class="p">(</span><span class="nx">secsFromChart</span><span class="p">){</span>

<span class="w">   </span><span class="c1">// Set the length of the timer, in seconds</span>
<span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">secsFromChart</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">){</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">timerRunning</span><span class="p">){</span>
<span class="w">         </span><span class="nx">secs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">secs</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">5</span><span class="p">;</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">secs</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">0</span><span class="p">){</span><span class="w"> </span>
<span class="w">            </span><span class="nx">secs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">3</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span><span class="k">else</span><span class="p">{</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">secs</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">){</span>
<span class="w">            </span><span class="nx">secs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">298</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">   </span><span class="p">}</span><span class="k">else</span><span class="p">{</span>
<span class="w">      </span><span class="nx">secs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">secsFromChart</span><span class="p">;</span><span class="w">   </span>
<span class="w">   </span><span class="p">}</span>
<span class="w">    </span>
<span class="w">   </span><span class="nx">stopTheTimer</span><span class="p">();</span>
<span class="w">   </span><span class="nx">startTheTimer</span><span class="p">();</span>
<span class="p">}</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">stopTheTimer</span><span class="p">(){</span>

<span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">timerRunning</span><span class="p">){</span>
<span class="w">      </span><span class="nx">clearTimeout</span><span class="p">(</span><span class="nx">timerID</span><span class="p">);</span>
<span class="w">      </span><span class="nx">timerRunning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w"> </span>
<span class="w">      </span><span class="c1">// This color change was used when there was a pause mode.</span>
<span class="w">      </span><span class="c1">//document.getElementById(&#39;spTimerSec&#39;).style.color = &#39;red&#39;;</span>
<span class="w">   </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">startTheTimer</span><span class="p">(){</span>

<span class="w">   </span><span class="c1">//Reset the color back to normal.</span>
<span class="w">   </span><span class="c1">//document.getElementById(&#39;spTimerSec&#39;).style.color = &#39;#008080&#39;;</span>

<span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">secs</span><span class="o">==</span><span class="mf">0</span><span class="p">){</span>
<span class="w">      </span><span class="c1">//stopTheTimer();</span>
<span class="w">        </span>
<span class="w">      </span><span class="c1">// Here&#39;s where you put something useful that&#39;s</span>
<span class="w">      </span><span class="c1">// executes after the allotted time.</span>
<span class="w">      </span><span class="nx">submitform</span><span class="p">();</span>
<span class="w">    </span>
<span class="w">   </span><span class="p">}</span><span class="k">else</span><span class="p">{</span>
<span class="w">      </span><span class="nx">self</span><span class="p">.</span><span class="nx">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">secs</span><span class="p">;</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">secs</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">10</span><span class="p">){</span>
<span class="w">         </span><span class="nx">secs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">secs</span><span class="p">;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;spTimerSec&#39;</span><span class="p">).</span><span class="nx">firstChild</span><span class="p">.</span><span class="nx">nodeValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">secs</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39;s.&#39;</span><span class="p">;</span>
<span class="w">      </span><span class="nx">secs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">secs</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span>

<span class="w">      </span><span class="nx">timerRunning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">      </span><span class="nx">timerID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">self</span><span class="p">.</span><span class="nx">setTimeout</span><span class="p">(</span><span class="s2">&quot;startTheTimer()&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">delay</span><span class="p">);</span>
<span class="w">   </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">changeRegionAnchorValue</span><span class="p">(</span><span class="w"> </span><span class="nx">theInputString</span><span class="p">){</span>
<span class="w">   </span><span class="c1">//window.alert( theInputString);</span>
<span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">theInputString</span><span class="o">==</span><span class="s1">&#39;MN&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;regionanchor&#39;</span><span class="p">).</span><span class="nx">firstChild</span><span class="p">.</span><span class="nx">nodeValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Columbia Basin Weather&#39;</span><span class="p">;</span>
<span class="w">   </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">theInputString</span><span class="o">==</span><span class="s1">&#39;CR&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;regionanchor&#39;</span><span class="p">).</span><span class="nx">firstChild</span><span class="p">.</span><span class="nx">nodeValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Minnesota Weather&#39;</span><span class="p">;</span>
<span class="w">   </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;regionanchor&#39;</span><span class="p">).</span><span class="nx">firstChild</span><span class="p">.</span><span class="nx">nodeValue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">theInputString</span><span class="p">;</span>
<span class="w">   </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">setRegionState</span><span class="p">(){</span>
<span class="w">   </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;Region_state&#39;</span><span class="p">).</span><span class="nx">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;new&#39;</span><span class="p">;</span>
<span class="w">   </span><span class="nx">submitform</span><span class="p">();</span><span class="w"> </span>
<span class="p">}</span>

<span class="c1">//--&gt;</span>
<span class="o">&lt;</span><span class="err">/SCRIPT&gt;</span>
<span class="o">&lt;</span><span class="err">/div&gt;</span>
<span class="o">&lt;</span><span class="err">/body&gt;</span>
<span class="o">&lt;</span><span class="err">/html&gt;</span>
</pre></div>
</body>
</html>
